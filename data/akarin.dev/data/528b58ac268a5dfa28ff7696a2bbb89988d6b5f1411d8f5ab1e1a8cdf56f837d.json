{
  "Source": "akarin.dev",
  "Title": "搞事情：用“图床”传视频，自带免费 CDN 加速（已失效，科普向）",
  "Link": "https://akarin.dev/2020/02/07/alicdn-video-hosting/",
  "Content": "\u003carticle class=\"mdui-p-a-3 mdui-card-content mdui-typo\"\u003e\u003cp\u003e更新：目前 \u003ccode\u003ehttps://kfupload.alibaba.com/mupload\u003c/code\u003e 这个上传接口已经失效了，不过仍然还有很多视频网站正在使用类似的方法通过其他的接口上传视频。这篇文章似乎被转发到了很多地方，如果你想要了解这类网站上传和使用视频切片的原理的话，把这篇作为科普向倒也不错？\u003c/p\u003e\u003cp\u003e在开头位置先推荐一下 \u003ca href=\"https://bottle.moe/\" target=\"_blank\" rel=\"noopener\"\u003e@SomeBottle\u003c/a\u003e 发布在自己博客上的教程\u003ca href=\"https://bottle.moe/post-269.html\" target=\"_blank\" rel=\"noopener\"\u003e《用图床看视频的体验·改》\u003c/a\u003e，非常详细，在这篇教程的基础上补充了包括“iOS 环境下如何播放”在内的很多东西～\u003c/p\u003e\u003cdetails\u003e\u003csummary\u003e之前的更新\u003c/summary\u003e\u003cp\u003e目前 alicdn 似乎又取消了文件格式检测，仍然可以像之前一样上传非图片类型的文件，只需要上传时填写文件名的那个字段使用图片的扩展名即可～\u003c/p\u003e\u003cp\u003e但是\u003cstrong\u003e不能上传 TS\u003c/strong\u003e，估计是被视频床的事情弄怕了 2333\u003c/p\u003e\u003cp\u003e当然还是有办法绕过这个限制。HLS 协议支持使用加密，操作方法是将所有的 TS 使用某个密钥和 IV 通过 AES-128-CBC 进行加密，然后将密钥以二进制写入文件中并上传，在 M3U8 中添加字段 \u003ccode\u003e#EXT-X-KEY\u003c/code\u003e 写上密钥文件的 URL 和 IV。加密以后的文件就不是 TS 了，仍然可以正常上传 | ू•ૅω•́)\u003c/p\u003e\u003cp\u003e在之前的上传脚本上改一改就可以进行加密了，至于怎么改？请独立完成作业（逃\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://jsbin.com/nonubudeli/edit?html,output\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e是演示。代码完全复制自 hls.js 的\u003ca href=\"https://github.com/video-dev/hls.js#getting-started\" target=\"_blank\" rel=\"noopener\"\u003e示例\u003c/a\u003e，所以在 iOS 上大概也能播放……？\u003c/p\u003e\u003chr/\u003e\u003cp\u003e\u003cstrong\u003e\u003cdel\u003e由于添加了文件格式检测，该方法已失效。\u003c/del\u003e\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e\u003cdel\u003e上传图片仍然是没问题的（不包括 WebP），但是无法再上传新的非图片文件，视频当然也不行了┐(´-｀)┌\u003c/del\u003e\u003c/p\u003e\u003cp\u003e另外现在获取文件时\u003cstrong\u003e有极低概率出现 429 错误\u003c/strong\u003e，如果介意的话建议更换其它图床 (=’_‘=)\u003c/p\u003e\u003cp\u003e传视频的替代品：\u003ca href=\"https://catbox.moe/\" target=\"_blank\" rel=\"noopener\"\u003eCatbox\u003c/a\u003e，Onedrive 5TB 配合\u003ca href=\"https://www.52pojie.cn/thread-1070131-1-1.html\" target=\"_blank\" rel=\"noopener\"\u003e直链生成工具\u003c/a\u003e，或许还有下一个不会检测文件格式的图床……？\u003c/p\u003e\u003chr/\u003e\u003cp\u003e一种理论上可行的方法：\u003c/p\u003e\u003cp\u003e众所周知，很多文件格式都有文件头和文件尾，解码图片时会直接\u003cstrong\u003e无视图片的文件尾之后的数据\u003c/strong\u003e。以前在网上经常会流传的“图种”就是利用了这个原理，在图片后面加上压缩包的数据即可在各大论坛上直接发送，压缩软件打开“图种”的时候又会无视压缩包文件头之前的数据，所以不影响正常打开。\u003c/p\u003e\u003cp\u003e利用这个手段同样可以解决文件格式检测的问题，只要用一个尽可能小的 1x1 的图片放在 TS 切片前面就可以在\u003cstrong\u003e任意图床\u003c/strong\u003e（只要不进行二压）正常上传了。至于播放……只考虑在网页上播放视频的话，hls.js 也支持\u003ca href=\"https://github.com/video-dev/hls.js/blob/master/docs/API.md#loader\" target=\"_blank\" rel=\"noopener\"\u003e对获取切片的 loader 进行重写\u003c/a\u003e，因此可以在这里把文件开头的那张图片去掉，应该就可以正常播放视频了～\u003c/p\u003e\u003cp\u003e\u003cdel\u003e由于 iOS 本身就支持播放 HLS，而且并不能使用 hls.js，因此无法在获取视频切片这一步上动手脚，所以这个办法\u003cstrong\u003e在 iOS 上是无法使用的\u003c/strong\u003e……\u003c/del\u003e\u003c/p\u003e\u003cp\u003e通过 M3U8 格式的 \u003ccode\u003e#EXT-X-BYTERANGE\u003c/code\u003e 字段似乎可以绕过？\u003c/p\u003e\u003cp\u003e\u003cdel\u003e占坑，写出来以后再更新（咕咕咕）\u003c/del\u003e\u003c/p\u003e\u003cp\u003e测试成功(σ′▽‵)′▽‵)σ \u003ca href=\"https://jsbin.com/qiqugiyeko/edit?html,output\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e是演示，具体操作方法请翻到\u003ca href=\"#%E5%9C%A8%E5%BC%80%E5%A7%8B%E6%A3%80%E6%B5%8B%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E4%B9%8B%E5%90%8E%E2%80%A6%E2%80%A6\"\u003e最后\u003c/a\u003e～\u003c/p\u003e\u003c/details\u003e\u003chr/\u003e\u003cblockquote\u003e\u003cp\u003e封面图：\u003ca href=\"https://www.pixiv.net/artworks/78997162\" target=\"_blank\" rel=\"noopener\"\u003ePixiv ID: 78997162 「綾あか」 by うめか\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003e先说结论，作为测试翻出了硬盘里的 LL 的四个多小时的 Final Live，自己压制成 720p 和 360p 后上传到“图床”上，播放非常流畅，一点问题都没有～\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://jsbin.com/catagatuyi/edit?html,output\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e是演示| ᐕ)୨ 需要自动上传脚本的可以直接翻到最后。\u003c/p\u003e\u003ch1 id=\"“非公开”的图床？\"\u003e\u003ca href=\"#“非公开”的图床？\" class=\"headerlink\" title=\"“非公开”的图床？\"\u003e\u003c/a\u003e“非公开”的图床？\u003c/h1\u003e\u003cp\u003e图床这种东西一抓一大把，比如 \u003ca href=\"https://sm.ms/\" target=\"_blank\" rel=\"noopener\"\u003eSM.MS\u003c/a\u003e 之类的图床本身就是用来提供图片外链服务的。\u003c/p\u003e\u003cp\u003e那……难道还有用途不是图片外链的图床吗？其实是有的(´ﾟωﾟ｀)\u003c/p\u003e\u003cp\u003e比如说最知名的图床：\u003cstrong\u003e微博图床\u003c/strong\u003e，因为使用简单（各种轮子足够多）、速度快（真・全球 CDN 加速）、有保障（在可见的相当一段长的时间内微博几乎不可能关闭）而被广泛使用，虽然也有强制二压图片、给图片加水印的不足之处……不过对于这种免费的“服务”，不能要求太多？\u003c/p\u003e\u003cp\u003e但是微博显然不是专门做图床的，它只是个社交网站。据说是因为发微博的时候上传图片的接口存在漏洞，已登录用户只要选择了图片就会立刻上传（不论有没有发送微博），而且这个接口只需要已登录用户的 Cookie，上传图片得到的 URL 直接拿去外链也不会有“该图片来自……未经允许不可引用”之类的提示，于是就被拿来当图床使用了(　ε:)\u003c/p\u003e\u003cp\u003e甚至还出现了一些图床，号称“全球 CDN 加速”、“图片永久储存”、“高速稳定”，实际上后端对接的也是微博图床，这就有点那啥……不过至少也是提供了一个上传工具嘛（摊手\u003c/p\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/1217*998),998px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/c7b41f87aadbda2fa2bd73ad3975f4b0/zT56RNCl.png\" data-src-webp=\"https://p.sda1.dev/12/8dfdfe6c78e3a32335c8c3a65c8fe6d4/b1RlaAab.webp\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAaACADASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAUBB//EACkQAAEEAQMCBAcAAAAAAAAAAAEAAgMRMQQSIRMiFCQ0YUFScYGRobH/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/EABYRAQEBAAAAAAAAAAAAAAAAAAABIf/aAAwDAQACEQMRAD8A79NA1kUjm5NcEoLHa0gANa7OE7UV0X2LFYUlo0oPdBODjt2KwM88MxBJiZMa6rQOLJBwjxzwU31OaokcfgpTAzcKMn33V+0oyc1E879vuiQal4utZCfZ7kzVenkUayW8n4hBY8RITXW02fmWtfudxIw1kDP9QIQ0zNBAItPDGAghoB+imD//2Q\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/c7b41f87aadbda2fa2bd73ad3975f4b0/zT56RNCl.png\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003cp\u003e由此可见，一个图片上传接口只要满足以下几点，就有被拿去\u003cdel\u003e薅羊毛\u003c/del\u003e作为图床的可能：\u003c/p\u003e\u003col\u003e\u003cli\u003e没有添加\u003cstrong\u003e防盗链\u003c/strong\u003e措施\u003c/li\u003e\u003cli\u003e上传图片无须复杂的身份验证，甚至允许\u003cstrong\u003e匿名上传\u003c/strong\u003e\u003c/li\u003e\u003cli\u003e不限制图片的上传次数\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e比如\u003ca href=\"https://blog.cmcncm.cn/2019/03/26/image-hosting/\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e就列举了一大堆符合以上条件的“非公开”图床（部分已失效），谁能想到一个图片搜索功能都可以拿来做图床的？！\u003c/p\u003e\u003ch1 id=\"如果还认为“检查文件格式-检查扩展名”的话……\"\u003e\u003ca href=\"#如果还认为“检查文件格式-检查扩展名”的话……\" class=\"headerlink\" title=\"如果还认为“检查文件格式 === 检查扩展名”的话……\"\u003e\u003c/a\u003e如果还认为“检查文件格式 === 检查扩展名”的话……\u003c/h1\u003e\u003cp\u003e这次\u003cdel\u003e要被玩坏的\u003c/del\u003e主角就是上面那个连接里提到过的福报厂的图片上传接口，也是本站一直在使用的接口(｡•̀ᴗ-)✧\u003c/p\u003e\u003cp\u003e先说明一下调用方法，以及总结一下它的属性：\u003c/p\u003e\u003cp\u003e\u003ccode\u003ehttps://kfupload.alibaba.com/mupload\u003c/code\u003e\u003c/p\u003e\u003cdiv class=\"mdui-shadow-0 mdui-table-fluid\"\u003e\u003ctable class=\"mdui-table mdui-table-hoverable\"\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003ePOST 参数\u003c/th\u003e\u003cth\u003e类型\u003c/th\u003e\u003cth\u003e说明\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e\u003ccode\u003efile\u003c/code\u003e\u003c/td\u003e\u003ctd\u003eFile\u003c/td\u003e\u003ctd\u003e文件的二进制数据\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/td\u003e\u003ctd\u003eString\u003c/td\u003e\u003ctd\u003e文件名\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e\u003ccode\u003escene\u003c/code\u003e\u003c/td\u003e\u003ctd\u003eString\u003c/td\u003e\u003ctd\u003e固定为 \u003ccode\u003eaeMessageCenterV2ImageRule\u003c/code\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003e支持 JPG、PNG、GIF 格式（？）\u003c/li\u003e\u003cli\u003e文件大小限制为 5MB\u003c/li\u003e\u003cli\u003e不会对图片（？）进行二压\u003c/li\u003e\u003cli\u003e无需身份验证\u003c/li\u003e\u003cli\u003e没有上传频率限制，大概吧\u003cspan style=\"opacity:.2\"\u003e（连续上传过数百个文件也没被封 IP 什么的）\u003c/span\u003e\u003c/li\u003e\u003cli\u003e没有图片内容审核，大概吧\u003cspan style=\"opacity:.2\"\u003e（上传过一张“好孩子看不见”的图片，观察了至少半个月也没被删除）\u003c/span\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e返回数据示例：\u003c/p\u003e\u003cpre class=\"line-numbers language-none\"\u003e\u003ccode class=\"language-none\"\u003e{\n    \u0026#34;fs_url\u0026#34;: \u0026#34;H2db4a9284928493eb92b0676277dc60a3.jpg\u0026#34;,\n    \u0026#34;code\u0026#34;: \u0026#34;0\u0026#34;,\n    \u0026#34;size\u0026#34;: \u0026#34;42585\u0026#34;,\n    \u0026#34;width\u0026#34;: \u0026#34;960\u0026#34;,\n    \u0026#34;url\u0026#34;: \u0026#34;https://ae01.alicdn.com/kf/H2db4a9284928493eb92b0676277dc60a3.jpg\u0026#34;,\n    \u0026#34;hash\u0026#34;: \u0026#34;26e29271d884f443e3e2660decd3776b\u0026#34;,\n    \u0026#34;height\u0026#34;: \u0026#34;540\u0026#34;\n}\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cdel\u003e所有的数据居然都是\u003cstrong\u003e字符串\u003c/strong\u003e类型，这是坠痛苦的\u003c/del\u003e\u003c/p\u003e\u003cp\u003e看上去是很正常的图片上传接口，但是实际上它对于文件格式的检测仅仅是根据\u003cstrong\u003e扩展名\u003c/strong\u003e（也就是 \u003ccode\u003ename\u003c/code\u003e 字段）。也就是说，只要\u003cstrong\u003e随便选择\u003c/strong\u003e一个 5MB 以内的文件，然后上传时在 \u003ccode\u003ename\u003c/code\u003e 字段\u003cstrong\u003e写上图片的文件名\u003c/strong\u003e（比如 \u003ccode\u003eimage.jpg\u003c/code\u003e），仍然可以正常上传！(๑˙ー˙๑)\u003c/p\u003e\u003cp\u003e比如 \u003ca href=\"https://ae01.alicdn.com/kf/Hcb7a3052f6894bfab549f41d324a68dbR.jpg\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003ehttps://ae01.alicdn.com/kf/Hcb7a3052f6894bfab549f41d324a68dbR.jpg\u003c/code\u003e\u003c/a\u003e 这个链接，看上去是 JPG 图片，打开后却无法显示。如果下载下来然后将扩展名改成 \u003ccode\u003em4a\u003c/code\u003e 的话……实际上是一个音频文件啦～\u003c/p\u003e\u003cp\u003e利用这个漏洞就可以实现上传\u003cstrong\u003e任意类型\u003c/strong\u003e的文件了，比如这个接口本来不支持上传 WebP 图片，但是通过改扩展名就可以解决（本站的 WebP 图片也是用这种方式上传的）。不过对于视频文件来说，其文件大小通常都在数十或数百 MB，甚至以 GB 为单位的数量级上，5 MB 的大小限制显然是不够用的（除非是○手、○音上的那些短视频……），那还能怎么办呢……\u003c/p\u003e\u003ch1 id=\"视频分片上传基本原理\"\u003e\u003ca href=\"#视频分片上传基本原理\" class=\"headerlink\" title=\"视频分片上传基本原理\"\u003e\u003c/a\u003e视频分片上传基本原理\u003c/h1\u003e\u003cp\u003e压缩包有分卷压缩，视频也可以拆成好几段然后然后组合到一起再播放，具体的实现手段就是 HLS 协议了。\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003eHTTP Live Streaming（缩写是 HLS）是由苹果公司提出基于 HTTP 的流媒体网络传输协议。是苹果公司 QuickTime X 和 iPhone 软件系统的一部分。\u003c/p\u003e\u003cp\u003e它的工作原理是\u003cstrong\u003e把整个流分成一个个小的基于 HTTP 的文件\u003c/strong\u003e来下载，每次只下载一些。当媒体流正在播放时，客户端可以选择从许多不同的备用源中以不同的速率下载同样的资源，允许流媒体会话适应不同的数据速率。\u003c/p\u003e\u003cp\u003e在开始一个流媒体会话时，客户端会下载一个包含元数据的 M3U8 文件，用于寻找可用的媒体流。\u003c/p\u003e\u003cp\u003e\u003cspan style=\"float:right\"\u003e\u003ca href=\"https://zh.wikipedia.org/wiki/HTTP_Live_Streaming\" target=\"_blank\" rel=\"noopener\"\u003e维基百科：HTTP Live Streaming\u003c/a\u003e\u003c/span\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003e播放 HLS 协议的视频流需要一个 M3U8 文件，这个文件按照一定格式存储了每一小段视频的 URL 以及时长。\u003c/p\u003e\u003cpre class=\"line-numbers language-none\"\u003e\u003ccode class=\"language-none\"\u003e#EXTM3U\n#EXT-X-VERSION:3\n#EXT-X-TARGETDURATION:10\n#EXT-X-MEDIA-SEQUENCE:0\n#EXTINF:5.000,\nhttp://tp-fad-files.huanxi.com/38c6b150aefe7a7150ce64b4f12f0538/1581043918/vod01/20200124/7cfe90e6-752b-4cba-87f0-10e2b188b007/4944/4944_1579831306_3865413_1505.ts\n#EXTINF:5.000,\nhttp://tp-fad-files.huanxi.com/34be054e87e4a7ad08609adaa42b53a7/1581043919/vod01/20200124/7cfe90e6-752b-4cba-87f0-10e2b188b007/4944/4944_1579831306_3631912_6505.ts\n\n...\n\n#EXTINF:5.000,\nhttp://tp-fad-files.huanxi.com/a467e02ed4c84cddcc72b4b8062bf46a/1581043919/vod01/20200124/7cfe90e6-752b-4cba-87f0-10e2b188b007/4944/4944_1579831388_4072629_7596505.ts\n#EXTINF:0.880,\nhttp://tp-fad-files.huanxi.com/05dfd6187eee5353498aafe175c7747e/1581043919/vod01/20200124/7cfe90e6-752b-4cba-87f0-10e2b188b007/4944/4944_1579831388_7758824_7601505.ts\n#EXT-X-ENDLIST\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e除此之外，HLS 协议也支持自适应切换视频流的功能。在 M3U8 里面再写上若干个视频流（也是 M3U8）的 URL，并给每个流标记上码率、分辨率、视频编码等数据（例如：\u003ccode\u003e#EXT-X-STREAM-INF:BANDWIDTH=1200000,RESOLUTION=640x360,CODECS=\u0026#34;avc1.42e00a,mp4a.40.2\u0026#34;,NAME=360p\u003c/code\u003e），这样客户端就可以根据网速和播放器的支持情况自动切换视频流。\u003c/p\u003e\u003cp\u003eHLS 使用到的 TS 视频文件，全称 Transport Stream，主要应用于实时传送视频数据，因此需要保证每个单独的 TS 都可以独立播放（相当于一个小的视频文件）。反过来，将若干个 TS 的二进制数据按顺序直接拼接到一起，就可以组成一个较长的视频。服务端源源不断地将视频数据转换为 TS 然后输出（可以把较早的 TS 删除），客户端不断获取 M3U8 文件来获取最新的几个 TS，这样就实现了视频直播；如果视频已经以 TS 形式保存在服务器上，也可以通过 HLS 依次获取然后播放，这样实现的就是视频点播。\u003c/p\u003e\u003cp\u003e只要能将自己手上的视频切割成 TS 然后逐个上传到“图床”，使用 HLS 协议不就能正常播放了吗！(੭ ˙ᗜ˙ )੭\u003c/p\u003e\u003ch1 id=\"准备上传\"\u003e\u003ca href=\"#准备上传\" class=\"headerlink\" title=\"准备上传\"\u003e\u003c/a\u003e准备上传\u003c/h1\u003e\u003cp\u003e目前在网页上播放视频的主流格式仍然是 MP4 封装的使用 H.264 + AAC 编码的视频文件，这里也只针对这种格式进行处理。\u003c/p\u003e\u003cp\u003e使用 FFmpeg 的两行命令就可以实现将视频转换为 TS，再对 TS 进行切割以及生成 M3U8 播放列表的工作：\u003c/p\u003e\u003cpre class=\"line-numbers language-bash\" data-language=\"bash\"\u003e\u003ccode class=\"language-bash\"\u003effmpeg \u003cspan class=\"token parameter variable\"\u003e-i\u003c/span\u003e video.mp4 \u003cspan class=\"token parameter variable\"\u003e-c\u003c/span\u003e copy \u003cspan class=\"token parameter variable\"\u003e-vbsf\u003c/span\u003e h264_mp4toannexb \u003cspan class=\"token parameter variable\"\u003e-absf\u003c/span\u003e aac_adtstoasc video.ts\nffmpeg \u003cspan class=\"token parameter variable\"\u003e-i\u003c/span\u003e video.ts \u003cspan class=\"token parameter variable\"\u003e-c\u003c/span\u003e copy \u003cspan class=\"token parameter variable\"\u003e-f\u003c/span\u003e segment \u003cspan class=\"token parameter variable\"\u003e-segment_list\u003c/span\u003e video.m3u8 %d.ts\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e因为是对视频直接进行分割，所以这个操作是无损的，不需要重新编码，速度非常快（唯一的限制是硬盘读写速度），对视频的画质也没有影响。执行后会在当前目录下生成一个 \u003ccode\u003evideo.m3u8\u003c/code\u003e 以及一大堆的 \u003ccode\u003e0.ts\u003c/code\u003e、\u003ccode\u003e1.ts\u003c/code\u003e……（忽略因为字符编码造成的乱码）\u003c/p\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/1703*968),968px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/5c53bb083678304cf00c2684b5e9f0f4/jLjqJEcR.jpg\" data-src-webp=\"https://p.sda1.dev/12/1d30b96920316637625c0ea1f2ba569e/xu30PL4b.webp\" data-src-avif=\"https://p.sda1.dev/12/1e846832a14c609e1258115ab92b71aa/mBsBqPyA.jpg\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAASACADASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYDBwgE/8QAJhAAAgICAAUDBQAAAAAAAAAAAQIDEQAEBQYVIjEHI1ESF2Fywf/EABcBAAMBAAAAAAAAAAAAAAAAAAACAwH/xAAbEQACAwADAAAAAAAAAAAAAAAAEQECQSExcf/aAAwDAQACEQMRAD8AZNj1U3E3ptToyMgneEuJq8MVy1dZD2gHytm8ytvl045tuGAC70hJNnw95oaDnblP6y6cR7Fjs+zLlL1SUCw3yMauxYD+fmsmdQEevNHET7g8nJKgfi1XRHsTfP6Y9MbU0D4xFJrgorf1NQ7+4TrRG55L7B85zrrawVgIIwCKICjDDLTngtuyHp3D2ZC2lAaqrjXNCYYZO+BTT//Z\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/5c53bb083678304cf00c2684b5e9f0f4/jLjqJEcR.jpg\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003cp\u003e使用 MPC-HC、VLC 等支持 HLS 的播放器打开 M3U8 就可以播放，如果将 TS 全部上传到“图床”然后用得到的 URL 替换掉 M3U8 里面的 \u003ccode\u003e0.ts\u003c/code\u003e、\u003ccode\u003e1.ts\u003c/code\u003e……那就相当于上传了整个视频。还记得那个“图床”的限制吗？\u003cstrong\u003e文件大小限制不能超过 5 MB\u003c/strong\u003e，因此切割出来的 TS 也不应该超过 5 MB，但是切割 TS 的大小并不是可以随意设定的……\u003c/p\u003e\u003cp\u003e这里就需要提到一些视频格式的基础知识了（逃\u003c/p\u003e\u003cp\u003e为了提高压缩率，H.264 编码标准将视频的帧分为 I 帧、P 帧、B 帧三类，后两者可以存储前后帧的图像变化，然后参考其他帧“预测”出画面数据；但 I 帧保存的是完整的一帧；部分 I 帧也是 IDR 帧，每一个 IDR 帧之后的帧都\u003cstrong\u003e不能参考 IDR 帧之前的内容\u003c/strong\u003e。\u003c/p\u003e\u003cp\u003e在无损的要求下，由于 IDR 帧的特性，视频分割的最小单位是以 IDR 帧（关键帧）进行分割得到的小段，又称 GOP（Group Of Pictures）。每个 GOP 的帧序列以 I 帧开头和结尾，例如 \u003ccode\u003eIBBBPBBBPBBBI\u003c/code\u003e，不能再继续分割。如果\u003cstrong\u003e视频的码率较高且 GOP 过长\u003c/strong\u003e的话，就很容易出现某个 GOP 已经超过了 5 MB 的情况。\u003c/p\u003e\u003cp\u003e简单的解决方法是将这些大小超过 5 MB 的 GOP 切出来的 TS \u003cstrong\u003e丢给 FFmpeg 进行二压\u003c/strong\u003e，不改变分辨率和帧率的话并不会影响整个视频的播放；但是在问题相当严重的情况下，最好是二压整个视频，降低码率，注意\u003cstrong\u003e将 x264 的参数 \u003ccode\u003ekeyint\u003c/code\u003e 改低一些\u003c/strong\u003e，保证不会出现过长的 GOP。\u003c/p\u003e\u003cp\u003e除了超出限制的文件，过小的文件也是需要注意的。上面的截图中的大部分 TS 都只有数百 KB，虽然可以上传，但是文件数量实在太多，加载时需要发送大量 HTTP 请求严重影响性能。可以将相邻的几个大小加起来刚好达到 5 MB 的 TS 的二进制数据按顺序合并起来，不过一开始的几个 TS 例外（只需要合并到 2 MB 就可以了？），否则按下“播放”按钮然后要等上很久才能播放第一个 TS 还是有点难受的……\u003c/p\u003e\u003cp\u003e上传视频也可以使用 curl 在命令行中完成，得到的响应会直接输出到 stdout。也可以使用其它编程语言的网络请求模块，不过不知道为什么使用 Python 的 \u003ccode\u003erequests\u003c/code\u003e 模块一直都无法上传……？\u003c/p\u003e\u003cpre class=\"line-numbers language-bash\" data-language=\"bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token function\"\u003ecurl\u003c/span\u003e https://kfupload.alibaba.com/mupload \u003cspan class=\"token parameter variable\"\u003e-X\u003c/span\u003e POST \u003cspan class=\"token parameter variable\"\u003e-F\u003c/span\u003e \u003cspan class=\"token variable assign-left\"\u003escene\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eaeMessageCenterV2ImageRule \u003cspan class=\"token parameter variable\"\u003e-F\u003c/span\u003e \u003cspan class=\"token variable assign-left\"\u003ename\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eimage.jpg \u003cspan class=\"token parameter variable\"\u003e-F\u003c/span\u003e \u003cspan class=\"token variable assign-left\"\u003efile\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e@video.ts\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch1 id=\"自动上传脚本\"\u003e\u003ca href=\"#自动上传脚本\" class=\"headerlink\" title=\"自动上传脚本\"\u003e\u003c/a\u003e自动上传脚本\u003c/h1\u003e\u003cvideo controls=\"\" poster=\"https://p.sda1.dev/12/067493692c212232eb183ce87bdc3da3/IJ3slYXU.jpg\" preload=\"metadata\"\u003e\u003csource type=\"video/mp4; codecs=av01.0.09M.10\" src=\"https://cc-im-kefu-cos.7moor-fs1.com/im/4d2c3f00-7d4c-11e5-af15-41bf63ae4ea0/35sJC4mB.mp4\"/\u003e\u003csource type=\"video/mp4; codecs=avc1.640033\" src=\"https://cc-im-kefu-cos.7moor-fs1.com/im/4d2c3f00-7d4c-11e5-af15-41bf63ae4ea0/zifEM-y4.mp4\"/\u003e\u003c/video\u003e\u003cp\u003e\u003cdel\u003e看上去是 Windows，实际上是 Kali 的 Windows 界面模式（滑稽\u003c/del\u003e\u003c/p\u003e\u003cp\u003e\u003cdel\u003e但是它真的预装了 PowerShell\u003c/del\u003e\u003c/p\u003e\u003cp\u003e\u003cdel\u003e出门右转 \u003ca href=\"https://gist.github.com/TransparentLC/54778bfd01b41c97dee1343521a9de9e\" target=\"_blank\" rel=\"noopener\"\u003eGitHub Gist\u003c/a\u003e 查看和下载脚本( ॑꒳ ॑ )\u003c/del\u003e\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e运行脚本需要 PowerShell 运行环境、FFmpeg 和 curl\u003c/strong\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e输入一个 MP4 封装的 H264 + AAC 编码的视频的路径（如果有需要，请自行对视频进行二压处理）\u003c/li\u003e\u003cli\u003e在相同目录下生成一个以随机 GUID 命名的临时文件夹，保存视频切割的 TS 并生成 M3U8（\u003ccode\u003evideo.m3u8\u003c/code\u003e）\u003c/li\u003e\u003cli\u003e如果存在超过 5 MB 的 TS 则给出提示，需要手动进行二压后才能继续上传\u003c/li\u003e\u003cli\u003e自动合并相邻的 TS，使文件大小接近 5 MB（前三个合并的 TS 为 2 MB）\u003c/li\u003e\u003cli\u003e将合并后的 TS 全部上传到“图床”，生成写入了“图床”的 URL 的 M3U8（\u003ccode\u003evideo_online.m3u8\u003c/code\u003e）\u003c/li\u003e\u003cli\u003e临时文件夹内的 TS 和 \u003ccode\u003evideo.m3u8\u003c/code\u003e 可以自行决定是否删除\u003c/li\u003e\u003cli\u003e\u003cspan style=\"opacity:.2\"\u003e脚本没有任何错误处理，所以如果出现了各种奇怪的事情大概率是视频文件本身的问题……大概吧（小声\u003c/span\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e将 \u003ccode\u003evideo_online.m3u8\u003c/code\u003e 存放到自己的服务器上（或者也上传到“图床”？！），在网页上使用 \u003ca href=\"https://github.com/video-dev/hls.js\" target=\"_blank\" rel=\"noopener\"\u003ehls.js\u003c/a\u003e 就可以播放了。\u003c/p\u003e\u003cp\u003e（实际上最前面的\u003ca href=\"https://jsbin.com/catagatuyi/edit?html,output\" target=\"_blank\" rel=\"noopener\"\u003e演示\u003c/a\u003e就是这么做的，还用到了自适应切换，如果网速比较快的话播放一段时间就可以发现视频的清晰度从 360p 无缝衔接到了 720p）\u003c/p\u003e\u003chr/\u003e\u003cp\u003e因为 Python 无法实现上传所以还是继续用 PowerShell 写脚本了～正好 PowerShell 6.0 已经支持跨平台了，所以做了一点微小的适配，在 Linux 下也能跑٩( ‘ω’ )و\u003c/p\u003e\u003cp\u003e当然 Linux 用户别忘了 \u003ccode\u003eapt-get install powershell\u003c/code\u003e，Windows 自带\u003cdel\u003e充话费送的\u003c/del\u003e PowerShell 运行环境。\u003c/p\u003e\u003cp\u003e脚本需要使用 FFmpeg，Windows 用户请出门右转\u003ca href=\"https://www.gyan.dev/ffmpeg/builds/\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e下载，然后\u003cstrong\u003e把 \u003ccode\u003effmpeg.exe\u003c/code\u003e 所在的目录添加到 PATH\u003c/strong\u003e 或者\u003cstrong\u003e去脚本的三十几行的位置手动修改路径\u003c/strong\u003e，Linux 用户请 \u003ccode\u003eapt-get install ffmpeg\u003c/code\u003e；还需要使用 curl，在 Linux 下应该是标配了，Windows 用户请出门右转\u003ca href=\"https://curl.se/download.html#Win64\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e下载，同样需要添加到 PATH 或者修改脚本里的路径。\u003c/p\u003e\u003ch1 id=\"在开始检测文件格式之后……\"\u003e\u003ca href=\"#在开始检测文件格式之后……\" class=\"headerlink\" title=\"在开始检测文件格式之后……\"\u003e\u003c/a\u003e在开始检测文件格式之后……\u003c/h1\u003e\u003cp\u003e目前 alicdn 的这个接口已经添加了图片的文件格式检测，如果上传的文件数据不是图片，即使自己改了 \u003ccode\u003ename\u003c/code\u003e 字段也会报错。不过借鉴“图种”的原理，把正常的图片数据插入到文件最前面就可以了～\u003c/p\u003e\u003cp\u003e在 \u003ca href=\"https://stackoverflow.com/questions/2570633/smallest-filesize-for-transparent-single-pixel-image#answer-15960901\" target=\"_blank\" rel=\"noopener\"\u003eStack Overflow\u003c/a\u003e 上查了一下，\u003ca href=\"data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAAC\"\u003e最小的 1x1 像素的 GIF 图片\u003c/a\u003e可以做到只有 24 字节。把它加到 M3U8 和 TS 切片的最前面，得到的“图片”是可以上传到 alicdn 的（理论上也支持所有图床），然后读取的时候再截掉前 24 字节就可以了 ∠( ᐛ 」∠)_\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003eTS 文件以一个 \u003ccode\u003e0x47\u003c/code\u003e 作为文件头，据说不截取也是可以的，但是我没有额外测试过。\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003e截取的操作在 hls.js 的 loader 上加一个 Hook 即可实现，不过遗憾的是这样的话将视频下载到本地就不能直接播放了……这个 Hook minify 以后只有三百多字节，在 \u003ccode\u003enew Hls(...)\u003c/code\u003e 之前执行即可～\u003c/p\u003e\u003cpre class=\"line-numbers language-javascript\" data-language=\"javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eHls\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e offset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e load \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Hls\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDefaultConfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eloader\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprototype\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eload\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    Hls\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDefaultConfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eloader\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprototype\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function function-variable\"\u003eload\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003econtext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e config\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e callbacks\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econtext\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e\u0026#39;manifest\u0026#39;\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e\u0026#39;level\u0026#39;\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eresponseType \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e\u0026#39;arraybuffer\u0026#39;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e onSuccess \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e callbacks\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eonSuccess\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            callbacks\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function function-variable\"\u003eonSuccess\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eresponse\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e stats\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                response\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eslice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eonSuccess\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecall\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e stats\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eload\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecall\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e context\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e config\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e callbacks\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eHls\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e24\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e出门右转 \u003ca href=\"https://gist.github.com/TransparentLC/72b6ea086b9a28964496c2bc1b721aa4\" target=\"_blank\" rel=\"noopener\"\u003eGitHub Gist\u003c/a\u003e 下载更新后的脚本( ॑꒳ ॑ ) 这个脚本最后会输出一个 \u003ccode\u003evideo_online.m3u8.gif\u003c/code\u003e，自行上传到任意图床即可（同样也可以将脚本中的上传部分自行修改为其它图床）。\u003ca href=\"https://jsbin.com/qiqugiyeko/edit?html,output\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e是演示～（可以注意到，M3U8 并没有存在 alicdn 上，不过 TS 切片还是使用 alicdn 上传）\u003c/p\u003e\u003cblockquote class=\"mdui-m-b-0 mdui-m-x-0 mdui-p-y-1\" style=\"border-left:4px solid rgba(0,0,0,.36)\"\u003e\u003cstrong\u003e本作品采用\u003ca href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh\" target=\"_blank\"\u003e知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议\u003c/a\u003e进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载。\u003c/strong\u003e\u003cbr/\u003e\u003cstrong\u003e本文作者：✨小透明・宸✨\u003c/strong\u003e\u003cbr/\u003e\u003cstrong\u003e本文链接：\u003ca href=\"https://akarin.dev/2020/02/07/alicdn-video-hosting/\"\u003ehttps://akarin.dev/2020/02/07/alicdn-video-hosting/\u003c/a\u003e\u003c/strong\u003e\u003c/blockquote\u003e\u003c/article\u003e",
  "Date": "2020-02-07T11:24:46Z",
  "Author": "✨小透明・宸✨"
}