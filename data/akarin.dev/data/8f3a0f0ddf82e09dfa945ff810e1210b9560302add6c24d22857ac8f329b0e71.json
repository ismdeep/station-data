{
  "Source": "akarin.dev",
  "Title": "图片渐进式加载的实现方法",
  "Link": "https://akarin.dev/2021/11/04/progressive-image-loading/",
  "Content": "\u003carticle class=\"mdui-p-a-3 mdui-card-content mdui-typo\"\u003e\u003cp\u003e其实这是之前自己写现在使用的这个 Hexo 主题的时候就想记下来的东西，不过一直咕到今天才写 …_φ(･ω･` )\u003c/p\u003e\u003cp\u003e在我写主题的过程中，为了节省流量而大量地对图片使用了懒加载。而各位应该很容易就可以发现，对于文章的封面图还有个额外的“从模糊变清晰”的加载效果。\u003c/p\u003e\u003cvideo controls=\"\" poster=\"https://p.sda1.dev/12/e1bf7ea924102d38b4c7c21c69f0bcac/6KjPgCbt.jpg\"\u003e\u003csource type=\"video/mp4; codecs=av01.0.05M.10\" src=\"https://cc-im-kefu-cos.7moor-fs1.com/im/4d2c3f00-7d4c-11e5-af15-41bf63ae4ea0/telIFazl.mp4\"/\u003e\u003csource type=\"video/mp4; codecs=avc1.640032\" src=\"https://s3plus.meituan.net/v1/mss_550586ef375b493da4aa79bebdfce4fa/csc-apply-file-web/prod/2021-11-03/8042b498-dca0-4752-bcc4-3b405280fdf1null\"/\u003e\u003c/video\u003e\u003cp\u003e这类加载方式一般被称为渐进式加载（Progressive Loading），对于图片来说，也就是在加载的过程中先展示一部分模糊的图片，等加载完成了再展示完整的原始图片。虽然渐进式加载不能从根本上提高图片的加载速度，但是因为用户\u003cstrong\u003e看到图片的时间提前了\u003c/strong\u003e（虽然还不是完整图片），因此可以给用户一种“看上去加载得比较快”的错觉，而不是对着未加载时图片位置的一片空白干等，可以提升使用体验。\u003c/p\u003e\u003ch1 id=\"图片格式中的渐进解码功能\"\u003e\u003ca href=\"#图片格式中的渐进解码功能\" class=\"headerlink\" title=\"图片格式中的渐进解码功能\"\u003e\u003c/a\u003e图片格式中的渐进解码功能\u003c/h1\u003e\u003cp\u003e现在常用的一些图片格式中都加入了渐进式解码的功能，可以在只加载了图片的部分数据的情况下显示出模糊的图像。由于是解码器直接提供支持，因此展示图片时并不需要额外的配置，只需要在保存图片时注意设置“渐进/连续（Progressive）”或者“交错（Interlace）”之类的选项就可以了。\u003c/p\u003e\u003cp\u003e下面就是模拟较慢的网速下加载以相同质量压缩的非渐进式和渐进式 JPEG 图片的效果，非渐进式是像扫描仪一样从上往下逐渐显示，而渐进式就先显示了大致的轮廓，在加载过程中再逐渐变清晰，“扫描”完第二遍时就已经是可以接受的图片质量了。\u003c/p\u003e\u003cvideo controls=\"\" poster=\"https://p.sda1.dev/12/e554dec8a70e0b826071005fc5ee720a/waCL5uzU.jpg\"\u003e\u003csource type=\"video/mp4; codecs=av01.0.05M.10\" src=\"https://cc-im-kefu-cos.7moor-fs1.com/im/4d2c3f00-7d4c-11e5-af15-41bf63ae4ea0/Qs1GK6PY.mp4\"/\u003e\u003csource type=\"video/mp4; codecs=avc1.640032\" src=\"https://s3plus.meituan.net/v1/mss_550586ef375b493da4aa79bebdfce4fa/csc-apply-file-web/prod/2021-11-03/8bb22ec9-43ab-4bc2-8f83-afa8bc6dd809null\"/\u003e\u003c/video\u003e\u003cp\u003e如果使用 \u003ca href=\"https://github.com/mozilla/mozjpeg\" target=\"_blank\" rel=\"noopener\"\u003emozjpeg\u003c/a\u003e 压图的话，默认就已经启用了参数 \u003ccode\u003e-progressive\u003c/code\u003e 启用渐进式解码，但是默认的解码方式是按顺序解码 Y、U、V 三个通道（即使用 \u003ccode\u003e-dc-scan-opt 1\u003c/code\u003e），效果是图片会先以黑白形式显示，再逐渐填充错误的颜色，最后变成正常的颜色，这样看上去的效果不太好，因此可以通过使用 \u003ccode\u003e-dc-scan-opt 0\u003c/code\u003e 改为同时加载三个通道，就可以达到上面的效果。还可以无损地将已有的非渐进式 JPEG 图片（也被称为 Baseline JPEG）转换为渐进式，文件大小稍微会小一点。\u003c/p\u003e\u003cp\u003e另外两个经典的图片格式 GIF 和 PNG 也支持渐进式解码，但是对这两个格式启用渐进式解码反而会使文件大小增加，实际使用也似乎不是很多。\u003c/p\u003e\u003cp\u003e那现代图片格式 WebP 和 AVIF 呢？遗憾的是，它们都不支持渐进式解码 ╮(╯_╰)╭\u003c/p\u003e\u003cp\u003eGoogle 已经在 WebP 的文档中表示\u003ca href=\"https://developers.google.com/speed/webp/faq#does_webp_support_progressive_or_interlaced_display\" target=\"_blank\" rel=\"noopener\"\u003e不支持渐进式解码的功能\u003c/a\u003e了。而 AVIF 最初也不支持渐进式解码，后来有人在 GitHub 上提出了相关的 \u003ca href=\"https://github.com/AOMediaCodec/av1-avif/issues/102\" target=\"_blank\" rel=\"noopener\"\u003eIssue\u003c/a\u003e，但是似乎是由于对编码格式的修改过于复杂而无法实装，作为替代有人提出了另一个 \u003ca href=\"https://github.com/AOMediaCodec/libavif/issues/605\" target=\"_blank\" rel=\"noopener\"\u003eIssue\u003c/a\u003e，通过在 AVIF 中内置缩略图来实现类似的效果，不过也没有什么进展……所以大约的确也是不行的。\u003c/p\u003e\u003ch1 id=\"懒加载和“从模糊变清晰”的加载效果\"\u003e\u003ca href=\"#懒加载和“从模糊变清晰”的加载效果\" class=\"headerlink\" title=\"懒加载和“从模糊变清晰”的加载效果\"\u003e\u003c/a\u003e懒加载和“从模糊变清晰”的加载效果\u003c/h1\u003e\u003cp\u003e在和图片相关的优化中，懒加载其实是更有必要做的优化。毕竟渐进式的图片加载只能做到视觉上的优化，但是懒加载可是实打实地减少了 HTTP 请求数量和流量消耗。一般的懒加载是在未加载的图片的位置上放一个固定的占位图，等需要加载图片的时候再用原图替换掉，类似的还有“省流模式”，只是将加载图片的时机从出现在屏幕上变成了用户手动点击图片。总之，如果把这张占位图改成图片的缩略图之类的话，就是上面提到的“从模糊变清晰”的渐进式加载效果了。\u003c/p\u003e\u003cp\u003e这个缩略图有哪些要求呢？\u003c/p\u003e\u003cul\u003e\u003cli\u003e缩略图应该立即显示在页面上，如果进行了额外的加载，那么加载之前图片仍然是一片空白。\u003c/li\u003e\u003cli\u003e缩略图还应该尽可能地小。\u003c/li\u003e\u003cli\u003e如果从缩略图直接切换到原图就太生硬了，应该有个渐变的效果，可以通过将缩略图的不透明度逐渐变成 0 来实现，于是这个缩略图应该作为单独的一层覆盖到原图上。\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e因此这个缩略图应该以 Data URL 的形式直接嵌入到页面中，并且使用几十像素的尺寸就足够了。下面就是将一个 32x18 的缩略图（大小只有 434 B）覆盖在 1280x720 的原图上的演示，点击下面的按钮可以模拟图片被加载时显示的图片从缩略图平滑过渡到原图的效果：\u003c/p\u003e\u003cdiv style=\"position:relative\"\u003e\u003cimg src=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQIAJQAlAAD/2wCEABcXFxcYFxocHBokJiImJDUwLCwwNVA5PTk9OVB5S1hLS1hLeWuBaWJpgWvAl4WFl8DeurC63v/w8P////////8BFxcXFxgXGhwcGiQmIiYkNTAsLDA1UDk9OT05UHlLWEtLWEt5a4FpYmmBa8CXhYWXwN66sLre//Dw///////////AABEIABIAIAMBIQACEQEDEQH/xABrAAADAQAAAAAAAAAAAAAAAAACBAUAEAACAgEEAQUAAAAAAAAAAAABAgMRAAQSITETBRRBcrEBAQEBAQAAAAAAAAAAAAAAAAQCAwERAAEDBAIDAQAAAAAAAAAAAAEAAgMEESExMoEiQUJx/9oADAMBAAIRAxEAPwCvBIXBLU1DvGoZt70XU4Gm0kSN5W9IxML6odXi04YG405+WrLqm+GAoi5ZK0KyXRPGHUEcm5dqspFnOUusqnnNh2lJi0DJ5WBDbrUnEV9QRqQIxA7JxczDLEAwjKyjcGvub4Vx+IzkrWk+z1WCpeXS0+VJ1TFoNEWJJ8bfuBB0fsMfHo/jlkdr/9k\" id=\"example-0-blurred\" style=\"position:absolute;width:100%;max-height:none;transition:opacity 1s\"/\u003e \u003cimg data-src=\"https://p.sda1.dev/12/bece1d43a7d093583129fdc7202ca924/Fhdt09T7.jpg\" data-src-avif=\"https://p.sda1.dev/12/3a708bab4022d35fa52f12344a6dabfb/m3nkyCIM.jpg\" data-src-webp=\"https://p.sda1.dev/12/04d499bac3b61e1596f370c51686c18a/d1iL6gt0.webp\" id=\"example-0-source\" style=\"width:100%;max-height:none;visibility:hidden\"/\u003e\u003c/div\u003e\u003cbutton id=\"example-0-load\"\u003e加载图片\u003c/button\u003e \u003cbutton id=\"example-0-unload\"\u003e恢复初始状态\u003c/button\u003e \u003cbutton id=\"example-0-blur\"\u003e切换缩略图模糊\u003c/button\u003e\u003cscript\u003e(()=\u003e{const l=l=\u003edocument.getElementById(l),e=\"example-0-\",i=l(e+\"blurred\"),t=l(e+\"source\"),c=l(e+\"load\"),y=l(e+\"unload\"),o=l(e+\"blur\");c.onclick=()=\u003e{i.style.opacity=0,t.style.visibility=\"\"},y.onclick=()=\u003e{i.style.opacity=1,t.style.visibility=\"hidden\"},o.onclick=()=\u003ei.style.filter=i.style.filter?\"\":\"blur(10px)\"})()\u003c/script\u003e\u003cpre class=\"language-markup line-numbers\" data-language=\"markup\"\u003e\u003ccode class=\"language-markup\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ediv\u003c/span\u003e \u003cspan class=\"token special-attr\"\u003e\u003cspan class=\"token attr-name\"\u003estyle\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"token css language-css value\"\u003e\u003cspan class=\"token property\"\u003eposition\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003erelative\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e\u0026lt;!-- 缩略图，显示的尺寸和位置都要设定为和原图一致 --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eimg\u003c/span\u003e\n        \u003cspan class=\"token special-attr\"\u003e\u003cspan class=\"token attr-name\"\u003estyle\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"token css language-css value\"\u003e\u003cspan class=\"token property\"\u003eposition\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003eabsolute\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003cspan class=\"token property\"\u003ewidth\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e100%\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003cspan class=\"token property\"\u003etransition\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003eopacity 1s\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003edata:image/jpeg;base64,...\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e\u0026lt;!-- 原图 --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eimg\u003c/span\u003e\n        \u003cspan class=\"token special-attr\"\u003e\u003cspan class=\"token attr-name\"\u003estyle\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"token css language-css value\"\u003e\u003cspan class=\"token property\"\u003ewidth\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e100%\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003ehttps://...\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e由于浏览器缩放显示图片时默认使用的是双线性插值（除此之外只能通过修改 \u003ccode\u003eimage-rendering: pixelated\u003c/code\u003e 设置为邻近取样，没有更好的缩放算法了），在将缩略图放大数倍时会出现明显的菱形和十字图形，比较难看。在缩略图上通过 \u003ccode\u003efilter: blur(10px)\u003c/code\u003e 添加模糊一定程度上可以掩盖这个问题，上面的演示中也可以通过自由切换来比较使用与不使用模糊的视觉效果区别。\u003c/p\u003e\u003cp\u003e但是，使用 CSS 的模糊滤镜又带来了别的问题。在演示中可以注意到，将缩略图模糊时缩略图的边缘也一起被模糊了，导致的后果就是点击“加载图片”时在边缘位置仍然是没有任何过渡地直接显示了图片，非常生硬。\u003c/p\u003e\u003cp\u003e如何解决呢？我首先找到了\u003ca href=\"https://css-tricks.com/the-blur-up-technique-for-loading-background-images/\" target=\"_blank\" rel=\"noopener\"\u003e一篇来自 CSS-Tricks 的文章\u003c/a\u003e，同样介绍了如何实现“从模糊变清晰”的渐进式加载效果，但是它使用了另一种不同的方法实现缩略图的模糊显示：不在 CSS 的 \u003ccode\u003efilter\u003c/code\u003e 中使用自带的 \u003ccode\u003eblur\u003c/code\u003e 模糊滤镜，而是以 SVG 滤镜的形式将模糊和修改透明度结合到一起。这个结合后的 SVG 滤镜是：\u003c/p\u003e\u003cpre class=\"language-markup line-numbers\" data-language=\"markup\"\u003e\u003ccode class=\"language-markup\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003esvg\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003exmlns\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003ehttp://www.w3.org/2000/svg\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003efilter\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e$\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003efeGaussianBlur\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003estdDeviation\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e10\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003efeComponentTransfer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n            \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003efeFuncA\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etype\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003ediscrete\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etableValues\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e1 1\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003efeComponentTransfer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003esvg\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003e\u0026lt;feGaussianBlur\u0026gt;\u003c/code\u003e 和 CSS 自带的 \u003ccode\u003eblur\u003c/code\u003e 一样，表示对图片进行指定半径的模糊处理。而 \u003ccode\u003e\u0026lt;feComponentTransfer\u0026gt;\u003c/code\u003e 则是对图片的每个像素的 RGBA 通道颜色值进行映射（就像 Photoshop 里的“曲线”一样），这里的设定是将 A 通道固定为 1（范围为 0-1），也就是使整个图像变得不透明。\u003c/p\u003e\u003cp\u003e给这个 SVG 滤镜任意添加一个 ID（可以短到只有一个字符），然后压缩，编码成使用 URL 编码的 Data URL，再像 HTML 中使用 \u003ccode\u003e#\u003c/code\u003e 指向有某个 ID 的元素一样引用这个滤镜，写入到 CSS 的 \u003ccode\u003efilter\u003c/code\u003e 中，就可以得到下面的 CSS 代码：\u003c/p\u003e\u003cpre class=\"language-css line-numbers\" data-language=\"css\"\u003e\u003ccode class=\"language-css\"\u003e\u003cspan class=\"token property\"\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token url\"\u003e\u003cspan class=\"token function\"\u003eurl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token url string\"\u003e\u0026#34;data:image/svg+xml,%3Csvg xmlns=\u0026#39;http://www.w3.org/2000/svg\u0026#39;%3E%3Cfilter id=\u0026#39;$\u0026#39;%3E%3CfeGaussianBlur stdDeviation=\u0026#39;9\u0026#39;/%3E%3CfeComponentTransfer%3E%3CfeFuncA type=\u0026#39;discrete\u0026#39; tableValues=\u0026#39;1 1\u0026#39;/%3E%3C/feComponentTransfer%3E%3C/filter%3E%3C/svg%3E#$\u0026#34;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这是目前这个主题正在对文章封面图的使用模糊方法。看上去似乎也没什么问题，但是在写这篇的时候我尝试对上面的演示中的缩略图使用，结果在图片边框出现了严重的色彩溢出现象，溢出的部分甚至还超出了图片的显示区域……\u003c/p\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/789*604),604px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/e5726043a2abe026a37a8f6aac99aaef/ShAtGwVG.jpg\" data-src-avif=\"https://p.sda1.dev/12/26eaa299c82c974e2119b6b10ef10484/mnHAu5nI.jpg\" data-src-webp=\"https://p.sda1.dev/12/61d1a0b825f4bdae396a19d4fe77150a/fJE3y2jU.webp\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAYACADASIAAhEBAxEB/8QAGgAAAgIDAAAAAAAAAAAAAAAAAAMBBAIFBv/EACcQAAIBBAECBQUAAAAAAAAAAAECBAADBRESEyIGFCExkRVBUmGh/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgME/8QAHREAAgMAAwEBAAAAAAAAAAAAAQIAAxEEEkEhE//aAAwDAQACEQMRAD8A72dIzbzZRtCCVF51ALPvip0N/ulc8+p2I+Mu7X1DvdGqsFAs2XtveRdPy5pydVLmyo4n71Lid7QGZydG+SN9hR3C5gJAiUv+IG5dSJi17fzvtTMfPznnoy3IeORWvIrFWulirN665UCTpjok1nH4XMhDPuevbP8AafNR6k7o5GefIePc1lgVgPplSTPVJksfTMoSt+4NpBvup03uGVSCDVCRmJYt3XtYbMO4HaggXxv5WiijShpzq7YPDkq1aMSSNJM00/L5V+j0fDWaO7ffqDdHE1OJk5JsjjQ+DzFrcyxye7FuIigONlmoorT+zlSpwjPYBRWrBgCDP//Z\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/e5726043a2abe026a37a8f6aac99aaef/ShAtGwVG.jpg\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003cp\u003e那为什么 CSS-Tricks 那边的使用以及对这个主题的封面图使用就没有问题呢？因为那两个情况下的图片都是通过 \u003ccode\u003ebackground-image\u003c/code\u003e 显示的，但是这里使用的是 \u003ccode\u003e\u0026lt;img\u0026gt;\u003c/code\u003e，稍微有点区别。至于为什么在 \u003ccode\u003e\u0026lt;img\u0026gt;\u003c/code\u003e 中使用就会在显示区域之外出现色彩溢出的部分，我也无法解释…… (;-_-)\u003c/p\u003e\u003cp\u003e后来我又找到了一个 \u003ca href=\"https://stackoverflow.com/questions/20443283#answer-48095387\" target=\"_blank\" rel=\"noopener\"\u003eStack Overflow 上的回答\u003c/a\u003e，给出了另一个 SVG 模糊滤镜：\u003c/p\u003e\u003cpre class=\"language-markup line-numbers\" data-language=\"markup\"\u003e\u003ccode class=\"language-markup\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003esvg\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003exmlns\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003ehttp://www.w3.org/2000/svg\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003efilter\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e$\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003efeGaussianBlur\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003estdDeviation\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e10\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003efeColorMatrix\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etype\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003ematrix\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003evalues\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e1 0 0 0 0, 0 1 0 0 0, 0 0 1 0 0, 0 0 0 9 0\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003efeComposite\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ein2\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003eSourceGraphic\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eoperator\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003ein\u003cspan class=\"token punctuation\"\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003esvg\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003e\u0026lt;feColorMatrix\u0026gt;\u003c/code\u003e 是使用变换矩阵处理每个像素的 RGBA 通道颜色值，上面的滤镜中的矩阵相当于将 A 通道的颜色值乘上 9，其他通道不变，对于被模糊（实际上是半透明）的边缘位置来说基本上就和设成 1 差不多了，并且这种实现方法不会在显示区域之外再出现什么奇怪的东西。对应的 CSS 代码：\u003c/p\u003e\u003cpre class=\"language-css line-numbers\" data-language=\"css\"\u003e\u003ccode class=\"language-css\"\u003e\u003cspan class=\"token property\"\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token url\"\u003e\u003cspan class=\"token function\"\u003eurl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token url string\"\u003e\u0026#34;data:image/svg+xml,%3Csvg xmlns=\u0026#39;http://www.w3.org/2000/svg\u0026#39;%3E%3Cfilter id=\u0026#39;$\u0026#39;%3E%3CfeGaussianBlur stdDeviation=\u0026#39;10\u0026#39;/%3E%3CfeColorMatrix type=\u0026#39;matrix\u0026#39; values=\u0026#39;1 0 0 0 0,0 1 0 0 0,0 0 1 0 0,0 0 0 9 0\u0026#39;/%3E%3CfeComposite in2=\u0026#39;SourceGraphic\u0026#39; operator=\u0026#39;in\u0026#39;/%3E%3C/filter%3E%3C/svg%3E#$\u0026#34;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e用这个滤镜替代最初的演示中使用的 CSS 自带的模糊滤镜：\u003c/p\u003e\u003cdiv style=\"position:relative\"\u003e\u003cimg src=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQIAJQAlAAD/2wCEABcXFxcYFxocHBokJiImJDUwLCwwNVA5PTk9OVB5S1hLS1hLeWuBaWJpgWvAl4WFl8DeurC63v/w8P////////8BFxcXFxgXGhwcGiQmIiYkNTAsLDA1UDk9OT05UHlLWEtLWEt5a4FpYmmBa8CXhYWXwN66sLre//Dw///////////AABEIABIAIAMBIQACEQEDEQH/xABrAAADAQAAAAAAAAAAAAAAAAACBAUAEAACAgEEAQUAAAAAAAAAAAABAgMRAAQSITETBRRBcrEBAQEBAQAAAAAAAAAAAAAAAAQCAwERAAEDBAIDAQAAAAAAAAAAAAEAAgMEESExMoEiQUJx/9oADAMBAAIRAxEAPwCvBIXBLU1DvGoZt70XU4Gm0kSN5W9IxML6odXi04YG405+WrLqm+GAoi5ZK0KyXRPGHUEcm5dqspFnOUusqnnNh2lJi0DJ5WBDbrUnEV9QRqQIxA7JxczDLEAwjKyjcGvub4Vx+IzkrWk+z1WCpeXS0+VJ1TFoNEWJJ8bfuBB0fsMfHo/jlkdr/9k\" id=\"example-1-blurred\" style=\"position:absolute;width:100%;max-height:none;transition:opacity 1s;filter:url(\u0026#39;data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22$%22%3E%3CfeGaussianBlur stdDeviation=%2210%22/%3E%3CfeColorMatrix type=%22matrix%22 values=%221 0 0 0 0,0 1 0 0 0,0 0 1 0 0,0 0 0 9 0%22/%3E%3CfeComposite in2=%22SourceGraphic%22 operator=%22in%22/%3E%3C/filter%3E%3C/svg%3E#$\u0026#39;)\"/\u003e \u003cimg data-src=\"https://p.sda1.dev/12/bece1d43a7d093583129fdc7202ca924/Fhdt09T7.jpg\" data-src-avif=\"https://p.sda1.dev/12/3a708bab4022d35fa52f12344a6dabfb/m3nkyCIM.jpg\" data-src-webp=\"https://p.sda1.dev/12/04d499bac3b61e1596f370c51686c18a/d1iL6gt0.webp\" id=\"example-1-source\" style=\"width:100%;max-height:none;visibility:hidden\"/\u003e\u003c/div\u003e\u003cbutton id=\"example-1-load\"\u003e加载图片\u003c/button\u003e \u003cbutton id=\"example-1-unload\"\u003e恢复初始状态\u003c/button\u003e\u003cscript\u003e(()=\u003e{const e=e=\u003edocument.getElementById(e),i=\"example-1-\",l=e(i+\"blurred\"),t=e(i+\"source\"),c=e(i+\"load\"),o=e(i+\"unload\");c.onclick=()=\u003e{l.style.opacity=0,t.style.visibility=\"\"},o.onclick=()=\u003e{l.style.opacity=1,t.style.visibility=\"hidden\"}})()\u003c/script\u003e\u003cp\u003e这样的效果就很完美了！( つ•̀ω•́)つ\u003c/p\u003e\u003ch1 id=\"除了小尺寸的-JPEG，还能用什么作为缩略图？\"\u003e\u003ca href=\"#除了小尺寸的-JPEG，还能用什么作为缩略图？\" class=\"headerlink\" title=\"除了小尺寸的 JPEG，还能用什么作为缩略图？\"\u003e\u003c/a\u003e除了小尺寸的 JPEG，还能用什么作为缩略图？\u003c/h1\u003e\u003cp\u003eCSS-Tricks 的文章还提到了 Facebook 技术团队的\u003ca href=\"https://engineering.fb.com/2015/08/06/android/the-technology-behind-preview-photos/\" target=\"_blank\" rel=\"noopener\"\u003e另一篇文章\u003c/a\u003e，介绍他们是如何在自家的 APP 中实现图片渐进式加载，使用的方法仍然是先立即显示模糊的缩略图再展示完整图片，但是他们的目标是\u003cstrong\u003e将缩略图的大小压到 200 B 左右\u003c/strong\u003e。为此他们使用了相同的质量和Huffman 表等参数进行压图，这样得到的图片就有了固定的标头，只要传输剩下的部分，在客户端再和固定的标头拼接起来，就可以得到使用的缩略图了。\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003eSo the final format became one byte for version number, one byte each for width and height, and finally the approximately 200 byte payload. The server would just send this format as part of the GraphQL response, and then the client could simply append the JPEG body to the predefined JPEG header, patch the width and height, and treat it as a regular JPEG image.\u003c/p\u003e\u003cp\u003eAfter the standard JPEG decoding, the client could run the predetermined Gaussian blur and scale it to fit the window size.\u003c/p\u003e\u003cp\u003e最终的数据格式先是各占 1 B 的版本号和图片的宽度和高度，剩下的部分就是 200 B 左右的负载。服务端只需要从 GraphQL 响应中返回这些数据，客户端简单地将负载拼接到预定义的 JPEG 头部后面，再填上宽度和高度，就可以当成一般的 JPEG 图片使用了。\u003c/p\u003e\u003cp\u003e在进行 JPEG 图片解码后，客户端就可以对图片添加高斯模糊并把它缩放到需要的大小。\u003c/p\u003e\u003c/blockquote\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/1342*413),413px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/078404d8ab2b2cc14f0bf4fc4ddcb2c5/PCPEkNLq.jpg\" data-src-avif=\"https://p.sda1.dev/12/95175c3768eef6ed81c6bdbb2de6bbf0/OB1G85E0.jpg\" data-src-webp=\"https://p.sda1.dev/12/87f7ba58cab07ece16be1c6b87fac673/SdxZk5k0.webp\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAKACADASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAQUHBv/EACEQAAICAgIBBQAAAAAAAAAAAAECAwQABRESBhMhI0FR/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/xAAWEQEBAQAAAAAAAAAAAAAAAAABEQD/2gAMAwEAAhEDEQA/AHVrzrY0ppkXUBk9RwvzkkkNlB8U3F/Y6OC/LXRO0swdOSWHDELmjkA7J7feHLVaukDKtzftxai7ZWsGCRoVjDEOW7AEcgZNh5tuDPBAdOwLSohfuzAAtlewCONTyEUH9AxXIb//2Q\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/078404d8ab2b2cc14f0bf4fc4ddcb2c5/PCPEkNLq.jpg\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003cp\u003e自己实现图片渐进式加载的时候当然不一定要做如此极端的优化，制作缩略图时，用任意一个软件把图片的宽度和高度压到 40px 左右，控制压缩 JPEG 的质量使大小在 2 KB 以内其实就可以了。\u003c/p\u003e\u003cp\u003e但是用更少的数据来表示缩略图确实是可行的，这里就需要介绍 \u003ca href=\"https://blurha.sh/\" target=\"_blank\" rel=\"noopener\"\u003eBlurHash\u003c/a\u003e 这个工具了。BlurHash 的算法主要是对原图进行了离散余弦变换，提取出最多 10x10=100 个系数，以 0-18 的范围（也就是大约 4.25 bit 的精度，不过对于缩略图已经够用了）表示颜色，按照一些紧凑的规则编码成二进制数据，再使用特别选择的字母表进行 Base83 编码，保证在 URL 和 JSON 等地方不需要额外转义就可以直接传输。详细的编码规则可以参见\u003ca href=\"https://github.com/woltapp/blurhash/blob/master/Algorithm.md\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e。\u003c/p\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/1896*855),855px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/3c58250178d463ef7b34d40ba3c32b6e/4OGhJAtT.jpg\" data-src-avif=\"https://p.sda1.dev/12/93188b3f9a2694ff63c0c58246682786/HMRXqvGF.jpg\" data-src-webp=\"https://p.sda1.dev/12/3468ba7ce4c33ec2db79f2eac2daa47a/r057l1uX.webp\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAOACADASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAQUEBgf/xAAfEAACAgIDAAMAAAAAAAAAAAABAgMEABEFEjEhIkH/xAAVAQEBAAAAAAAAAAAAAAAAAAACAf/EAB0RAAICAgMBAAAAAAAAAAAAAAECERIAAyEikSP/2gAMAwEAAhEDEQA/ANascxbpVy05aQgAlVUlvdH4GM+NsyWKMM5DlpASRJtG9OtjDf4dLF+GyL1qLr13FG4EbdTv7DR9xgyBho+YU0rqTT9WdghDTI9xM9i3UAE5GsvKIHZV06ka6sW/cS2+WsxdFAkJLAbVCcsaoFGhvWEIASdnC2uzlrECsQCfcoaABUHmc//Z\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/3c58250178d463ef7b34d40ba3c32b6e/4OGhJAtT.jpg\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003cp\u003e在系数数量为 6x4 的情况下从上面的缩略图得到的 BlurHash 只有 52 B。即使将 10x10 个系数用满，由此得到的最长的 BlurHash 也只有 166 B，这个数据量比 Facebook 的极端优化还要小。\u003c/p\u003e\u003cp\u003e需要展示缩略图的时候，只要使用解码库就可以直接将 BlurHash 解码成任意尺寸的位图。系数越少得到的图片就越模糊（或者说是平滑？），但是就算是 10x10 也比前面使用的添加了高斯模糊的低分辨率 JPEG 还要模糊。也许有人会因为想要在模糊的缩略图中多展示一些图片细节而仍然选择低分辨率 JPEG，不过这就是个人喜好不同了 (´▽｀)ノ♪\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e2023-04-30 更新：\u003c/p\u003e\u003cp\u003e以在前端开发领域目前被广泛使用的、跑得最快的 JS 打包器 esbuild 为代表作的 evanw 最近推出了 \u003ca href=\"https://evanw.github.io/thumbhash/\" target=\"_blank\" rel=\"noopener\"\u003eThumbHash\u003c/a\u003e，原理和使用方式与 BlurHash 非常类似。根据官网上的对比，在相同数据量的情况下从 ThumbHash 解码的图像比 BlurHash 有更多的细节，颜色也更接近原图。\u003c/p\u003e\u003cp\u003eThumbHash 不像 BlurHash 一样允许通过调节系数数量来控制数据量和解码图像的质量，不过如果本来就不想纠结这个的话其实并不算什么缺点。\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003e在搜索的过程中，我另外还发现了一个名为 \u003ca href=\"https://github.com/fogleman/primitive\" target=\"_blank\" rel=\"noopener\"\u003ePrimitive\u003c/a\u003e 的比较有意思的工具，可以用数百个椭圆、矩形、三角形等简单的图形对图片进行拟合，还支持以 SVG 的矢量格式输出。\u003c/p\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/720*450),450px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/6c6cd5de13b8cd23dd2985c4d3ac7d36/gocRFLuN.jpg\" data-src-avif=\"https://p.sda1.dev/12/beb4a4956ea45b440675fad7bf90e80b/otUfpNyO.jpg\" data-src-webp=\"https://p.sda1.dev/12/f7433d8bc5c33095a2b969d755cb5dec/ObVzo1Qv.webp\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAUACADASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQGBQH/xAAmEAABBAEDAwQDAAAAAAAAAAABAAIDBDEFERITIYEGIiNCMjNR/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQMC/8QAIBEAAgIBAwUAAAAAAAAAAAAAAQIAAwQREzESMnGRkv/aAAwDAQACEQMRAD8Ai5fTVxmYnLLm0Www92FXT9Tt9e00W7D4mRtMT+O3Uccg8sLNt6jOeXynP3Ix43SmZe3dQPcu+Hjji8/Mh36dKDhLGnIDhVpv13QSCSxEJPqOiXb+eQWRLaY4N9zfxG5Ddu/klUTILMRtMPIkWoCjXdUxq5eskfsOFOzWpnZehCDxAk9USc92+Vzm7+oQsTU//9k\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/6c6cd5de13b8cd23dd2985c4d3ac7d36/gocRFLuN.jpg\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003cp\u003e这个工具是用 Go 写的，不过遗憾的是我没有 Go 语言环境，因此就没办法亲自体验了，作者提供的预编译版也只有 macOS 版。这种图片也是可以当缩略图使用的，虽然压到 2 KB 以内大概是做不到了……不过这种画风本身还是挺有趣的 (っ’ω’)っ\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e封面图：\u003ca href=\"https://www.pixiv.net/artworks/83265679\" target=\"_blank\" rel=\"noopener\"\u003ePixiv ID: 83265679 「チノちゃんと遊園地デート」 by チノマロン\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003cblockquote class=\"mdui-m-b-0 mdui-m-x-0 mdui-p-y-1\" style=\"border-left:4px solid rgba(0,0,0,.36)\"\u003e\u003cstrong\u003e本作品采用\u003ca href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh\" target=\"_blank\"\u003e知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议\u003c/a\u003e进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载。\u003c/strong\u003e\u003cbr/\u003e\u003cstrong\u003e本文作者：✨小透明・宸✨\u003c/strong\u003e\u003cbr/\u003e\u003cstrong\u003e本文链接：\u003ca href=\"https://akarin.dev/2021/11/04/progressive-image-loading/\"\u003ehttps://akarin.dev/2021/11/04/progressive-image-loading/\u003c/a\u003e\u003c/strong\u003e\u003c/blockquote\u003e\u003c/article\u003e",
  "Date": "2021-11-04T14:48:47Z",
  "Author": "✨小透明・宸✨"
}