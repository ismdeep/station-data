{
  "Source": "akarin.dev",
  "Title": "通过 VapourSynth 在 Premiere 中使用 ASS 字幕",
  "Link": "https://akarin.dev/2019/08/03/use-ass-in-premiere/",
  "Content": "\u003carticle class=\"mdui-p-a-3 mdui-card-content mdui-typo\"\u003e\u003cblockquote\u003e\u003cp\u003e封面图：\u003ca href=\"https://www.pixiv.net/member_illust.php?mode=medium\u0026amp;illust_id=62550768\" target=\"_blank\" rel=\"noopener\"\u003ePixiv ID: 62550768 「エロマンガ先生」 by 幽灵Genkyo\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003cdiv class=\"aplayer\" style=\"margin-bottom:20px\" id=\"aplayer-115556ab\"\u003e\u003c/div\u003e\u003cscript\u003e(window.aplayersLite||(window.aplayersLite=[])).push({container:document.getElementById(\"aplayer-115556ab\"),audio:{title:\"adrenaline!!!\",author:\"TrySail\",url:\"https://fs-im-kefu.7moor-fs2.com/im/2768a390-5474-11ea-afc9-7b323e3e16c0/dR7-w8ZD.m4a\",cover:\"https://p.sda1.dev/12/34dd04aeebd020509675781ba5f00a4c/J1doNgKH.jpg\"}})\u003c/script\u003e\u003cnoscript\u003e\u003cp\u003e\u003cem\u003e♪ adrenaline!!! - TrySail\u003c/em\u003e\u003c/p\u003e\u003caudio controls preload=\"metadata\" src=\"https://fs-im-kefu.7moor-fs2.com/im/2768a390-5474-11ea-afc9-7b323e3e16c0/dR7-w8ZD.m4a\"\u003e\u003c/audio\u003e\u003c/noscript\u003e\u003cp\u003e说到外挂字幕，像小透明这样的肥宅比较熟悉的应该是用 \u003ca href=\"http://www.aegisub.org/\" target=\"_blank\" rel=\"noopener\"\u003eAegisub\u003c/a\u003e 弄出来的 ASS 格式的字幕，几乎所有动画字幕组发外挂字幕的时候使用的都是这种格式。ASS 格式本身不难掌握，Aegisub 又是全平台的\u003cstrong\u003e免费开源软件\u003c/strong\u003e，有些字幕组还把 ASS 玩出了花，在每一集动画的 OP 和 ED 还有插曲处使用 Aegisub 弄出使字幕文件大小\u003cstrong\u003e增加数百 KB 甚至 MB\u003c/strong\u003e 的“卡拉 OK 特效字幕”，用这一套东西给视频加上字幕当然是坠吼的啦～(っ´ω｀)ﾉ\u003c/p\u003e\u003cp\u003e然而比较尴尬的是 ASS 字幕是开源产物，并没有成为工业标准，所以和 MKV 视频一样并不能直接拖进正统的非编软件里使用，至少小透明使用的 Premiere 是不行的。之前小透明也找到过一些解决方法，不过都不怎么完美(｡í _ ì｡)\u003c/p\u003e\u003ch1 id=\"不完美的解决方法\"\u003e\u003ca href=\"#不完美的解决方法\" class=\"headerlink\" title=\"不完美的解决方法\"\u003e\u003c/a\u003e不完美的解决方法\u003c/h1\u003e\u003ch2 id=\"使用-AviSynth-脚本读取插件\"\u003e\u003ca href=\"#使用-AviSynth-脚本读取插件\" class=\"headerlink\" title=\"使用 AviSynth 脚本读取插件\"\u003e\u003c/a\u003e使用 AviSynth 脚本读取插件\u003c/h2\u003e\u003cp\u003e一种方法是使用动画压制组（以前）经常使用的视频处理工具 \u003ca href=\"http://avisynth.nl/index.php/Main_Page\" target=\"_blank\" rel=\"noopener\"\u003eAviSynth\u003c/a\u003e。AviSynth 简单来说是一个通过\u003cstrong\u003e写脚本\u003c/strong\u003e来给视频加上缩放、切边、添加外挂字幕等各种滤镜的视频处理工具，x264 和 x265 之类的视频编码器可以通过 AviSynth 从脚本中获取（处理后的）每一帧视频数据进行编码。\u003c/p\u003e\u003cp\u003eAVS 脚本也不能直接拖进非编软件。对于 PR，有人编写了插件使 AVS 脚本在 PR 中可以被读取成可用的视频片段（具体请搜索“Premiere CS AVS Importer x64”）。\u003c/p\u003e\u003cp\u003e然而小透明在最新的 CC 2019 版 PR 中使用这个插件读取 AVS 脚本时会直接报错，也许是插件原作者没有继续维护，结果就不能兼容最新版本……总之是个过时的方法(=’_’=)\u003c/p\u003e\u003ch2 id=\"使用-ArcTime-将字幕导出成图片和序列\"\u003e\u003ca href=\"#使用-ArcTime-将字幕导出成图片和序列\" class=\"headerlink\" title=\"使用 ArcTime 将字幕导出成图片和序列\"\u003e\u003c/a\u003e使用 ArcTime 将字幕导出成图片和序列\u003c/h2\u003e\u003cp\u003e小透明在接触 Aegisub 之前也用过 \u003ca href=\"http://arctime.cn/\" target=\"_blank\" rel=\"noopener\"\u003eArcTime\u003c/a\u003e 这个字幕制作软件，它有个功能可以把 ASS 字幕的每一条字幕渲染成 PNG 图片，然后生成包含各张图片起止时间的 XML 文件，导入到 PR 中就可以根据起止时间组合成一个序列（可以当成是只有字幕的透明背景视频），叠加到正片上～(´ﾟωﾟ｀)\u003c/p\u003e\u003cp\u003e不过当时在小透明使用的低配渣机上使用 ArcTime 很容易卡顿，所以小透明后来就没有继续研究这个软件了_(:_」∠)_\u003c/p\u003e\u003cp\u003e性能的问题嘛……加钱加电脑配置就可以了，但是这个方法的缺陷是生成一大堆图片实在是太不优雅了！(╯‵□′)╯︵┻━┻ 一般的字幕还好，但是碰到那种“卡拉 OK 特效字幕”，每一个字的\u003cstrong\u003e出现、显示、消失各算一条字幕\u003c/strong\u003e，如果有粒子效果的话\u003cstrong\u003e每一个粒子也要算一条字幕\u003c/strong\u003e，那一句歌词，一首 OP 或 ED 的字幕要生成多少张图片，序列的时间线要堆上多少东西呢？\u003c/p\u003e\u003cp\u003e不过这个思路至少是可行的。按照 ArcTime 原作者的解释，用 XML 保存的序列是工业标准格式，兼容包括 PR 在内的各种非编软件。\u003c/p\u003e\u003cp\u003eArcTime 有\u003ca href=\"http://arctime.cn/service.html\" target=\"_blank\" rel=\"noopener\"\u003e收费项目\u003c/a\u003e可以解锁“软字幕序列”的导出功能，这种情况下导出的字幕是 PR 的专用格式，可以在 PR 中继续修改，不需要导出一大堆图片。收费的解决方案这里就不考虑啦～\u003c/p\u003e\u003ch2 id=\"使用-FFmpeg-生成带有字幕的透明背景视频\"\u003e\u003ca href=\"#使用-FFmpeg-生成带有字幕的透明背景视频\" class=\"headerlink\" title=\"使用 FFmpeg 生成带有字幕的透明背景视频\"\u003e\u003c/a\u003e使用 FFmpeg 生成带有字幕的透明背景视频\u003c/h2\u003e\u003cblockquote\u003e\u003cp\u003e参见：\u003ca href=\"https://halu.lu/%E7%AC%94%E8%AE%B0/%E5%9C%A8-premiere-%E4%B8%AD%E6%B7%BB%E5%8A%A0-ass-%E5%AD%97%E5%B9%95/\" target=\"_blank\" rel=\"noopener\"\u003e在Premiere中添加ASS字幕 - 無位小站\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003e和使用 ArcTime 一样，本质上是将字幕直接弄成视频素材放进 PR 中使用，不过使用 \u003ca href=\"https://ffmpeg.org/\" target=\"_blank\" rel=\"noopener\"\u003eFFmpeg\u003c/a\u003e 的话就可以直接生成视频了(*′ ▽‘)\u003c/p\u003e\u003cpre class=\"line-numbers language-none\"\u003e\u003ccode class=\"language-none\"\u003effmpeg -f lavfi -i \u0026#34;color=color=black@0.0:size=1920x1080,format=rgba,subtitles=subtitle.ass:alpha=1\u0026#34; -c:v qtrle -t \u0026#34;00:00:05.000\u0026#34; -r 60 subtitle.mov\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以上的命令可以生成一个时长为五秒的 1080p 60fps 透明视频，并且 \u003ccode\u003esubtitle.ass\u003c/code\u003e 的字幕内容也会被渲染进去。把最后生成的 \u003ccode\u003esubtitle.mov\u003c/code\u003e 拖进 PR 的时间轴上就可以了～\u003c/p\u003e\u003cp\u003e这个方法唯一的缺点来自于生成的视频文件本身。虽然上面的命令使用了 QuickTime 的无损压缩编码 \u003ccode\u003eqtrle\u003c/code\u003e，但是生成的视频文件本身还是要占用硬盘空间的，而且视频分辨率和帧率越高、时间越长，视频文件的大小也会更大。\u003c/p\u003e\u003ch1 id=\"VapourSynth-大法好！\"\u003e\u003ca href=\"#VapourSynth-大法好！\" class=\"headerlink\" title=\"VapourSynth 大法好！\"\u003e\u003c/a\u003eVapourSynth 大法好！\u003c/h1\u003e\u003cp\u003e上面的那些解决方法是小透明很久以前折腾的了。现在小透明因为学业不得不接触 Python，再加上小透明知道的\u003cruby\u003e某知名动画压制组\u003crt\u003eVCB-Studio\u003c/rt\u003e\u003c/ruby\u003e在自家的网站和论坛上公开了很多 VapourSynth 的教程，所以小透明也就开始接触这个东西啦！然后就发现用它可以完美满足在 PR 中使用 ASS 字幕的需求～\u003c/p\u003e\u003cp\u003eVapourSynth 和 AviSynth 差不多，也是写脚本处理视频输出给编码器的工具。不过 VapourSynth 使用 Python 作为脚本语言（当然它的使用也依赖于 Python 环境），更容易入门，而且生态比历史悠久、开发几乎陷入停滞的 AviSynth 好了很多（小透明放弃 AviSynth 的原因之一就是因为装的是 x64 版，然后发现很多十几年前的处理滤镜只有 x86 版且无人移植……）\u003c/p\u003e\u003ch2 id=\"配置-VapourSynth-压制环境\"\u003e\u003ca href=\"#配置-VapourSynth-压制环境\" class=\"headerlink\" title=\"配置 VapourSynth 压制环境\"\u003e\u003c/a\u003e配置 VapourSynth 压制环境\u003c/h2\u003e\u003cp\u003e先去 \u003ca href=\"https://www.python.org/downloads/\" target=\"_blank\" rel=\"noopener\"\u003ePython 的官方网站\u003c/a\u003e上下载安装 Python 运行环境，再去 \u003ca href=\"https://github.com/vapoursynth/vapoursynth/releases\" target=\"_blank\" rel=\"noopener\"\u003eVapourSynth 的官方 GitHub 仓库\u003c/a\u003e 下载安装 VapourSynth。如果没有问题的话，安装 VapourSynth 的时候会自动识别出之前安装的 Python 运行环境，总之下一步就可以了(´• ᵕ •`)*\u003c/p\u003e\u003cp\u003e虽然写 VapourSynth 的脚本用的是 Python，但是对于简单的压制脚本，实际上只会涉及到很小一部分的 Python 语法，大部分时候调用函数和赋值就完事了……而且仅仅是为了实现在 PR 中使用 ASS 字幕的话，更是只需要使用一个自带滤镜，不需要再安装别的东西。\u003c/p\u003e\u003cp\u003e在 Python 中输入以下代码，能显示 VapourSynth 的版本号就算是配置完了٩( ‘ω’ )و\u003c/p\u003e\u003cpre class=\"language-python line-numbers\" data-language=\"python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token comment\"\u003e# 引入VapourSynth\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e vapoursynth \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e vs\n\u003cspan class=\"token comment\"\u003e# 获取VapourSynth的版本并输出\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eversion\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/1231*707),707px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/067d94dd0b873deb57305d9722718d87/k-yiqNUJ.png\" data-src-webp=\"https://p.sda1.dev/12/d463b9dbbd1ce5d2bdebefd00634c05d/pD8lgmNa.webp\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAASACADASIAAhEBAxEB/8QAGwAAAQQDAAAAAAAAAAAAAAAAAAECBAUDBgf/xAAnEAABAwMCBAcAAAAAAAAAAAABAAIFBAYREiEDE0FRFSIxcYGUwf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDnTp+bZqHjVZ7c8qE+5Zsu80tIfFQ78K197i5xJOSmoL83LN9JeS+09YmXHcIO01XjJ6VHEVKlHqEEgtbk7BJpb2CEIDSOwQAMjYIQg//Z\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/067d94dd0b873deb57305d9722718d87/k-yiqNUJ.png\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003ch2 id=\"字幕视频脚本的编写和-avfs-的使用\"\u003e\u003ca href=\"#字幕视频脚本的编写和-avfs-的使用\" class=\"headerlink\" title=\"字幕视频脚本的编写和 avfs 的使用\"\u003e\u003c/a\u003e字幕视频脚本的编写和 \u003ccode\u003eavfs\u003c/code\u003e 的使用\u003c/h2\u003e\u003cp\u003e实际压片时，一般都是把脚本保存为扩展名为 \u003ccode\u003e*.vpy\u003c/code\u003e 的文件来使用的。用记事本新建一个文本文档，输入下面的代码就可以创建一个带有字幕的视频：\u003c/p\u003e\u003cp\u003e（这里使用的例子是《埃罗芒阿老师》的 NCED 的特效字幕。从\u003ca href=\"https://files.catbox.moe/2zx0en.mp4\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e和\u003ca href=\"https://files.catbox.moe/0gwn5t.ass\" target=\"_blank\" rel=\"noopener\"\u003e这里\u003c/a\u003e分别可以下载片源和字幕。另外需要预先安装字幕渲染器 \u003ccode\u003evsrepo install subtext\u003c/code\u003e，VSFilter 等等其他的渲染器在这里是不能满足需求的）\u003c/p\u003e\u003cpre class=\"language-python line-numbers\" data-language=\"python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e vapoursynth \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e vs\n\n\u003cspan class=\"token comment\"\u003e# 将clip设为一个两分钟的1080p 60fps黑色空白视频\u003c/span\u003e\nclip \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e vs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eBlankClip\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewidth\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1920\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e height\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1080\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e length\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e60\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e120\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fpsnum\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e60\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fpsden\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# 使用sub.TextFile()函数将字幕渲染到clip上，返回渲染后的视频并赋值给subs\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 记得替换字幕文件的路径，路径前面加个r是禁用Python对字符串的转义\u003c/span\u003e\nsubs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e vs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esub\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTextFile\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eclip\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003er\u0026#34;G:\\Anime\\[VCB-Studio] Eromanga Sensei [Ma10p_1080p]\\SPs\\Subs\\[VCB-Studio] Eromanga Sensei [NCED02][Ma10p_1080p][x265_flac].ass\u0026#34;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# 设置字幕视频subs为脚本的输出\u003c/span\u003e\nsubs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eset_output\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e脚本写完了，不过怎么才能看到视频呢？这就要用的 \u003ccode\u003eavfs\u003c/code\u003e 这个小工具了。\u003c/p\u003e\u003cp\u003e\u003ccode\u003eavfs\u003c/code\u003e 全称“AviSynth Virtual File System”，看这名字就知道和 AviSynth 有一些关系，实际上它来自于一个\u003ca href=\"https://turtlewar.org/avfs/\" target=\"_blank\" rel=\"noopener\"\u003e为 AviSynth 编写的插件\u003c/a\u003e，可以在电脑中虚拟出一个包含了无损 AVI 文件的目录，那个 AVI 文件就是 AVS 脚本处理后的视频数据。VapourSynth 安装时也自带了这个组件，还可以把 \u003ccode\u003e*.vpy\u003c/code\u003e 的脚本拿过去用～\u003c/p\u003e\u003cp\u003e把 \u003ccode\u003e*.vpy\u003c/code\u003e 的“打开方式”设为 VapourSynth 安装目录下的 \u003ccode\u003ecore\u003c/code\u003e 文件夹中的 \u003ccode\u003eavfs.exe\u003c/code\u003e，打开后就会弹出命令行窗口显示虚拟的视频目录的路径，退出时记得按 \u003ckbd\u003eCtrl+C\u003c/kbd\u003e 而不是直接按右上角红叉，虚拟目录会自动消失。\u003c/p\u003e\u003cp\u003e如果没有视频文件，大概是脚本写错了，在 \u003ccode\u003eerror.log\u003c/code\u003e 里可以看到报错信息。如果修改了脚本，需要退出 \u003ccode\u003eavfs\u003c/code\u003e 然后重新打开才能应用更改。\u003c/p\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/1326*763),763px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/2cff499ce12a9e7aa45d1b404012b3f0/R3K_YxEH.png\" data-src-webp=\"https://p.sda1.dev/12/7983ce16661684b601e5acc21fa995c4/LCx5EEyd.webp\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAASACADASIAAhEBAxEB/8QAGQAAAwADAAAAAAAAAAAAAAAAAAIEAQUH/8QAIhAAAgICAQMFAAAAAAAAAAAAAQIAEQMEIRIxgTNBQlHh/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/AO4lFTVVwtBcgUA2feog2bNIR27EfsqfAU17LnlgQLuubmtwfPlQeqBauyodlYgkeJTXUt1wR9xtfVwPjDugLG7MzAiLMQQWNRYQgX4PSXzCEIH/2Q\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/2cff499ce12a9e7aa45d1b404012b3f0/R3K_YxEH.png\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003cp\u003e双击 AVI 文件就可以直接播放脚本处理后的视频了，实际上是 AviSynth / VapourSynth 在实时处理并输出视频数据。虽然文件看起来很大（要把小透明的硬盘塞满了……？），不过因为这个目录都是\u003cstrong\u003e虚拟出来的\u003c/strong\u003e，所以实际上完全不占用硬盘存储空间，不像上面的两个方法一样需要生成大量“中间产物”。\u003c/p\u003e\u003cp\u003e（还可以使用 VapourSynth 自带的另一个工具 \u003ccode\u003evspipe\u003c/code\u003e 将脚本处理后的视频数据输出给编码器，具体方法略）\u003c/p\u003e\u003ch2 id=\"使用“遮罩”组合出字幕视频\"\u003e\u003ca href=\"#使用“遮罩”组合出字幕视频\" class=\"headerlink\" title=\"使用“遮罩”组合出字幕视频\"\u003e\u003c/a\u003e使用“遮罩”组合出字幕视频\u003c/h2\u003e\u003cp\u003e现在这个虚拟的 AVI 文件就可以拖到 PR 的时间线上了～不过 VapourSynth 不支持输出带有透明度的视频，所以字幕的视频仍然是\u003cstrong\u003e黑色背景色\u003c/strong\u003e，即使能在非编中使用也没有意义ﾍ(´ー｀ﾍ)\u003c/p\u003e\u003cp\u003e\u003ccode\u003evs.core.sub.TextFile()\u003c/code\u003e 函数有个布尔类型的参数 \u003ccode\u003eblend\u003c/code\u003e，默认为 \u003ccode\u003eTrue\u003c/code\u003e，表示返回在源视频上渲染了字幕后的视频，如果设为 \u003ccode\u003eFalse\u003c/code\u003e 的话，就会返回两个视频：\u003c/p\u003e\u003cul\u003e\u003cli\u003e以 \u003ccode\u003eRGB24\u003c/code\u003e 的颜色格式保存的，在黑色背景上渲染的字幕视频。\u003c/li\u003e\u003cli\u003e以 \u003ccode\u003eGRAY8\u003c/code\u003e 的颜色格式（也就是只有灰度）保存的遮罩用视频。\u003c/li\u003e\u003c/ul\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/700*300),300px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/56c629b39e1a2249d0cf710ff6b1aad9/wBKoGp2h.jpg\" data-src-webp=\"https://p.sda1.dev/12/b605c2d3378786f408e61776e2e7eff6/QGVb5Cdo.webp\" data-src-avif=\"https://p.sda1.dev/12/890994833502efa75f5bcd3fafe8419c/Rj9zsVX2.jpg\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAOACADASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAABwMEBgj/xAAhEAABBAMBAAIDAAAAAAAAAAABAgMEEQAFEgYHMRYhI//EABUBAQEAAAAAAAAAAAAAAAAAAAEA/8QAHBEBAQEAAQUAAAAAAAAAAAAAAQIAERIxMnGh/9oADAMBAAIRAxEAPwA183rJszXSVsaBmcgP0VlfLgPBpAo3WbRek2Dcdsn48iGlK+pFnExHidA0KbgtpF3QyZXk9OtHC4wUm7oqJF4FwnZ1UUV5nHrED2tniLPr48jJ/mbWHiSj9CygdYebhmM0toN6yVCWW0dNvkkE8iymwDRzp/8ACfOVStYypJ+xZyzI81ppLbTL8Bt1pquEOLWpKeRyKBOFXILmZ5Q6vm//2Q\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/56c629b39e1a2249d0cf710ff6b1aad9/wBKoGp2h.jpg\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003cp\u003e上面分别是遮罩视频、字幕视频和在片源上渲染了字幕的视频。遮罩视频的白到黑对应字幕视频每个像素 0~100% 的不透明度，例如这里的最后一个字符是半透明的，在遮罩中就显示为灰色。\u003c/p\u003e\u003cp\u003e（VSFilter 等更常用的字幕渲染器只能直接把字幕渲染到视频上，不能像这样把遮罩分离出来。）\u003c/p\u003e\u003cp\u003e因此就需要准备两个脚本，分别命名为 \u003ccode\u003esubtitle_source.vpy\u003c/code\u003e 和 \u003ccode\u003esubtitle_mask.vpy\u003c/code\u003e，对应字幕视频和遮罩视频，脚本内容几乎没有什么区别：\u003c/p\u003e\u003cpre class=\"language-python line-numbers\" data-language=\"python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e vapoursynth \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e vs\n\nclip \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e vs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eBlankClip\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewidth\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1920\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e height\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1080\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e length\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e60\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e120\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fpsnum\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e60\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fpsden\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nsubtitle_path \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003er\u0026#34;G:\\Anime\\[VCB-Studio] Eromanga Sensei [Ma10p_1080p]\\SPs\\Subs\\[VCB-Studio] Eromanga Sensei [NCED02][Ma10p_1080p][x265_flac].ass\u0026#34;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# 字幕视频\u003c/span\u003e\nsubs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e vs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esub\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTextFile\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eclip\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e subtitle_path\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e blend\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 遮罩视频\u003c/span\u003e\nmask \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e vs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecore\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ePropToClip\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esubs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\u0026#39;_Alpha\u0026#39;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# 在subtitle_source.vpy中，使用这行将字幕视频作为输出\u003c/span\u003e\nsubs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eset_output\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 在subtitle_mask.vpy中，使用这行将遮罩视频作为输出\u003c/span\u003e\nmask\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eset_output\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"line-numbers-rows\" aria-hidden=\"true\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e然后把两个虚拟的 AVI 文件拖到 PR 的时间线上，片源放在轨道 1，字幕视频放在轨道 2，遮罩视频放在轨道 3 并隐藏输出。然后……“效果”→“视频效果”→“通道”→\u003cstrong\u003e“设置遮罩”\u003c/strong\u003e，把这个拖到字幕视频上，在它的“效果控件”中选择获取遮罩的图层为\u003cstrong\u003e遮罩视频所在的轨道 3\u003c/strong\u003e，“用于遮罩”选择“红色/绿色/蓝色通道”或“明亮度”或“变亮”之一（因为遮罩视频是单色灰度，所以没有区别啦～），这样轨道 2 上的就是带有透明度的字幕视频了！( ´▽` )ﾉ\u003c/p\u003e\u003cfigure class=\"akarin-blurred-container\"\u003e\u003cdiv style=\"padding-bottom:min(calc(100%/1920*1080),1080px,480px)\"\u003e\u003c/div\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded\" data-src=\"https://p.sda1.dev/12/7ac96d9cf193efdf942a46922ac0a259/D8q9cfNG.png\" data-src-webp=\"https://p.sda1.dev/12/3a19de335bf68ec4c58146c0fb5f1ab3/9JRzA5D7.webp\"/\u003e \u003cimg class=\"mdui-hoverable mdui-img-rounded akarin-blurred\" src=\"data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAASACADASIAAhEBAxEB/8QAGwAAAQQDAAAAAAAAAAAAAAAAAAIDBgcBBAX/xAAlEAABBAIABAcAAAAAAAAAAAABAAIDBAUREhUhkzJEUWFxgpH/xAAXAQEBAQEAAAAAAAAAAAAAAAAAAQID/8QAIREAAQQCAAcAAAAAAAAAAAAAAgABAxEEFAUSEzJRUnH/2gAMAwEAAhEDEQA/AKyOZy4OuZWu65OxZ7MDe8jad8zydPwrmEBrk5DDxloDmNBPiedAKopljZsxb4SLmQkG+pbNL6exUojqWBFIZbN8OETnDdiYdR9lWgx+vP1O6tayx8BaBYjfsb3G8uC5zxGcdCTg+v07b2u+f6pxFtvPxsiF9eOMWYoQ7TrzVJlwGykkDZQhbVSSAsIQiL//2Q\"/\u003e\u003cnoscript\u003e\u003cimg class=\"mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid\" src=\"https://p.sda1.dev/12/7ac96d9cf193efdf942a46922ac0a259/D8q9cfNG.png\" alt=\"undefined\" title=\"undefined\"\u003e\u003c/noscript\u003e\u003c/figure\u003e\u003cp\u003e（这里把片源换成了彩条）\u003c/p\u003e\u003cp\u003e现在对于使用 PR 剪辑的视频，就可以根据下面的流程加上 ASS 格式的字幕了ヽ(´•ω•`)､\u003c/p\u003e\u003col\u003e\u003cli\u003e完成视频的剪辑\u003c/li\u003e\u003cli\u003e导出一份码率较低、分辨率较低、帧率较低……（总之能让视频导出的时间缩短就行）的临时视频\u003c/li\u003e\u003cli\u003e在 Aegisub 中用临时视频制作出字幕\u003c/li\u003e\u003cli\u003e用以上的方法将字幕弄成虚拟 AVI 文件，导入时间轴\u003c/li\u003e\u003cli\u003e导出正片\u003c/li\u003e\u003c/ol\u003e\u003chr/\u003e\u003cp\u003e其实也可以直接导出正片再制作字幕，然后从 AviSynth、VapourSynth、FFmpeg、x264、x265……选择自己喜欢的工具进行硬字幕的压制。不过这样相当于进行了二压，画质会有损失，小透明还是有点介意这个的啦┓( ´∀` )┏\u003c/p\u003e\u003cp\u003e不想二压的话，也可以安装 PR 的插件 \u003ca href=\"https://www.debugmode.com/frameserver/\" target=\"_blank\" rel=\"noopener\"\u003eDebugmode FrameServer\u003c/a\u003e，从 PR 直接导出虚拟 AVI，通过 Vapoursynth 脚本的 \u003ccode\u003evs.core.avisource.AVISource\u003c/code\u003e 读取，再使用 VSFilter 等常用的渲染器添加字幕，最后通过 \u003ccode\u003evspipe\u003c/code\u003e 输出给编码器。除非你还要在 PR 里进行更多的剪辑，否则这种做法其实更简单……\u003c/p\u003e\u003cp\u003e最后来一个用上面的那个特效字幕压制的硬字幕版的《埃罗芒阿老师》的 NCED，这种特效还是挺有意思的～\u003c/p\u003e\u003cp\u003e\u003cvideo controls=\"\" poster=\"https://p.sda1.dev/12/1b8358f50a816fe9dcde2f6ab73e7fcf/hUPjNCVE.jpg\" preload=\"metadata\" src=\"https://fs-im-kefu.7moor-fs2.com/im/2768a390-5474-11ea-afc9-7b323e3e16c0/E7xbDWEl.mp4\" type=\"video/mp4; codecs=\u0026#34;av01.0.08M.10,Opus\u0026#34;\"\u003e\u003c/video\u003e\u003c/p\u003e\u003cp\u003e（AV1+Opus 编码，如果播放不了请更新浏览器）\u003c/p\u003e\u003cblockquote class=\"mdui-m-b-0 mdui-m-x-0 mdui-p-y-1\" style=\"border-left:4px solid rgba(0,0,0,.36)\"\u003e\u003cstrong\u003e本作品采用\u003ca href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh\" target=\"_blank\"\u003e知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议\u003c/a\u003e进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载。\u003c/strong\u003e\u003cbr/\u003e\u003cstrong\u003e本文作者：✨小透明・宸✨\u003c/strong\u003e\u003cbr/\u003e\u003cstrong\u003e本文链接：\u003ca href=\"https://akarin.dev/2019/08/03/use-ass-in-premiere/\"\u003ehttps://akarin.dev/2019/08/03/use-ass-in-premiere/\u003c/a\u003e\u003c/strong\u003e\u003c/blockquote\u003e\u003c/article\u003e",
  "Date": "2019-08-03T10:10:30Z",
  "Author": "✨小透明・宸✨"
}