{
  "Source": "antonz.org",
  "Title": "Building a pivot table in SQLite",
  "Link": "https://antonz.org/sqlite-pivot-table/",
  "Content": "\u003carticle class=\"post\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12 col-md-10 article\"\u003e\u003cheader\u003e\u003ch1\u003eBuilding a pivot table in SQLite\u003c/h1\u003e\u003c/header\u003e\u003cp\u003eSuppose we have a \u003ccode\u003esales\u003c/code\u003e table with product incomes for the years 2020-2023:\u003c/p\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e┌─────────┬──────┬────────┐\n│ product │ year │ income │\n├─────────┼──────┼────────┤\n│ alpha   │ 2020 │ 100    │\n│ alpha   │ 2021 │ 120    │\n│ alpha   │ 2022 │ 130    │\n│ alpha   │ 2023 │ 140    │\n│ beta    │ 2020 │ 10     │\n│ beta    │ 2021 │ 20     │\n│ beta    │ 2022 │ 40     │\n│ beta    │ 2023 │ 80     │\n│ gamma   │ 2020 │ 80     │\n│ gamma   │ 2021 │ 75     │\n│ gamma   │ 2022 │ 78     │\n│ gamma   │ 2023 │ 80     │\n└─────────┴──────┴────────┘\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca href=\"https://sqlime.org/#gist:4a46833d948e8635593fec028eb178ba\"\u003eplayground\u003c/a\u003e • \u003ca href=\"./sales.sql\"\u003edownload\u003c/a\u003e\u003c/p\u003e\u003cp\u003eAnd we want to transform it into a so-called \u003cem\u003epivot table\u003c/em\u003e, where products serve as rows and years serve as columns:\u003c/p\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e┌─────────┬──────┬──────┬──────┬──────┐\n│ product │ 2020 │ 2021 │ 2022 │ 2023 │\n├─────────┼──────┼──────┼──────┼──────┤\n│ alpha   │ 100  │ 120  │ 130  │ 140  │\n│ beta    │ 10   │ 20   │ 40   │ 80   │\n│ gamma   │ 80   │ 75   │ 78   │ 80   │\n└─────────┴──────┴──────┴──────┴──────┘\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eSome DBMS, like SQL Server, have a custom \u003ccode\u003epivot\u003c/code\u003e operator to do this. SQLite does not. Still, there are multiple ways to solve the problem. Let\u0026#39;s examine them.\u003c/p\u003e\u003ch2 id=\"1-filtered-totals\"\u003e1. Filtered totals\u003c/h2\u003e\u003cp\u003eLet\u0026#39;s manually extract each year in a separate column and calculate a filtered total income for that year:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003efilter\u003c/span\u003e (\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2020\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2020\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003efilter\u003c/span\u003e (\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2021\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2021\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003efilter\u003c/span\u003e (\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2022\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2022\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003efilter\u003c/span\u003e (\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2023\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2023\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esales\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003egroup\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eby\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eorder\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eby\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHere is our pivot table:\u003c/p\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e┌─────────┬──────┬──────┬──────┬──────┐\n│ product │ 2020 │ 2021 │ 2022 │ 2023 │\n├─────────┼──────┼──────┼──────┼──────┤\n│ alpha   │ 100  │ 120  │ 130  │ 140  │\n│ beta    │ 10   │ 20   │ 40   │ 80   │\n│ gamma   │ 80   │ 75   │ 78   │ 80   │\n└─────────┴──────┴──────┴──────┴──────┘\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis universal method works in every DBMS, not only SQLite. Even if your DB engine does not support \u003ccode\u003efilter\u003c/code\u003e, you can always resort to using \u003ccode\u003ecase\u003c/code\u003e:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ewhen\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2020\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ethen\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eend\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2020\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ewhen\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2021\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ethen\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eend\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2021\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ewhen\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2022\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ethen\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eend\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2022\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ewhen\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2023\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ethen\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eend\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2023\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esales\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003egroup\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eby\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eorder\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eby\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe \u003ccode\u003ecase\u003c/code\u003e statement is used here to include only income values for the \u003ccode\u003eyear\u003c/code\u003e that matches the specified year.\u003c/p\u003e\u003cp\u003eUsing \u003ccode\u003efilter\u003c/code\u003e is probably the easiest way when we know the columns in advance. But what if we don\u0026#39;t?\u003c/p\u003e\u003ch2 id=\"2-dynamic-sql\"\u003e2. Dynamic SQL\u003c/h2\u003e\u003cp\u003eLet\u0026#39;s build our query dynamically without hardcoding year values:\u003c/p\u003e\u003col\u003e\u003cli\u003eExtract distinct year values.\u003c/li\u003e\u003cli\u003eGenerate a \u003ccode\u003e...filter (where year = X) as \u0026#34;X\u0026#34;\u003c/code\u003e query line for each year.\u003c/li\u003e\u003c/ol\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ewith\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eyears\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003edistinct\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esales\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003elines\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;select product \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#000\"\u003epart\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eunion\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;, sum(income) filter (where year = \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;) as \u0026#34;\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;\u0026#34; \u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eyears\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eunion\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;from sales group by product order by product;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003egroup_concat\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003epart\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003elines\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis query returns the same SQL we wrote manually at the previous step (minus formatting):\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e , \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003efilter\u003c/span\u003e (\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2020\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2020\u0026#34;\u003c/span\u003e , \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003efilter\u003c/span\u003e (\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2021\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2021\u0026#34;\u003c/span\u003e , \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003efilter\u003c/span\u003e (\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2022\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2022\u0026#34;\u003c/span\u003e , \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003efilter\u003c/span\u003e (\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e2023\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;2023\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esales\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003egroup\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eby\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eorder\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eby\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow we have to execute it. For that, let\u0026#39;s use the \u003ccode\u003eeval(sql)\u003c/code\u003e function available as part of the \u003ca href=\"https://github.com/nalgeon/sqlean/blob/main/docs/define.md\"\u003e\u003ccode\u003edefine\u003c/code\u003e\u003c/a\u003e extension:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eload_extension\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;./define\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ewith\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eyears\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003edistinct\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esales\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003elines\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;drop view if exists v_sales; \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#000\"\u003epart\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eunion\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;create view v_sales as \u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eunion\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;select product \u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eunion\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;, sum(income) filter (where year = \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;) as \u0026#34;\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;\u0026#34; \u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eyears\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eunion\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;from sales group by product order by product;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eeval\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003egroup_concat\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003epart\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003elines\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHere, we are building a \u003ccode\u003ev_sales\u003c/code\u003e view which executes the query we\u0026#39;ve constructed previously. Let\u0026#39;s select the data from it:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ev_sales\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e┌─────────┬──────┬──────┬──────┬──────┐\n│ product │ 2020 │ 2021 │ 2022 │ 2023 │\n├─────────┼──────┼──────┼──────┼──────┤\n│ alpha   │ 100  │ 120  │ 130  │ 140  │\n│ beta    │ 10   │ 20   │ 40   │ 80   │\n│ gamma   │ 80   │ 75   │ 78   │ 80   │\n└─────────┴──────┴──────┴──────┴──────┘\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\u003cp\u003eNote: extensions do not work in the playground, so you\u0026#39;ll have to use your local SQLite to reproduce this step.\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003eNice!\u003c/p\u003e\u003ch2 id=\"3-pivot-extension\"\u003e3. Pivot extension\u003c/h2\u003e\u003cp\u003eIf dynamic SQL seems too much for you, there is a more straightforward solution — the \u003ca href=\"https://github.com/nalgeon/sqlean/issues/27#issuecomment-997052157\"\u003e\u003ccode\u003epivotvtab\u003c/code\u003e\u003c/a\u003e extension.\u003c/p\u003e\u003cp\u003eWith it, we only have to provide three selects to build a pivot:\u003c/p\u003e\u003col\u003e\u003cli\u003eSelect row values.\u003c/li\u003e\u003cli\u003eSelect column values.\u003c/li\u003e\u003cli\u003eSelect cell values.\u003c/li\u003e\u003c/ol\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eload_extension\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;./pivotvtab\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ecreate\u003c/span\u003e \u003cspan style=\"color:#000\"\u003evirtual\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ev_sales\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eusing\u003c/span\u003e \u003cspan style=\"color:#000\"\u003epivot_vtab\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#177500\"\u003e-- rows\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e  (\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003edistinct\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esales\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#177500\"\u003e-- columns\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e  (\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003edistinct\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e, \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esales\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#177500\"\u003e-- cells\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e  (\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eincome\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esales\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eproduct\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e?\u003c/span\u003e\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eyear\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e?\u003c/span\u003e\u003cspan style=\"color:#1c01ce\"\u003e2\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003epivot_vtab\u003c/code\u003e takes three arguments:\u003c/p\u003e\u003col\u003e\u003cli\u003eA subquery that specifies the rows of the virtual table. In this case, the subquery selects all distinct products.\u003c/li\u003e\u003cli\u003eA subquery that specifies the columns of the virtual table. In this case, the subquery selects all distinct years. \u003ccode\u003epivot_vtab\u003c/code\u003e expects two values for each column, one for the column value and one for the column name. By duplicating the \u003ccode\u003eyear\u003c/code\u003e value, we are effectively using it as both the value and name for the column.\u003c/li\u003e\u003cli\u003eA subquery that specifies the values of the virtual table. In this case, the subquery selects the total \u003ccode\u003eincome\u003c/code\u003e for a specific \u003ccode\u003eproduct\u003c/code\u003e and \u003ccode\u003eyear\u003c/code\u003e combination. The \u003ccode\u003e?1\u003c/code\u003e and \u003ccode\u003e?2\u003c/code\u003e placeholders in the subquery represent parameters that will be filled in at runtime with the actual values for \u003ccode\u003eproduct\u003c/code\u003e and \u003ccode\u003eyear\u003c/code\u003e.\u003c/li\u003e\u003c/ol\u003e\u003cp\u003eThe extension does the rest:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ev_sales\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e┌─────────┬──────┬──────┬──────┬──────┐\n│ product │ 2020 │ 2021 │ 2022 │ 2023 │\n├─────────┼──────┼──────┼──────┼──────┤\n│ alpha   │ 100  │ 120  │ 130  │ 140  │\n│ beta    │ 10   │ 20   │ 40   │ 80   │\n│ gamma   │ 80   │ 75   │ 78   │ 80   │\n└─────────┴──────┴──────┴──────┴──────┘\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThat\u0026#39;s even easier than the \u003ccode\u003epivot\u003c/code\u003e operator in SQL Server!\u003c/p\u003e\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\u003cp\u003eThere are three ways to build a pivot table in SQLite:\u003c/p\u003e\u003col\u003e\u003cli\u003eUsing plain SQL and \u003ccode\u003esum()\u003c/code\u003e + \u003ccode\u003efilter\u003c/code\u003e expressions.\u003c/li\u003e\u003cli\u003eBuilding and executing a dynamic query with the \u003ccode\u003eeval()\u003c/code\u003e function.\u003c/li\u003e\u003cli\u003eUtilizing the \u003ccode\u003epivotvtab\u003c/code\u003e extension.\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e──\u003c/p\u003e\u003cp\u003eP.S. \u003cmark\u003eInterested in using SQL for data analytics?\u003c/mark\u003e Check out my book — \u003ca href=\"/sql-window-functions-book\"\u003eSQL Window Functions Explained\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003cem\u003e\u003ca href=\"/subscribe/\"\u003e\u003ci class=\"fas fa-star\"\u003e\u003c/i\u003e \u003cstrong\u003eSubscribe\u003c/strong\u003e\u003c/a\u003e\nto keep up with new posts.\u003c/em\u003e\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cfooter class=\"post__footer\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12\"\u003e\u003cdiv class=\"post__date\"\u003e\u003ctime datetime=\"2023-02-09 14:00:00 +0000 UTC\"\u003e09 Feb, 2023\u003c/time\u003e\u003c/div\u003e\u003cdiv class=\"post__tags\"\u003e\u003ca href=\"/tags/sqlite/\"\u003esqlite\u003c/a\u003e \u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/footer\u003e\u003c/article\u003e",
  "Date": "2023-02-09T14:00:00Z",
  "Author": "Anton Zhiyanov"
}