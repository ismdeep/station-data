{
  "Source": "antonz.org",
  "Title": "Reading and writing files in SQLite",
  "Link": "https://antonz.org/sqlean-fileio/",
  "Content": "\u003carticle class=\"post\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12 col-md-10 article\"\u003e\u003cheader\u003e\u003ch1\u003eReading and writing files in SQLite\u003c/h1\u003e\u003c/header\u003e\u003cp\u003eSometimes it\u0026#39;s useful to load a dataset from an external file or export query results to a file.\u003c/p\u003e\u003cp\u003eSQLite does not support file I/O operations by default. However, you can easily enable them using the \u003ccode\u003esqlean-fileio\u003c/code\u003e extension.\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e\u003cstrong\u003eNote\u003c/strong\u003e. Unlike other DBMS, adding extensions to SQLite is a breeze. Download a file, run one database command — and you are good to go.\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003e\u003ccode\u003esqlean-fileio\u003c/code\u003e solves common import/export tasks such as:\u003c/p\u003e\u003cul\u003e\u003cli\u003eLoading a JSON document from a file.\u003c/li\u003e\u003cli\u003eReading a text file line by line.\u003c/li\u003e\u003cli\u003eStreaming query results to a file.\u003c/li\u003e\u003cli\u003eImporting all files in a directory.\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eLet\u0026#39;s look at some examples.\u003c/p\u003e\u003ch2 id=\"loading-a-json-document-from-a-file\"\u003eLoading a JSON Document From a File\u003c/h2\u003e\u003cp\u003eSuppose we have a JSON file containing employee data:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003e\u0026#34;employees\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e11\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Diane\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e70\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e12\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Bob\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e78\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e21\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Emma\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e84\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e22\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Grace\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e90\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e23\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Henry\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e104\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e24\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Irene\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e104\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e25\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Frank\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e120\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e31\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Cindy\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e96\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e32\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Dave\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e96\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        { \u003cspan style=\"color:#000\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e33\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Alice\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003e\u0026#34;salary\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#1c01ce\"\u003e100\u003c/span\u003e }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnd an \u003ccode\u003eemployees\u003c/code\u003e table:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ecreate\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eemployees\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003einteger\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eprimary\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ekey\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003esalary\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003einteger\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTo import the JSON data into the table, we combine \u003ccode\u003efileo_read()\u003c/code\u003e with \u003ccode\u003ejson_tree()\u003c/code\u003e:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003einsert\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003einto\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eemployees\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eid\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003ename\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003esalary\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003ejson_extract\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003evalue\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;$.id\u0026#39;\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003ejson_extract\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003evalue\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;$.name\u0026#39;\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003ejson_extract\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003evalue\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;$.salary\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ejson_tree\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003efileio_read\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;employees.json\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;object\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efullkey\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003elike\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;$.employees%\u0026#39;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003efileio_read()\u003c/code\u003e loads the file as a blob, while \u003ccode\u003ejson_tree()\u003c/code\u003e iterates over it. When the query completes, the data is imported into the \u003ccode\u003eemployees\u003c/code\u003e table:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eemployees\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e┌────┬───────┬────────┐\n│ id │ name  │ salary │\n├────┼───────┼────────┤\n│ 11 │ Diane │ 70     │\n│ 12 │ Bob   │ 78     │\n│ 21 │ Emma  │ 84     │\n│ 22 │ Grace │ 90     │\n│ 23 │ Henry │ 104    │\n│ 24 │ Irene │ 104    │\n│ 25 │ Frank │ 120    │\n│ 31 │ Cindy │ 96     │\n│ 32 │ Dave  │ 96     │\n│ 33 │ Alice │ 100    │\n└────┴───────┴────────┘\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"reading-a-text-file-line-by-line\"\u003eReading a Text File Line by Line\u003c/h2\u003e\u003cp\u003eReading the whole file into memory, as we did with \u003ccode\u003eemployees.json\u003c/code\u003e, may not be a good idea for very large files (e.g., logs with millions of lines). In this case, it is better to read the file line by line.\u003c/p\u003e\u003cp\u003eSuppose we have an \u003ccode\u003eapp.log\u003c/code\u003e file with 1M lines:\u003c/p\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ets=2023-02-26 13:00:00,level=INFO,message=begin processing\nts=2023-02-26 13:01:00,level=INFO,message=processed 1000 records\nts=2023-02-26 13:02:00,level=INFO,message=processed 2000 records\nts=2023-02-26 13:03:00,level=INFO,message=processed 3000 records\nts=2023-02-26 13:03:25,level=ERROR,message=invalid record data\nts=2023-02-26 13:03:25,level=INFO,message=processing failed\n...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAnd an \u003ccode\u003eapp_log\u003c/code\u003e table:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ecreate\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003eline\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026#39;s iterate over the log file with \u003ccode\u003efileio_scan()\u003c/code\u003e, loading lines one by one, and inserting them into the table:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003einsert\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003einto\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eline\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003evalue\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efileio_scan\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;app.log\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ecount\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e-- 1000000\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow we can extract the individual fields using the \u003ccode\u003eregexp_capture\u003c/code\u003e function from the \u003ca href=\"/sqlean-regexp/\"\u003e\u003ccode\u003esqlean-regexp\u003c/code\u003e\u003c/a\u003e extension:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ealter\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eadd\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ecolumn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ets\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ealter\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eadd\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ecolumn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003elevel\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ealter\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eadd\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ecolumn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emessage\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eupdate\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eset\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ets\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eregexp_capture\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eline\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;ts=([^,]+)\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eupdate\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eset\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003elevel\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eregexp_capture\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eline\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;level=([^,]+)\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eupdate\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eset\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emessage\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eregexp_capture\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eline\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;message=([^,]+)\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow each log field is stored in a separate column:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ets\u003c/span\u003e, \u003cspan style=\"color:#a90d91\"\u003elevel\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003emessage\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003elimit\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e5\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e┌─────────────────────┬───────┬────────────────────────┐\n│         ts          │ level │        message         │\n├─────────────────────┼───────┼────────────────────────┤\n│ 2023-02-26 13:00:00 │ INFO  │ begin processing       │\n│ 2023-02-26 13:01:00 │ INFO  │ processed 1000 records │\n│ 2023-02-26 13:02:00 │ INFO  │ processed 2000 records │\n│ 2023-02-26 13:03:00 │ INFO  │ processed 3000 records │\n│ 2023-02-26 13:03:25 │ ERROR │ invalid record data    │\n└─────────────────────┴───────┴────────────────────────┘\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNeat!\u003c/p\u003e\u003ch2 id=\"streaming-query-results-to-a-file\"\u003eStreaming Query Results to a File\u003c/h2\u003e\u003cp\u003eSuppose we want to export the ERROR log lines into a separate file. Let\u0026#39;s use \u003ccode\u003efileio_append\u003c/code\u003e for that:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003esum\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#000\"\u003efileio_append\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;error.log\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;%s: %s\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003ets\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003emessage\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003echar\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e10\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e) \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eapp_log\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003elevel\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;ERROR\u0026#39;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis is \u003ccode\u003eerror.log\u003c/code\u003e after the export:\u003c/p\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e2023-02-26 13:03:25: invalid record data\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"importing-all-files-in-a-directory\"\u003eImporting All Files in a Directory\u003c/h2\u003e\u003cp\u003eSuppose we have multiple log files:\u003c/p\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eapp.log.1\napp.log.2\napp.log.3\n...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eLet\u0026#39;s import them all at once using the \u003ccode\u003efilio_ls()\u003c/code\u003e function.\u003c/p\u003e\u003cp\u003eFirst, we\u0026#39;ll look at the files to make sure we\u0026#39;re loading the correct data:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efileio_ls\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;logs\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003elike\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;logs/app.log%\u0026#39;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e┌────────────────┬───────┬────────────┬──────┐\n│      name      │ mode  │   mtime    │ size │\n├────────────────┼───────┼────────────┼──────┤\n│ logs/app.log.2 │ 33188 │ 1677425479 │ 316  │\n│ logs/app.log.3 │ 33188 │ 1677425496 │ 377  │\n│ logs/app.log.1 │ 33188 │ 1677425467 │ 316  │\n└────────────────┴───────┴────────────┴──────┘\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eSeems fine. Now let\u0026#39;s import them into the \u003ccode\u003elogs\u003c/code\u003e table:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ecreate\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003elogs\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efname\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eline\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ewith\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efiles\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efileio_ls\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;logs\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a90d91\"\u003ewhere\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ename\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003elike\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;logs/app.log%\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003einsert\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003einto\u003c/span\u003e \u003cspan style=\"color:#000\"\u003elogs\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efname\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eline\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efiles\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ename\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003evalue\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efileio_scan\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efiles\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ename\u003c/span\u003e), \u003cspan style=\"color:#000\"\u003efiles\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026#39;s double-check that all logs are imported:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efname\u003c/span\u003e, \u003cspan style=\"color:#a90d91\"\u003ecount\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003elogs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003egroup\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eby\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efname\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e┌────────────────┬──────────┐\n│     fname      │ count(*) │\n├────────────────┼──────────┤\n│ logs/app.log.1 │ 5        │\n│ logs/app.log.2 │ 5        │\n│ logs/app.log.3 │ 6        │\n└────────────────┴──────────┘\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eLooks fine!\u003c/p\u003e\u003ch2 id=\"installation-and-usage\"\u003eInstallation and Usage\u003c/h2\u003e\u003col\u003e\u003cli\u003e\u003cp\u003eDownload the \u003ca href=\"https://github.com/nalgeon/sqlean/releases/latest\"\u003elatest release\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003eUse with SQLite command-line interface:\u003c/p\u003e\u003c/li\u003e\u003c/ol\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003esqlite\u0026gt; .load ./fileio\nsqlite\u0026gt; select * from fileio_read(\u0026#39;data.txt\u0026#39;);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eSee \u003ca href=\"https://github.com/nalgeon/sqlean/blob/main/docs/install.md\"\u003eHow to Install an Extension\u003c/a\u003e for usage with IDE, Python, etc.\u003c/p\u003e\u003cp\u003eSee \u003ca href=\"https://github.com/nalgeon/sqlean/blob/main/docs/fileio.md\"\u003eExtension Documentation\u003c/a\u003e for reference.\u003c/p\u003e\u003cp\u003e\u003cem\u003e\u003ca href=\"/subscribe/\"\u003e\u003ci class=\"fas fa-star\"\u003e\u003c/i\u003e \u003cstrong\u003eSubscribe\u003c/strong\u003e\u003c/a\u003e\nto keep up with new posts.\u003c/em\u003e\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cfooter class=\"post__footer\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12\"\u003e\u003cdiv class=\"post__date\"\u003e\u003ctime datetime=\"2023-02-26 15:00:00 +0000 UTC\"\u003e26 Feb, 2023\u003c/time\u003e\u003c/div\u003e\u003cdiv class=\"post__tags\"\u003e\u003ca href=\"/tags/sqlite/\"\u003esqlite\u003c/a\u003e \u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/footer\u003e\u003c/article\u003e",
  "Date": "2023-02-26T15:00:00Z",
  "Author": "Anton Zhiyanov"
}