{
  "Source": "antonz.org",
  "Title": "Modern SQLite: Generated columns",
  "Link": "https://antonz.org/sqlite-generated-columns/",
  "Content": "\u003carticle class=\"post\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12 col-md-10 article\"\u003e\u003cheader\u003e\u003ch1\u003eModern SQLite: Generated columns\u003c/h1\u003e\u003c/header\u003e\u003cp\u003e\u003cem\u003eThis post is part of the \u003ca href=\"/tags/modern-sqlite/\"\u003eModern SQLite\u003c/a\u003e series, where I write about handy SQLite features you might not have heard about.\u003c/em\u003e\u003c/p\u003e\u003cp\u003eGenerated columns are calculated based on other columns in the same table. For example, we can calculate the failure rate based on the number of queries:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ecreate\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003estats\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003edate\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003en_total\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003en_failed\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003efail_perc\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003en_failed\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1c01ce\"\u003e100\u003c/span\u003e.\u003cspan style=\"color:#1c01ce\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#000\"\u003en_total\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003einsert\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003einto\u003c/span\u003e \u003cspan style=\"color:#000\"\u003estats\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003evalues\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;2024-05-01\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e100\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e15\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;2024-05-02\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e150\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e27\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;2024-05-02\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e110\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e22\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003edate\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efail_perc\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003estats\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"sqlite\" editor=\"basic\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e┌────────────┬───────────┐\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e│    date    │ fail_perc │\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e├────────────┼───────────┤\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e│ 2024-05-01 │ 15.0      │\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e│ 2024-05-02 │ 18.0      │\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e│ 2024-05-02 │ 20.0      │\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e└────────────┴───────────┘\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnother common use case is to extract a certain JSON path into a separate column and optionally index it:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ecreate\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eevents\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003einteger\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eprimary\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ekey\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eevent\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eblob\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eetime\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003eevent\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e-\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;time\u0026#39;\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eetype\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003etext\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003eevent\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e-\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ecreate\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eindex\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eevents_time\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eon\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eevents\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eetime\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003einsert\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003einto\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eevents\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eevent\u003c/span\u003e) \u003cspan style=\"color:#a90d91\"\u003evalues\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e(\u003cspan style=\"color:#000\"\u003ejsonb\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;{\u0026#34;time\u0026#34;: \u0026#34;2024-05-01\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;credit\u0026#34;}\u0026#39;\u003c/span\u003e)),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e(\u003cspan style=\"color:#000\"\u003ejsonb\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;{\u0026#34;time\u0026#34;: \u0026#34;2024-05-02\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;debit\u0026#34;}\u0026#39;\u003c/span\u003e)),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e(\u003cspan style=\"color:#000\"\u003ejsonb\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;{\u0026#34;time\u0026#34;: \u0026#34;2024-05-03\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;close\u0026#34;}\u0026#39;\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eetime\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eetype\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eevents\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"sqlite\" editor=\"basic\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e┌────────────┬────────┐\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e│   etime    │ etype  │\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e├────────────┼────────┤\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e│ 2024-05-01 │ credit │\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e│ 2024-05-02 │ debit  │\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e│ 2024-05-03 │ close  │\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e└────────────┴────────┘\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis allows using SQLite as a document database:\u003c/p\u003e\u003cul\u003e\u003cli\u003eStore the document as a JSON blob.\u003c/li\u003e\u003cli\u003eExtract fields as generated columns as needed.\u003c/li\u003e\u003cli\u003eBuild indexes on extracted fields for faster queries.\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eGenerated columns can be computed on the fly or stored on disk. Stored are rarely used in practice.\u003c/p\u003e\u003cp\u003eAvailable since SQLite 3.31 (Jan 2020).\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://www.sqlite.org/gencol.html\"\u003eDocumentation\u003c/a\u003e\u003c/p\u003e\u003cp\u003e──\u003c/p\u003e\u003cp\u003e\u003cmark\u003eInteractive examples in this post\u003c/mark\u003e are powered by \u003ca href=\"https://codapi.org/\"\u003e\u003cstrong\u003ecodapi\u003c/strong\u003e\u003c/a\u003e — an open source tool I\u0026#39;m building. Use it to embed live code snippets into your product docs, online course or blog.\u003c/p\u003e\u003cscript defer=\"\" src=\"/modules/codapi/snippet.js\"\u003e\u003c/script\u003e\u003cp\u003e\u003ca href=\"/subscribe/\"\u003e★ Subscribe\u003c/a\u003e to keep up with new posts.\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cfooter class=\"post__footer\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12\"\u003e\u003cdiv class=\"post__date\"\u003e\u003ctime datetime=\"2024-05-08 13:00:00 +0000 UTC\"\u003e08 May, 2024\u003c/time\u003e\u003c/div\u003e\u003cdiv class=\"post__tags\"\u003e\u003ca href=\"/tags/sqlite/\"\u003esqlite\u003c/a\u003e \n\u003ca href=\"/tags/modern-sqlite/\"\u003emodern-sqlite\u003c/a\u003e \u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/footer\u003e\u003c/article\u003e",
  "Date": "2024-05-08T13:00:00Z",
  "Author": "Anton Zhiyanov"
}