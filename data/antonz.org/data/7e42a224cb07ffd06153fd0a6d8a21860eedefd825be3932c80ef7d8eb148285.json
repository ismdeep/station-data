{
  "Source": "antonz.org",
  "Title": "Trying chDB, an embeddable ClickHouse engine",
  "Link": "https://antonz.org/trying-chdb/",
  "Content": "\u003carticle class=\"post\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12 col-md-10 article\"\u003e\u003cheader\u003e\u003ch1\u003eTrying chDB, an embeddable ClickHouse engine\u003c/h1\u003e\u003c/header\u003e\u003cp\u003e\u003ca href=\"https://github.com/chdb-io/chdb\"\u003echDB\u003c/a\u003e is an embeddable, in-process SQL OLAP engine powered by ClickHouse. It\u0026#39;s as if SQLite and ClickHouse had an offspring (no offence to either party). chDB takes up ≈100mb of disk space, runs on smaller machines (even on a 64mb RAM container), and provides language bindings for Python, Node.js, Go, Rust and C/C++.\u003c/p\u003e\u003cp\u003eLet\u0026#39;s get a taste of chDB with some interactive examples (you can run/edit them without leaving the browser or installing anything).\u003c/p\u003e\u003cp\u003e\u003ca href=\"#using-chdb\"\u003eUsing chDB\u003c/a\u003e •\n\u003ca href=\"#sql-dialect\"\u003eSQL dialect\u003c/a\u003e •\n\u003ca href=\"#reading-data\"\u003eReading data\u003c/a\u003e •\n\u003ca href=\"#writing-data\"\u003eWriting data\u003c/a\u003e •\n\u003ca href=\"#user-defined-functions\"\u003eUser-defined functions\u003c/a\u003e •\n\u003ca href=\"#python-database-api\"\u003ePython DB API\u003c/a\u003e •\n\u003ca href=\"#current-status\"\u003eCurrent status\u003c/a\u003e\u003c/p\u003e\u003ch2 id=\"using-chdb\"\u003eUsing chDB\u003c/h2\u003e\u003cp\u003eIt\u0026#39;s as simple as \u003ccode\u003epip install chdb\u003c/code\u003e and then:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select 42\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eUsing a database engine to select the number \u003ccode\u003e42\u003c/code\u003e is probably not very exciting, but bear with me.\u003c/p\u003e\u003ch2 id=\"sql-dialect\"\u003eSQL dialect\u003c/h2\u003e\u003cp\u003echDB is a wrapper around ClickHouse, so it supports exactly the same \u003ca href=\"https://clickhouse.com/docs/en/sql-reference/syntax\"\u003eSQL syntax\u003c/a\u003e, including joins, CTEs, set operations, aggregations and window functions.\u003c/p\u003e\u003cp\u003eFor example, let\u0026#39;s create a sampled table of 10000 random numbers and calculate the mean and 95th percentile:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb.session\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eSession\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eSession\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;create database db\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;use db\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003ecreate table data (id UInt32, x UInt32)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003eengine MergeTree order by id sample by id\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003eas\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003eselect number+1 as id, randUniform(1, 100) as x\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003efrom numbers(10000);\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003eselect\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  avg(x) as \u0026#34;avg\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  round(quantile(0.95)(x), 2) as p95\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003efrom data\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003esample 0.1;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;PrettyCompactNoEscapes\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eNote a couple of things here:\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003ccode\u003eSession\u003c/code\u003e provides a stateful database connection (the data is stored in the temporary folder and discarded when the connection is closed).\u003c/li\u003e\u003cli\u003eThe second argument to the \u003ccode\u003equery\u003c/code\u003e method specifies the output format. There are many \u003ca href=\"https://doc.chdb.io/#/formats\"\u003esupported formats\u003c/a\u003e such as \u003ccode\u003eCSV\u003c/code\u003e, \u003ccode\u003eSQLInsert\u003c/code\u003e, \u003ccode\u003eJSON\u003c/code\u003e and \u003ccode\u003eXML\u003c/code\u003e (try changing the format in the above example and re-running the code). The default one is \u003ccode\u003eCSV\u003c/code\u003e.\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"reading-data\"\u003eReading data\u003c/h2\u003e\u003cp\u003eAs with output formats, chDB supports any input format supported by ClickHouse.\u003c/p\u003e\u003cp\u003eFor example, we can read a dataset from CSV:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select * from \u0026#39;employees.csv\u0026#39;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;PrettyCompactNoEscapes\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#c41a16\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003erows_read\u003c/span\u003e()\u003cspan style=\"color:#c41a16\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e rows | \u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#c41a16\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ebytes_read\u003c/span\u003e()\u003cspan style=\"color:#c41a16\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e bytes | \u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#c41a16\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eelapsed\u003c/span\u003e()\u003cspan style=\"color:#c41a16\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e seconds\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\" template=\"main.py\" files=\"employees.csv\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eOr work with an external dataset as if it were a database table:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003eselect distinct city\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003efrom \u0026#39;employees.csv\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;CSV\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\" template=\"main.py\" files=\"employees.csv\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eWe can even query Pandas dataframes as if they were tables:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb.dataframe\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ecdf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003epandas\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#000\"\u003epd\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eemployees\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003epd\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eread_csv\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;employees.csv\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edepartments\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003epd\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eread_csv\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;departments.csv\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003eselect\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  emp_id, first_name,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  dep.name as dep_name,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  salary\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003efrom __emp__ as emp\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e    join __dep__ as dep using(dep_id)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003eorder by salary desc;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ecdf\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eemp\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eemployees\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003edep\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#000\"\u003edepartments\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\" files=\"employees.csv departments.csv\"\u003e\u003c/codapi-snippet\u003e\u003ch2 id=\"writing-data\"\u003eWriting data\u003c/h2\u003e\u003cp\u003eThe easiest way to export data is to use the output format (the second parameter in the \u003ccode\u003equery\u003c/code\u003e method), and then write the data to disk:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003epathlib\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ePath\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select * from \u0026#39;employees.csv\u0026#39;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Parquet\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e# export to Parquet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003epath\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ePath\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;/tmp/employees.parquet\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003epath\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ewrite_bytes\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ebytes\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e# import from Parquet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select * from \u0026#39;/tmp/employees.parquet\u0026#39; limit 5\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;PrettyCompactNoEscapes\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\" template=\"main.py\" files=\"employees.csv\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eWe can also easily convert the chDB result object into a PyArrow table:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select * from \u0026#39;employees.csv\u0026#39;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Arrow\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003etable\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eto_arrowTable\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003etable\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eschema\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\" template=\"main.py\" files=\"employees.csv\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eOr Pandas dataframe:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select * from \u0026#39;employees.csv\u0026#39;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003equery_sql\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Arrow\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eframe\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eto_df\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eframe\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003einfo\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\" template=\"main.py\" files=\"employees.csv\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eTo persist a chDB session to a specific folder on disk, use the \u003ccode\u003epath\u003c/code\u003e constructor parameter. This way you can restore the session later:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb.session\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eSession\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e# create a persistent session\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eSession\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003epath\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;/tmp/employees\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e# create a database and a table\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;create database db\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003ecreate table db.employees (\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  emp_id UInt32 primary key,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  first_name String, last_name String,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  birth_dt Date, hire_dt Date,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  dep_id String, city String,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e  salary UInt32,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e) engine MergeTree;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e# load data into the table\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003einsert into db.employees\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003eselect * from \u0026#39;employees.csv\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e# ...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e# restore the session later\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eSession\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003epath\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;/tmp/employees\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e# query the data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select count(*) from db.employees\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eres\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\" files=\"employees.csv\"\u003e\u003c/codapi-snippet\u003e\u003ch2 id=\"user-defined-functions\"\u003eUser-defined functions\u003c/h2\u003e\u003cp\u003eWe can define a function in Python and use it in chDB SQL queries.\u003c/p\u003e\u003cp\u003eHere is a \u003ccode\u003esplit_part\u003c/code\u003e function that splits a string on the given separator and returns the resulting field with the given index (counting from one):\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb.udf\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb_udf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003e@chdb_udf\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esplit_part\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003es\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003esep\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eidx\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eidx\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eidx\u003c/span\u003e)\u003cspan style=\"color:#000\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003es\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003esplit\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003esep\u003c/span\u003e)[\u003cspan style=\"color:#000\"\u003eidx\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003esecond\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select split_part(\u0026#39;a;b;c\u0026#39;, \u0026#39;;\u0026#39;, 2)\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003esecond\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\" template=\"main.py\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eAnd here is a \u003ccode\u003esumn\u003c/code\u003e function that calculates a sum from 1 to N:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb.udf\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb_udf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003e@chdb_udf\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ereturn_type\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;Int32\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esumn\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003en\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003en\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003en\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003en\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003en\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\u003cspan style=\"color:#000\"\u003e//\u003c/span\u003e\u003cspan style=\"color:#1c01ce\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003esum20\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003equery\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select sumn(20)\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003esum20\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\" template=\"main.py\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eCurrently chDB only supports scalar functions that take strings as parameters. If the function returns a type other than string, we should pass it as \u003ccode\u003ereturn_type\u003c/code\u003e to the \u003ccode\u003echdb_udf\u003c/code\u003e decorator.\u003c/p\u003e\u003ch2 id=\"python-database-api\"\u003ePython Database API\u003c/h2\u003e\u003cp\u003eThe chDB Python package adheres to the Python DB API (\u003ca href=\"https://peps.python.org/pep-0249/\"\u003ePEP 249\u003c/a\u003e), so you can use it just like you\u0026#39;d use stdlib\u0026#39;s \u003ccode\u003esqlite3\u003c/code\u003e module:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003econtextlib\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eclosing\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003echdb\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#000\"\u003edbapi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;chdb version: \u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#000\"\u003edbapi\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eget_client_info\u003c/span\u003e()\u003cspan style=\"color:#c41a16\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003ewith\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eclosing\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003edbapi\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003econnect\u003c/span\u003e()) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#000\"\u003econn\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003ewith\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eclosing\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003econn\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ecursor\u003c/span\u003e()) \u003cspan style=\"color:#a90d91\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ecur\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003ecur\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eexecute\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;select version()\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;description:\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003ecur\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003edescription\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;data:\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003ecur\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#000\"\u003efetchone\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"chdb-python\" editor=\"basic\"\u003e\u003c/codapi-snippet\u003e\u003ch2 id=\"current-status\"\u003eCurrent status\u003c/h2\u003e\u003cp\u003echDB reached 1.0 in December 2023. It has the full power of ClickHouse under the hood, a team of passionate maintainers and a growing user base. The future looks bright and I wish chDB all the best!\u003c/p\u003e\u003cp\u003e──\u003c/p\u003e\u003cp\u003eP.S. \u003cmark\u003eInteractive examples in this post\u003c/mark\u003e are powered by \u003ca href=\"https://codapi.org/\"\u003e\u003cstrong\u003ecodapi\u003c/strong\u003e\u003c/a\u003e — an open source tool I\u0026#39;m building. Use it to embed live code snippets into your product docs, online course or blog.\u003c/p\u003e\u003cscript defer=\"\" src=\"/modules/codapi/snippet.js\"\u003e\u003c/script\u003e\u003cp\u003e\u003cem\u003e\u003ca href=\"/subscribe/\"\u003e\u003ci class=\"fas fa-star\"\u003e\u003c/i\u003e \u003cstrong\u003eSubscribe\u003c/strong\u003e\u003c/a\u003e\nto keep up with new posts.\u003c/em\u003e\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cfooter class=\"post__footer\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12\"\u003e\u003cdiv class=\"post__date\"\u003e\u003ctime datetime=\"2023-12-11 12:00:00 +0000 UTC\"\u003e11 Dec, 2023\u003c/time\u003e\u003c/div\u003e\u003cdiv class=\"post__tags\"\u003e\u003ca href=\"/tags/data/\"\u003edata\u003c/a\u003e \n\u003ca href=\"/tags/software/\"\u003esoftware\u003c/a\u003e \u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/footer\u003e\u003c/article\u003e",
  "Date": "2023-12-11T12:00:00Z",
  "Author": "Anton Zhiyanov"
}