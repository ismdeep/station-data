{
  "Source": "antonz.org",
  "Title": "Gist of Go: Wait groups",
  "Link": "https://antonz.org/go-concurrency/wait-groups/",
  "Content": "\u003carticle class=\"post\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12 col-md-10 article\"\u003e\u003cheader\u003e\u003ch1\u003eGist of Go: Wait groups\u003c/h1\u003e\u003c/header\u003e\u003cp\u003e\u003cem\u003eThis is a chapter from my book on \u003ca href=\"/go-concurrency\"\u003eGo concurrency\u003c/a\u003e, which teaches the topic from the ground up through interactive exercises.\u003c/em\u003e\u003c/p\u003e\u003cp\u003eChannels are a multi-purpose concurrency tool in Go. In \u003ca href=\"/go-concurrency/#contents\"\u003ePart 1\u003c/a\u003e of the book, we covered their main use cases:\u003c/p\u003e\u003cul\u003e\u003cli\u003eTransferring data between goroutines.\u003c/li\u003e\u003cli\u003eSynchronizing goroutines (the \u003cem\u003edone\u003c/em\u003e channel).\u003c/li\u003e\u003cli\u003eCanceling goroutines (the \u003cem\u003ecancel\u003c/em\u003e channel).\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eTransferring data is what channels were designed for, and they excel at it. For canceling goroutines, there is a special tool besides channels — a \u003cem\u003econtext\u003c/em\u003e (which we\u0026#39;ve also discussed). For synchronizing goroutines, there is also a special tool — a \u003cem\u003ewait group\u003c/em\u003e. Let\u0026#39;s talk about it.\u003c/p\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12 col-sm-6 col-md-5\"\u003e\u003cul\u003e\u003cli\u003e\u003ca href=\"#wait-group\"\u003eWait group\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#-from-channel-to-wait-group\"\u003eChannel/wait group\u003c/a\u003e ✎\u003c/li\u003e\u003cli\u003e\u003ca href=\"#inner-world\"\u003eInner world\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#value-vs-pointer\"\u003eValue vs. pointer\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#encapsulation\"\u003eEncapsulation\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#-concurrent-group\"\u003eConcurrent group\u003c/a\u003e ✎\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003cdiv class=\"col-xs-12 col-sm-6 col-md-6\"\u003e\u003cul\u003e\u003cli\u003e\u003ca href=\"#add-after-wait\"\u003eAdd after Wait\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#multiple-waits\"\u003eMultiple Waits\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#-waiting-for-worker\"\u003eWaiting for worker\u003c/a\u003e ✎\u003c/li\u003e\u003cli\u003e\u003ca href=\"#panic\"\u003ePanic\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#-concurrent-group-with-panic-handling\"\u003eConcurrent group + panic\u003c/a\u003e ✎\u003c/li\u003e\u003cli\u003e\u003ca href=\"#keep-it-up\"\u003eKeep it up\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/div\u003e\u003ch2 id=\"wait-group\"\u003eWait group\u003c/h2\u003e\u003cp\u003eA wait group lets you wait for one or more goroutines to finish. We started with a wait group in the very first chapter on goroutines, and now we\u0026#39;ll go into more detail.\u003c/p\u003e\u003cp\u003eSuppose we want to start a goroutine and wait for it to complete. Here\u0026#39;s how to do it with a done channel:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003edone\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003emake\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e{}, \u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e50\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrint\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003edone\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e{}{}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003e\u0026lt;-\u003c/span\u003e\u003cspan style=\"color:#000\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e.done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnd here\u0026#39;s how to do it with a wait group:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e50\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrint\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" template=\"header.go\" output=\"\" actions=\"Playground:@playground\" data-playground=\"https://go.dev/play/p/n66zfhmW1St\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e.done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eInterestingly, a \u003ccode\u003eWaitGroup\u003c/code\u003e doesn\u0026#39;t know anything about the goroutines it manages. It works with an internal counter. Calling \u003ccode\u003ewg.Add(1)\u003c/code\u003e increments the counter by one, while \u003ccode\u003ewg.Done()\u003c/code\u003e decrements it. \u003ccode\u003ewg.Wait()\u003c/code\u003e blocks the calling goroutine (in this case, \u003ccode\u003emain\u003c/code\u003e) until the counter reaches zero. So, \u003ccode\u003emain()\u003c/code\u003e waits for the called goroutine to finish before exiting.\u003c/p\u003e\u003cp\u003eTypically, if you just need to wait for goroutines to complete without needing a result from them, you use a wait group instead of a done channel.\u003c/p\u003e\u003ch2 id=\"-from-channel-to-wait-group\"\u003e✎ From channel to wait group\u003c/h2\u003e\u003cp\u003e\u003cem\u003eThe ✎ symbol indicates exercises. They are an essential part of the book, so try not to skip them. Half of what you learn comes from the exercises.\u003c/em\u003e\u003c/p\u003e\u003cp\u003eI wrote a function called \u003ccode\u003etimeit\u003c/code\u003e. It takes another function as input, runs it multiple times with concurrent goroutines, and returns the execution time.\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// timeit executes a function nIter times using nWorkers concurrent workers,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// and returns the execution time in milliseconds.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etimeit\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003edone\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003emake\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e{}, \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eNow\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// there are nWorkers concurrent workers\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#177500\"\u003e// each worker performs nIter/nWorkers iterations\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003edone\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e{}{}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// wait for all workers to finish\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003e\u0026lt;-\u003c/span\u003e\u003cspan style=\"color:#000\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSince\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e).\u003cspan style=\"color:#000\"\u003eMilliseconds\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"s-timeit\" editor=\"off\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eUsage example:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#177500\"\u003e// \u0026#34;work\u0026#34; takes from 10 to 50 ms\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\t\u003cspan style=\"color:#000\"\u003en\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e10\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#000\"\u003erand\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eIntn\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e40\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDuration\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003en\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e = \u003cspan style=\"color:#1c01ce\"\u003e16\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e []\u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e{\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e16\u003c/span\u003e} {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003eelapsed\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etimeit\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;%d iterations, %d workers, took %dms\\n\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e), \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eelapsed\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-timeit\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e16 iterations, 1 workers, took 444ms\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e16 iterations, 2 workers, took 305ms\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e16 iterations, 4 workers, took 131ms\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e16 iterations, 16 workers, took 49ms\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eCurrently, \u003ccode\u003etimeit\u003c/code\u003e uses a done channel. Refactor it to use a wait group.\u003c/p\u003e\u003cp\u003eGuarantees (to keep things simple):\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e \u0026gt; \u003cspan style=\"color:#1c01ce\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e \u0026gt; \u003cspan style=\"color:#1c01ce\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e%\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSubmit only the code fragment marked with \u0026#34;solution start\u0026#34; and \u0026#34;solution end\u0026#34; comments. The full source code is available via the \u0026#34;Playground\u0026#34; link below.\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// solution start\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// timeit executes a function nIter times using nWorkers concurrent\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// workers, and returns the execution time in milliseconds.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etimeit\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003edone\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003emake\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e{}, \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eNow\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// there are nWorkers concurrent workers\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#177500\"\u003e// each worker performs nIter/nWorkers iterations\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003edone\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e{}{}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// wait for all workers to finish\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003e\u0026lt;-\u003c/span\u003e\u003cspan style=\"color:#000\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSince\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e).\u003cspan style=\"color:#000\"\u003eMilliseconds\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// solution end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"ex01\" sandbox=\"go\" editor=\"basic\" template=\"ex01.go\" actions=\"Playground:@playground Toggle_solution:@solution\" data-playground=\"https://go.dev/play/p/pfYtBhWliFL\"\u003e\u003c/codapi-snippet\u003e\u003cdiv id=\"ex01-solution\" class=\"boxed\" hidden=\"\"\u003e\u003cp\u003e\u003cstrong\u003e✓ From channel to wait group\u003c/strong\u003e\u003c/p\u003e\u003cp\u003eIt\u0026#39;s quite simple: we replace the buffered channel with a wait group of \u003ccode\u003enWorkers\u003c/code\u003e elements, and we\u0026#39;re done.\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// timeit executes a function nIter times using nWorkers concurrent\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// workers, and returns the execution time in milliseconds.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etimeit\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eNow\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// there are nWorkers concurrent workers\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#177500\"\u003e// each worker performs nIter/nWorkers iterations\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enIter\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#000\"\u003enWorkers\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// wait for all workers to finish\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSince\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e).\u003cspan style=\"color:#000\"\u003eMilliseconds\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003ch2 id=\"inner-world\"\u003eInner world\u003c/h2\u003e\u003cp\u003eAs we discussed, the wait group knows nothing about goroutines and works with a counter instead. This simplifies the implementation a lot. Conceptually, you can think of the wait group like this:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// A WaitGroup waits for a collection of goroutines to finish.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003en\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Add adds delta to the WaitGroup counter.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003edelta\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003eint\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003en\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003edelta\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003en\u003c/span\u003e \u0026lt; \u003cspan style=\"color:#1c01ce\"\u003e0\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003epanic\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;negative counter\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Done decrements the WaitGroup counter by one.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Wait blocks until the WaitGroup counter is zero.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003en\u003c/span\u003e \u0026gt; \u003cspan style=\"color:#1c01ce\"\u003e0\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"s-naive\" editor=\"basic\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e50\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrint\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-naive\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e.done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOf course, in practice it\u0026#39;s more complicated :\u003c/p\u003e\u003cul\u003e\u003cli\u003eAll methods can be called concurrently from multiple goroutines. Modifying the shared variable \u003ccode\u003en\u003c/code\u003e from multiple goroutines is unsafe — concurrent access can corrupt data (we\u0026#39;ll talk more about this in the chapter on data races).\u003c/li\u003e\u003cli\u003eA loop-based \u003ccode\u003eWait\u003c/code\u003e implementation will max out a CPU core until the loop finishes (this type of waiting is also known as \u003cem\u003ebusy waiting\u003c/em\u003e). Such code is strongly discouraged in production.\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eHowever, our naive implementation shows the properties of a wait group that are also present in the actual \u003ccode\u003esync.WaitGroup\u003c/code\u003e:\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003ccode\u003eAdd\u003c/code\u003e increments or decrements (if \u003ccode\u003edelta \u0026lt; 0\u003c/code\u003e) the counter. Positive deltas are much more common, but technically nothing prevents you from calling \u003ccode\u003eAdd(-1)\u003c/code\u003e.\u003c/li\u003e\u003cli\u003e\u003ccode\u003eWait\u003c/code\u003e blocks execution until the counter reaches 0. So if you call \u003ccode\u003eWait\u003c/code\u003e before the first \u003ccode\u003eAdd\u003c/code\u003e, the goroutine won\u0026#39;t block.\u003c/li\u003e\u003cli\u003eAfter \u003ccode\u003eWait\u003c/code\u003e completes, the wait group returns to its initial state (counter is 0). You can then reuse it.\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"value-vs-pointer\"\u003eValue vs. pointer\u003c/h2\u003e\u003cp\u003eAnother important implementation nuance: you should pass the wait group as a pointer (\u003ccode\u003e*WaitGroup\u003c/code\u003e), not as a value (\u003ccode\u003eWaitGroup\u003c/code\u003e). Otherwise, each recipient will get its own copy with a duplicate counter, and synchronization won\u0026#39;t work.\u003c/p\u003e\u003cp\u003eHere\u0026#39;s an example of passing a value:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003erunWork\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e50\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;work done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003erunWork\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;all done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003eall done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003erunWork\u003c/code\u003e got a copy of the group and increased its counter with \u003ccode\u003eAdd\u003c/code\u003e. Meanwhile, \u003ccode\u003emain\u003c/code\u003e has its own copy with a zero counter, so \u003ccode\u003eWait\u003c/code\u003e didn\u0026#39;t block execution. As a result, \u003ccode\u003emain\u003c/code\u003e finished without waiting for the \u003ccode\u003erunWork\u003c/code\u003e goroutine to complete.\u003c/p\u003e\u003cp\u003eHere\u0026#39;s an example of passing a pointer:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003erunWork\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e50\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;work done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003erunWork\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;all done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ework done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003eall done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow \u003ccode\u003erunWork\u003c/code\u003e and \u003ccode\u003emain\u003c/code\u003e share the same instance of the group, so everything works as it should.\u003c/p\u003e\u003cp\u003eAn even better approach would be not to pass the wait group around at all. Instead, we can encapsulate it in a separate type that hides the implementation details and provides a nice interface. Let\u0026#39;s see how to do that.\u003c/p\u003e\u003ch2 id=\"encapsulation\"\u003eEncapsulation\u003c/h2\u003e\u003cp\u003eIn Go, it\u0026#39;s considered a good practice to hide synchronization details from clients calling your code. Fellow developers won\u0026#39;t thank you for forcing them to deal with wait groups. It\u0026#39;s better to encapsulate the synchronization logic in a separate function or type, and provide a convenient interface.\u003c/p\u003e\u003ch3 id=\"wrapper-functions\"\u003eWrapper functions\u003c/h3\u003e\u003cp\u003eLet\u0026#39;s say I wrote a function called \u003ccode\u003eRunConc\u003c/code\u003e that runs a set of given functions concurrently:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// RunConc executes functions concurrently.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eRunConc\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e...\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003elen\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"s-run-conc-1\" editor=\"basic\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eAnd I suggest calling it this way:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e50\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrint\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eNow\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003eRunConc\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003eelapsed\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eNow\u003c/span\u003e().\u003cspan style=\"color:#000\"\u003eSub\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e).\u003cspan style=\"color:#000\"\u003eMilliseconds\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;took %d ms\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eelapsed\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-run-conc-1\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e...took 50 ms\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIs this convenient, given that the client just wants to run functions concurrently and wait for them to finish? Not really.\u003c/p\u003e\u003cp\u003eIt\u0026#39;s better to hide the wait group inside a function:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// RunConc executes functions concurrently and waits for them to finish.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eRunConc\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e...\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003elen\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"s-run-conc-2\" editor=\"basic\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eNow you can call it like this:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e50\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrint\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eNow\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003eRunConc\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003eelapsed\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eNow\u003c/span\u003e().\u003cspan style=\"color:#000\"\u003eSub\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003estart\u003c/span\u003e).\u003cspan style=\"color:#000\"\u003eMilliseconds\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintf\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;took %d ms\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003eelapsed\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-run-conc-2\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e...took 50 ms\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe client doesn\u0026#39;t need to know how \u003ccode\u003eRunConc\u003c/code\u003e does its job. It just works, and that\u0026#39;s great.\u003c/p\u003e\u003ch3 id=\"wrapper-types\"\u003eWrapper types\u003c/h3\u003e\u003cp\u003eSuppose other developers tried \u003ccode\u003eRunConc\u003c/code\u003e and didn\u0026#39;t like it. They say they prefer to add functions one at a time and then run them all together later. They also want to run a set of functions multiple times.\u003c/p\u003e\u003cp\u003eOkay, I\u0026#39;ll rewrite \u003ccode\u003eRunConc\u003c/code\u003e as a \u003ccode\u003eConcRunner\u003c/code\u003e type:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// ConcRunner executes functions concurrently.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eConcRunner\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e    \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e []\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// NewConcRunner creates a new ConcRunner instance.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewConcRunner\u003c/span\u003e() \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcRunner\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcRunner\u003c/span\u003e{}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Add adds a function without executing it.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcRunner\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e = \u003cspan style=\"color:#a90d91\"\u003eappend\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Run executes functions concurrently and waits for them to finish.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcRunner\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eRun\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003elen\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003efuncs\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"s-run-conc-3\" editor=\"basic\"\u003e\u003c/codapi-snippet\u003e\u003cblockquote\u003e\u003cp\u003eYou might ask: why is the \u003ccode\u003ewg\u003c/code\u003e field in \u003ccode\u003eConcRunner\u003c/code\u003e defined as a \u003ccode\u003eWaitGroup\u003c/code\u003e value instead of a \u003ccode\u003e*WaitGroup\u003c/code\u003e pointer? It\u0026#39;s because \u003ccode\u003eConcRunner\u003c/code\u003e itself is used as a pointer: the constructor returns a \u003ccode\u003e*ConcRunner\u003c/code\u003e, and methods are defined on it. So the methods use the same \u003ccode\u003ewg\u003c/code\u003e value, avoiding counter issues.\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003eThe wait group is hidden in the type\u0026#39;s fields, while the client still has a clean interface without the messy details:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecr\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewConcRunner\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// add functions to the runner\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003ecr\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecr\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecr\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// run the functions concurrently\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003etimeit\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ecr\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// and again\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003etimeit\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ecr\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-run-conc-3\" template=\"conc-runner.go\" output=\"\" actions=\"Playground:@playground\" data-playground=\"https://go.dev/play/p/mDrJLswSoin\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e...took 50 ms\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e...took 50 ms\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIn rare cases, a client may want to explicitly access your code\u0026#39;s synchronization machinery. But usually it\u0026#39;s better to encapsulate the synchronization logic.\u003c/p\u003e\u003ch2 id=\"-concurrent-group\"\u003e✎ Concurrent group\u003c/h2\u003e\u003cp\u003eA typical use case for a wait group is to start one or more goroutines and wait for them to finish:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#177500\"\u003e// do stuff\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e4\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThat\u0026#39;s fine, but it feels a bit clumsy. It would be nice to have a \u003ccode\u003eConcGroup\u003c/code\u003e type that does the same thing but provides a more concise interface:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewConcGroup\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e4\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eRun\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003eRun\u003c/code\u003e executes a function in a separate goroutine, and \u003ccode\u003eWait\u003c/code\u003e waits for all goroutines started with \u003ccode\u003eRun\u003c/code\u003e to finish.\u003c/p\u003e\u003cp\u003eImplement \u003ccode\u003eConcGroup\u003c/code\u003e.\u003c/p\u003e\u003cp\u003eSubmit only the code fragment marked with \u0026#34;solution start\u0026#34; and \u0026#34;solution end\u0026#34; comments. The full source code is available via the \u0026#34;Playground\u0026#34; link below.\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// solution start\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// ConcGroup performs the work given to it in separate goroutines.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// NewConcGroup creates a new ConcGroup instance.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewConcGroup\u003c/span\u003e() \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Run performs the given work in a separate goroutine.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eRun\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Wait waits for all the work to finish.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// solution end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"ex02\" sandbox=\"go\" editor=\"basic\" template=\"ex02.go\" actions=\"Playground:@playground Toggle_solution:@solution\" data-playground=\"https://go.dev/play/p/S5L_bCAwG7Y\"\u003e\u003c/codapi-snippet\u003e\u003cdiv id=\"ex02-solution\" class=\"boxed\" hidden=\"\"\u003e\u003cp\u003e\u003cstrong\u003e✓ Concurrent group\u003c/strong\u003e\u003c/p\u003e\u003cp\u003eWe put a wait group inside \u003ccode\u003eConcGroup\u003c/code\u003e. In the \u003ccode\u003eRun\u003c/code\u003e method, we increment the group counter before starting the goroutine and decrement it after the goroutine finishes. In the \u003ccode\u003eWait\u003c/code\u003e method, we wait until the counter reaches zero.\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// ConcGroup performs the work given to it in separate goroutines.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// NewConcGroup creates a new ConcGroup instance.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewConcGroup\u003c/span\u003e() \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e{\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e: \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e{}}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Run performs the given work in a separate goroutine.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eRun\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Wait waits for all the work to finish.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cp\u003eA concurrent group like our \u003ccode\u003eConcGroup\u003c/code\u003e is often useful in practice. To avoid reinventing the wheel, use the standard library extension \u003ca href=\"https://pkg.go.dev/golang.org/x/sync/errgroup\"\u003egolang.org/x/sync/errgroup\u003c/a\u003e — it provides such a group with additional features like limiting the number of concurrent goroutines, context cancellation, and error tracking.\u003c/p\u003e\u003ch2 id=\"add-after-wait\"\u003eAdd after Wait\u003c/h2\u003e\u003cp\u003eNormally, all \u003ccode\u003eAdd\u003c/code\u003e calls happen before \u003ccode\u003eWait\u003c/code\u003e. But technically, there\u0026#39;s nothing stopping us from doing some of the \u003ccode\u003eAdd\u003c/code\u003e calls before \u003ccode\u003eWait\u003c/code\u003e and some after (from another goroutine).\u003c/p\u003e\u003cp\u003eLet\u0026#39;s say we have a function \u003ccode\u003erunWork\u003c/code\u003e that does its job in a separate goroutine:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// runWork performs work in a goroutine.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003erunWork\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;starting work...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e50\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;work done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"s-run-work\" editor=\"basic\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eWe\u0026#39;ll do the following:\u003c/p\u003e\u003cul\u003e\u003cli\u003eStart a \u003ccode\u003erunWork\u003c/code\u003e goroutine (worker);\u003c/li\u003e\u003cli\u003eStart another goroutine to wait for the work to finish (waiter);\u003c/li\u003e\u003cli\u003eStart two more workers;\u003c/li\u003e\u003cli\u003eWhen all three workers have finished, the waiter will wake up and signal completion to the \u003ccode\u003emain\u003c/code\u003e function.\u003c/li\u003e\u003c/ul\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// main wait group\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewgMain\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// worker wait group\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewgWork\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// run the first worker\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003erunWork\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ewgWork\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// the waiter goroutine waits for all workers to finish,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#177500\"\u003e// and then completes the main wait group\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003ewgMain\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;waiting for work to be done...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewgWork\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;all work done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewgMain\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// run two more workers after a while\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e10\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003erunWork\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ewgWork\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003erunWork\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ewgWork\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// executes when the waiter goroutine finishes\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003ewgMain\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-run-work\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003estarting work...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ewaiting for work to be done...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003estarting work...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003estarting work...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ework done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ework done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ework done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003eall work done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis is rarely used in practice.\u003c/p\u003e\u003ch2 id=\"multiple-waits\"\u003eMultiple Waits\u003c/h2\u003e\u003cp\u003eAnother not-so-popular \u003ccode\u003eWaitGroup\u003c/code\u003e feature: you can call \u003ccode\u003eWait\u003c/code\u003e from multiple goroutines. They will all block until the group\u0026#39;s counter reaches zero.\u003c/p\u003e\u003cp\u003eFor example, we can start one worker and three waiters:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// worker\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#177500\"\u003e// do stuff\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\t\u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e50\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;work done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// first waiter\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;waiter 1 done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// second waiter\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;waiter 2 done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// main waiter\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;main waiter done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ework done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ewaiter 1 done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ewaiter 2 done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003emain waiter done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAll waiters unblock after the worker calls \u003ccode\u003ewg.Done()\u003c/code\u003e. But the order in which this happens is not guaranteed. Could be this:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ework done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ewaiter 1 done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ewaiter 2 done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003emain waiter done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOr this:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ework done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ewaiter 1 done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003emain waiter done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ewaiter 2 done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOr even this:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ework done\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003emain waiter done\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIn the last case, the main waiter finished first, and then \u003ccode\u003emain\u003c/code\u003e exited before the other waiters could even print anything.\u003c/p\u003e\u003cp\u003eWe\u0026#39;ll see another use case for multiple \u003ccode\u003eWait\u003c/code\u003es in the chapter on semaphores.\u003c/p\u003e\u003ch2 id=\"-waiting-for-worker\"\u003e✎ Waiting for worker\u003c/h2\u003e\u003cp\u003eI\u0026#39;ve implemented a \u003ccode\u003eWorker\u003c/code\u003e type. It runs a given function in a loop until it encounters an error:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Worker executes the given function\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// in a loop until it returns an error.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() \u003cspan style=\"color:#a90d91\"\u003eerror\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// NewWorker creates a new Worker instance with the given function.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewWorker\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() \u003cspan style=\"color:#a90d91\"\u003eerror\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e{\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e: \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Start starts a separate goroutine that executes\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// the given function in a loop until it returns an error.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eStart\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#000\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"s-worker\" editor=\"off\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eUsage example:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() \u003cspan style=\"color:#a90d91\"\u003eerror\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e--\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e0\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eerrors\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eNew\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;count is zero\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e10\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eworker\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewWorker\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eworker\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eStart\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e25\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-worker\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e3 2 1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow it\u0026#39;s time to update the \u003ccode\u003eWorker\u003c/code\u003e for new requirements.\u003c/p\u003e\u003cp\u003e➊ Add a \u003ccode\u003eStop\u003c/code\u003e method to stop the worker:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() \u003cspan style=\"color:#a90d91\"\u003eerror\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e--\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e10\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eworker\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewWorker\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eworker\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eStart\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e25\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eworker\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eStop\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#177500\"\u003e// 3 2 1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e➋ Add a \u003ccode\u003eWait\u003c/code\u003e method that blocks the caller until the worker finishes:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() \u003cspan style=\"color:#a90d91\"\u003eerror\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrint\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e--\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e10\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eworker\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewWorker\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003eworker\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eStart\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#177500\"\u003e// this goroutine will stop the worker after 25 ms\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eSleep\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e25\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#000\"\u003etime\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eMillisecond\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003eworker\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eStop\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#177500\"\u003e// waiting for the worker to stop\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#000\"\u003eworker\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#177500\"\u003e// 3 2 1 done\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eUpdate the \u003ccode\u003eWorker\u003c/code\u003e to meet the new requirements. Don\u0026#39;t use channels or context, use a wait group instead. You can use a boolean variable for the worker status (running/stopped) without worrying about data races, since we haven\u0026#39;t covered them yet. See the code comments for detailed requirements.\u003c/p\u003e\u003cp\u003eSubmit only the code fragment marked with \u0026#34;solution start\u0026#34; and \u0026#34;solution end\u0026#34; comments. The full source code is available via the \u0026#34;Playground\u0026#34; link below.\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// solution start\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Worker executes the given function in a loop until stopped.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() \u003cspan style=\"color:#a90d91\"\u003eerror\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// NewWorker creates a new Worker instance with the given function.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewWorker\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() \u003cspan style=\"color:#a90d91\"\u003eerror\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e{\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e: \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Start starts a separate goroutine that executes the given function\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// in a loop until Stop is called or the function returns an error.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Subsequent calls to Start are ignored.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Start does not support concurrent calls.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eStart\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Stop stops the execution of the loop.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Calling Stop before Start is ignored.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Subsequent calls to Stop are ignored.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Stop does not support concurrent calls.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eStop\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Wait blocks the calling goroutine until the Worker is stopped\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// (due to an error or a call to Stop).\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Wait can be called multiple times. It supports concurrent calls.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Wait can be called before Start. Such a call does not block.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Wait can be called after Stop. Such a call does not block.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// solution end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"ex03\" sandbox=\"go\" editor=\"basic\" template=\"ex03.go\" actions=\"Playground:@playground Toggle_solution:@solution\" data-playground=\"https://go.dev/play/p/isbtAQt19cG\"\u003e\u003c/codapi-snippet\u003e\u003cdiv id=\"ex03-solution\" class=\"boxed\" hidden=\"\"\u003e\u003cp\u003e\u003cstrong\u003e✓ Waiting for worker\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e➊ Add the Stop method\u003c/p\u003e\u003cp\u003eWe add a wait group and a boolean flag indicating that the worker is running:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e      \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() \u003cspan style=\"color:#a90d91\"\u003eerror\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e      \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003erunning\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003ebool\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhen \u003ccode\u003eStart\u003c/code\u003e is called, we increment the group counter and set the \u003ccode\u003erunning\u003c/code\u003e flag:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eStart\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003erunning\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003erunning\u003c/span\u003e = \u003cspan style=\"color:#a90d91\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe extract the internal worker loop into the \u003ccode\u003ework\u003c/code\u003e method. We break from the loop if the function returns an error or if \u003ccode\u003erunning\u003c/code\u003e changes to \u003ccode\u003efalse\u003c/code\u003e. When exiting \u003ccode\u003ework\u003c/code\u003e, we reset the wait group counter:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003erunning\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#000\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003efn\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003erunning\u003c/span\u003e = \u003cspan style=\"color:#a90d91\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a90d91\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIn the \u003ccode\u003eStop\u003c/code\u003e method, we change \u003ccode\u003erunning\u003c/code\u003e to \u003ccode\u003efalse\u003c/code\u003e to stop the \u003ccode\u003ework\u003c/code\u003e loop (and reset the wait group counter as a consequence):\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eStop\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e !\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003erunning\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003erunning\u003c/span\u003e = \u003cspan style=\"color:#a90d91\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e➋ Add the Wait method\u003c/p\u003e\u003cp\u003eWe call \u003ccode\u003eWait\u003c/code\u003e on the wait group to block the caller until the worker stops:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eWorker\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e !\u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003erunning\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ew\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThat\u0026#39;s it!\u003c/p\u003e\u003c/div\u003e\u003ch2 id=\"panic\"\u003ePanic\u003c/h2\u003e\u003cp\u003eIf multiple goroutines are involved in the wait group, there are multiple possible panic sources.\u003c/p\u003e\u003cp\u003eLet\u0026#39;s say there\u0026#39;s a \u003ccode\u003ework\u003c/code\u003e function that panics on even numbers:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003en\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003erand\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eIntn\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e9\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e; \u003cspan style=\"color:#000\"\u003en\u003c/span\u003e\u003cspan style=\"color:#000\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#1c01ce\"\u003e2\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e0\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003epanic\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eErrorf\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;bad number: %d\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#000\"\u003en\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// do stuff\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"s-work-panic\" editor=\"basic\"\u003e\u003c/codapi-snippet\u003e\u003cp\u003eWe start four \u003ccode\u003ework\u003c/code\u003e goroutines:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e4\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;work done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-work-panic\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003epanic: bad number: 8\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003egoroutine 9 [running]:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003emain.work()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t/sandbox/src/main.go:19 +0x6e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003emain.main.func1()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t/sandbox/src/main.go:29 +0x1c\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ecreated by main.main in goroutine 1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t/sandbox/src/main.go:28 +0x30 (exit status 2)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnd we face a panic (unless we are very lucky).\u003c/p\u003e\u003ch3 id=\"shared-recover\"\u003eShared recover\u003c/h3\u003e\u003cp\u003eLet\u0026#39;s add \u003ccode\u003erecover\u003c/code\u003e to catch the panic and run the program again:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003eval\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erecover\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eval\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;work done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t} \u003cspan style=\"color:#a90d91\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;panicked!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e4\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-work-panic\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003epanic: bad number: 6\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003egoroutine 21 [running]:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003emain.work()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t/sandbox/src/main.go:19 +0x73\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003emain.main.func2()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t/sandbox/src/main.go:38 +0x1c\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003ecreated by main.main in goroutine 1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t/sandbox/src/main.go:37 +0x4d (exit status 2)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNope. You might expect \u003ccode\u003erecover\u003c/code\u003e to catch the panic and print \u0026#34;panicked\u0026#34;. But instead we get the same unhandled panic as before.\u003c/p\u003e\u003cp\u003eThe problem is that \u003ccode\u003erecover\u003c/code\u003e has an important limitation: it only works within the \u003cem\u003esame goroutine\u003c/em\u003e that caused the panic. In our case, the panic comes from the \u003ccode\u003ework\u003c/code\u003e goroutines, while \u003ccode\u003erecover\u003c/code\u003e runs in the \u003ccode\u003emain\u003c/code\u003e goroutine — so it doesn\u0026#39;t catch the panic. Goroutines are completely independent, remember? You can only catch the panic happening in those goroutines themselves.\u003c/p\u003e\u003ch3 id=\"per-goroutine-recover\"\u003ePer-goroutine recover\u003c/h3\u003e\u003cp\u003eLet\u0026#39;s move \u003ccode\u003erecover\u003c/code\u003e inside the \u003ccode\u003ework\u003c/code\u003e goroutines:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003epanicked\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e4\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#000\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erecover\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\t\u003cspan style=\"color:#000\"\u003epanicked\u003c/span\u003e = \u003cspan style=\"color:#a90d91\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e !\u003cspan style=\"color:#000\"\u003epanicked\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;work done\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#a90d91\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003efmt\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ePrintln\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#34;panicked!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet sandbox=\"go\" editor=\"basic\" depends-on=\"s-work-panic\" template=\"header.go\" output=\"\"\u003e\u003c/codapi-snippet\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003epanicked!\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow, the panic is caught in its own goroutine, which then sets the \u003ccode\u003epanicked\u003c/code\u003e flag in the \u003ccode\u003emain\u003c/code\u003e goroutine. Now the program works fine and prints \u0026#34;panicked\u0026#34; as we expected.\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003eHere we are modifying the shared \u003ccode\u003epanicked\u003c/code\u003e variable from multiple goroutines. In general, this is not a good practice because it leads to data races (we\u0026#39;ll talk about them in the next chapter). But in this particular case, there\u0026#39;s no real harm from races.\u003c/p\u003e\u003c/blockquote\u003e\u003cp\u003eKey takeaway: you cannot catch a panic from \u0026#34;child\u0026#34; goroutines in the \u0026#34;parent\u0026#34; goroutine. If you want to catch a panic, do it in the goroutine where it happens.\u003c/p\u003e\u003ch2 id=\"-concurrent-group-with-panic-handling\"\u003e✎ Concurrent group with panic handling\u003c/h2\u003e\u003cp\u003eLet\u0026#39;s go back to the \u003ccode\u003eConcGroup\u003c/code\u003e type you developed earlier. The concurrent group runs functions in separate goroutines and waits for them to finish:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewConcGroup\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#1c01ce\"\u003e4\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eRun\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003eRun\u003c/code\u003e starts a function in a separate goroutine, while \u003ccode\u003eWait\u003c/code\u003e waits for all goroutines started by \u003ccode\u003eRun\u003c/code\u003e to finish.\u003c/p\u003e\u003cp\u003eRefine \u003ccode\u003eConcGroup\u003c/code\u003e so that the \u003ccode\u003eWait\u003c/code\u003e method panics if any of the goroutines started by \u003ccode\u003eRun\u003c/code\u003e panics. The panic argument in \u003ccode\u003eWait\u003c/code\u003e should be the same as the panic argument of the goroutine that caused it.\u003c/p\u003e\u003cp\u003eIf multiple goroutines panic, the panic argument in \u003ccode\u003eWait\u003c/code\u003e can be from any of them (no need to combine panics). You can even use a shared variable for the panic value, since we haven\u0026#39;t covered races yet.\u003c/p\u003e\u003cp\u003eThe \u003ccode\u003eRun\u003c/code\u003e method should not panic.\u003c/p\u003e\u003cp\u003eSubmit only the code fragment marked with \u0026#34;solution start\u0026#34; and \u0026#34;solution end\u0026#34; comments. The full source code is available via the \u0026#34;Playground\u0026#34; link below.\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// solution start\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// ConcGroup performs the work given to it in separate goroutines.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// NewConcGroup creates a new ConcGroup instance.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewConcGroup\u003c/span\u003e() \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Run performs the given work in a separate goroutine.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// If the goroutine panics, Run does not panic.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ep\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eRun\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Wait waits for all the work to finish.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// If any of the goroutines started by Run panicked, Wait panics too.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ep\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#177500\"\u003e// ...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// solution end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ccodapi-snippet id=\"ex04\" sandbox=\"go\" editor=\"basic\" template=\"ex04.go\" actions=\"Playground:@playground Toggle_solution:@solution\" data-playground=\"https://go.dev/play/p/SPHfdEFk8-l\"\u003e\u003c/codapi-snippet\u003e\u003cdiv id=\"ex04-solution\" class=\"boxed\" hidden=\"\"\u003e\u003cp\u003e\u003cstrong\u003e✓ Concurrent group with panic handling\u003c/strong\u003e\u003c/p\u003e\u003cp\u003eWhen a panic occurs in the \u003ccode\u003eRun\u003c/code\u003e goroutine, we store it in a buffered \u003ccode\u003epanics\u003c/code\u003e channel. Thanks to \u003ccode\u003eselect\u003c/code\u003e + \u003ccode\u003edefault\u003c/code\u003e, only the first panic is captured; subsequent ones are ignored.\u003c/p\u003e\u003cp\u003eIn \u003ccode\u003eWait\u003c/code\u003e, we wait for all started goroutines to finish. Then we panic if necessary.\u003c/p\u003e\u003cp\u003eWe write the panic value back to the channel in \u003ccode\u003eWait\u003c/code\u003e to ensure that other \u003ccode\u003eWait\u003c/code\u003e calls (if there are multiple) will also panic. This is a bad solution because it\u0026#39;s not fully concurrent-safe. It would be better to use a regular variable of type \u003ccode\u003eany\u003c/code\u003e and protect it from data races with a mutex. We\u0026#39;ll cover this in the next chapter.\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// ConcGroup performs the work given to it in separate goroutines.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e     \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003epanics\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eany\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// NewConcGroup creates a new ConcGroup instance.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eNewConcGroup\u003c/span\u003e() \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e:     \u003cspan style=\"color:#000\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#000\"\u003esync\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWaitGroup\u003c/span\u003e{},\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003epanics\u003c/span\u003e: \u003cspan style=\"color:#a90d91\"\u003emake\u003c/span\u003e(\u003cspan style=\"color:#a90d91\"\u003echan\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eany\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Run performs the given work in a separate goroutine.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// If the goroutine panics, Run does not panic.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eRun\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eAdd\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ego\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a90d91\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eval\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003erecover\u003c/span\u003e(); \u003cspan style=\"color:#000\"\u003eval\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#177500\"\u003e// capture the first panic\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\t\t\t\t\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#a90d91\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003epanics\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eval\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#a90d91\"\u003edefault\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eDone\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ework\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// Wait waits for all the work to finish.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e// If any of the goroutines started by Run panicked, Wait panics too.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003efunc\u003c/span\u003e (\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#000\"\u003eConcGroup\u003c/span\u003e) \u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003ewg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003eWait\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eval\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026lt;-\u003c/span\u003e\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003epanics\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#000\"\u003ecg\u003c/span\u003e.\u003cspan style=\"color:#000\"\u003epanics\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eval\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a90d91\"\u003epanic\u003c/span\u003e(\u003cspan style=\"color:#000\"\u003eval\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a90d91\"\u003edefault\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003ch2 id=\"keep-it-up\"\u003eKeep it up\u003c/h2\u003e\u003cp\u003eThe wait group is used to wait for goroutines to finish. Now you understand how it works and how to apply it. In the next chapter, we\u0026#39;ll talk about \u003ca href=\"/go-concurrency/data-races/\" class=\"disabled\"\u003edata races\u003c/a\u003e (coming soon).\u003c/p\u003e\u003cp\u003e\u003ca class=\"button\" href=\"https://antonz.gumroad.com/l/go-concurrency\"\u003ePre-order for $10\n\u003c/a\u003e \nor \u003ca href=\"/go-concurrency/\"\u003eread online\u003c/a\u003e\u003c/p\u003e\u003cscript defer=\"\" src=\"/modules/codapi/snippet.js\"\u003e\u003c/script\u003e\u003cscript defer=\"\" src=\"../goroutines/index.js\"\u003e\u003c/script\u003e\u003cp\u003e\u003ca href=\"/subscribe/\"\u003e★ Subscribe\u003c/a\u003e to keep up with new posts.\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cfooter class=\"post__footer\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12\"\u003e\u003cdiv class=\"post__date\"\u003e\u003ctime datetime=\"2024-07-30 12:00:00 +0000 UTC\"\u003e30 Jul, 2024\u003c/time\u003e\u003c/div\u003e\u003cdiv class=\"post__tags\"\u003e\u003ca href=\"/tags/thank-go/\"\u003ethank-go\u003c/a\u003e \u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/footer\u003e\u003c/article\u003e",
  "Date": "2024-07-30T12:00:00Z",
  "Author": "Anton Zhiyanov"
}