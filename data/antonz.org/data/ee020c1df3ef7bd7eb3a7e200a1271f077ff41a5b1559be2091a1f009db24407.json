{
  "Source": "antonz.org",
  "Title": "User-defined functions in SQLite",
  "Link": "https://antonz.org/sqlean-define/",
  "Content": "\u003carticle class=\"post\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12 col-md-10 article\"\u003e\u003cheader\u003e\u003ch1\u003eUser-defined functions in SQLite\u003c/h1\u003e\u003c/header\u003e\u003cp\u003eMost database engines provide a lot of built-in functions. Still, sometimes they are not enough, and people turn to writing their own — \u003cem\u003euser-defined\u003c/em\u003e — functions in plain SQL or some SQL-based language (like pl/sql in Oracle or pl/pgsql in Postgres).\u003c/p\u003e\u003cp\u003eSQLite does not support user-defined functions by default. However, you can easily enable them using the \u003ccode\u003esqlean-define\u003c/code\u003e extension.\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e\u003cstrong\u003eNote\u003c/strong\u003e. Unlike other DBMS, adding extensions to SQLite is a breeze. Download a file, run one database command — and you are good to go.\u003c/p\u003e\u003c/blockquote\u003e\u003ch2 id=\"custom-functions\"\u003eCustom Functions\u003c/h2\u003e\u003cp\u003eWith \u003ccode\u003esqlean-define\u003c/code\u003e writing a custom function becomes as easy as:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003edefine\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;sumn\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;:n * (:n + 1) / 2\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnd then using it as any built-in function:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esumn\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e5\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e-- 15\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eUser-defined functions can take multiple parameters and call other functions.\u003c/p\u003e\u003cp\u003eGenerate a random \u003ccode\u003eN\u003c/code\u003e such that \u003ccode\u003ea ≤ N ≤ b\u003c/code\u003e:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003edefine\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;randint\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#c41a16\"\u003e\u0026#39;:a + abs(random()) % (:b - :a + 1)\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003erandint\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e99\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e-- 42\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003erandint\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e99\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e-- 17\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003erandint\u003c/span\u003e(\u003cspan style=\"color:#1c01ce\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#1c01ce\"\u003e99\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e-- 29\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eList user-defined functions:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a90d91\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#000\"\u003esqlean_define\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eDelete a function:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eundefine\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;sumn\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThere is even a way to return multiple values from a function!\u003c/p\u003e\u003ch2 id=\"dynamic-sql\"\u003eDynamic SQL\u003c/h2\u003e\u003cp\u003eTo dynamically compose an SQL query and execute it without creating a function, use \u003ccode\u003eeval()\u003c/code\u003e:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eeval\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;select 10 + 32\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#177500\"\u003e-- 42\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSupports any DDL or DML queries:\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eeval\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;create table tmp(value int)\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eeval\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;insert into tmp(value) values (1), (2), (3)\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eeval\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;select value from tmp\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a90d91\"\u003eselect\u003c/span\u003e \u003cspan style=\"color:#000\"\u003eeval\u003c/span\u003e(\u003cspan style=\"color:#c41a16\"\u003e\u0026#39;drop table tmp\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"installation-and-usage\"\u003eInstallation and Usage\u003c/h2\u003e\u003col\u003e\u003cli\u003e\u003cp\u003eDownload the \u003ca href=\"https://github.com/nalgeon/sqlean/releases/latest\"\u003elatest release\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003eUse with SQLite command-line interface:\u003c/p\u003e\u003c/li\u003e\u003c/ol\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003esqlite\u0026gt; .load ./define\nsqlite\u0026gt; select define(\u0026#39;sumn\u0026#39;, \u0026#39;:n * (:n + 1) / 2\u0026#39;);\nsqlite\u0026gt; select sumn(5);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eSee \u003ca href=\"https://github.com/nalgeon/sqlean/blob/main/docs/install.md\"\u003eHow to Install an Extension\u003c/a\u003e for usage with IDE, Python, etc.\u003c/p\u003e\u003cp\u003eSee \u003ca href=\"https://github.com/nalgeon/sqlean/blob/main/docs/define.md\"\u003eExtension Documentation\u003c/a\u003e for reference.\u003c/p\u003e\u003cp\u003e\u003cem\u003e\u003ca href=\"/subscribe/\"\u003e\u003ci class=\"fas fa-star\"\u003e\u003c/i\u003e \u003cstrong\u003eSubscribe\u003c/strong\u003e\u003c/a\u003e\nto keep up with new posts.\u003c/em\u003e\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e\u003cfooter class=\"post__footer\"\u003e\u003cdiv class=\"row\"\u003e\u003cdiv class=\"col-xs-12\"\u003e\u003cdiv class=\"post__date\"\u003e\u003ctime datetime=\"2022-09-08 15:30:00 +0000 UTC\"\u003e08 Sep, 2022\u003c/time\u003e\u003c/div\u003e\u003cdiv class=\"post__tags\"\u003e\u003ca href=\"/tags/sqlite/\"\u003esqlite\u003c/a\u003e \u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003c/footer\u003e\u003c/article\u003e",
  "Date": "2022-09-08T15:30:00Z",
  "Author": "Anton Zhiyanov"
}