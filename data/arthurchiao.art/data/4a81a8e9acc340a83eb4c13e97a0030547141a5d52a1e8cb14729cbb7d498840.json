{
  "Source": "arthurchiao.art",
  "Title": "What's Inside Cilium's KVStore (and What's Not)",
  "Link": "https://arthurchiao.art/blog/whats-inside-cilium-etcd/",
  "Content": "\u003cdiv class=\"post\"\u003e\n  \n  \u003ch1 class=\"postTitle\"\u003eWhat\u0026#39;s Inside Cilium\u0026#39;s KVStore (and What\u0026#39;s Not)\u003c/h1\u003e\n  \u003cp class=\"meta\"\u003ePublished at 2020-05-20 | Last Update 2020-09-27\u003c/p\u003e\n  \n  \u003cul id=\"markdown-toc\"\u003e\n  \u003cli\u003e\u003ca href=\"#1-preparation\" id=\"markdown-toc-1-preparation\"\u003e1 Preparation\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#11-environment\" id=\"markdown-toc-11-environment\"\u003e1.1 Environment\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#12-cilium-etcd-information\" id=\"markdown-toc-12-cilium-etcd-information\"\u003e1.2 Cilium-etcd information\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#13-setup-etcdctl\" id=\"markdown-toc-13-setup-etcdctl\"\u003e1.3 Setup \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eetcdctl\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#2-whats-inside-cilium-etcd\" id=\"markdown-toc-2-whats-inside-cilium-etcd\"\u003e2 What’s inside cilium-etcd\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#21-identity\" id=\"markdown-toc-21-identity\"\u003e2.1 Identity\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#22-labels---identity\" id=\"markdown-toc-22-labels---identity\"\u003e2.2 Labels -\u0026gt; Identity\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#23-pod-ip-address\" id=\"markdown-toc-23-pod-ip-address\"\u003e2.3 Pod IP Address\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#24-kubernetes-node\" id=\"markdown-toc-24-kubernetes-node\"\u003e2.4 Kubernetes Node\u003c/a\u003e        \u003cul\u003e\n          \u003cli\u003e\u003ca href=\"#241-ipv4alloccidr\" id=\"markdown-toc-241-ipv4alloccidr\"\u003e2.4.1 IPv4AllocCIDR\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#242-ciliuminternalip\" id=\"markdown-toc-242-ciliuminternalip\"\u003e2.4.2 CiliumInternalIP\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#243-ipv4healthip\" id=\"markdown-toc-243-ipv4healthip\"\u003e2.4.3 IPv4HealthIP\u003c/a\u003e\u003c/li\u003e\n        \u003c/ul\u003e\n      \u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#3-whats-not-inside-cilium-etcd\" id=\"markdown-toc-3-whats-not-inside-cilium-etcd\"\u003e3 What’s NOT inside cilium-etcd\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#31-cilium-network-policy-cnp\" id=\"markdown-toc-31-cilium-network-policy-cnp\"\u003e3.1 Cilium network policy (CNP)\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#32-endpoint\" id=\"markdown-toc-32-endpoint\"\u003e3.2 Endpoint\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#33-ciliumendpoint-cep\" id=\"markdown-toc-33-ciliumendpoint-cep\"\u003e3.3 CiliumEndpoint (CEP)\u003c/a\u003e\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#4-summary\" id=\"markdown-toc-4-summary\"\u003e4. Summary\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#references\" id=\"markdown-toc-references\"\u003eReferences\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr/\u003e\n\n\u003cp\u003eIn a large Cilium-powered Kubernetes cluster, there is a \u003cstrong\u003ecentral\u003c/strong\u003e\nrepository (kvstore) that all Cilium agents will connect to.\nWhile Cilium supports several types of kvstores, the most oftenly used is etcd.\u003c/p\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/whats-inside-cilium-etcd/cilium-powered-k8s-cluster.png\" width=\"70%\" height=\"70%\"/\u003e\u003c/p\u003e\n\u003cp align=\"center\"\u003eFig. Cilium Components [1]\u003c/p\u003e\n\n\u003cp\u003eThen you may wonder: \u003cstrong\u003ewhat exactly stuffs are stored in this kvstore\u003c/strong\u003e? \nWe will dig inside in this post.\u003c/p\u003e\n\n\u003ch1 id=\"1-preparation\"\u003e1 Preparation\u003c/h1\u003e\n\n\u003ch2 id=\"11-environment\"\u003e1.1 Environment\u003c/h2\u003e\n\n\u003cp\u003eSoftware version:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003eKubernetes: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e1.17+\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003eCilium: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e1.8.2\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003eEtcd (cilium kvstore): \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e3.2.24\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eother configurations:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003eCilium networking solution: direct routing via BGP [2]\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eNote that some command line outputs in this post are re-formatted for better\nhuman viewing.\u003c/p\u003e\n\n  \u003cp\u003e\u003cstrong\u003eDo not rely on the output formats in this post if you are automating something.\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eWe will execute commands on the following types of nodes:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003ek8s worker nodes\u003c/li\u003e\n  \u003cli\u003ek8s master nodes\u003c/li\u003e\n  \u003cli\u003ecilium-etcd nodes\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"12-cilium-etcd-information\"\u003e1.2 Cilium-etcd information\u003c/h2\u003e\n\n\u003cp\u003eOn k8s worker node:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003ek8s node\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecilium status\nKVStore:    Ok  etcd: 3/3 connected, ... https://10.5.2.10:2379\u003cspan class=\"p\"\u003e;\u003c/span\u003e https://10.5.2.11:2379\u003cspan class=\"p\"\u003e;\u003c/span\u003e https://10.5.2.12:2379 \u003cspan class=\"o\"\u003e(\u003c/span\u003eLeader\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nKubernetes: Ok  1.17+ \u003cspan class=\"o\"\u003e[\u003c/span\u003elinux/amd64]\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAs shown in the output, we are connected to 3 etcd instances.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eI can run \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecilium\u003c/code\u003e command on worker nodes because \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecilium\u003c/code\u003e is a wrapper\nhere:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003ek8s node\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecat\u003c/span\u003e /usr/local/bin/cilium\n\u003cspan class=\"c\"\u003e#!/bin/bash\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eCID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"nb\"\u003esudo \u003c/span\u003edocker ps | \u003cspan class=\"nb\"\u003eawk\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;/cilium-agent/ {print $1}\u0026#39;\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003cspan class=\"nb\"\u003esudo \u003c/span\u003edocker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e \u003cspan class=\"nv\"\u003e$CID\u003c/span\u003e cilium \u003cspan class=\"nv\"\u003e$@\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"13-setup-etcdctl\"\u003e1.3 Setup \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eetcdctl\u003c/code\u003e\u003c/h2\u003e\n\n\u003cp\u003eOn etcd node:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003eetcd node\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecat\u003c/span\u003e /etc/etcd/etcdrc\n\u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eETCDCTL_API\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e3\n\u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eETCDCTL_ENDPOINTS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://127.0.0.1:2379\u0026#34;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eETCDCTL_CACERT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/etcd/ssl/ca.crt\n\u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eETCDCTL_CERT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/etcd/ssl/etcd-client.crt\n\u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eETCDCTL_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/etcd/ssl/etcd-client.key\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eTest:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003eetcd node\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /etc/etcd/etcdrc\n\n\u003cspan class=\"o\"\u003e(\u003c/span\u003eetcd node\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003eetcdctl endpoint health\n127.0.0.1:2379 is healthy: successfully committed proposal: took \u003cspan class=\"o\"\u003e=\u003c/span\u003e 2.67051ms\n\n\u003cspan class=\"o\"\u003e(\u003c/span\u003eetcd node\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003eetcdctl member list\ne7c82b4ad3edb47,  started, etcd-node1, https://10.5.2.10:2380, https://10.5.2.10:2379\nd0c026e8a84e61d4, started, etcd-node2, https://10.5.2.12:2380, https://10.5.2.12:2379\nf13a3cd92f97eadd, started, etcd-node3, https://10.5.2.11:2380, https://10.5.2.11:2379\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1 id=\"2-whats-inside-cilium-etcd\"\u003e2 What’s inside cilium-etcd\u003c/h1\u003e\n\n\u003cp\u003eFirst, have a glimpse of all keys in etcd:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eetcdctl get \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"nt\"\u003e--prefix\u003c/span\u003e \u003cspan class=\"nt\"\u003e--keys-only\u003c/span\u003e\ncilium/state/identities/v1/id/10004\n...\ncilium/state/nodes/v1/default/node1\n...\ncilium/state/ip/v1/default/10.6.36.43\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eStrip blank lines and redirect to file:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eetcdctl get \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"nt\"\u003e--prefix\u003c/span\u003e \u003cspan class=\"nt\"\u003e--keys-only\u003c/span\u003e | \u003cspan class=\"nb\"\u003egrep\u003c/span\u003e \u003cspan class=\"nt\"\u003e-v\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;^$\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e keys.txt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIn my environment, those dumped keys group into 3 types:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003epod identities\u003c/li\u003e\n  \u003cli\u003epod ip addresses\u003c/li\u003e\n  \u003cli\u003ek8s nodes\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"21-identity\"\u003e2.1 Identity\u003c/h2\u003e\n\n\u003cp\u003eDump the content (value) of a specific identity:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eetcdctl get cilium/state/identities/v1/id/12928\nk8s:app\u003cspan class=\"o\"\u003e=\u003c/span\u003eistio-ingressgateway\u003cspan class=\"p\"\u003e;\u003c/span\u003e\nk8s:chart\u003cspan class=\"o\"\u003e=\u003c/span\u003egateways\u003cspan class=\"p\"\u003e;\u003c/span\u003e\nk8s:heritage\u003cspan class=\"o\"\u003e=\u003c/span\u003eTiller\u003cspan class=\"p\"\u003e;\u003c/span\u003e\nk8s:io.cilium.k8s.policy.cluster\u003cspan class=\"o\"\u003e=\u003c/span\u003edefault\u003cspan class=\"p\"\u003e;\u003c/span\u003e\nk8s:io.cilium.k8s.policy.serviceaccount\u003cspan class=\"o\"\u003e=\u003c/span\u003eai-ingressgateway-service-account\u003cspan class=\"p\"\u003e;\u003c/span\u003e\nk8s:io.kubernetes.pod.namespace\u003cspan class=\"o\"\u003e=\u003c/span\u003eistio-system\u003cspan class=\"p\"\u003e;\u003c/span\u003e\nk8s:istio\u003cspan class=\"o\"\u003e=\u003c/span\u003eai-ingressgateway\u003cspan class=\"p\"\u003e;\u003c/span\u003e\nk8s:release\u003cspan class=\"o\"\u003e=\u003c/span\u003eistio\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThese seem to be Pod labels, verify it on K8S master:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003ek8s master\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ek get pod \u003cspan class=\"nt\"\u003e-n\u003c/span\u003e istio-system \u003cspan class=\"nt\"\u003e--show-labels\u003c/span\u003e | \u003cspan class=\"nb\"\u003egrep \u003c/span\u003eistio-ingressgateway\nNAME                                      READY   LABELS\nai-ingressgateway-6bdbdbf7dc-jz85c        1/1     \u003cspan class=\"nv\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eistio-ingressgateway,chart\u003cspan class=\"o\"\u003e=\u003c/span\u003egateways,heritage\u003cspan class=\"o\"\u003e=\u003c/span\u003eTiller,istio\u003cspan class=\"o\"\u003e=\u003c/span\u003eai-ingressgateway,pod-template-hash\u003cspan class=\"o\"\u003e=\u003c/span\u003e6bdbdbf7dc,release\u003cspan class=\"o\"\u003e=\u003c/span\u003eistio\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eDescribe pod to get more detailed information:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003ek8s master\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ek describe pod \u003cspan class=\"nt\"\u003e-n\u003c/span\u003e istio-system ai-ingressgateway-6bdbdbf7dc-jz85c\nName:         ai-ingressgateway-6bdbdbf7dc-jz85c\n...\nLabels:       \u003cspan class=\"nv\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eistio-ingressgateway\n              \u003cspan class=\"nv\"\u003echart\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003egateways\n              \u003cspan class=\"nv\"\u003eheritage\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eTiller\n              \u003cspan class=\"nv\"\u003eistio\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eai-ingressgateway\n              pod-template-hash\u003cspan class=\"o\"\u003e=\u003c/span\u003e6bdbdbf7dc\n              \u003cspan class=\"nv\"\u003erelease\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eistio\nAnnotations:  sidecar.istio.io/inject: \u003cspan class=\"nb\"\u003efalse\n\u003c/span\u003eIP:           10.6.6.43\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThat’s it!\u003c/p\u003e\n\n\u003cp\u003eAs we can see, Cilium picks up \u003cstrong\u003esome\u003c/strong\u003e (not all, e.g. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003epod-template\u003c/code\u003e ignored)\nlabels from K8S, and appends them with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ek8s:\u003c/code\u003e, then stores to cilium-etcd:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eapp=istio-ingressgateway\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003echart=gateways\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eheritage=Tiller\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eistio=ai-ingressgateway\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003erelease=istio\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eBesides, it also adds its own labels:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ek8s:io.cilium.k8s.policy.cluster=default\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ek8s:io.cilium.k8s.policy.serviceaccount=ai-ingressgateway-service-account\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ek8s:io.kubernetes.pod.namespace=istio-system\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eNote that pod label \u003ccode class=\"language-plaintext highlighter-rouge\"\u003epod-template-hash=6bdbdbf7dc\u003c/code\u003e is not stored into etcd\n(ignored by Cilium).\u003c/p\u003e\n\n\u003ch2 id=\"22-labels---identity\"\u003e2.2 Labels -\u0026gt; Identity\u003c/h2\u003e\n\n\u003ch2 id=\"23-pod-ip-address\"\u003e2.3 Pod IP Address\u003c/h2\u003e\n\n\u003cp\u003eIn the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ek describe pod\u003c/code\u003e output, we get some additional information:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003ePod IP: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e10.6.6.43\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003eNode: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ek8s-node1\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003ePodCIDR: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e10.6.6.0/24\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eNow dump the IP address information in cilium-etcd:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eetcdctl get cilium/state/ip/v1/default/10.6.6.43\n\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;IP\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;10.6.6.43\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;Mask\u0026#34;\u003c/span\u003e:null,\n  \u003cspan class=\"s2\"\u003e\u0026#34;HostIP\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;10.5.1.132\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;ID\u0026#34;\u003c/span\u003e:12928,\n  \u003cspan class=\"s2\"\u003e\u0026#34;Key\u0026#34;\u003c/span\u003e:0,\n  \u003cspan class=\"s2\"\u003e\u0026#34;Metadata\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;cilium-global:default:k8s-node1:432\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;K8sNamespace\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;istio-system\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;K8sPodName\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;ai-ingressgateway-6bdbdbf7dc-jz85c\u0026#34;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"24-kubernetes-node\"\u003e2.4 Kubernetes Node\u003c/h2\u003e\n\n\u003cp\u003eDump the node information:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eetcdctl get cilium/state/nodes/v1/default/k8s-node1\n\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;Name\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;k8s-node1\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;Cluster\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;default\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;IPAddresses\u0026#34;\u003c/span\u003e:[\u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Type\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;InternalIP\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;IP\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;10.5.1.132\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n                 \u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Type\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;CiliumInternalIP\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;IP\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;10.6.6.71\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e}]\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;IPv4AllocCIDR\u0026#34;\u003c/span\u003e:\u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;IP\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;10.6.6.0\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;Mask\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;////AA==\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;IPv6AllocCIDR\u0026#34;\u003c/span\u003e:null,\n  \u003cspan class=\"s2\"\u003e\u0026#34;IPv4HealthIP\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;10.6.6.79\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;IPv6HealthIP\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;ClusterID\u0026#34;\u003c/span\u003e:0,\n  \u003cspan class=\"s2\"\u003e\u0026#34;Source\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;local\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;EncryptionKey\u0026#34;\u003c/span\u003e:0\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWhere:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eInternalIP\u003c/code\u003e: node IP address\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eIPv4AllocCIDR\u003c/code\u003e: PodCIDR for this node, used by Cilium agent\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCiliumInternalIP\u003c/code\u003e: Cilium’s gateway IP (configured on \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecilium_host\u003c/code\u003e) on this node, allocated from PodCIDR\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eIPv4HealthIP\u003c/code\u003e: Cilium’s health check IP address on this node, allocated from PodCIDR\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"241-ipv4alloccidr\"\u003e2.4.1 IPv4AllocCIDR\u003c/h3\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003ek8s master\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ekubectl describe node k8s-node1 | \u003cspan class=\"nb\"\u003egrep \u003c/span\u003ePodCIDR\nPodCIDR:                      10.6.6.0/24\nPodCIDRs:                     10.6.6.0/24\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"242-ciliuminternalip\"\u003e2.4.2 CiliumInternalIP\u003c/h3\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003ek8s-node1\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003eifconfig cilium_host\ncilium_host: \u003cspan class=\"nv\"\u003eflags\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e4291\u0026lt;UP,BROADCAST,RUNNING,NOARP,MULTICAST\u0026gt;  mtu 1500\n        inet 10.6.6.71  netmask 255.255.255.255  broadcast 0.0.0.0\n        ...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"243-ipv4healthip\"\u003e2.4.3 IPv4HealthIP\u003c/h3\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003ek8s-node1\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecilium endpoint list | \u003cspan class=\"nb\"\u003eawk\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;NR == 1 || /reserved:health/\u0026#39;\u003c/span\u003e\nENDPOINT   POLICY \u003cspan class=\"o\"\u003e(\u003c/span\u003eingress\u003cspan class=\"o\"\u003e)\u003c/span\u003e   POLICY \u003cspan class=\"o\"\u003e(\u003c/span\u003eegress\u003cspan class=\"o\"\u003e)\u003c/span\u003e   IDENTITY   LABELS \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e:key[\u003cspan class=\"o\"\u003e=\u003c/span\u003evalue]\u003cspan class=\"o\"\u003e)\u003c/span\u003e   IPv4          STATUS\n3030       Disabled           Disabled          4          reserved:health               10.6.6.79    ready\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1 id=\"3-whats-not-inside-cilium-etcd\"\u003e3 What’s NOT inside cilium-etcd\u003c/h1\u003e\n\n\u003cp\u003eRe-depict the above picture for better illustration:\u003c/p\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/whats-inside-cilium-etcd/cilium-powered-k8s-cluster.png\" width=\"70%\" height=\"70%\"/\u003e\u003c/p\u003e\n\n\u003ch2 id=\"31-cilium-network-policy-cnp\"\u003e3.1 Cilium network policy (CNP)\u003c/h2\u003e\n\n\u003cp\u003eCilium network policy (CNP) stores in k8s apiserver.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003ek8s master\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ekubelet get cnp\nNAME        AGE\ncnp-test    10d\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eCilium agents listen to apiserver, and cache them locally:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003enode\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecilium policy get\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\u0026#34;endpointSelector\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\u0026#34;matchLabels\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"s2\"\u003e\u0026#34;any:cnp\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;test\u0026#34;\u003c/span\u003e,\n        \u003cspan class=\"s2\"\u003e\u0026#34;k8s:io.kubernetes.pod.namespace\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;default\u0026#34;\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n    \u003cspan class=\"s2\"\u003e\u0026#34;ingress\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"s2\"\u003e\u0026#34;fromEndpoints\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n          \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\u0026#34;matchLabels\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"s2\"\u003e\u0026#34;any:io.kubernetes.pod.namespace\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;default\u0026#34;\u003c/span\u003e,\n              \u003cspan class=\"s2\"\u003e\u0026#34;any:cnp\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;apitest\u0026#34;\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e]\u003c/span\u003e,\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003enode\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecilium bpf policy get \u003cspan class=\"nt\"\u003e--all\u003c/span\u003e\n/sys/fs/bpf/tc/globals/cilium_policy_02489:\n\nDIRECTION   LABELS \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e:key[\u003cspan class=\"o\"\u003e=\u003c/span\u003evalue]\u003cspan class=\"o\"\u003e)\u003c/span\u003e   PORT/PROTO   PROXY PORT   BYTES         PACKETS\nIngress     reserved:unknown              ANY          NONE         10359922482   1736082\nIngress     reserved:host                 ANY          NONE         0             0\nIngress     reserved:remote-node          ANY          NONE         0             0\nEgress      reserved:unknown              ANY          NONE         2106265974    13269635\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eOn agent restart or node reboot, Cilium agents will recreate them from apiserver.\u003c/p\u003e\n\n\u003ch2 id=\"32-endpoint\"\u003e3.2 Endpoint\u003c/h2\u003e\n\n\u003cp\u003eCilium’s \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eEndpoint\u003c/code\u003e is a node-local concept, that is, EndpointID is meaningless\nout of the node that created it, and EndpointIDs are overlapping among different\nnodes.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003enode1\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecilium endpoint list\nENDPOINT   IDENTITY   LABELS \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e:key[\u003cspan class=\"o\"\u003e=\u003c/span\u003evalue]\u003cspan class=\"o\"\u003e)\u003c/span\u003e                    IPv4       STATUS\n2489       42222      k8s:app\u003cspan class=\"o\"\u003e=\u003c/span\u003eredis                                  10.2.2.2   ready\n                      k8s:io.kubernetes.pod.namespace\u003cspan class=\"o\"\u003e=\u003c/span\u003edefault\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003enode2\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecilium endpoint list\nENDPOINT   IDENTITY   LABELS \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e:key[\u003cspan class=\"o\"\u003e=\u003c/span\u003evalue]\u003cspan class=\"o\"\u003e)\u003c/span\u003e                    IPv4       STATUS\n2489       43333      k8s:app\u003cspan class=\"o\"\u003e=\u003c/span\u003emongo                                  10.2.3.3   ready\n                      k8s:io.kubernetes.pod.namespace\u003cspan class=\"o\"\u003e=\u003c/span\u003edefault\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"33-ciliumendpoint-cep\"\u003e3.3 CiliumEndpoint (CEP)\u003c/h2\u003e\n\n\u003cp\u003eFor each Endpoint, cilium-agent will create a corresponding CiliumEndpoint\ncustom resource in Kubernetes:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003emaster\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ \u003c/span\u003ek describe cep web1-0\nName:         web1-0\nNamespace:    default\nLabels:       \u0026lt;none\u0026gt;\nAnnotations:  \u0026lt;none\u0026gt;\nAPI Version:  cilium.io/v2\nKind:         CiliumEndpoint\nMetadata:\n  Creation Timestamp:  2020-09-16T10:25:56Z\n  Generation:          1\n  Resource Version:    2164268066\n  Self Link:           /apis/cilium.io/v2/namespaces/default/ciliumendpoints/web1-0\n  UID:                 9881196e-359a-4bd2-bcb8-a357e17a9441\nStatus:\n  Encryption:\n  External - Identifiers:\n    Container - Id:  34722eeca1019e273c158f2ef94bfd80c36d45f8afd48d8f547c12989ae69348\n    k8s-namespace:   default\n    k8s-pod-name:    web1-0\n    Pod - Name:      default/web1-0\n  Id:                3139\n  Identity:\n    Id:  8419\n    Labels:\n      k8s:io.kubernetes.pod.namespace\u003cspan class=\"o\"\u003e=\u003c/span\u003edefault\n      k8s:statefulset.kubernetes.io/pod-name\u003cspan class=\"o\"\u003e=\u003c/span\u003eweb1-0\n  Named - Ports:\n    Name:      web\n    Port:      80\n    Protocol:  TCP\n  Networking:\n    Addressing:\n      ipv4:  10.6.2.2\n    Node:    10.5.6.60\n  State:     ready\nEvents:      \u0026lt;none\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eFor each endpoint, there will be a dedicated controller to synchronize local Endpoint states to Kubernetes CEP.\nFor more details, see \u003ca href=\"/blog/cilium-code-cni-create-network/\"\u003eCilium Code Walk Through: CNI Create Network\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch1 id=\"4-summary\"\u003e4. Summary\u003c/h1\u003e\n\n\u003cp\u003eWhat’s inside cilium-etcd (key -\u0026gt; value):\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eIdentityID\u003c/code\u003e -\u0026gt; \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eIdentityLabels\u003c/code\u003e (PodLabels)\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eIdentityLabels\u003c/code\u003e + \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e/\u003c/code\u003e + \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eNodeIP\u003c/code\u003e -\u0026gt; \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eIdentityID\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePodIP\u003c/code\u003e -\u0026gt; \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePodIPDetails\u003c/code\u003e (e.g. identity, host, etc)\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eNodeName\u003c/code\u003e -\u0026gt; \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eNodeDetails\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eClusterMeshNodeName\u003c/code\u003e -\u0026gt; \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eClusterMeshNodeDetails\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eWhat’s \u003cstrong\u003eNOT\u003c/strong\u003e inside cilium-etcd:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003eCiliumNetworkPolicy (CNP): stores in k8s\u003c/li\u003e\n  \u003cli\u003eEndpoint (node local): stores in node-local files\u003c/li\u003e\n  \u003cli\u003eCiliumEndpoint (CEP): stores in k8s\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1 id=\"references\"\u003eReferences\u003c/h1\u003e\n\n\u003col\u003e\n  \u003cli\u003e\u003ca href=\"/blog/cilium-code-clustermesh/\"\u003eCilium ClusterMesh: A Hands-on Guide\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"/blog/trip-first-step-towards-cloud-native-networking/\"\u003eTrip.com: First Step towards Cloud-native Networking\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"/blog/cilium-code-cni-create-network/\"\u003eCilium Code Walk Through: CNI Create Network\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\n  \u003c!-- POST NAVIGATION --\u003e\n  \u003cdiv class=\"postNav clearfix\"\u003e\n     \n      \u003ca class=\"prev\" href=\"/blog/google-tech-writing-notes-zh/\"\u003e\u003cspan\u003e« [笔记] Google（英文）技术写作课（2020）\u003c/span\u003e\n      \n    \u003c/a\u003e\n      \n      \n      \u003ca class=\"next\" href=\"/blog/google-beyondprod-zh/\"\u003e\u003cspan\u003e[译] BeyondProd：云原生安全的一种新方法（Google, 2019） »\u003c/span\u003e\n       \n      \u003c/a\u003e\n     \n  \u003c/div\u003e\n\u003c/div\u003e",
  "Date": "2020-05-20T00:00:00Z",
  "Author": "Arthur Chiao"
}