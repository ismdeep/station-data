{
  "Source": "arthurchiao.art",
  "Title": "tcpdump: An Incomplete Guide",
  "Link": "https://arthurchiao.art/blog/tcpdump/",
  "Content": "\u003cdiv class=\"post\"\u003e\n  \n  \u003ch1 class=\"postTitle\"\u003etcpdump: An Incomplete Guide\u003c/h1\u003e\n  \u003cp class=\"meta\"\u003ePublished at 2018-11-28 | Last Update 2024-01-21\u003c/p\u003e\n  \n  \u003cul id=\"markdown-toc\"\u003e\n  \u003cli\u003e\u003ca href=\"#1-basic-options\" id=\"markdown-toc-1-basic-options\"\u003e1 Basic options\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#11-capture-options\" id=\"markdown-toc-11-capture-options\"\u003e1.1 Capture options\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#12-output-options\" id=\"markdown-toc-12-output-options\"\u003e1.2 Output options\u003c/a\u003e        \u003cul\u003e\n          \u003cli\u003e\u003ca href=\"#verbosity\" id=\"markdown-toc-verbosity\"\u003eVerbosity\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#ip-protocol-port\" id=\"markdown-toc-ip-protocol-port\"\u003eIP, Protocol, Port\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#mac-address\" id=\"markdown-toc-mac-address\"\u003eMAC Address\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#packet-content\" id=\"markdown-toc-packet-content\"\u003ePacket Content\u003c/a\u003e\u003c/li\u003e\n        \u003c/ul\u003e\n      \u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#13-save-to-file--read-from-file\" id=\"markdown-toc-13-save-to-file--read-from-file\"\u003e1.3 Save to file \u0026amp; read from file\u003c/a\u003e        \u003cul\u003e\n          \u003cli\u003e\u003ca href=\"#split-captured-file\" id=\"markdown-toc-split-captured-file\"\u003eSplit captured file\u003c/a\u003e\u003c/li\u003e\n        \u003c/ul\u003e\n      \u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#14-stop-capturing\" id=\"markdown-toc-14-stop-capturing\"\u003e1.4 Stop capturing\u003c/a\u003e\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#2-matching-expressions\" id=\"markdown-toc-2-matching-expressions\"\u003e2 Matching expressions\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#21-match-host\" id=\"markdown-toc-21-match-host\"\u003e2.1 Match host\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#22-match-mac-address--vlan\" id=\"markdown-toc-22-match-mac-address--vlan\"\u003e2.2 Match MAC address \u0026amp; VLAN\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#23-match-network-ip-range\" id=\"markdown-toc-23-match-network-ip-range\"\u003e2.3 Match network (ip range)\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#24-match-port--port-ranges\" id=\"markdown-toc-24-match-port--port-ranges\"\u003e2.4 Match port \u0026amp; port ranges\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#25-match-protocol-l2-l4\" id=\"markdown-toc-25-match-protocol-l2-l4\"\u003e2.5 Match protocol (L2-L4)\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#26-match-traffic-direction-ingressegress\" id=\"markdown-toc-26-match-traffic-direction-ingressegress\"\u003e2.6 Match traffic direction (ingress/egress)\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#27-match-tcp-flags\" id=\"markdown-toc-27-match-tcp-flags\"\u003e2.7 Match TCP flags\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#28-logical-operators\" id=\"markdown-toc-28-logical-operators\"\u003e2.8 Logical operators\u003c/a\u003e\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#3-advanced-matching-header-fieldsbits-matching\" id=\"markdown-toc-3-advanced-matching-header-fieldsbits-matching\"\u003e3 Advanced matching (header fields/bits matching)\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#31-match-fields-in-ip-header\" id=\"markdown-toc-31-match-fields-in-ip-header\"\u003e3.1 Match fields in IP header\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#32-match-fields-in-icmp-header\" id=\"markdown-toc-32-match-fields-in-icmp-header\"\u003e3.2 Match fields in ICMP header\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#33-match-fields-in-tcp-header\" id=\"markdown-toc-33-match-fields-in-tcp-header\"\u003e3.3 Match fields in TCP header\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#34-match-fields-in-udp-header\" id=\"markdown-toc-34-match-fields-in-udp-header\"\u003e3.4 Match fields in UDP header\u003c/a\u003e        \u003cul\u003e\n          \u003cli\u003e\u003ca href=\"#filter-reverse-dns-lookup-requests-dig--x-ipv6\" id=\"markdown-toc-filter-reverse-dns-lookup-requests-dig--x-ipv6\"\u003eFilter reverse DNS lookup requests (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edig -x \u0026lt;ipv6\u0026gt;\u003c/code\u003e)\u003c/a\u003e\u003c/li\u003e\n        \u003c/ul\u003e\n      \u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#35-match-fields-in-http-header\" id=\"markdown-toc-35-match-fields-in-http-header\"\u003e3.5 Match fields in HTTP header\u003c/a\u003e\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#4-misc\" id=\"markdown-toc-4-misc\"\u003e4 Misc\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#41-truncate-packet-length\" id=\"markdown-toc-41-truncate-packet-length\"\u003e4.1 Truncate packet length\u003c/a\u003e\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#reference\" id=\"markdown-toc-reference\"\u003eReference\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcpdump\u003c/code\u003e is a network tool to dump traffic on the network.\nThis post servers as a guide to some frequently used commands. For a complete guide,\nplease refer to the \u003ca href=\"https://www.tcpdump.org/manpages/tcpdump.1.html\"\u003eman page\u003c/a\u003e, or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eman tcpdump\u003c/code\u003e on a linux machine.\u003c/p\u003e\n\n\u003ch1 id=\"1-basic-options\"\u003e1 Basic options\u003c/h1\u003e\n\n\u003cp\u003eA help summary:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003etcpdump [ -AbdDefhHIJKlLnNOpqStuUvxX# ] [ -B buffer_size ]\n        [ -c count ]\n        [ -C file_size ] [ -G rotate_seconds ] [ -F file ]\n        [ -i interface ] [ -j tstamp_type ] [ -m module ] [ -M secret ]\n        [ --number ] [ -Q in|out|inout ]\n        [ -r file ] [ -V file ] [ -s snaplen ] [ -T type ] [ -w file ]\n        [ -W filecount ]\n        [ -E spi@ipaddr algo:secret,...  ]\n        [ -y datalinktype ] [ -z postrotate-command ] [ -Z user ]\n        [ --time-stamp-precision=tstamp_precision ]\n        [ --immediate-mode ] [ --version ]\n        [ expression ]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eRunning \u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcpdump\u003c/code\u003e needs root privilege, so prefix \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esudo\u003c/code\u003e before all commands in\nthis post if you are not root user.\u003c/p\u003e\n\n\u003ch2 id=\"11-capture-options\"\u003e1.1 Capture options\u003c/h2\u003e\n\n\u003cp\u003eThe simplest way to capture traffic on a host is to specify a device with\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-i\u003c/code\u003e option, the output may look like this:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003esudo \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"c\"\u003e# use CTL-C to terminate it\u003c/span\u003e\n18:10:14.578057 IP 192.168.1.3.ssh \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.1.124.53519: Flags \u003cspan class=\"o\"\u003e[\u003c/span\u003eP.], \u003cspan class=\"nb\"\u003eseq \u003c/span\u003e2350:2350, ack 166, win 198, length 240\n18:10:14.578775 IP 192.168.1.124.53519 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.1.3.ssh: Flags \u003cspan class=\"o\"\u003e[\u003c/span\u003e.], ack 240, win 252, length 0\n18:10:14.634826 ARP, Request who-has 192.168.1.68 tell 192.168.1.81, length 46\n18:10:14.670785 ARP, Request who-has 192.168.1.146 tell 192.168.1.81, length 46\n^C\n4 packets captured\n39 packets received by filter\n0 packets dropped by kernel\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eOne \u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcpdump\u003c/code\u003e process could only capture one device, to capture multiple devices, e.g. both \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eeth0\u003c/code\u003e\nand \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eeth1\u003c/code\u003e, you have to launch two processes:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"o\"\u003e[\u003c/span\u003eOPTIONS]\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth1 \u003cspan class=\"o\"\u003e[\u003c/span\u003eOPTIONS]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"12-output-options\"\u003e1.2 Output options\u003c/h2\u003e\n\n\u003cp\u003eThis section describes the options for displaying packets info on standard output.\u003c/p\u003e\n\n\u003ch3 id=\"verbosity\"\u003eVerbosity\u003c/h3\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-v\u003c/code\u003e verbose\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-vv\u003c/code\u003e more verbose\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-vvv\u003c/code\u003e even more verbose\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"ip-protocol-port\"\u003eIP, Protocol, Port\u003c/h3\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-n\u003c/code\u003e print IP instead of host name. This can be used to avoid DNS lookups\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-nn\u003c/code\u003e print integer protocol/port numbers instead of protocl/port names, e.g. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e22\u003c/code\u003e vs \u003ccode class=\"language-plaintext highlighter-rouge\"\u003essh\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e80\u003c/code\u003e vs \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ehttp\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eExamples:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0\n14:54:35.161548 IP ctn-1.example.com \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e ctn-2.example.com: ICMP \u003cspan class=\"nb\"\u003eecho \u003c/span\u003erequest, \u003cspan class=\"nb\"\u003eid \u003c/span\u003e29455, \u003cspan class=\"nb\"\u003eseq \u003c/span\u003e0, length 64\n14:54:35.161599 IP ctn-2.example.com \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e ctn-1.example.com: ICMP \u003cspan class=\"nb\"\u003eecho \u003c/span\u003ereply, \u003cspan class=\"nb\"\u003eid \u003c/span\u003e29455, \u003cspan class=\"nb\"\u003eseq \u003c/span\u003e0, length 64\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-n\u003c/span\u003e \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0\n14:55:34.296206 IP 192.168.1.3 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.1.4: ICMP \u003cspan class=\"nb\"\u003eecho \u003c/span\u003erequest, \u003cspan class=\"nb\"\u003eid \u003c/span\u003e29711, \u003cspan class=\"nb\"\u003eseq \u003c/span\u003e0, length 64\n14:55:34.296259 IP 192.168.1.4 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.1.3: ICMP \u003cspan class=\"nb\"\u003eecho \u003c/span\u003ereply, \u003cspan class=\"nb\"\u003eid \u003c/span\u003e29711, \u003cspan class=\"nb\"\u003eseq \u003c/span\u003e0, length 64\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"mac-address\"\u003eMAC Address\u003c/h3\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-e\u003c/code\u003e also print MAC address\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-n\u003c/span\u003e \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0\n15:05:12.225901 fa:16:3e:39:8c:fd \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 00:22:0d:27:c2:45, ethertype IPv4 \u003cspan class=\"o\"\u003e(\u003c/span\u003e0x0800\u003cspan class=\"o\"\u003e)\u003c/span\u003e, length 294: 192.168.1.3 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.1.124: Flags \u003cspan class=\"o\"\u003e[\u003c/span\u003eP.], \u003cspan class=\"nb\"\u003eseq\u003c/span\u003e ...\n15:05:12.226585 00:22:0d:27:c2:45 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e fa:16:3e:39:8c:fd, ethertype IPv4 \u003cspan class=\"o\"\u003e(\u003c/span\u003e0x0800\u003cspan class=\"o\"\u003e)\u003c/span\u003e, length 60: 192.168.1.124 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.1.3: Flags \u003cspan class=\"o\"\u003e[\u003c/span\u003e.], ack ...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"packet-content\"\u003ePacket Content\u003c/h3\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-x\u003c/code\u003e   print the data of each packet (minus its link level header) in hex\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-xx\u003c/code\u003e  print the data of each packet, including its link level header, in hex.\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-X\u003c/code\u003e   print the data of each packet (minus its link level header) in  hex  and  ASCII.\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-XX\u003c/code\u003e  print the data of each packet, including its link level header, in hex and ASCII.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"nt\"\u003e-x\u003c/span\u003e\n19:33:33.724674 IP 192.168.1.3 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.1.4: ICMP \u003cspan class=\"nb\"\u003eecho \u003c/span\u003erequest, \u003cspan class=\"nb\"\u003eid \u003c/span\u003e10258, \u003cspan class=\"nb\"\u003eseq \u003c/span\u003e0, length 64\n        0x0000:  4500 0054 6e2b 4000 4001 4926 c0a8 0103\n        0x0010:  c0a8 0104 0800 a20e 2812 0000 0f1c 1ec3\n        0x0020:  0000 0000 0000 0000 0000 0000 0000 0000\n        0x0030:  0000 0000 0000 0000 0000 0000 0000 0000\n        0x0040:  0000 0000 0000 0000 0000 0000 0000 0000\n        0x0050:  0000 0000\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"13-save-to-file--read-from-file\"\u003e1.3 Save to file \u0026amp; read from file\u003c/h2\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-w outfile.pcap\u003c/code\u003e save packets to file\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-G\u003c/code\u003e rotate the dump file, should be used with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-w\u003c/code\u003e option\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-r outfile.pcap\u003c/code\u003e read a captured file\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eCaptured files usually suffixed with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecap\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.pcap\u003c/code\u003e, which means \u003cstrong\u003epacket\ncapture file\u003c/strong\u003e. The captured files are totally different from those generated\nwith \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026gt; outfile\u003c/code\u003e, which only redirects the messages on standard output (text) to\na file.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# save raw packets to file\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"nt\"\u003e-w\u003c/span\u003e test.pcap\n\n\u003cspan class=\"c\"\u003e# redirect logs to text file\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e test.txt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eCaptured files could be open again later:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \u003cspan class=\"nt\"\u003e-nn\u003c/span\u003e \u003cspan class=\"nt\"\u003e-r\u003c/span\u003e test.pcap \u003cspan class=\"c\"\u003e# read captured file content, print ether header, and be more numeric\u003c/span\u003e\n15:10:40.111214 fa:16:30:a1:33:27 \u003cspan class=\"o\"\u003e(\u003c/span\u003eoui Unknown\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e fa:16:3f:e2:16:17 \u003cspan class=\"o\"\u003e(\u003c/span\u003eoui Unknown\u003cspan class=\"o\"\u003e)\u003c/span\u003e, ethertype 802.1Q \u003cspan class=\"o\"\u003e(\u003c/span\u003e0x8100\u003cspan class=\"o\"\u003e)\u003c/span\u003e, length 78: \u003cspan class=\"o\"\u003e[\u003c/span\u003e|vlan]\n15:10:40.111275 fa:16:30:a1:33:27 \u003cspan class=\"o\"\u003e(\u003c/span\u003eoui Unknown\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e fa:16:3f:e2:16:17 \u003cspan class=\"o\"\u003e(\u003c/span\u003eoui Unknown\u003cspan class=\"o\"\u003e)\u003c/span\u003e, ethertype 802.1Q \u003cspan class=\"o\"\u003e(\u003c/span\u003e0x8100\u003cspan class=\"o\"\u003e)\u003c/span\u003e, length 78: \u003cspan class=\"o\"\u003e[\u003c/span\u003e|vlan]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eOr, those files could also be opened with more professional traffic analyzing\ntools, e.g. \u003ca href=\"https://www.wireshark.org\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eWireshark\u003c/code\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch3 id=\"split-captured-file\"\u003eSplit captured file\u003c/h3\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-C \u0026lt;N\u0026gt;\u003c/code\u003e write pcap file \u003cmark\u003eevery N MB\u003c/mark\u003e.\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-W \u0026lt;N\u0026gt;\u003c/code\u003e \u003cmark\u003ekeep at most N copies\u003c/mark\u003e, then start to rotate.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eExample: \u003cstrong\u003e\u003cmark\u003eread a large pcap file, split it into 10MB chunks\u003c/mark\u003e\u003c/strong\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-r\u003c/span\u003e a.pcap \u003cspan class=\"nt\"\u003e-C\u003c/span\u003e 10 b.pcap\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003els\n\u003c/span\u003eb.pcap0 b.pcap1 b.pcap2 ...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"14-stop-capturing\"\u003e1.4 Stop capturing\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCTL-C\u003c/code\u003e will stop capturing.\u003c/p\u003e\n\n\u003cp\u003eBesides, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-c \u0026lt;count\u0026gt;\u003c/code\u003e will auto exit after receiving \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;count\u0026gt;\u003c/code\u003e packets.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e 2\n15:00:18.129859 IP 192.168.1.3.ssh \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.1.4.53519: Flags \u003cspan class=\"o\"\u003e[\u003c/span\u003eP.], \u003cspan class=\"nb\"\u003eseq\u003c/span\u003e ...\n15:00:18.130500 IP 192.168.1.4.53519 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.1.3.ssh: Flags \u003cspan class=\"o\"\u003e[\u003c/span\u003e.], ack ...\n2 packets captured\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1 id=\"2-matching-expressions\"\u003e2 Matching expressions\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcpdump\u003c/code\u003e supports filter expressions, this is where the real power comes to\nplace. A complete guide of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003epcap-filter\u003c/code\u003e could be get from it’s \u003ca href=\"https://www.tcpdump.org/manpages/pcap-filter.7.txt\"\u003eman page\u003c/a\u003e,\nor through:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eman 7 pcap-filter\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIf no filter expressions specified, tcpdump will capture all the packets on the\ndevice, which may be huge in mount. With filter expressions, it will only capture those that match the expressions.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"o\"\u003e[\u003c/span\u003eOPTIONS] \u003cspan class=\"o\"\u003e[\u003c/span\u003eexpression]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"21-match-host\"\u003e2.1 Match host\u003c/h2\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ehost \u0026lt;hostname or IP\u0026gt;\u003c/code\u003e - capture packets \u003cstrong\u003esent from and to\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ehost\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003esrc host \u0026lt;hostname or IP\u0026gt;\u003c/code\u003e - capture packets \u003cstrong\u003esent from\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ehost\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edst host \u0026lt;hostname or IP\u0026gt;\u003c/code\u003e - capture packets \u003cstrong\u003esent to\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ehost\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eExamples:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 host baidu.com   \u003cspan class=\"c\"\u003e# traffic from or to baidu.com\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 host 192.168.1.3 \u003cspan class=\"c\"\u003e# traffic from or to 192.168.1.3\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 src host 192.168.1.3\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 dst host 192.168.1.3\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"22-match-mac-address--vlan\"\u003e2.2 Match MAC address \u0026amp; VLAN\u003c/h2\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eether host \u0026lt;MAC\u0026gt;\u003c/code\u003e - capture packets \u003cstrong\u003esent from and to\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;MAC\u0026gt;\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eether src \u0026lt;MAC\u0026gt;\u003c/code\u003e - capture packets \u003cstrong\u003esent from\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;MAC\u0026gt;\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eether dst \u0026lt;MAC\u0026gt;\u003c/code\u003e - capture packets \u003cstrong\u003esent to\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;MAC\u0026gt;\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003evlan \u0026lt;VLAN ID\u0026gt;\u003c/code\u003e - match VLAN ID\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"23-match-network-ip-range\"\u003e2.3 Match network (ip range)\u003c/h2\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003enet \u0026lt;NET\u0026gt; mask \u0026lt;MASK\u0026gt;\u003c/code\u003e - IPv4 only\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003enet \u0026lt;NET\u0026gt;/\u0026lt;LEN\u0026gt;\u003c/code\u003e - IPv4/IPv6\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eMay be qualified with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esrc\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003edst\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eExamples:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e$ tcpdump -i eth0 net 192.168.1.0 mask 255.255.255.0\n$ tcpdump -i eth0 net 192.168.1.0/24\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"24-match-port--port-ranges\"\u003e2.4 Match port \u0026amp; port ranges\u003c/h2\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eport \u0026lt;port\u0026gt;\u003c/code\u003e - packets \u003cstrong\u003efrom and to\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;port\u0026gt;\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003esrc port \u0026lt;port\u0026gt;\u003c/code\u003e - packets \u003cstrong\u003efrom\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;port\u0026gt;\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edst port \u0026lt;port\u0026gt;\u003c/code\u003e - packets \u003cstrong\u003eto\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;port\u0026gt;\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eportrange \u0026lt;port1\u0026gt;-\u0026lt;port2\u0026gt;\u003c/code\u003e - packets \u003cstrong\u003efrom and to\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;port1\u0026gt;-\u0026lt;port2\u0026gt;\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003esrc portrange \u0026lt;port1\u0026gt;-\u0026lt;port2\u0026gt;\u003c/code\u003e - packets \u003cstrong\u003efrom\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;port1\u0026gt;-\u0026lt;port2\u0026gt;\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edst portrange \u0026lt;port1\u0026gt;-\u0026lt;port2\u0026gt;\u003c/code\u003e - packets \u003cstrong\u003eto\u003c/strong\u003e \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026lt;port1\u0026gt;-\u0026lt;port2\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eExamples:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 port 80\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 dst port 80\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 src portrange 8000-8080\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"25-match-protocol-l2-l4\"\u003e2.5 Match protocol (L2-L4)\u003c/h2\u003e\n\n\u003cp\u003eMatch protocols in L3 header:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eip proto \u0026lt;PROTO\u0026gt;\u003c/code\u003e - PROTO: icmp, icmp6, igmp, igrp, pim, ah, esp, vrrp, udp, or tcp\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eFollow are abbreviations:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eicmp\u003c/code\u003e = \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eproto icmp\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp\u003c/code\u003e = \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eproto tcp\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eudp\u003c/code\u003e = \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eproto udp\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eMatch protocols in L2 header:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eether proto \u0026lt;PROTO\u0026gt;\u003c/code\u003e - PROTO: ip, ip6, arp, rarp, atalk, aarp, decnet, sca, lat, mopdl, moprc,  iso,  stp,  ipx,  or  netbeui\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eFollow are abbreviations:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eip\u003c/code\u003e = \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eether proto ip\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eip6\u003c/code\u003e = \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eether proto ip6\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003earp\u003c/code\u003e = \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eether proto arp\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003erarp\u003c/code\u003e = \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eether proto rarp\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 arp\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 icmp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"26-match-traffic-direction-ingressegress\"\u003e2.6 Match traffic direction (ingress/egress)\u003c/h2\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e--direction=[in|out|inout]\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-Q [in|out]\u003c/code\u003e - note that not all platform supports this\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"27-match-tcp-flags\"\u003e2.7 Match TCP flags\u003c/h2\u003e\n\n\u003cp\u003eTCP flags (bits):\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp-syn\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp-ack\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp-fin\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp-rst\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp-push\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eFilter expressions based on the above flags:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026#39;tcp[tcpflags] \u0026amp; (tcp-rst) != 0\u0026#39;\u003c/code\u003e: capture reset packets\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026#39;tcp[tcpflags] \u0026amp; (tcp-syn) != 0\u0026#39;\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp[13] \u0026amp; 2 != 0\u003c/code\u003e: capture \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esyn\u003c/code\u003e packets\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026#39;tcp[tcpflags] \u0026amp; (tcp-syn|tcp-ack) != 0\u0026#39;\u003c/code\u003e: capture \u003cmark\u003eTCP handshake\u003c/mark\u003e packets\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-nn\u003c/span\u003e \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"s1\"\u003e\u0026#39;tcp[tcpflags] \u0026amp; (tcp-rst) != 0\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"28-logical-operators\"\u003e2.8 Logical operators\u003c/h2\u003e\n\n\u003cp\u003eWith logical operators, we could combine simple expressions into a complex one.\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eand\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e\u0026amp;\u0026amp;\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eor\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e||\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003enot\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e!\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eExamples:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# capture traffic: 192.168.1.3\u0026lt;-\u0026gt;192.168.1.4:80\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"s1\"\u003e\u0026#39;host 192.168.1.3 and (host 192.168.1.4 and port 80)\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e# capture traffic: 192.168.1.3-\u0026gt;192.168.1.4:80\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"s1\"\u003e\u0026#39;src host 192.168.1.3 and (dst host 192.168.1.4 and port 80)\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e# capture traffic: 192.168.1.0/24-\u0026gt;10.1.1.4\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"s1\"\u003e\u0026#39;src net 192.168.1.0/24 and dst host 10.1.1.4 -w test.pcap\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1 id=\"3-advanced-matching-header-fieldsbits-matching\"\u003e3 Advanced matching (header fields/bits matching)\u003c/h1\u003e\n\n\u003cp\u003eThis part is borrowed from [4].\u003c/p\u003e\n\n\u003cp\u003eGeneral format:\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003e\n    \u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eproto[x:y]\u003c/code\u003e: starting from \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ex\u003c/code\u003eth byte, extract \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ey\u003c/code\u003e consecutive bytes, where \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ex\u003c/code\u003e starts from 0.\u003c/p\u003e\n\n    \u003cp\u003eFor example: \u003cstrong\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eip[2:2]\u003c/code\u003e means extracting the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e3rd\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e4th\u003c/code\u003e bytes.\u003c/strong\u003e\u003c/p\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\n    \u003cp\u003eThe extracted result could further be processed: e.g. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eresult \u0026amp; 0xF != 0\u003c/code\u003e\u003c/p\u003e\n  \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"31-match-fields-in-ip-header\"\u003e3.1 Match fields in IP header\u003c/h2\u003e\n\n\u003cp\u003eIP header:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebyte:       0               1               2               3\n\nbit  0 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    |Version|  IHL  |Type of Service|          Total Length         |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    |         Identification        |Flags|      Fragment Offset    |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    |  Time to Live |    Protocol   |         Header Checksum       |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    |                       Source Address                          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    |                    Destination Address                        |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    |                    Options                    |    Padding    | \u0026lt;-- optional\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    |                            DATA ...                           |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eip[6] = 32\u003c/code\u003e: packets with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eMF=1\u003c/code\u003e (More Fragments) in \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eFlags\u003c/code\u003e field, which indicates this is a fragmented packet\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eip[8] \u0026lt; 5\u003c/code\u003e: packets with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTTL \u0026lt; 5\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eip[2:2] \u0026gt; 600\u003c/code\u003e: packets with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elength \u0026gt; 600\u003c/code\u003e bytes (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTotal Length\u003c/code\u003e field)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"32-match-fields-in-icmp-header\"\u003e3.2 Match fields in ICMP header\u003c/h2\u003e\n\n\u003ch2 id=\"33-match-fields-in-tcp-header\"\u003e3.3 Match fields in TCP header\u003c/h2\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebyte:       0               1               2               3\n\nbit  0 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|          Source Port          |       Destination Port        |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|                        Sequence Number                        |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|                    Acknowledgment Number                      |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|  Data |       |C|E|U|A|P|R|S|F|                               |\n| Offset|  Res. |W|C|R|C|S|S|Y|I|            Window             |\n|       |       |R|E|G|K|H|T|N|N|                               |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|           Checksum            |         Urgent Pointer        |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|                    Options                    |    Padding    |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n|                             data                              |\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp[0:2] \u0026gt; 1024\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp src portrange 1025-65535\u003c/code\u003e: packets with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esrc port \u0026gt; 1024\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp[13] = 2\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp[tcpflags] \u0026amp; tcp-syn != 0\u003c/code\u003e: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esyn\u003c/code\u003e packets\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp[13] = 18\u003c/code\u003e: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esyn+ack\u003c/code\u003e packets\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp[13] \u0026amp; 2 = 2\u003c/code\u003e: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esyn\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esyn+ack\u003c/code\u003e packets\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp[13] \u0026amp; 1 = 1\u003c/code\u003e: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003efin\u003c/code\u003e packets\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcp[13] \u0026amp; 4 = 4\u003c/code\u003e: \u003ccode class=\"language-plaintext highlighter-rouge\"\u003erst\u003c/code\u003e packets\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"34-match-fields-in-udp-header\"\u003e3.4 Match fields in UDP header\u003c/h2\u003e\n\n\u003ch3 id=\"filter-reverse-dns-lookup-requests-dig--x-ipv6\"\u003eFilter reverse DNS lookup requests (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edig -x \u0026lt;ipv6\u0026gt;\u003c/code\u003e)\u003c/h3\u003e\n\n\u003cp\u003eQuery the domain name for IPv6 address \u003ccode class=\"language-plaintext highlighter-rouge\"\u003efe80::5107:a8da:61ec:b226\u003c/code\u003e, using DNS server \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e8.8.8.8\u003c/code\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003edig \u003cspan class=\"nt\"\u003e-x\u003c/span\u003e fe80::5107:a8da:61ec:b226 @8.8.8.8\n...\n\u003cspan class=\"p\"\u003e;\u003c/span\u003e EDNS: version: 0, flags:\u003cspan class=\"p\"\u003e;\u003c/span\u003e udp: 512\n\u003cspan class=\"p\"\u003e;;\u003c/span\u003e QUESTION SECTION:\n\u003cspan class=\"p\"\u003e;\u003c/span\u003e6.2.2.b.c.e.1.6.a.d.8.a.7.0.1.5.0.0.0.0.0.0.0.0.0.0.0.0.0.8.e.f.ip6.arpa. IN PTR\n\n\u003cspan class=\"p\"\u003e;;\u003c/span\u003e AUTHORITY SECTION:\nip6.arpa.               3300    IN      SOA     b.ip6-servers.arpa. nstld.iana.org. 2022092102 1800 900 604800 3600\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe plain text \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e6.2.2.b.c.e.1.6.a.d.8.a.7.0.1.5.0.0.0.0.0.0.0.0.0.0.0.0.0.8.e.f.ip6.arpa.\u003c/code\u003e\nwill be encoded into the UDP data field. With wireshark, you can easily decide the offset\nof the text: click on the binary data, then the corresponding text will be highlighted:\u003c/p\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/tcpdump/reverse-dns-lookup-pkt.png\" width=\"90%\" height=\"90%\"/\u003e\u003c/p\u003e\n\n\u003cp\u003eFor example, text \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003eip6.\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e (hex \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003e0x69 0x70 0x36 0x04\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e)\nis the \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003e85~87\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e octet in UDP header,\nso we can filter by this snippet to \u003cstrong\u003e\u003cmark\u003eignore all other DNS queries\u003c/mark\u003e\u003c/strong\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003esudo \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-nn\u003c/span\u003e \u003cspan class=\"nt\"\u003e-x\u003c/span\u003e \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e enp0s3 dst port 53 and dst host 8.8.8.8 and \u003cspan class=\"s2\"\u003e\u0026#34;udp[85:4] = 0x69703604\u0026#34;\u003c/span\u003e\n18:49:35.301843 IP 10.0.2.15.45855 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 8.8.8.8.53: 34915+ \u003cspan class=\"o\"\u003e[\u003c/span\u003e1au] PTR? 6.2.2.b.c.e.1.6.a.d.8.a.7.0.1.5.0.0.0.0.0.0.0.0.0.0.0.0.0.8.e.f.ip6.arpa. \u003cspan class=\"o\"\u003e(\u003c/span\u003e113\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n        0x0000:  4500 008d 9337 0000 4011 cb0a 0a00 020f\n        0x0010:  0808 0808 b31f 0035 0079 1ca9 8863 0120\n        0x0020:  0001 0000 0000 0001 0136 0132 0132 0162\n        0x0030:  0163 0165 0131 0136 0161 0164 0138 0161\n        0x0040:  0137 0130 0131 0135 0130 0130 0130 0130\n        0x0050:  0130 0130 0130 0130 0130 0130 0130 0130\n        0x0060:  0130 0138 0165 0166 0369 7036 0461 7270\n        0x0070:  6100 000c 0001 0000 2910 0000 0000 0000\n        0x0080:  0c00 0a00 0854 a19a 7f83 9f15 c4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eYou could also filter by \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003e0.8.e.f\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e, which is the start of all IPv6 link local addresses (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003efe80\u003c/code\u003e).\nLeave this exercise to readers.\u003c/p\u003e\n\n\u003ch2 id=\"35-match-fields-in-http-header\"\u003e3.5 Match fields in HTTP header\u003c/h2\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etcpdump \u0026lt;options\u0026gt; | grep GET\u003c/code\u003e: HTTP GET requests\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1 id=\"4-misc\"\u003e4 Misc\u003c/h1\u003e\n\n\u003ch2 id=\"41-truncate-packet-length\"\u003e4.1 Truncate packet length\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-s \u0026lt;LEN\u0026gt;\u003c/code\u003e truncate each packet to length \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eLEN\u003c/code\u003e bytes. This could substantially\nreduce the resulted pcap file size.\u003c/p\u003e\n\n\u003cp\u003eFor example, if want to capture only L2 and L3 headers, you could truncate each\npacket to 14 (ether header) + 2 (potential VLAN) + 20 (IP header basic part) =\n36 bytes, thus:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003etcpdump \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e eth0 \u003cspan class=\"nt\"\u003e-s\u003c/span\u003e 36 \u003cspan class=\"nt\"\u003e-w\u003c/span\u003e test.pcap\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1 id=\"reference\"\u003eReference\u003c/h1\u003e\n\n\u003col\u003e\n  \u003cli\u003e\u003ca href=\"https://www.tcpdump.org/manpages/tcpdump.1.html\"\u003eMan Page of tcpdump\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://www.wireshark.org\"\u003eWireshark\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://www.tcpdump.org/manpages/pcap-filter.7.txt\"\u003eMan Page of pcap-filter\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://blog.wains.be/2007/2007-10-01-tcpdump-advanced-filters/\"\u003eTcpdump advanced filters\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\n  \u003c!-- POST NAVIGATION --\u003e\n  \u003cdiv class=\"postNav clearfix\"\u003e\n     \n      \u003ca class=\"prev\" href=\"/blog/monitoring-hub/\"\u003e\u003cspan\u003e« Monitoring Docker Registry\u003c/span\u003e\n      \n    \u003c/a\u003e\n      \n      \n      \u003ca class=\"next\" href=\"/blog/trace-packet-with-tracepoint-perf-ebpf-zh/\"\u003e\u003cspan\u003e[译] 使用 Linux tracepoint、perf 和 eBPF 跟踪数据包 (2017) »\u003c/span\u003e\n       \n      \u003c/a\u003e\n     \n  \u003c/div\u003e\n\u003c/div\u003e",
  "Date": "2018-11-28T00:00:00Z",
  "Author": "Arthur Chiao"
}