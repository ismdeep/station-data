{
  "Source": "arthurchiao.art",
  "Title": "源码解析：K8s 创建 pod 时，背后发生了什么（一）（2021）",
  "Link": "https://arthurchiao.art/blog/what-happens-when-k8s-creates-pods-1-zh/",
  "Content": "\u003cdiv class=\"post\"\u003e\n  \n  \u003ch1 class=\"postTitle\"\u003e源码解析：K8s 创建 pod 时，背后发生了什么（一）（2021）\u003c/h1\u003e\n  \u003cp class=\"meta\"\u003ePublished at 2021-06-01 | Last Update 2023-01-25\u003c/p\u003e\n  \n  \u003cp\u003e本文基于 2019 年的一篇文章\n\u003ca href=\"https://github.com/jamiehannaford/what-happens-when-k8s\"\u003eWhat happens when … Kubernetes edition!\u003c/a\u003e\n\u003cstrong\u003e\u003cmark\u003e梳理了 k8s 创建 pod\u003c/mark\u003e\u003c/strong\u003e（及其 deployment/replicaset）\u003cstrong\u003e\u003cmark\u003e的整个过程\u003c/mark\u003e\u003c/strong\u003e，\n整理了每个\u003cstrong\u003e重要步骤的代码调用栈\u003c/strong\u003e，以\u003cstrong\u003e\u003cmark\u003e在实现层面加深对整个过程的理解\u003c/mark\u003e\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e原文参考的 k8S 代码已经较老（\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ev1.8\u003c/code\u003e/\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ev1.14\u003c/code\u003e 以及当时的 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emaster\u003c/code\u003e），且部分代码\n链接已失效；\u003cstrong\u003e本文代码基于 \u003ca href=\"https://github.com/kubernetes/kubernetes/tree/v1.21.1\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ev1.21\u003c/code\u003e\u003c/a\u003e\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e由于内容已经不与原文一一对应（有增加和删减），因此标题未加 “[译]” 等字样。感谢原作者（们）的精彩文章。\u003c/p\u003e\n\n\u003cp\u003e篇幅太长，分成了几部分：\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003e\u003ca href=\"/blog/what-happens-when-k8s-creates-pods-1-zh/\"\u003e源码解析：K8s 创建 pod 时，背后发生了什么（一）（2021）\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"/blog/what-happens-when-k8s-creates-pods-2-zh/\"\u003e源码解析：K8s 创建 pod 时，背后发生了什么（二）（2021）\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"/blog/what-happens-when-k8s-creates-pods-3-zh/\"\u003e源码解析：K8s 创建 pod 时，背后发生了什么（三）（2021）\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"/blog/what-happens-when-k8s-creates-pods-4-zh/\"\u003e源码解析：K8s 创建 pod 时，背后发生了什么（四）（2021）\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"/blog/what-happens-when-k8s-creates-pods-5-zh/\"\u003e源码解析：K8s 创建 pod 时，背后发生了什么（五）（2021）\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003chr/\u003e\n\n\u003cul id=\"markdown-toc\"\u003e\n  \u003cli\u003e\u003ca href=\"#0-k8s-组件启动过程\" id=\"markdown-toc-0-k8s-组件启动过程\"\u003e0 K8s 组件启动过程\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#01-kube-apiserver-启动\" id=\"markdown-toc-01-kube-apiserver-启动\"\u003e0.1 kube-apiserver 启动\u003c/a\u003e        \u003cul\u003e\n          \u003cli\u003e\u003ca href=\"#调用栈\" id=\"markdown-toc-调用栈\"\u003e调用栈\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#注册命令行参数\" id=\"markdown-toc-注册命令行参数\"\u003e注册命令行参数\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#注册各种-handler\" id=\"markdown-toc-注册各种-handler\"\u003e注册各种 handler\u003c/a\u003e\u003c/li\u003e\n        \u003c/ul\u003e\n      \u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#02-controller-manager-启动\" id=\"markdown-toc-02-controller-manager-启动\"\u003e0.2 controller-manager 启动\u003c/a\u003e        \u003cul\u003e\n          \u003cli\u003e\u003ca href=\"#调用栈-1\" id=\"markdown-toc-调用栈-1\"\u003e调用栈\u003c/a\u003e\u003c/li\u003e\n        \u003c/ul\u003e\n      \u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#03-kubelet-启动\" id=\"markdown-toc-03-kubelet-启动\"\u003e0.3 kubelet 启动\u003c/a\u003e        \u003cul\u003e\n          \u003cli\u003e\u003ca href=\"#调用栈-2\" id=\"markdown-toc-调用栈-2\"\u003e调用栈\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#newcontainermanager\" id=\"markdown-toc-newcontainermanager\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eNewContainerManager()\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n        \u003c/ul\u003e\n      \u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#04-小结\" id=\"markdown-toc-04-小结\"\u003e0.4 小结\u003c/a\u003e\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr/\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/what-happens-when-k8s-creates-pods/kube-scheduler.svg\" width=\"100%\" height=\"100%\"/\u003e\u003c/p\u003e\n\u003cp align=\"center\"\u003eFig. What happens when create a Pod, image credit \u003ca href=\"https://kubernetes.io/blog/2023/01/12/protect-mission-critical-pods-priorityclass/\"\u003eKubernetes Blog\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e本文试图回答以下问题：\u003cstrong\u003e敲下 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ekubectl run nginx --image=nginx --replicas=3\u003c/code\u003e 命令后\u003c/strong\u003e，\n\u003cstrong\u003e\u003cmark\u003eK8s 中发生了哪些事情？\u003c/mark\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e要弄清楚这个问题，我们需要：\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003e了解 k8s 几个核心组件的启动过程，它们分别做了哪些事情，以及\u003c/li\u003e\n  \u003cli\u003e从客户端发起请求到 pod ready 的整个过程。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1 id=\"0-k8s-组件启动过程\"\u003e0 K8s 组件启动过程\u003c/h1\u003e\n\n\u003cp\u003e首先看几个核心组件的启动过程分别做了哪些事情。\u003c/p\u003e\n\n\u003ch2 id=\"01-kube-apiserver-启动\"\u003e0.1 kube-apiserver 启动\u003c/h2\u003e\n\n\u003ch3 id=\"调用栈\"\u003e调用栈\u003c/h3\u003e\n\n\u003cp\u003e创建命令行（\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ekube-apiserver\u003c/code\u003e）入口：\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003emain                                         // cmd/kube-apiserver/apiserver.go\n |-cmd := app.NewAPIServerCommand()          // cmd/kube-apiserver/app/server.go\n |  |-RunE := func() {\n |      Complete()\n |        |-ApplyAuthorization(s.Authorization)\n |        |-if TLS:\n |            ServiceAccounts.KeyFiles = []string{CertKey.KeyFile}\n |      Validate()\n |      Run(completedOptions, handlers) // 核心逻辑\n |    }\n |-cmd.Execute()\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ekube-apiserver\u003c/code\u003e 启动后，会执行到其中的 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRun()\u003c/code\u003e 方法：\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003eRun()          // cmd/kube-apiserver/app/server.go\n |-server = CreateServerChain()\n |           |-CreateKubeAPIServerConfig()\n |           |   |-buildGenericConfig\n |           |   |   |-genericapiserver.NewConfig()     // staging/src/k8s.io/apiserver/pkg/server/config.go\n |           |   |   |  |-return \u0026amp;Config{\n |           |   |   |       Serializer:             codecs,\n |           |   |   |       BuildHandlerChainFunc:  DefaultBuildHandlerChain, // 注册 handler，例如 AuthN\n |           |   |   |    } \n |           |   |   |\n |           |   |   |-OpenAPIConfig = DefaultOpenAPIConfig()  // OpenAPI schema\n |           |   |   |-kubeapiserver.NewStorageFactoryConfig() // etcd 相关配置\n |           |   |   |-APIResourceConfig = genericConfig.MergedResourceConfig\n |           |   |   |-storageFactoryConfig.Complete(s.Etcd)\n |           |   |   |-storageFactory = completedStorageFactoryConfig.New()\n |           |   |   |-s.Etcd.ApplyWithStorageFactoryTo(storageFactory, genericConfig)\n |           |   |   |-BuildAuthorizer(s, genericConfig.EgressSelector, versionedInformers)\n |           |   |   |-pluginInitializers, admissionPostStartHook = admissionConfig.New()\n |           |   |\n |           |   |-capabilities.Initialize\n |           |   |-controlplane.ServiceIPRange()\n |           |   |-config := \u0026amp;controlplane.Config{}\n |           |   |-AddPostStartHook(\u0026#34;start-kube-apiserver-admission-initializer\u0026#34;, admissionPostStartHook)\n |           |   |-ServiceAccountIssuerURL = s.Authentication.ServiceAccounts.Issuer\n |           |   |-ServiceAccountJWKSURI = s.Authentication.ServiceAccounts.JWKSURI\n |           |   |-ServiceAccountPublicKeys = pubKeys\n |           |\n |           |-createAPIExtensionsServer\n |           |-CreateKubeAPIServer\n |           |-createAggregatorServer    // cmd/kube-apiserver/app/aggregator.go\n |           |   |-aggregatorConfig.Complete().NewWithDelegate(delegateAPIServer)   // staging/src/k8s.io/kube-aggregator/pkg/apiserver/apiserver.go\n |           |   |  |-apiGroupInfo := NewRESTStorage()\n |           |   |  |-GenericAPIServer.InstallAPIGroup(\u0026amp;apiGroupInfo)\n |           |   |  |-InstallAPIGroups\n |           |   |  |-openAPIModels := s.getOpenAPIModels(APIGroupPrefix, apiGroupInfos...)\n |           |   |  |-for apiGroupInfo := range apiGroupInfos {\n |           |   |  |   s.installAPIResources(APIGroupPrefix, apiGroupInfo, openAPIModels)\n |           |   |  |   s.DiscoveryGroupManager.AddGroup(apiGroup)\n |           |   |  |   s.Handler.GoRestfulContainer.Add(discovery.NewAPIGroupHandler(s.Serializer, apiGroup).WebService())\n |           |   |  |\n |           |   |  |-GenericAPIServer.Handler.NonGoRestfulMux.Handle(\u0026#34;/apis\u0026#34;, apisHandler)\n |           |   |  |-GenericAPIServer.Handler.NonGoRestfulMux.UnlistedHandle(\u0026#34;/apis/\u0026#34;, apisHandler)\n |           |   |  |-\n |           |   |-\n |-prepared = server.PrepareRun()     // staging/src/k8s.io/kube-aggregator/pkg/apiserver/apiserver.go\n |            |-GenericAPIServer.AddPostStartHookOrDie\n |            |-GenericAPIServer.PrepareRun\n |            |  |-routes.OpenAPI{}.Install()\n |            |     |-registerResourceHandlers // staging/src/k8s.io/apiserver/pkg/endpoints/installer.go\n |            |         |-POST: XX\n |            |         |-GET: XX\n |            |\n |            |-openapiaggregator.BuildAndRegisterAggregator()\n |            |-openapiaggregator.NewAggregationController()\n |            |-preparedAPIAggregator{}\n |-prepared.Run() // staging/src/k8s.io/kube-aggregator/pkg/apiserver/apiserver.go\n    |-s.runnable.Run()\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e一些重要步骤：\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003e注册命令行参数\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003e创建 server chain\u003c/strong\u003e。Server aggregation（聚合）是一种支持多 apiserver 的方式，其中\n包括了一个 \u003ca href=\"https://github.com/kubernetes/kubernetes/blob/v1.21.0/cmd/kube-apiserver/app/server.go#L219\"\u003egeneric apiserver\u003c/a\u003e，作为默认实现。\u003c/li\u003e\n  \u003cli\u003e\u003cstrong\u003e\u003cmark\u003e生成 OpenAPI schema\u003c/mark\u003e\u003c/strong\u003e，保存到 apiserver 的 \u003ca href=\"https://github.com/kubernetes/kubernetes/blob/v1.21.0/staging/src/k8s.io/apiserver/pkg/server/config.go#L167\"\u003eConfig.OpenAPIConfig 字段\u003c/a\u003e。\u003c/li\u003e\n  \u003cli\u003e遍历 schema 中的所有 API group，为每个 API group 配置一个\n\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/v1.21.0/staging/src/k8s.io/kube-aggregator/pkg/apiserver/apiserver.go#L204\"\u003estorage provider\u003c/a\u003e，\n这是一个通用 backend 存储抽象层。\u003c/li\u003e\n  \u003cli\u003e遍历每个 group 版本，为每个 HTTP route\n\u003ca href=\"https://github.com/kubernetes/kubernetes/blob/v1.21.0/staging/src/k8s.io/apiserver/pkg/endpoints/groupversion.go#L92\"\u003e配置 REST mappings\u003c/a\u003e。\n稍后处理请求时，就能将 requests 匹配到合适的 handler。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3 id=\"注册命令行参数\"\u003e注册命令行参数\u003c/h3\u003e\n\n\u003cp\u003e这里特别介绍下 AuthN 相关的配置，后面\n\u003ca href=\"/blog/what-happens-when-k8s-creates-pods-3-zh/\"\u003e源码解析：K8s 创建 pod 时，背后发生了什么（三）（2021）\u003c/a\u003e\n会用到：\u003c/p\u003e\n\n\u003cdiv class=\"language-go highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e// https://github.com/kubernetes/kubernetes/blob/v1.23.1/pkg/kubeapiserver/options/authentication.go#L48\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e// BuiltInAuthenticationOptions contains all build-in authentication options for API Server\u003c/span\u003e\n\u003cspan class=\"k\"\u003etype\u003c/span\u003e \u003cspan class=\"n\"\u003eBuiltInAuthenticationOptions\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eAnonymous\u003c/span\u003e       \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eAnonymousAuthenticationOptions\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eBootstrapToken\u003c/span\u003e  \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eBootstrapTokenAuthenticationOptions\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eClientCert\u003c/span\u003e      \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003egenericoptions\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClientCertAuthenticationOptions\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eOIDC\u003c/span\u003e            \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eOIDCAuthenticationOptions\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eRequestHeader\u003c/span\u003e   \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003egenericoptions\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRequestHeaderAuthenticationOptions\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eServiceAccounts\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eServiceAccountAuthenticationOptions\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eTokenFile\u003c/span\u003e       \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eTokenFileAuthenticationOptions\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eWebHook\u003c/span\u003e         \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eWebHookAuthenticationOptions\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e// WithAll set default value for every build-in authentication option\u003c/span\u003e\n\u003cspan class=\"k\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eBuiltInAuthenticationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eWithAll\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eBuiltInAuthenticationOptions\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWithAnonymous\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWithBootstrapToken\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWithClientCert\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWithOIDC\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWithRequestHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWithServiceAccounts\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWithTokenFile\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eWithWebHook\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e// 注册各种 AuthN 相关的命令行参数到 API Server\u003c/span\u003e\n\u003cspan class=\"k\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eBuiltInAuthenticationOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eAddFlags\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efs\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epflag\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFlagSet\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eBoolVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;anonymous-auth\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eBoolVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;enable-bootstrap-token-auth\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c\"\u003e// Client certificate flags\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eClientCert\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAddFlags\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e|-\u003c/span\u003e\u003cspan class=\"n\"\u003eStringVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;client-ca-file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c\"\u003e// OIDC flags\u003c/span\u003e\n\n    \u003cspan class=\"c\"\u003e// Request header flags\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eRequestHeader\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAddFlags\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e|-\u003c/span\u003e\u003cspan class=\"n\"\u003eStringSliceVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;requestheader-username-headers\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c\"\u003e// e.g. `X-Remote-User`\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e|-\u003c/span\u003e\u003cspan class=\"n\"\u003eStringSliceVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;requestheader-group-headers\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e    \u003cspan class=\"c\"\u003e// e.g. `X-Remote-Group`\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e|-\u003c/span\u003e\u003cspan class=\"n\"\u003eStringSliceVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;requestheader-extra-headers-prefix\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c\"\u003e// e.g. `X-Remote-Extra-`\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e|-\u003c/span\u003e\u003cspan class=\"n\"\u003eStringVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;requestheader-client-ca-file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e|-\u003c/span\u003e\u003cspan class=\"n\"\u003eStringSliceVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;requestheader-allowed-names\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c\"\u003e// ServiceAccount flags\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eStringVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;service-account-key-file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c\"\u003e// e.g. --service-account-key-file=/etc/kubernetes/pki/sa.pub\u003c/span\u003e\n\n    \u003cspan class=\"c\"\u003e// Token file\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eStringVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;token-auth-file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c\"\u003e// Webhook\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eK8s 支持多种认证方式，并且不同认证方式可以一起使用，这种情况下，任何一种方式认证成功就算成功。\n因此，这些配置最终形成一个 authenticator list，例如，\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e如果指定了 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e--service-account-key-file=/etc/kubernetes/pki/sa.pub\u003c/code\u003e，就会将这个公钥加到这个列表；\u003c/li\u003e\n  \u003cli\u003e如果指定了 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e--client-ca-file\u003c/code\u003e，就会将 x509 证书加到这个列表；\u003c/li\u003e\n  \u003cli\u003e如果指定了 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e--token-auth-file\u003c/code\u003e，就会将 token 加到这个列表；\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"注册各种-handler\"\u003e注册各种 handler\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eNewConfig()\u003c/code\u003e 里面会调用下面的方法注册认证、鉴权、审计等等各种 handler，\u003c/p\u003e\n\n\u003cdiv class=\"language-go highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e// https://github.com/kubernetes/kubernetes/blob/v1.23.0/staging/src/k8s.io/apiserver/pkg/server/config.go#L764\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efunc\u003c/span\u003e \u003cspan class=\"n\"\u003eDefaultBuildHandlerChain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eapiHandler\u003c/span\u003e \u003cspan class=\"n\"\u003ehttp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003ehttp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehandler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egenericapifilters\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWithAuthorization\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuthorization\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuthorizer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSerializer\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehandler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egenericapifilters\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWithAudit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuditBackend\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuditPolicyRuleEvaluator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLongRunningFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ehandler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egenericapifilters\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWithAuthentication\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuthentication\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuthenticator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efailedHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAuthentication\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAPIAudiences\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e例如 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eWithAuthentication()\u003c/code\u003e 注册成功之后，就会对客户端的每个请求执行认证。\n\u003ca href=\"/blog/what-happens-when-k8s-creates-pods-3-zh/\"\u003e源码解析：K8s 创建 pod 时，背后发生了什么（三）（2021）\u003c/a\u003e\n将有进一步介绍。\u003c/p\u003e\n\n\u003ch2 id=\"02-controller-manager-启动\"\u003e0.2 controller-manager 启动\u003c/h2\u003e\n\n\u003ch3 id=\"调用栈-1\"\u003e调用栈\u003c/h3\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003eNewDeploymentController\nNewReplicaSetController\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"03-kubelet-启动\"\u003e0.3 kubelet 启动\u003c/h2\u003e\n\n\u003ch3 id=\"调用栈-2\"\u003e调用栈\u003c/h3\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003emain                                                                            // cmd/kubelet/kubelet.go\n |-NewKubeletCommand                                                            // cmd/kubelet/app/server.go\n   |-Run                                                                        // cmd/kubelet/app/server.go\n      |-initForOS                                                               // cmd/kubelet/app/server.go\n      |-run                                                                     // cmd/kubelet/app/server.go\n        |-initConfigz                                                           // cmd/kubelet/app/server.go\n        |-InitCloudProvider\n        |-NewContainerManager\n        |-ApplyOOMScoreAdj\n        |-PreInitRuntimeService\n        |-RunKubelet                                                            // cmd/kubelet/app/server.go\n        | |-k = createAndInitKubelet                                            // cmd/kubelet/app/server.go\n        | |  |-NewMainKubelet\n        | |  |  |-watch k8s Service\n        | |  |  |-watch k8s Node\n        | |  |  |-klet := \u0026amp;Kubelet{}\n        | |  |  |-init klet fields\n        | |  |\n        | |  |-k.BirthCry()\n        | |  |-k.StartGarbageCollection()\n        | |\n        | |-startKubelet(k)                                                     // cmd/kubelet/app/server.go\n        |    |-go k.Run()                                                       // -\u0026gt; pkg/kubelet/kubelet.go\n        |    |  |-go cloudResourceSyncManager.Run()\n        |    |  |-initializeModules\n        |    |  |-go volumeManager.Run()\n        |    |  |-go nodeLeaseController.Run()\n        |    |  |-initNetworkUtil() // setup iptables\n        |    |  |-go Until(PerformPodKillingWork, 1*time.Second, neverStop)\n        |    |  |-statusManager.Start()\n        |    |  |-runtimeClassManager.Start\n        |    |  |-pleg.Start()\n        |    |  |-syncLoop(updates, kl)                                         // pkg/kubelet/kubelet.go\n        |    |\n        |    |-k.ListenAndServe\n        |\n        |-go http.ListenAndServe(healthz)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"newcontainermanager\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eNewContainerManager()\u003c/code\u003e\u003c/h3\u003e\n\n\u003cdiv class=\"language-go highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e// cmd/kubelet/app/server.go\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efunc\u003c/span\u003e \u003cspan class=\"n\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCgroupsPerQOS\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCgroupRoot\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCgroupRoot\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e \u003cspan class=\"c\"\u003e// if --cgroups-per-qos enabled but --cgroup-root not specified, default to /\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ekubeDeps\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContainerManager\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewContainerManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ekubeDeps\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMounter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ekubeDeps\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCAdvisorInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNodeConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eRuntimeCgroupsName\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e    \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRuntimeCgroups\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eSystemCgroupsName\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e     \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSystemCgroups\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eKubeletCgroupsName\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e    \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKubeletCgroups\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eKubeletOOMScoreAdj\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e    \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOOMScoreAdj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eCgroupsPerQOS\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e         \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCgroupsPerQOS\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eCgroupRoot\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e            \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCgroupRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eCgroupDriver\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e          \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCgroupDriver\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eKubeletRootDir\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e        \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRootDirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eProtectKernelDefaults\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eProtectKernelDefaults\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eNodeAllocatableConfig\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNodeAllocatableConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eKubeReservedCgroupName\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e   \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKubeReservedCgroup\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eSystemReservedCgroupName\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSystemReservedCgroup\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eEnforceNodeAllocatable\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e   \u003cspan class=\"n\"\u003esets\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEnforceNodeAllocatable\u003c/span\u003e\u003cspan class=\"o\"\u003e...\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eKubeReserved\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e             \u003cspan class=\"n\"\u003ekubeReserved\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eSystemReserved\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e           \u003cspan class=\"n\"\u003esystemReserved\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eReservedSystemCPUs\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e       \u003cspan class=\"n\"\u003ereservedSystemCPUs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eHardEvictionThresholds\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e   \u003cspan class=\"n\"\u003ehardEvictionThresholds\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eQOSReserved\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e                              \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eexperimentalQOSReserved\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eCPUManagerPolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e                         \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCPUManagerPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eCPUManagerPolicyOptions\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e                  \u003cspan class=\"n\"\u003ecpuManagerPolicyOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eCPUManagerReconcilePeriod\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e                \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCPUManagerReconcilePeriod\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDuration\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eExperimentalMemoryManagerPolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e          \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMemoryManagerPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eExperimentalMemoryManagerReservedMemory\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e  \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReservedMemory\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eExperimentalPodPidsLimit\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e                 \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePodPidsLimit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eEnforceCPULimits\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e                         \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCPUCFSQuota\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eCPUCFSQuotaPeriod\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e                        \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCPUCFSQuotaPeriod\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDuration\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eExperimentalTopologyManagerPolicy\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e        \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopologyManagerPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eExperimentalTopologyManagerScope\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e         \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopologyManagerScope\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eExperimentalTopologyManagerPolicyOptions\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etopologyManagerPolicyOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n            \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFailSwapOn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ekubeDeps\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRecorder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ekubeDeps\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eKubeClient\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-go highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e// pkg/kubelet/cm/container_manager_linux.go\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efunc\u003c/span\u003e \u003cspan class=\"n\"\u003eNewContainerManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emountUtil\u003c/span\u003e \u003cspan class=\"n\"\u003emount\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecadvisorInterface\u003c/span\u003e \u003cspan class=\"n\"\u003ecadvisor\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enodeConfig\u003c/span\u003e \u003cspan class=\"n\"\u003eNodeConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efailSwapOn\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erecorder\u003c/span\u003e \u003cspan class=\"n\"\u003erecord\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEventRecorder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekubeClient\u003c/span\u003e \u003cspan class=\"n\"\u003eclientset\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eContainerManager\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubsystems\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetCgroupSubsystems\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003efailSwapOn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c\"\u003e// Check whether swap is enabled. The Kubelet does not support running with swap enabled.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eswapFile\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;/proc/swaps\u0026#34;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eswapData\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eReadFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eswapFile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003emachineInfo\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"n\"\u003ecadvisorInterface\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMachineInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"n\"\u003ecadvisor\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCapacityFromMachineInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emachineInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"k\"\u003erange\u003c/span\u003e \u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einternalCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ecgroupRoot\u003c/span\u003e    \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"n\"\u003eParseCgroupfsToCgroupName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enodeConfig\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCgroupRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e      \u003cspan class=\"c\"\u003e// \u0026#34;\u0026#34;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecgroupManager\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"n\"\u003eNewCgroupManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esubsystems\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enodeConfig\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCgroupDriver\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c\"\u003e// \u0026#34;cgroupfs\u0026#34;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enodeConfig\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCgroupsPerQOS\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c\"\u003e// true by default\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecgroupManager\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eValidate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecgroupRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecgroupRoot\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNewCgroupName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecgroupRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edefaultNodeAllocatableCgroupName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c\"\u003e// -\u0026gt; \u0026#34;/kubepods\u0026#34;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eInfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Creating Container Manager object based on Node Config\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;nodeConfig\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enodeConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eqosContainerManager\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"n\"\u003eNewQOSContainerManager\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esubsystems\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecgroupRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enodeConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecgroupManager\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003econtainerManagerImpl\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecadvisorInterface\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e   \u003cspan class=\"n\"\u003ecadvisorInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emountUtil\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e           \u003cspan class=\"n\"\u003emountUtil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eNodeConfig\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e          \u003cspan class=\"n\"\u003enodeConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esubsystems\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e          \u003cspan class=\"n\"\u003esubsystems\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecgroupManager\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e       \u003cspan class=\"n\"\u003ecgroupManager\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e            \u003cspan class=\"n\"\u003ecapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einternalCapacity\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e    \u003cspan class=\"n\"\u003einternalCapacity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecgroupRoot\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e          \u003cspan class=\"n\"\u003ecgroupRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erecorder\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e            \u003cspan class=\"n\"\u003erecorder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eqosContainerManager\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eqosContainerManager\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopologyManager\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etopologymanager\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewManager\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceManager\u003c/span\u003e   \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edevicemanager\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewManagerImpl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emachineInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTopology\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopologyManager\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edraManager\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edra\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewManagerImpl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekubeClient\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c\"\u003e// initialize DRA manager\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecpuManager\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecpumanager\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewManager\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c\"\u003e// Initialize CPU manager\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ememoryManager\u003c/span\u003e   \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ememorymanager\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNewManager\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ecm\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"no\"\u003enil\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ekubelet 要求必须关闭 swap，\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecat /proc/swaps\u003c/code\u003e。\u003c/p\u003e\n\n\u003ch2 id=\"04-小结\"\u003e0.4 小结\u003c/h2\u003e\n\n\u003cp\u003e以上核心组件启动完成后，就可以从命令行发起请求创建 pod 了。\u003c/p\u003e\n\n\n  \u003c!-- POST NAVIGATION --\u003e\n  \u003cdiv class=\"postNav clearfix\"\u003e\n     \n      \u003ca class=\"prev\" href=\"/blog/lifetime-of-bpf-objects-zh/\"\u003e\u003cspan\u003e« [译] BPF 对象（BPF objects）的生命周期（Facebook，2018）\u003c/span\u003e\n      \n    \u003c/a\u003e\n      \n      \n      \u003ca class=\"next\" href=\"/blog/what-happens-when-k8s-creates-pods-2-zh/\"\u003e\u003cspan\u003e源码解析：K8s 创建 pod 时，背后发生了什么（二）（2021） »\u003c/span\u003e\n       \n      \u003c/a\u003e\n     \n  \u003c/div\u003e\n\u003c/div\u003e",
  "Date": "2021-06-01T00:00:00Z",
  "Author": "Arthur Chiao"
}