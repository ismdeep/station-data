{
  "Source": "arthurchiao.art",
  "Title": "直观解读 JuiceFS 的数据和元数据设计（一）：看山是山（2024）",
  "Link": "https://arthurchiao.art/blog/juicefs-data-metadata-design-illustrative-guide-1-zh/",
  "Content": "\u003cdiv class=\"post\"\u003e\n  \n  \u003ch1 class=\"postTitle\"\u003e直观解读 JuiceFS 的数据和元数据设计（一）：看山是山（2024）\u003c/h1\u003e\n  \u003cp class=\"meta\"\u003ePublished at 2024-10-27 | Last Update 2024-10-27\u003c/p\u003e\n  \n  \u003cp\u003e本系列分为三篇文章，试图通过简单的实地环境来\u003cstrong\u003e\u003cmark\u003e直观理解\u003c/mark\u003e\u003c/strong\u003e JuiceFS\n的\u003cstrong\u003e\u003cmark\u003e数据（data）和元数据（metadata）\u003c/mark\u003e\u003c/strong\u003e设计。\u003c/p\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/juicefs-data-metadata-design/minio-bucket-after-juicefs-format.png\" width=\"80%\"/\u003e\u003c/p\u003e\n\u003cp align=\"center\"\u003eFig. MinIO bucket browser: one object was created (\u003cmark\u003e\u003ccode\u003e{volume}/juicefs_uuid\u003c/code\u003e\u003c/mark\u003e) on a new juicefs volume creation.\u003c/p\u003e\n\n\u003cp\u003e水平及维护精力所限，文中不免存在错误或过时之处，请酌情参考。\n\u003cstrong\u003e\u003cmark\u003e传播知识，尊重劳动，年满十八周岁，转载请注明\u003ca href=\"https://arthurchiao.art\"\u003e出处\u003c/a\u003e\u003c/mark\u003e\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ca href=\"/blog/juicefs-data-metadata-design-illustrative-guide-1-zh/\"\u003e直观解读 JuiceFS 的数据和元数据设计（一）：看山是山（2024）\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"/blog/juicefs-data-metadata-design-illustrative-guide-2-zh/\"\u003e直观解读 JuiceFS 的数据和元数据设计（二）：看山不是山（2024）\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"/blog/juicefs-data-metadata-design-illustrative-guide-3-zh/\"\u003e直观解读 JuiceFS 的数据和元数据设计（三）：看山还是山（2024）\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr/\u003e\n\n\u003cul id=\"markdown-toc\"\u003e\n  \u003cli\u003e\u003ca href=\"#1-juicefs-高层架构与组件\" id=\"markdown-toc-1-juicefs-高层架构与组件\"\u003e1 JuiceFS 高层架构与组件\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#2-搭建极简-juicefs-集群\" id=\"markdown-toc-2-搭建极简-juicefs-集群\"\u003e2 搭建极简 JuiceFS 集群\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#21-搭建元数据集群\" id=\"markdown-toc-21-搭建元数据集群\"\u003e2.1 搭建元数据集群\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#22-搭建对象存储minio\" id=\"markdown-toc-22-搭建对象存储minio\"\u003e2.2 搭建对象存储（MinIO）\u003c/a\u003e        \u003cul\u003e\n          \u003cli\u003e\u003ca href=\"#221-启动-minio-server\" id=\"markdown-toc-221-启动-minio-server\"\u003e2.2.1 启动 MinIO server\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#222-创建-bucket\" id=\"markdown-toc-222-创建-bucket\"\u003e2.2.2 创建 bucket\u003c/a\u003e\u003c/li\u003e\n        \u003c/ul\u003e\n      \u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#23-下载-juicefs-客户端\" id=\"markdown-toc-23-下载-juicefs-客户端\"\u003e2.3 下载 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ejuicefs\u003c/code\u003e 客户端\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#24-创建-juicefs-volume\" id=\"markdown-toc-24-创建-juicefs-volume\"\u003e2.4 创建 JuiceFS volume\u003c/a\u003e        \u003cul\u003e\n          \u003cli\u003e\u003ca href=\"#241-创建格式化-volumejuicefs-format\" id=\"markdown-toc-241-创建格式化-volumejuicefs-format\"\u003e2.4.1 创建/格式化 volume：\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ejuicefs format\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n          \u003cli\u003e\u003ca href=\"#242-查看-minio-bucket多了一个-juicefs_uuid-文件\" id=\"markdown-toc-242-查看-minio-bucket多了一个-juicefs_uuid-文件\"\u003e2.4.2 查看 MinIO bucket：多了一个 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ejuicefs_uuid\u003c/code\u003e 文件\u003c/a\u003e\u003c/li\u003e\n        \u003c/ul\u003e\n      \u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#3-将-juicefs-volume-挂载到本地路径\" id=\"markdown-toc-3-将-juicefs-volume-挂载到本地路径\"\u003e3 将 JuiceFS volume 挂载到本地路径\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#4-在-juicefs-volume-挂载的本地路径内读写\" id=\"markdown-toc-4-在-juicefs-volume-挂载的本地路径内读写\"\u003e4 在 JuiceFS volume 挂载的本地路径内读写\u003c/a\u003e    \u003cul\u003e\n      \u003cli\u003e\u003ca href=\"#41-创建和写入文件\" id=\"markdown-toc-41-创建和写入文件\"\u003e4.1 创建和写入文件\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#42-查看文件属性\" id=\"markdown-toc-42-查看文件属性\"\u003e4.2 查看文件属性\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#43-读取和追加文件\" id=\"markdown-toc-43-读取和追加文件\"\u003e4.3 读取和追加文件\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#44-查找文件\" id=\"markdown-toc-44-查找文件\"\u003e4.4 查找文件\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#45-删除文件\" id=\"markdown-toc-45-删除文件\"\u003e4.5 删除文件\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#46-目录操作\" id=\"markdown-toc-46-目录操作\"\u003e4.6 目录操作\u003c/a\u003e\u003c/li\u003e\n      \u003cli\u003e\u003ca href=\"#47-小结\" id=\"markdown-toc-47-小结\"\u003e4.7 小结\u003c/a\u003e\u003c/li\u003e\n    \u003c/ul\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#5-总结\" id=\"markdown-toc-5-总结\"\u003e5 总结\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"#参考资料\" id=\"markdown-toc-参考资料\"\u003e参考资料\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr/\u003e\n\n\u003cp\u003e本篇首先快速了解下 JuiceFS 架构和组件，然后将搭建一个极简 JuiceFS 集群，\n并以 JuiceFS 用户的身份来体验下它的基本功能。\u003c/p\u003e\n\n\u003ch1 id=\"1-juicefs-高层架构与组件\"\u003e1 JuiceFS 高层架构与组件\u003c/h1\u003e\n\n\u003cp\u003eJuiceFS 的高层架构和组件，\u003c/p\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/juicefs-metadata-deep-dive/juicefs-tikv-cluster.png\" width=\"90%\"/\u003e\u003c/p\u003e\n\u003cp align=\"center\"\u003eFig. JuiceFS cluster initialization, and how POSIX file operations are handled by JuiceFS.\u003c/p\u003e\n\n\u003cp\u003e三大组件：\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003e元数据引擎：存储文件元数据，例如文件名、权限等。JuiceFS 支持多种元数据引擎，比如 TiKV、sqlite、redis 等。\u003c/li\u003e\n  \u003cli\u003e对象存储：存储文件本身。JuiceFS 支持多种对象存储，比如 MinIO、AWS S3、阿里云 OSS 等。\u003c/li\u003e\n  \u003cli\u003eJuiceFS 客户端：将 JuiceFS volume 挂载到机器上，提供文件系统视图给用户。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e更多架构信息，见 [1]。\u003c/p\u003e\n\n\u003ch1 id=\"2-搭建极简-juicefs-集群\"\u003e2 搭建极简 JuiceFS 集群\u003c/h1\u003e\n\n\u003cp\u003e接下来搭建一个极简 JuiceFS 环境，方便我们做一些功能测试。\n按上一节提到的，只需要搭建以下 3 个组件：\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003e元数据引擎，这里我们用 \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003eTiKV\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e；\u003c/li\u003e\n  \u003cli\u003e对象存储，这里我们用 \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003eMinIO\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e；\u003c/li\u003e\n  \u003cli\u003eJuiceFS 客户端。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"21-搭建元数据集群\"\u003e2.1 搭建元数据集群\u003c/h2\u003e\n\n\u003cp\u003e对于功能测试来说，使用哪种元数据引擎都无所谓，比如最简单的 sqlite 或 redis。\u003c/p\u003e\n\n\u003cp\u003e不过，本系列第二篇会介绍 TiKV 相关的一些设计，所以本文用的 TiKV 集群作为元数据引擎，\n相关的搭建步骤见社区文档。\u003c/p\u003e\n\n\u003cp\u003e本篇假设搭建的是三节点的 TiKV 集群，IP 地址分别是 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e192.168.1.{1,2,3}\u003c/code\u003e。\u003c/p\u003e\n\n\u003ch2 id=\"22-搭建对象存储minio\"\u003e2.2 搭建对象存储（MinIO）\u003c/h2\u003e\n\n\u003cp\u003e这里我们用 MinIO 搭建一个对象存储服务，主要是空集群\u003cstrong\u003e\u003cmark\u003e方便观察其中的文件变化\u003c/mark\u003e\u003c/strong\u003e。\u003c/p\u003e\n\n\u003ch3 id=\"221-启动-minio-server\"\u003e2.2.1 启动 MinIO server\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/minio/minio\"\u003eMinIO\u003c/a\u003e 是一个兼容 S3 接口的开源对象存储产品，部署非常简单，就一个可执行文件，下载执行就行了。\u003c/p\u003e\n\n\u003cp\u003e也可以用容器，一条命令启动：\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003esudo \u003c/span\u003edocker run \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e 9000:9000 \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e 8080:8080 \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n    quay.io/minio/minio server /data \u003cspan class=\"nt\"\u003e--console-address\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;0.0.0.0:8080\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e访问 http://localhost:8080/ 就能看到 MinIO 的管理界面了。默认账号密码都是 \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003eminioadmin\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e。\u003c/p\u003e\n\n\u003ch3 id=\"222-创建-bucket\"\u003e2.2.2 创建 bucket\u003c/h3\u003e\n\n\u003cp\u003e通过 MinIO 管理界面创建一个 bucket，这里我们命名为 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ejuicefs-bucket\u003c/code\u003e，\u003c/p\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/juicefs-data-metadata-design/minio-empty-bucket.png\" width=\"100%\"/\u003e\u003c/p\u003e\n\u003cp align=\"center\"\u003eFig. MinIO bucket list: an empty bucket.\u003c/p\u003e\n\n\u003cp\u003e可以看到现在里面一个对象也没有，已使用空间也是 \u003cstrong\u003e\u003cmark\u003e0 字节\u003c/mark\u003e\u003c/strong\u003e。\u003c/p\u003e\n\n\u003ch2 id=\"23-下载-juicefs-客户端\"\u003e2.3 下载 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ejuicefs\u003c/code\u003e 客户端\u003c/h2\u003e\n\n\u003cp\u003e从 https://github.com/juicedata/juicefs/releases 下载一个可执行文件就行了，\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ewget https://github.com/juicedata/juicefs/releases/download/v1.2.1/juicefs-1.2.1-linux-amd64.tar.gz\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003etar\u003c/span\u003e \u003cspan class=\"nt\"\u003e-xvf\u003c/span\u003e juicefs-1.2.1-linux-amd64.tar.gz\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003echmod\u003c/span\u003e +x juicefs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"24-创建-juicefs-volume\"\u003e2.4 创建 JuiceFS volume\u003c/h2\u003e\n\n\u003cp\u003e接下来就可以创建一个 JuiceFS volume 了，这里命名为 \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003efoo-dev\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e。\u003c/p\u003e\n\n\u003ch3 id=\"241-创建格式化-volumejuicefs-format\"\u003e2.4.1 创建/格式化 volume：\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ejuicefs format\u003c/code\u003e\u003c/h3\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ejuicefs format \u003cspan class=\"nt\"\u003e--storage\u003c/span\u003e minio \u003cspan class=\"nt\"\u003e--bucket\u003c/span\u003e http://localhost:9000/juicefs-bucket \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e--access-key\u003c/span\u003e minioadmin \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e--secret-key\u003c/span\u003e minioadmin \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n        tikv://192.168.1.1:2379,192.168.1.2:2379,192.168.1.3:2379/foo-dev  \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n        foo-dev\n\n\u0026lt;INFO\u0026gt;: Meta address: tikv://192.168.1.1:2379,192.168.1.2:2379,192.168.1.3:2379/foo-dev \u003cspan class=\"o\"\u003e[\u003c/span\u003einterface.go:504]\n\u0026lt;INFO\u0026gt;: Data use minio://localhost:9000/juicefs-bucket/foo-dev/ \u003cspan class=\"o\"\u003e[\u003c/span\u003eformat.go:528]\n\u0026lt;INFO\u0026gt;: Volume is formatted as \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;Name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;foo-dev\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;UUID\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;3b4e509b-a7c8-456f-b726-cb8395cf8eb6\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;Storage\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;minio\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;Bucket\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;http://localhost:9000/juicefs-bucket\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;AccessKey\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;minioadmin\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;SecretKey\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;removed\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;BlockSize\u0026#34;\u003c/span\u003e: 4096,\n  \u003cspan class=\"s2\"\u003e\u0026#34;UploadLimit\u0026#34;\u003c/span\u003e: 0,\n  \u003cspan class=\"s2\"\u003e\u0026#34;DownloadLimit\u0026#34;\u003c/span\u003e: 0,\n  ...\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"242-查看-minio-bucket多了一个-juicefs_uuid-文件\"\u003e2.4.2 查看 MinIO bucket：多了一个 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ejuicefs_uuid\u003c/code\u003e 文件\u003c/h3\u003e\n\n\u003cp\u003e再查看 MinIO bucket，会发现多了一个 object，\u003c/p\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/juicefs-data-metadata-design/minio-bucket-after-juicefs-format.png\" width=\"80%\"/\u003e\u003c/p\u003e\n\u003cp align=\"center\"\u003eFig. MinIO bucket browser: one object was created on a new juicefs volume creation.\u003c/p\u003e\n\n\u003cp\u003e点进去，发现是一个叫 \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003ejuicefs_uuid\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e 的文件，\u003c/p\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/juicefs-data-metadata-design/minio-bucket-after-juicefs-format-1.png\" width=\"100%\"/\u003e\u003c/p\u003e\n\u003cp align=\"center\"\u003eFig. MinIO bucket browser: one object was created after juicefs format.\u003c/p\u003e\n\n\u003cp\u003e可以把这个文件下载下来，其内容就是上面 \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003ejuicefs format\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e\n命令输出的 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euuid\u003c/code\u003e 信息，也就是说 juicefs client 会把 volume 的 uuid 上传到对象存储中。\u003c/p\u003e\n\n\u003ch1 id=\"3-将-juicefs-volume-挂载到本地路径\"\u003e3 将 JuiceFS volume 挂载到本地路径\u003c/h1\u003e\n\n\u003cp\u003e这么我们将这个 volume 挂载到本地路径 \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e/tmp/foo-dev\u003c/code\u003e，\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e./juicefs mount \u003cspan class=\"nt\"\u003e--debug\u003c/span\u003e \u003cspan class=\"nt\"\u003e--backup-meta\u003c/span\u003e 0 \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n     tikv://192.168.1.1:2379,192.168.1.2:2379,192.168.1.3:2379/foo-dev /tmp/foo-dev\n\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eINFO] \u003cspan class=\"o\"\u003e[\u003c/span\u003eclient.go:405] \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;[pd] create pd client with endpoints\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003ecomponent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003etikv] \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003epid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e2881678] \u003cspan class=\"o\"\u003e[\u003c/span\u003epd-address\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;[192.168.1.1:2379,192.168.1.2:2379,192.168.1.3:2379]\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eINFO] \u003cspan class=\"o\"\u003e[\u003c/span\u003ebase_client.go:378] \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;[pd] switch leader\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003ecomponent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003etikv] \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003epid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e2881678] \u003cspan class=\"o\"\u003e[\u003c/span\u003enew-leader\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://192.168.1.3:2379] \u003cspan class=\"o\"\u003e[\u003c/span\u003eold-leader\u003cspan class=\"o\"\u003e=]\u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eINFO] \u003cspan class=\"o\"\u003e[\u003c/span\u003ebase_client.go:105] \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;[pd] init cluster id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003ecomponent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003etikv] \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003epid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e2881678] \u003cspan class=\"o\"\u003e[\u003c/span\u003ecluster-id\u003cspan class=\"o\"\u003e=\u003c/span\u003e7418858894192002550]\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eINFO] \u003cspan class=\"o\"\u003e[\u003c/span\u003eclient.go:698] \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;[pd] tso dispatcher created\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003ecomponent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003etikv] \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003epid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e2881678] \u003cspan class=\"o\"\u003e[\u003c/span\u003edc-location\u003cspan class=\"o\"\u003e=\u003c/span\u003eglobal]\n\u0026lt;INFO\u0026gt;: Data use minio://localhost:9000/juicefs-bucket/foo-dev/ \u003cspan class=\"o\"\u003e[\u003c/span\u003emount.go:650]\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e进入目录：\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /tmp/foo-dev\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003els\u003c/span\u003e \u003cspan class=\"nt\"\u003e-ahl\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e-r--------\u003c/span\u003e  1 root root    0 Oct 26 10:45 .accesslog\n\u003cspan class=\"nt\"\u003e-r--------\u003c/span\u003e  1 root root 2.9K Oct 26 10:45 .config\n\u003cspan class=\"nt\"\u003e-r--r--r--\u003c/span\u003e  1 root root    0 Oct 26 10:45 .stats\ndr-xr-xr-x  2 root root    0 Oct 26 10:45 .trash\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e可以看到几个隐藏文件，\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e这些是 JuiceFS 的元数据文件，在 [1] 系列文章中有过详细介绍。\u003c/li\u003e\n  \u003cli\u003e这些都是 volume 本地文件，\u003cstrong\u003e\u003cmark\u003e不会上传到 MinIO\u003c/mark\u003e\u003c/strong\u003e。此时，MinIO \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ejuicefs-bucket\u003c/code\u003e 里面还是只有一个 uuid 文件。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1 id=\"4-在-juicefs-volume-挂载的本地路径内读写\"\u003e4 在 JuiceFS volume 挂载的本地路径内读写\u003c/h1\u003e\n\n\u003cp\u003e接下来进行一些 POSIX 操作测试。\u003c/p\u003e\n\n\u003ch2 id=\"41-创建和写入文件\"\u003e4.1 创建和写入文件\u003c/h2\u003e\n\n\u003cp\u003e创建三个文件，一个只有\u003cstrong\u003e\u003cmark\u003e几十字节\u003c/mark\u003e\u003c/strong\u003e（但命名为 file1_1KB），\n一个 \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003e5MB\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e，一个 \u003cstrong\u003e\u003cmark\u003e\u003ccode\u003e129MB\u003c/code\u003e\u003c/mark\u003e\u003c/strong\u003e，\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /tmp/foo-dev\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Hello, JuiceFS!\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e file1_1KB\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003edd \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/zero \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003efile2_5MB \u003cspan class=\"nv\"\u003ebs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1M \u003cspan class=\"nv\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e5\n5+0 records \u003cspan class=\"k\"\u003ein\n\u003c/span\u003e5+0 records out\n5242880 bytes \u003cspan class=\"o\"\u003e(\u003c/span\u003e5.2 MB, 5.0 MiB\u003cspan class=\"o\"\u003e)\u003c/span\u003e copied, 0.0461253 s, 114 MB/s\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003edd \u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/zero \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003efile3_129MB \u003cspan class=\"nv\"\u003ebs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1M \u003cspan class=\"nv\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e129\n129+0 records \u003cspan class=\"k\"\u003ein\n\u003c/span\u003e129+0 records out\n135266304 bytes \u003cspan class=\"o\"\u003e(\u003c/span\u003e135 MB, 129 MiB\u003cspan class=\"o\"\u003e)\u003c/span\u003e copied, 0.648757 s, 209 MB/s\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"42-查看文件属性\"\u003e4.2 查看文件属性\u003c/h2\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003els\u003c/span\u003e \u003cspan class=\"nt\"\u003e-ahl\u003c/span\u003e file\u003cspan class=\"k\"\u003e*\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e-rw-r-----\u003c/span\u003e 1 root root   16  file1_1KB\n\u003cspan class=\"nt\"\u003e-rw-r-----\u003c/span\u003e 1 root root 5.0M  file2_5MB\n\u003cspan class=\"nt\"\u003e-rw-r-----\u003c/span\u003e 1 root root 129M  file3_129MB\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003efile file2_5MB\nfile2_5MB: data\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"43-读取和追加文件\"\u003e4.3 读取和追加文件\u003c/h2\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecat \u003c/span\u003efile1_1KB\nHello, JuiceFS!\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Hello, JuiceFS!\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e file1_1KB\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecat \u003c/span\u003efile1_1KB\nHello, JuiceFS!\nHello, JuiceFS!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"44-查找文件\"\u003e4.4 查找文件\u003c/h2\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003efind /tmp \u003cspan class=\"nt\"\u003e-name\u003c/span\u003e file1_1KB\n/tmp/foo-dev/file1_1KB\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"45-删除文件\"\u003e4.5 删除文件\u003c/h2\u003e\n\n\u003cp\u003e直接用 rm 删除就行了，不过这几个文件我们还有用，先不删。\u003c/p\u003e\n\n\u003ch2 id=\"46-目录操作\"\u003e4.6 目录操作\u003c/h2\u003e\n\n\u003cp\u003e目录的创建、移动、修改权限、删除等待也是一样的，大家可以自己试试，这里不再赘述。\u003c/p\u003e\n\n\u003ch2 id=\"47-小结\"\u003e4.7 小结\u003c/h2\u003e\n\n\u003cp\u003e根据以上测试，在 JuiceFS 挂载路径里创建/读写/查找/删除文件，都\u003cstrong\u003e\u003cmark\u003e跟本地目录没什么区别\u003c/mark\u003e\u003c/strong\u003e ——\n这也正是「分布式\u003cstrong\u003e\u003cmark\u003e“文件系统”\u003c/mark\u003e\u003c/strong\u003e」的意义所在 —— 兼容 POSIX 语义，用户无需关心数据存在哪，\n当本地目录使用就行了（性能另当别论）。\u003c/p\u003e\n\n\u003ch1 id=\"5-总结\"\u003e5 总结\u003c/h1\u003e\n\n\u003cp\u003e本篇中，我们作为 JuiceFS 用户对它进行了一些最基本的功能测试，结论是和本地文件系统没什么区别。\u003c/p\u003e\n\n\u003cp\u003e对于普通\u003cstrong\u003e\u003cmark\u003e用户\u003c/mark\u003e\u003c/strong\u003e来说，了解到这一层就够了；\n但对于高阶用户以及 JuiceFS 的开发/运维来说，这只是表象，必有第二重境界等着他们。\u003c/p\u003e\n\n\u003ch1 id=\"参考资料\"\u003e参考资料\u003c/h1\u003e\n\n\u003col\u003e\n  \u003cli\u003e\u003ca href=\"/blog/juicefs-metadata-deep-dive-1-zh/\"\u003eJuiceFS 元数据引擎初探：高层架构、引擎选型、读写工作流（2024）\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003chr/\u003e\n\n\u003cp\u003e\u003ca href=\"https://notbyai.fyi\"\u003e\u003cimg src=\"/assets/img/Written-By-Human-Not-By-AI-Badge-white.svg\" alt=\"Written by Human, Not by AI\"/\u003e\u003c/a\u003e\n\u003ca href=\"https://notbyai.fyi\"\u003e\u003cimg src=\"/assets/img/Written-By-Human-Not-By-AI-Badge-black.svg\" alt=\"Written by Human, Not by AI\"/\u003e\u003c/a\u003e\u003c/p\u003e\n\n\n  \u003c!-- POST NAVIGATION --\u003e\n  \u003cdiv class=\"postNav clearfix\"\u003e\n     \n      \u003ca class=\"prev\" href=\"/blog/juicefs-metadata-deep-dive-5-zh/\"\u003e\u003cspan\u003e« JuiceFS 元数据引擎五探：元数据备份与恢复（2024）\u003c/span\u003e\n      \n    \u003c/a\u003e\n      \n      \n      \u003ca class=\"next\" href=\"/blog/juicefs-data-metadata-design-illustrative-guide-2-zh/\"\u003e\u003cspan\u003e直观解读 JuiceFS 的数据和元数据设计（二）：看山不是山（2024） »\u003c/span\u003e\n       \n      \u003c/a\u003e\n     \n  \u003c/div\u003e\n\u003c/div\u003e",
  "Date": "2024-10-27T00:00:00Z",
  "Author": "Arthur Chiao"
}