{
  "Source": "arthurchiao.art",
  "Title": "[译] 云原生时代，是否还需要 VPC 做应用安全？（2020）",
  "Link": "https://arthurchiao.art/blog/do-i-really-need-a-vpc-zh/",
  "Content": "\u003cdiv class=\"post\"\u003e\n  \n  \u003ch1 class=\"postTitle\"\u003e[译] 云原生时代，是否还需要 VPC 做应用安全？（2020）\u003c/h1\u003e\n  \u003cp class=\"meta\"\u003ePublished at 2020-02-28 | Last Update 2020-02-28\u003c/p\u003e\n  \n  \u003ch3 id=\"译者序\"\u003e译者序\u003c/h3\u003e\n\n\u003cp\u003e本文翻译自 2020 年的一篇英文文章 \u003ca href=\"https://info.acloud.guru/resources/do-i-really-need-a-vpc\"\u003eDO I REALLY NEED A\nVPC?\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e由于译者水平有限，本文不免存在遗漏或错误之处。如有疑问，请查阅原文。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e以下是译文。\u003c/p\u003e\n\n\u003chr/\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/do-i-really-need-a-vpc-zh/blog-header.webp\" width=\"75%\" height=\"75%\"/\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003e\u003cstrong\u003e从安全的角度来说，VPC 非但不是一种超能力，反而是另一层责任\u003c/strong\u003e（another layer\nof responsibility）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e准备在 AWS 上部署应用？那你需要一个 \u003ca href=\"https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html\"\u003eVPC\u003c/a\u003e：\n这种虚拟私有网络（virtual private network）能够保护你的应用免受来自公网的攻击，\n就像它们部署在老式数据中心一样。\u003cstrong\u003e这是“虚拟机为王”\u003c/strong\u003e —— 即所谓\n的 Cloud  1.0 （IaaS 浪潮） —— 时代\u003cstrong\u003e的指导哲学\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e但如今，当我在云上构建新应用或与同行交流类似主题时，我们通常都不会提到 “VPC”。这\n是因为，人们越来越倾向于\u003cstrong\u003e将云原生应用（cloud-native applications）直接部署在更\n高层的托管服务之上\u003c/strong\u003e —— 例如 Lambda、API Gateway 和 DynamoDB —— 这些服务通过 API\n与彼此进行通信。在 AWS上，这种情况下的最佳实践是 \u003cstrong\u003e使用\n\u003ca href=\"https://aws.amazon.com/iam/\"\u003eIAM\u003c/a\u003e 做认证和鉴权\u003c/strong\u003e，以保障微服务间的通信安全。\u003c/p\u003e\n\n\u003cp\u003e如果需要\u003cstrong\u003e将公有云和私有数据中心打通\u003c/strong\u003e，那 VPC 是不可或缺的。但\u003cstrong\u003e现代云原生应用\n的安全，真的还需要 VPC 扮演关键角色吗？\u003c/strong\u003e在给出我自己的答案之前，我先陈述几位业\n内专家的观点。\u003c/p\u003e\n\n\u003cp\u003e\u003ca name=\"ch_1\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1 id=\"1-需求分析vpc-是可选还是必需\"\u003e1. 需求分析：VPC 是可选还是必需？\u003c/h1\u003e\n\n\u003cp\u003e也许此刻你正在与安全团队一起，评估你们为\u003cstrong\u003e本地部署的应用\u003c/strong\u003e（on-prem applications\n）设计的云原生方案【译者注 1】。你们的评估方式是：对照一个清单（checklist），逐\n一检查方案是否满足其中列出的要求，满足的就打对勾（checking the box）。我们来听听\nPurpleBox Security 公司的 Nihat Guven 对此怎么说：“\u003cstrong\u003e安全\u003c/strong\u003e（security）与\u003cstrong\u003e合规\u003c/strong\u003e\n（compliance）在其中同样重要，二者互相追赶（playing catch-up）”。但是，\u003cstrong\u003e相比\n于真正去思考 VPC 能否提供安全优势、能提供哪些安全优势\u003c/strong\u003e，“大家更多地将精力放在了\n合规方面，即 —— \u003cstrong\u003e遵循既有标准，只要清单上列出了（例如，VPC），我们就做\u003c/strong\u003e”。\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003e【译者注 1】\u003c/p\u003e\n\n  \u003cp\u003eOn-premises 表示部署在私有数据中心。这个词来源于单词 “premises”，注意这是一个\n独立的单词，并不是 “premise”（“前提、假设”）的复数形式（虽然 “premise” 的复数也\n是“premises”）。单词 “premises” 表示“（企业、机构的）营业场所”，由此引申出两个\n早期术语：\u003c/p\u003e\n\n  \u003cul\u003e\n    \u003cli\u003eon-premises：本地机房\u003c/li\u003e\n    \u003cli\u003eoff-premises：非本地机房\u003c/li\u003e\n  \u003c/ul\u003e\n\n  \u003cp\u003e到了云计算时代，公有云显然就是 off-premises 模式（不过没人这么叫）；与此相\n对应，on-premises 指没有部署在公有云上的，一般就是公司自己的数据中心，不管是自建的\n还是租赁的，也不管是自维护的还是托管的。On-premises 或 on-premises deployment\n现在一般翻译为“本地部署”，虽然“本地”一词通常让人首先想到的是 “local”。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e另一位 AWS hero Teri Radichel（即将出版的 \u003cstrong\u003e\u003cem\u003eCloud Security for Executives\u003c/em\u003e\u003c/strong\u003e 一\n书的作者）赞同这样一种观点： \u003cstrong\u003eVPC 并没有什么神奇之处\u003c/strong\u003e。“VPC 实际上并没有做任何\n事情”，她指出。“\u003cstrong\u003e你真正需要的是一个包含 NACL、子网和安全组的合理网络架构\u003c/strong\u003e。你\n需要知道如何构建这样的架构，然后才能针对攻击做好监控。此外，你还要理解网络的各个\n分层、攻击的种类，以及攻击者是如何渗透网络的。”\u003c/p\u003e\n\n\u003cp\u003e这引出了问题的关键所在：基于 IAM 的安全方案，其暴露面已经是理论上最小的；而为应\n用添加 VPC 这件事情，最终都会变成在这个最小暴露面之外，再加额外的防护层（\nadding layers of security to the theoretical minimum imposed by IAM）。\u003cstrong\u003e所以你\n引入 VPC 并不是为了解决某个问题\u003c/strong\u003e，而是为了 —— 例如，增加额外的保护层防止数据渗透（\ndata exfiltration），或者能够对流量模式进行更细粒度的分析。\u003c/p\u003e\n\n\u003cp\u003e以上例子都说明，很多时候 VPC 只是可选项，而非必需。遗憾的是，很多工程师并没有理\n解到这一层。\u003c/p\u003e\n\n\u003cp\u003e\u003ca name=\"ch_2\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1 id=\"2-利弊权衡额外的责任而非超能力\"\u003e2. 利弊权衡：额外的责任而非超能力\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003e从安全的角度来说，VPC 非但不是一种超能力（superpower），反而是额外的责任\n（additional responsibility）\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003e“如果没有业务需求 —— 例如与私有数据中心互联 —— 那最好不要引入 VPC”，否则，“由\n于 VPC 而引入的额外复杂性对安全配置来说非但无益，反而有害”。 – Don Magee，前 AWS 安全专家\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e确实，\u003cstrong\u003e对于安全配置来说，越多并非永远意味着越好\u003c/strong\u003e（more is not always better）\n。如果你连配置 IAM 角色都还没搞熟，那又如何相信你能做好 VPC 安全？如果你连S3\nbucket 的 public 属性都不清楚，那又如何确定你能管好安全组、ACL 以及 VPC 引入的\nsubnets？\u003c/p\u003e\n\n\u003cp\u003eVPC 确实会带来一些额外的网络监控工具，例如 flow logs，但问题又来了：你知道如何高\n效地使用这些工具吗？如果不知道，那就是在花大价钱抓数据，但又没有如何分析这些数据\n的清晰计划。\u003c/p\u003e\n\n\u003cp\u003e另外，\u003cstrong\u003e并不是说引入了 VPC，它就自动为你的数据提供一层额外的防护\u003c/strong\u003e。正如 Magee\n提醒我们的：“即使在 VPC 内，数据的保护也仅仅 HTTPS 加密 —— 就像你自己用 HTTPS 加\n密一样。你觉得这种安全值得信赖吗？”。\u003c/p\u003e\n\n\u003cp\u003e\u003ca name=\"ch_3\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1 id=\"3-云原生安全模型抽象与安全下沉\"\u003e3. 云原生安全：模型抽象与安全下沉\u003c/h1\u003e\n\n\u003cp\u003e云安全太难了！但我显然不是在鼓励大家因此而放弃。相反，正是因为云安全如此困难且重\n要（both hard and important），我才建议你\u003cstrong\u003e不要轻易引入自己的网络控制方案\u003c/strong\u003e，而\n应该\u003cstrong\u003e尽可能用好平台提供的安全能力\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e这听起来像是 “serverless” 的套路 —— 事实上，我们确实离此不远了。毕竟，如 AWS Lambda\n项目的创始人 Tim Wagner \u003ca href=\"https://medium.com/@timawagner/not-using-serverless-yet-why-you-need-to-care-about-re-invent-2019s-serverless-launches-c26fa0263d77\"\u003e所乐于指出\u003c/a\u003e的，\u003cstrong\u003e所有 Lambda functions 默认都在 VPC 内运\n行\u003c/strong\u003e —— 这种 VPC 是 AWS 托管的，因此比大部分人自维护的 VPC 要更安全（我们得\n承认这个事实）。\u003c/p\u003e\n\n\u003cp\u003e这是目前大的技术趋势。AWS 仍然会维护主机层安全（host-level security），同时也会\n提供更上层的服务，例如 AppSync 和 DynamoDB。但我并不是说网络安全在这些领域已经式\n微了，而是说\u003cstrong\u003e越来越多的职责下沉到了云提供商那里\u003c/strong\u003e。你确实会\u003cstrong\u003e失去一些控制能力\u003c/strong\u003e\n，但\u003cstrong\u003e换来的是 AWS 最佳实践的保驾护航之下，更快的应用构建速度\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003e你可能会说，保护云原生应用的安全其实最后就是：“要么裸奔，要么上云”（letting go\nand letting cloud）。确实，但这种职责模型转变（paradigm shift）是\u003ca href=\"https://containerjournal.com/topics/container-ecosystems/comparing-serverless-and-containers-which-is-best/\"\u003e传统的安全团队才需\n要关心的\u003c/a\u003e\n；对于用户来说，只需要用好这种优势，自然就会取得巨大收益。\u003c/p\u003e\n\n\u003cp align=\"center\"\u003e\u003cimg src=\"/assets/img/do-i-really-need-a-vpc-zh/vpc.png\" width=\"60%\" height=\"60%\"/\u003e\u003c/p\u003e\n\n\u003cp\u003e因此，尝试去建立你的威胁模型，理解你面临的风险，对你的团队进行恰当的培训。做完这\n些你可能会发现，你最终还是需要 VPC，但那说明你是真的需要它，而不是为了合规或其\n他需求而无脑地引入。\u003c/p\u003e\n\n\u003cp\u003e如果有一天，你的云原生蜘蛛侠（cloud-native Spidey）意识开始变得模糊，有一点还请\n牢记：\u003cstrong\u003e有时候，责任越小，能力越大\u003c/strong\u003e（sometimes, great power comes from less\nresponsibility）。\u003c/p\u003e\n\n\n  \u003c!-- POST NAVIGATION --\u003e\n  \u003cdiv class=\"postNav clearfix\"\u003e\n     \n      \u003ca class=\"prev\" href=\"/blog/sre-notes-zh/\"\u003e\u003cspan\u003e« [笔记]《Site Reliability Engineering》（OReilly, 2016）\u003c/span\u003e\n      \n    \u003c/a\u003e\n      \n      \n      \u003ca class=\"next\" href=\"/blog/how-verizon-and-a-bgp-optimizer-knocked-the-internet-zh/\"\u003e\u003cspan\u003e[译] Verizon 和一个 BGP Optimizer 如何导致了全球大面积断网（2019） »\u003c/span\u003e\n       \n      \u003c/a\u003e\n     \n  \u003c/div\u003e\n\u003c/div\u003e",
  "Date": "2020-02-28T00:00:00Z",
  "Author": "Arthur Chiao"
}