{
  "Source": "arthurchiao.art",
  "Title": "GoBGP Cheat Sheet",
  "Link": "https://arthurchiao.art/blog/gobgp-cheat-sheet/",
  "Content": "\u003cdiv class=\"post\"\u003e\n  \n  \u003ch1 class=\"postTitle\"\u003eGoBGP Cheat Sheet\u003c/h1\u003e\n  \u003cp class=\"meta\"\u003ePublished at 2019-04-18 | Last Update \u003c/p\u003e\n  \n  \u003ch3 id=\"tldr\"\u003eTL;DR\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/osrg/gobgp\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eGoBGP\u003c/code\u003e\u003c/a\u003e is an open source BGP implementation,\nimplemented in Golang [1].\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/cloudnativelabs/kube-router\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ekube-router\u003c/code\u003e\u003c/a\u003e is a \nKubernetes networking solution with aim to provide operational simplicity\nand high performance. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ekube-router\u003c/code\u003e internally uses \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eGoBGP\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThis post serves as a cheat sheet of GoBGP CLIs. Note that command set varies\namong different gobgp releases, you should run \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp -h\u003c/code\u003e to get the full\nlist of your installed version.\u003c/p\u003e\n\n\u003cp\u003eCLI list of version \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e?\u003c/code\u003e:\u003c/p\u003e\n\n\u003ctable\u003e\n  \u003cthead\u003e\n    \u003ctr\u003e\n      \u003cth style=\"text-align: left\"\u003eCommand\u003c/th\u003e\n      \u003cth style=\"text-align: left\"\u003eUsed For\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp bmp       [ add | del ]\u003c/code\u003e\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003e \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp global    [ del | policy | rib ]\u003c/code\u003e\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003eManage global settings\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp monitor   [ adj-in | global | neighbor]\u003c/code\u003e\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003e \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp mtr       [ inject ]\u003c/code\u003e\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003e \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp neighbor  [ add | del | update ]\u003c/code\u003e\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003eManage neighbors\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp policy    [ add | as-path | community | del | ext-community | large-community | neighbor | prefix | set | statement ]\u003c/code\u003e\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003e \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp rpki      [ server | table | validate ]\u003c/code\u003e\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003e \u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd style=\"text-align: left\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp vrf       [ add | del ]\u003c/code\u003e\u003c/td\u003e\n      \u003ctd style=\"text-align: left\"\u003eManage VRFs\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eFor each subcommand, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp [subcommand] -h\u003c/code\u003e will print the detailed usage,\ne.g. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp global -h\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egobgp bmp add -h\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eLooking at the commands’ outputs is a good way for learning gobgp. So in the\nfollowing, we will give some illustrative examples and the respective\noutputs.\u003c/p\u003e\n\n\u003ch2 id=\"1-bmp\"\u003e1 BMP\u003c/h2\u003e\n\n\u003ch2 id=\"2-global\"\u003e2 Global\u003c/h2\u003e\n\n\u003cp\u003eCheck configurations of this BGP agent:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egobgp global\nAS:        65342\nRouter-ID: 192.168.1.101\nListening Port: 179, Addresses: 192.168.1.101, ::1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eCheck global policies:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egobgp global policy\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eCheck global RIBs (Routing Information Base):\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egobgp global rib\n   Network              Next Hop             AS_PATH              Age        Attrs\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e 192.168.100.0/24     192.168.1.101                             00:00:06   \u003cspan class=\"o\"\u003e[{\u003c/span\u003eOrigin: i\u003cspan class=\"o\"\u003e}]\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e# gobgp global rib summary\u003c/span\u003e\nTable ipv4-unicast\nDestination: 1, Path: 1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eTODO: The RIB entries started with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e*\u003c/code\u003e are those that \u003cstrong\u003eannounced to\nneighbors\u003c/strong\u003e by this GoBGP agent?\u003c/p\u003e\n\n\u003ch2 id=\"3-monitor\"\u003e3 Monitor\u003c/h2\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egobgp monitor global rib\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egobgp monitor neighbor\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"4-mrt\"\u003e4 MRT\u003c/h2\u003e\n\n\u003ch2 id=\"5-neighbor\"\u003e5 Neighbor\u003c/h2\u003e\n\n\u003cp\u003eCheck BGP neighbors (peers) of this node:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egobgp neighbor\nPeer           AS     Up/Down State       |#Received  Accepted\n192.168.255.1 65342 1d 18:32:30 Establ      |        0         0\n192.168.255.2 65342 1d 18:28:07 Establ      |        0         0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eNeighbor details:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egobgp neighbor 192.168.255.1\nBGP neighbor is 192.168.255.1, remote AS 65342\n  BGP version 4, remote router ID 192.168.255.1\n  BGP state \u003cspan class=\"o\"\u003e=\u003c/span\u003e established, up \u003cspan class=\"k\"\u003efor \u003c/span\u003e1d 18:55:34\n  BGP OutQ \u003cspan class=\"o\"\u003e=\u003c/span\u003e 0, Flops \u003cspan class=\"o\"\u003e=\u003c/span\u003e 0\n  Hold \u003cspan class=\"nb\"\u003etime \u003c/span\u003eis 90, keepalive interval is 30 seconds\n  Configured hold \u003cspan class=\"nb\"\u003etime \u003c/span\u003eis 90, keepalive interval is 30 seconds\n\n  Neighbor capabilities:\n    multiprotocol:\n        ipv4-unicast:   advertised and received\n    route-refresh:      advertised and received\n    extended-nexthop:   received\n        Remote: nlri: ipv4-unicast, nexthop: ipv6\n    graceful-restart:   received\n        Remote: restart \u003cspan class=\"nb\"\u003etime \u003c/span\u003e120 sec\n            ipv4-unicast\n    4-octet-as: advertised and received\n    UnknownCapability\u003cspan class=\"o\"\u003e(\u003c/span\u003e66\u003cspan class=\"o\"\u003e)\u003c/span\u003e:      received\n    UnknownCapability\u003cspan class=\"o\"\u003e(\u003c/span\u003e67\u003cspan class=\"o\"\u003e)\u003c/span\u003e:      received\n    cisco-route-refresh:        received\n  Message statistics:\n                         Sent       Rcvd\n    Opens:                  1          1\n    Notifications:          0          0\n    Updates:              517          1\n    Keepalives:          5152       5150\n    Route Refresh:          0          1\n    Discarded:              0          0\n    Total:               5670       5153\n  Route statistics:\n    Advertised:             1\n    Received:               0\n    Accepted:               0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"6-policy\"\u003e6 Policy\u003c/h2\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egobgp policy\nName kube_router:\n    StatementName kube_router_stmt0:\n      Conditions:\n        PrefixSet: any clusteripprefixset\n        NeighborSet: any externalpeerset\n      Actions:\n         accept\n    StatementName kube_router_stmt1:\n      Conditions:\n        PrefixSet: any podcidrprefixset\n        NeighborSet: any externalpeerset\n      Actions:\n         accept\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egobgp policy statement\nStatementName kube_router_stmt0:\n  Conditions:\n    PrefixSet: any clusteripprefixset\n    NeighborSet: any externalpeerset\n  Actions:\n     accept\nStatementName kube_router_stmt1:\n  Conditions:\n    PrefixSet: any podcidrprefixset\n    NeighborSet: any externalpeerset\n  Actions:\n     accept\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"7-rpki\"\u003e7 RPKI\u003c/h2\u003e\n\n\u003ch2 id=\"8-vrf\"\u003e8 VRF\u003c/h2\u003e\n\n\u003ch2 id=\"references\"\u003eReferences\u003c/h2\u003e\n\n\u003col\u003e\n  \u003cli\u003e\u003ca href=\"https://github.com/osrg/gobgp\"\u003eGoBGP: Github\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://github.com/osrg/gobgp/blob/master/docs/sources/cli-command-syntax.md\"\u003eGoBGP CLI syntax\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://github.com/cloudnativelabs/kube-router\"\u003ekube-router: Github\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\n  \u003c!-- POST NAVIGATION --\u003e\n  \u003cdiv class=\"postNav clearfix\"\u003e\n     \n      \u003ca class=\"prev\" href=\"/blog/ctrip-network-arch-evolution/\"\u003e\u003cspan\u003e« Ctrip Network Architecture Evolution in the Cloud Computing Era\u003c/span\u003e\n      \n    \u003c/a\u003e\n      \n      \n      \u003ca class=\"next\" href=\"/blog/ctrip-network-arch-evolution-zh/\"\u003e\u003cspan\u003e云计算时代携程的网络架构变迁（2019） »\u003c/span\u003e\n       \n      \u003c/a\u003e\n     \n  \u003c/div\u003e\n\u003c/div\u003e",
  "Date": "2019-04-18T00:00:00Z",
  "Author": "Arthur Chiao"
}