{
  "Source": "blog.zzbd.org",
  "Title": "Win10及WSL2使用中的小trick",
  "Link": "https://blog.zzbd.org/2021/05/20/wsl-better/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003cp\u003e记录一下最近使用win10过程中积累的一些经验，后续有新的idea再来补充。\u003ci class=\"fa fa-wink\"\u003e\u003c/i\u003e\u003c/p\u003e\u003cspan id=\"more\"\u003e\u003c/span\u003e\u003ch3 id=\"Win10-内存优化\"\u003e\u003ca href=\"#Win10-内存优化\" class=\"headerlink\" title=\"Win10 内存优化\"\u003e\u003c/a\u003eWin10 内存优化\u003c/h3\u003e\u003col\u003e\u003cli\u003e\u003cp\u003e尽量不要点开企业微信里的网盘（存在\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.v2ex.com/t/624229\"\u003e内存泄漏\u003c/a\u003e），可以直接在文件夹里找到，或者按照之前的\u003ca href=\"/2021/05/19/win10_search/\"\u003e教程\u003c/a\u003e把网盘加入索引。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e如果使用了自带的杀毒软件，在\u003ccode\u003e病毒和威胁防护\u003c/code\u003e的设置里增加排除项，这个因人而异了。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e关闭或者设定Windows Search（参考上篇文章）\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e在sublime text 3里设置排除文件夹，比如这样：\u003c/p\u003e\u003cfigure class=\"highlight\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u0026#34;folder_exclude_patterns\u0026#34;: [\u0026#34;node_modules\u0026#34;, \u0026#34;.svn\u0026#34;, \u0026#34;.git\u0026#34;, \u0026#34;.hg\u0026#34;, \u0026#34;CVS\u0026#34;]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e使用监控软件，发现异常及时处理。我用的是\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/zhongyang219/TrafficMonitor\"\u003ezhongyang219/TrafficMonitor\u003c/a\u003e，在任务栏可以很方便的监视。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e使用Edge的话在\u003ccode\u003e设置-系统-节约资源\u003c/code\u003e中打开\u003ccode\u003e使用标签页休眠功能节约资源\u003c/code\u003e。Chrome安装The Great Suspender。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e充分利用文档、下载文件夹，桌面当作临时文件夹，随时清理，避免冗余文件。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e使用自带邮件系统，这样在不打开邮件程序的情况下也能及时收到通知，设置提醒也方便。\u003c/p\u003e\u003c/li\u003e\u003c/ol\u003e\u003ch3 id=\"WSL2-优化\"\u003e\u003ca href=\"#WSL2-优化\" class=\"headerlink\" title=\"WSL2 优化\"\u003e\u003c/a\u003eWSL2 优化\u003c/h3\u003e\u003col\u003e\u003cli\u003e\u003cp\u003e锁定输入法。在设置中搜索\u003ccode\u003e输入法\u003c/code\u003e，勾选\u003ccode\u003e允许我为每个应用窗口使用不同输入法\u003c/code\u003e，这样在Terminal中不会莫名其妙切换回中文。甚至在输入法设置里把英文设置为默认。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e设置端口转发，方便局域网访问wsl上的服务。这里参考CzBiX的方法，下载WSLHostPatcher。首先启动WSL2，启动nginx，观察资源监视器-\u0026gt;网络-\u0026gt;侦听端口中的\u003ccode\u003ewslhost.exe\u003c/code\u003e一栏，地址列应该是\u003ccode\u003eIPv4 环回\u003c/code\u003e。此时浏览器可以访问localhost，但其他机器通过局域网无法访问。运行WSLHostPatcher，重启nginx服务（\u003cstrong\u003e重要\u003c/strong\u003e），再次观察地址列，如果变成\u003ccode\u003e未指定 IPv4\u003c/code\u003e，恭喜你，可以用手机试试打开win10的ip，magic出现。停止转发再Powershell中运行\u003ccode\u003ewsl --shutdown\u003c/code\u003e。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e设置Proxy，参考上篇文章。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e设置快捷启动Nginx + PHP + Mariadb，上脚本，用root身份保存为\u003ccode\u003elnmp.sh\u003c/code\u003e：\u003c/p\u003e\u003c/li\u003e\u003c/ol\u003e\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003c/span\u003e\u003cspan class=\"bash\"\u003e!/bin/bash\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eopt=$1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eif [ \u0026#34;$EUID\u0026#34; -ne 0 ]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  then echo \u0026#34;Please run as root\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  exit\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eproc=( \u0026#34;nginx\u0026#34; \u0026#34;mariadb\u0026#34; \u0026#34;php7.4-fpm\u0026#34; )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecomm=( \u0026#34;nginx\u0026#34; \u0026#34;mariadbd\u0026#34; \u0026#34;php-fpm7.4\u0026#34; )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efor i in \u0026#34;${!comm[@]}\u0026#34;; do\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  ps cax | grep ${comm[i]} \u0026gt; /dev/null\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  if [ $? -eq 0 ]; then\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    if [ \u0026#34;$opt\u0026#34; = \u0026#34;stop\u0026#34; ]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      then service ${proc[i]} stop\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      if [ $? -eq 0 ]; then\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo \u0026#34;${comm[i]} stop successfully\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo \u0026#34;${comm[i]} stop fail!\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      echo \u0026#34;${comm[i]} is running\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    if [ \u0026#34;$opt\u0026#34; = \u0026#34;start\u0026#34; ]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      then service ${proc[i]} start\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      if [ $? -eq 0 ]; then\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo \u0026#34;${comm[i]} start successfully\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo \u0026#34;${comm[i]} start fail!\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      echo \u0026#34;${comm[i]} is NOT run\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edone\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003cp\u003e或者是\u003ccode\u003elamp.sh\u003c/code\u003e：\u003c/p\u003e\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003c/span\u003e\u003cspan class=\"bash\"\u003e!/bin/bash\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eopt=$1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eif [ \u0026#34;$EUID\u0026#34; -ne 0 ]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  then echo \u0026#34;Please run as root\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  exit\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efor i in apache2 mariadb; do\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  ps cax | grep $i \u0026gt; /dev/null\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  if [ $? -eq 0 ]; then\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    if [ \u0026#34;$opt\u0026#34; = \u0026#34;stop\u0026#34; ]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      then service $i stop\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      if [ $? -eq 0 ]; then\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo \u0026#34;$i stop successfully\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo \u0026#34;$i stop fail!\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      echo \u0026#34;$i is running\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    if [ \u0026#34;$opt\u0026#34; = \u0026#34;start\u0026#34; ]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      then service $i start\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      if [ $? -eq 0 ]; then\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo \u0026#34;$i start successfully\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo \u0026#34;$i start fail!\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    else\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      echo \u0026#34;$i is NOT run\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  fi\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edone\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003cp\u003e注意要用sudo运行，参数：start启动服务；stop终止服务；其他查询服务。为什么不设置自启动？额，个人习惯吧\u003cimg class=\"emoji\" data-src=\"https://zzbd.org/images/smzdm/38.png\"/\u003e\u003c/p\u003e\u003col start=\"5\"\u003e\u003cli\u003eWindows defender 排除vmmem进程，还有Debian安装文件夹，一般在\u003ccode\u003eC:\\Users\\xxx\\AppData\\Local\\Packages\\\u003c/code\u003e中。\u003c/li\u003e\u003c/ol\u003e\u003ch3 id=\"参考\"\u003e\u003ca href=\"#参考\" class=\"headerlink\" title=\"参考\"\u003e\u003c/a\u003e参考\u003c/h3\u003e\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://blog.czbix.com/WSL2-lan-access.html\"\u003e解决局域网无法访问 WSL2 端口的问题 - 疯狂的盒子 (czbix.com)\u003c/a\u003e\u003c/p\u003e\u003c/div\u003e",
  "Date": "2021-05-20T07:46:50Z",
  "Author": "J. F"
}