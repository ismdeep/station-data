{
  "Source": "blog.zzbd.org",
  "Title": "云书库calibre-web搭建（2）",
  "Link": "https://blog.zzbd.org/2020/03/01/calibre-web2/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch3 id=\"折腾之路\"\u003e\u003ca href=\"#折腾之路\" class=\"headerlink\" title=\"折腾之路\"\u003e\u003c/a\u003e折腾之路\u003c/h3\u003e\u003ch4 id=\"合并原项目新commit\"\u003e\u003ca href=\"#合并原项目新commit\" class=\"headerlink\" title=\"合并原项目新commit\"\u003e\u003c/a\u003e合并原项目新commit\u003c/h4\u003e\u003cp\u003e原项目还在活跃更新，所以每次push之前最好合并最新补丁，分为以下几步：\u003c/p\u003e\u003cspan id=\"more\"\u003e\u003c/span\u003e\u003col\u003e\u003cli\u003e\u003cp\u003e增加远程分支并fetch到本地，在主分支下rebase\u003c/p\u003e\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003egit checkout origin/master\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003egit remote add jane https://github.com/janeczku/calibre-web.git\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003egit fetch jane\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003egit rebase jane/master\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e通过\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://gist.githubusercontent.com/bitmingw/414c1781412f4ece07087ab6f2ce42f8/\"\u003egit_batch_resolver.py\u003c/a\u003e解决翻译冲突问题，记得是保留\u003cstrong\u003etheirs\u003c/strong\u003e(本地版本)，这点与merge正好相反，随后\u003ccode\u003egit rebase --continue\u003c/code\u003e即可完成合并。\u003c/p\u003e\u003c/li\u003e\u003c/ol\u003e\u003ch4 id=\"i18n中文\"\u003e\u003ca href=\"#i18n中文\" class=\"headerlink\" title=\"i18n中文\"\u003e\u003c/a\u003ei18n中文\u003c/h4\u003e\u003cp\u003e花了一下午时间补全了中文翻译，提交了第一个pull requests，作者Jan火速合并到主分支，还\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/janeczku/calibre-web/pull/1229\"\u003e留言\u003c/a\u003e了很多感谢的话，可以看出是个很负责的coder。每次更新代码都需要重新生成messages.pot以及translations文件夹，从作者的repository同步完之后也需要处理这部分\u003c/p\u003e\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003c/span\u003e\u003cspan class=\"bash\"\u003e re-generate messages.pot file\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epybabel extract --no-wrap -F babel.cfg -o messages.pot cps\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003c/span\u003e\u003cspan class=\"bash\"\u003e merge update to old translations\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epybabel update --no-wrap -i messages.pot -d cps/translations\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003c/span\u003e\u003cspan class=\"bash\"\u003e re-complile after complete translating\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epybabel compile -d cps/translations\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003cp\u003e由于界面样式中有根据字符串长度hard coding，所以切换语言之后可能会有BUG\u003c/p\u003e\u003ch4 id=\"增加评论功能\"\u003e\u003ca href=\"#增加评论功能\" class=\"headerlink\" title=\"增加评论功能\"\u003e\u003c/a\u003e增加评论功能\u003c/h4\u003e\u003cp\u003e既然注册登录完成度很高，所以第一个feature request就是评论功能，优先选择\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/xCss/Valine\"\u003eValine\u003c/a\u003e 或者 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/gitalk/gitalk\"\u003eGitalk\u003c/a\u003e这样无后端模块，降低施工难度。兴致勃勃地去提\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/janeczku/calibre-web/issues/1230\"\u003eissue\u003c/a\u003e，希望能得到一些指点，然而无情的被Jan拒绝🙄\u003c/p\u003e\u003cp\u003e既然如此，只好参考作者增加viewer的commit，依葫芦画瓢。最后还是选择Valine（依托github总是感觉有点奇怪）。评论框放在书籍详情页（detail.html），所以默认主题下，在\u003ccode\u003e编辑标签\u003c/code\u003e旁边还要新增一个详情页的链接按钮。最后，如果登录了的话还可以自动填上邮箱和用户名。\u003c/p\u003e\u003ch4 id=\"界面优化\"\u003e\u003ca href=\"#界面优化\" class=\"headerlink\" title=\"界面优化\"\u003e\u003c/a\u003e界面优化\u003c/h4\u003e\u003cp\u003e主要是修复一些BUG\u003c/p\u003e\u003ch4 id=\"豆瓣信息更新自定义\"\u003e\u003ca href=\"#豆瓣信息更新自定义\" class=\"headerlink\" title=\"豆瓣信息更新自定义\"\u003e\u003c/a\u003e豆瓣信息更新自定义\u003c/h4\u003e\u003cp\u003e使得可以自由选择更新哪些条目，而不是一股脑全部替换。\u003c/p\u003e\u003ch3 id=\"参考链接：\"\u003e\u003ca href=\"#参考链接：\" class=\"headerlink\" title=\"参考链接：\"\u003e\u003c/a\u003e参考链接：\u003c/h3\u003e\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://translations.readthedocs.io/en/latest/flask-babel.html\"\u003eFlask-Babel 简介\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://bitmingw.com/2017/02/16/git-merge-rebase-ours-and-theirs/\"\u003e化解冲突：git merge 与 git rebase 中的 ours 和 theirs\u003c/a\u003e\u003c/p\u003e\u003c/div\u003e",
  "Date": "2020-03-01T06:38:32Z",
  "Author": "J. F"
}