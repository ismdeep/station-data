{
  "Source": "blog.zzbd.org",
  "Title": "在coding自动化部署hexo",
  "Link": "https://blog.zzbd.org/2020/05/01/blog-ci/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003cblockquote\u003e\u003cp\u003e从\u003cstrong\u003e木木木木木的博客\u003c/strong\u003e上发现两篇有意思的文章，于是决定把博客小小改造下。自动化部署，真的就全web界面写博客了；字体异步加载，提高页面载入速度，很早就有这个想法，这次总算比较优雅地解决了。\u003c/p\u003e\u003c/blockquote\u003e\u003ch3 id=\"博客自动化部署\"\u003e\u003ca href=\"#博客自动化部署\" class=\"headerlink\" title=\"博客自动化部署\"\u003e\u003c/a\u003e博客自动化部署\u003c/h3\u003e\u003cp\u003e既然选择了coding作为仓库，顺手采用他家的构建计划，和github actions异曲同工。直接贴出\u003ccode\u003e.Jenkinsfile\u003c/code\u003e\u003c/p\u003e\u003cspan id=\"more\"\u003e\u003c/span\u003e\u003cfigure class=\"highlight\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003epipeline {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  agent any\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  stages {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    stage(\u0026#39;检出\u0026#39;) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      steps {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        checkout([\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          $class: \u0026#39;GitSCM\u0026#39;,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          branches: [[name: env.GIT_BUILD_REF]],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          doGenerateSubmoduleConfigurations: false,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          extensions: [[$class: \u0026#39;SubmoduleOption\u0026#39;,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          disableSubmodules: false,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          parentCredentials: false,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          recursiveSubmodules: false,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          reference: \u0026#39;\u0026#39;,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          trackingSubmodules: false\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        ]],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        submoduleCfg: [],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        userRemoteConfigs: [[\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          url: env.GIT_REPO_URL,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          credentialsId: env.CREDENTIALS_ID\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        ]]])\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    stage(\u0026#39;安装依赖\u0026#39;) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      steps {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        sh \u0026#39;npm install -g hexo-cli\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        sh \u0026#39;npm install\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    stage(\u0026#39;自动部署\u0026#39;) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      steps {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        sh \u0026#39;npx gulp deploy\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003cp\u003e值得一提的是，next主题需要作为submodule一同checkout，deploy使用gulp脚本，生成、压缩、上传一条龙。这里有个\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/hexojs/hexo-deployer-git/issues/159\"\u003e坑\u003c/a\u003e，hexo deploy插件的配置需要使用第二种形式。\u003c/p\u003e\u003ch3 id=\"异步加载字体文件\"\u003e\u003ca href=\"#异步加载字体文件\" class=\"headerlink\" title=\"异步加载字体文件\"\u003e\u003c/a\u003e异步加载字体文件\u003c/h3\u003e\u003cp\u003e只需要在link标签增加两个属性即可解决这个问题。\u003c/p\u003e\u003cfigure class=\"highlight html\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003elink\u003c/span\u003e \u003cspan class=\"attr\"\u003erel\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;stylesheet\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003ehref\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;https://fonts.loli.net/css?family=Source+Sans+Pro:300\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003emedia\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;print\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003eonload\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;this.media=\u0026#39;all\u0026#39;\u0026#34;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003ch3 id=\"参考链接\"\u003e\u003ca href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"\u003e\u003c/a\u003e参考链接\u003c/h3\u003e\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://immmmm.com/hugo-github-actions/\"\u003eHugo + Github Actions 实现自动化部署\u003c/a\u003e\u003cbr/\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://immmmm.com/noto-serif-sc-by-google-fonts/\"\u003e添加 Google Fonts 思源宋体\u003c/a\u003e\u003cbr/\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://stackoverflow.com/questions/51361907/implicitly-loading-submodules-in-jenkins-pipeline-stages\"\u003eImplicitly loading submodules in Jenkins pipeline stages\u003c/a\u003e\u003c/p\u003e\u003c/div\u003e",
  "Date": "2020-05-01T11:46:04Z",
  "Author": "J. F"
}