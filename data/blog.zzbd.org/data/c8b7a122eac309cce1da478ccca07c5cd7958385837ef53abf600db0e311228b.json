{
  "Source": "blog.zzbd.org",
  "Title": "Wox插件开发：查单词",
  "Link": "https://blog.zzbd.org/2021/04/13/wox_dict/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003cp\u003e又开始尝试摆脱鼠标了，于是重新用回了Wox，用来做一些基本的查询还是很方便的。因为有医学单词查询的需求，想到了湘雅专业词典。可惜官网不提供API，不过好在用Wox手撸一个建议爬虫还是可以做到的，mcd8的网页还是很规整的，非常适合快速构建提取流程。\u003c/p\u003e\u003cspan id=\"more\"\u003e\u003c/span\u003e\u003cp\u003e直接说核心代码，首先是query模块，这里要注意的点包括关键词的预处理，JSON中特殊字符串的处理和规避，以及特殊情况下的If判断避免报错等等。贴上单词释义相关的loop代码\u003c/p\u003e\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e words.find_all(\u003cspan class=\"string\"\u003e\u0026#39;div\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;block\u0026#39;\u003c/span\u003e):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    content = self.getText(i.find(\u003cspan class=\"string\"\u003e\u0026#39;div\u0026#39;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#39;content\u0026#39;\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    results.append({\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"string\"\u003e\u0026#34;Title\u0026#34;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;{}\u0026#34;\u003c/span\u003e.\u003cspan class=\"built_in\"\u003eformat\u003c/span\u003e(self.getText(i.find(\u003cspan class=\"string\"\u003e\u0026#39;div\u0026#39;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#39;dict\u0026#39;\u003c/span\u003e))),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"string\"\u003e\u0026#34;SubTitle\u0026#34;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;{}\u0026#34;\u003c/span\u003e.\u003cspan class=\"built_in\"\u003eformat\u003c/span\u003e(content),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"string\"\u003e\u0026#34;IcoPath\u0026#34;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;Images/detail.png\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"string\"\u003e\u0026#34;ContextData\u0026#34;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;demo\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"string\"\u003e\u0026#34;JsonRPCAction\u0026#34;\u003c/span\u003e: {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"string\"\u003e\u0026#39;method\u0026#39;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;addToClipBoard\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"string\"\u003e\u0026#39;parameters\u0026#39;\u003c/span\u003e: [\u003cspan class=\"string\"\u003e\u0026#34;{}\u0026#34;\u003c/span\u003e.\u003cspan class=\"built_in\"\u003eformat\u003c/span\u003e(content.replace(\u003cspan class=\"string\"\u003e\u0026#39;\\n\u0026#39;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#39;//\u0026#39;\u003c/span\u003e))], \u003cspan class=\"comment\"\u003e#换行是JSON语法的保留符号\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"string\"\u003e\u0026#39;dontHideAfterAction\u0026#39;\u003c/span\u003e: \u003cspan class=\"literal\"\u003eTrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    })\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003cp\u003e另外还想实现右键复制到剪切板的功能，在网上搜到了解决方案\u003c/p\u003e\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title\"\u003eaddToClipBoard\u003c/span\u003e(\u003cspan class=\"params\"\u003eself, text\u003c/span\u003e):\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    subprocess.run(\u003cspan class=\"string\"\u003e\u0026#34;clip\u0026#34;\u003c/span\u003e, universal_newlines=\u003cspan class=\"literal\"\u003eTrue\u003c/span\u003e, \u003cspan class=\"built_in\"\u003einput\u003c/span\u003e=text, creationflags=\u003cspan class=\"number\"\u003e0x08000000\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003cp\u003e这里的\u003ccode\u003ecreationflags\u003c/code\u003e是为了阻止复制时弹出命令行窗口。\u003c/p\u003e\u003cp\u003e总体来说还是比较简单，当然还可以有更多的需求，比如相关词汇点击可持续搜索词条等等。目前的功能已经够用，也懒得研究Wox的API，所以先这样吧。用Python做扩展的好处是简单，相比C#与Wox本体的耦合度较差，如果要高级功能或者用着更舒服只有上C#这条路了（大坑）。\u003c/p\u003e\u003cp\u003e4.14更新\u003cbr/\u003e记录一个坑：如果搜索框因为失去焦点被隐藏，下次通过自定义快捷键呼出时，光标的焦点不在输入框里。通过搜索issue并没有找到解决方案，目前的方式是关闭设置中的\u003ccode\u003e失去焦点时自动隐藏Wox\u003c/code\u003e，每次通过\u003ccode\u003eEsc\u003c/code\u003e关闭搜索框，再次呼出时焦点就正常了。\u003c/p\u003e\u003c/div\u003e",
  "Date": "2021-04-13T07:46:50Z",
  "Author": "J. F"
}