{
  "Source": "blog.zzbd.org",
  "Title": "谈谈flash防下载",
  "Link": "https://blog.zzbd.org/2010/05/02/flashlock/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003cp\u003e本人是flash小白，只会玩不会做，嘿嘿，今天就打肿脸充胖子，谈谈flash防下载技术~\u003cbr/\u003e以\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://plant.hzau.edu.cn/study/systematic/player.html\"\u003e这个\u003c/a\u003eflash为例，正常浏览应该到\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://plant.hzau.edu.cn/study/systematic/systematic.asp\"\u003e这儿\u003c/a\u003e。用迅雷探测了下，发现是调用了shell.swf（光看名字就知道是个壳），只有几十字节，下载下来反编，只有一句话\u003ccode\u003eStage.showMenu = true;loadMovieNum(\u0026#34;player.swf\u0026#34;, 2);\u003c/code\u003e。于是把域名里的\u003ccode\u003eshell.swf\u003c/code\u003e替换成\u003ccode\u003eplayer.swf\u003c/code\u003e整个flash就显示_\u003ccode\u003eplease run index.html,shell.swf or shell.exe\u003c/code\u003e_顺藤摸瓜，使用它提示的网址，直接就跳转到一开始所说的那个位置了。查看源代码，除了几句象征性的防直接访问代码外，没有找到有价值的东西。看来这个player.swf就是核心了。\u003cspan id=\"more\"\u003e\u003c/span\u003e\u003c/p\u003e\u003cp\u003e下载下来有100多K，反编译之后直奔它的AS。以搜索之前flash的提示文字，定位到了判断语句\u003ccode\u003eloadAllSlide()\u003c/code\u003e\u003c/p\u003e\u003cfigure class=\"highlight reasonml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e load\u003cspan class=\"constructor\"\u003eAllSlide()\u003c/span\u003e       \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    var _loc2 = this.create\u003cspan class=\"constructor\"\u003eEmptyMovieClip(\u003cspan class=\"string\"\u003e\u0026#34;ctrl\u0026#34;\u003c/span\u003e, \u003cspan class=\"params\"\u003ei\u003c/span\u003e)\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (arrSlide\u003cspan class=\"literal\"\u003e[\u003cspan class=\"identifier\"\u003ei\u003c/span\u003e]\u003c/span\u003e.index\u003cspan class=\"constructor\"\u003eOf(\u003cspan class=\"string\"\u003e\u0026#34;Slide\u0026#34;\u003c/span\u003e)\u003c/span\u003e != -\u003cspan class=\"number\"\u003e1\u003c/span\u003e)        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    {        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        mc.load\u003cspan class=\"constructor\"\u003eMovie(\u003cspan class=\"string\"\u003e\u0026#34;data/\u0026#34;\u003c/span\u003e + \u003cspan class=\"params\"\u003earrSlide\u003c/span\u003e[\u003cspan class=\"params\"\u003ei\u003c/span\u003e])\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    {        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        mc.load\u003cspan class=\"constructor\"\u003eMovie(\u003cspan class=\"params\"\u003earrSlide\u003c/span\u003e[\u003cspan class=\"params\"\u003ei\u003c/span\u003e])\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    } \u003cspan class=\"comment\"\u003e// end else if        \u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"module-access\"\u003e\u003cspan class=\"module\"\u003e\u003cspan class=\"identifier\"\u003e_loc2\u003c/span\u003e.\u003c/span\u003e\u003c/span\u003eonEnterFrame = \u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"literal\"\u003e()\u003c/span\u003e        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    {        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        mc.stop\u003cspan class=\"literal\"\u003e()\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        mc.mc_Slide.stop\u003cspan class=\"literal\"\u003e()\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        bytLoaded = mc.get\u003cspan class=\"constructor\"\u003eBytesLoaded()\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        bytTotal = mc.get\u003cspan class=\"constructor\"\u003eBytesTotal()\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (!isGone)        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        {        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            mc_logo.ldr.text = strObj.loadInfo + \u003cspan class=\"string\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e + \u003cspan class=\"module-access\"\u003e\u003cspan class=\"module\"\u003e\u003cspan class=\"identifier\"\u003eMath\u003c/span\u003e.\u003c/span\u003e\u003c/span\u003eround(i\u003cspan class=\"operator\"\u003e * \u003c/span\u003e\u003cspan class=\"number\"\u003e100\u003c/span\u003e\u003cspan class=\"operator\"\u003e / \u003c/span\u003eg_totalSlide + \u003cspan class=\"number\"\u003e100\u003c/span\u003e\u003cspan class=\"operator\"\u003e / \u003c/span\u003eg_totalSlide\u003cspan class=\"operator\"\u003e * \u003c/span\u003ebytLoaded\u003cspan class=\"operator\"\u003e / \u003c/span\u003ebytTotal).\u003cspan class=\"keyword\"\u003eto\u003c/span\u003e\u003cspan class=\"constructor\"\u003eString()\u003c/span\u003e + \u003cspan class=\"string\"\u003e\u0026#34;%\u0026#34;\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (bytLoaded != undefined\u003cspan class=\"operator\"\u003e \u0026amp;\u0026amp; \u003c/span\u003ebytTotal != undefined\u003cspan class=\"operator\"\u003e \u0026amp;\u0026amp; \u003c/span\u003ei\u003cspan class=\"operator\"\u003e / \u003c/span\u003eg_totalSlide + bytLoaded\u003cspan class=\"operator\"\u003e / \u003c/span\u003ebytTotal\u003cspan class=\"operator\"\u003e / \u003c/span\u003eg_totalSlide \u0026gt;= buf)        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            {        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                mc = mc_load; \u0026lt;!--more--\u0026gt;       \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                isGone = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                play \u003cspan class=\"literal\"\u003e()\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            } \u003cspan class=\"comment\"\u003e// end if        \u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"comment\"\u003e// end if        \u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (bytLoaded\u003cspan class=\"operator\"\u003e == \u003c/span\u003ebytTotal\u003cspan class=\"operator\"\u003e \u0026amp;\u0026amp; \u003c/span\u003ebytTotal != undefined)        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        {        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            mc.unload\u003cspan class=\"constructor\"\u003eMovie()\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            arrLoaded\u003cspan class=\"literal\"\u003e[\u003cspan class=\"identifier\"\u003ei\u003c/span\u003e]\u003c/span\u003e = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            delete this.onEnterFrame;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            ++i;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (i \u0026lt; g_totalSlide)        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            {        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                load\u003cspan class=\"constructor\"\u003eAllSlide()\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            }        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            {        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                this.remove\u003cspan class=\"constructor\"\u003eMovieClip()\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (_currentframe\u003cspan class=\"operator\"\u003e == \u003c/span\u003e\u003cspan class=\"number\"\u003e4\u003c/span\u003e)        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                {        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    play \u003cspan class=\"literal\"\u003e()\u003c/span\u003e;        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                } \u003cspan class=\"comment\"\u003e// end if        \u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            } \u003cspan class=\"comment\"\u003e// end if        \u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"comment\"\u003e// end else if        \u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    };        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003cp\u003e注意到15行，就是调用的位置，可惜直接用浏览器访问../data/文件夹返回403错误，看来只有本地程序才有权限访问或者代码里做了什么手脚。故事没有下文，其他的等待高手分析了。\u003c/p\u003e\u003cp\u003e附上重要AU文件[下载地址]\u003ccode\u003e(链接失效)\u003c/code\u003e\u003c/p\u003e\u003c/div\u003e",
  "Date": "2010-05-02T07:42:03Z",
  "Author": "J. F"
}