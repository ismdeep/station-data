{
  "Source": "bogomolov.tech",
  "Title": "XenForo 2 add-on development reference",
  "Link": "https://bogomolov.tech/XenForo-2-add-on-development-reference/",
  "Content": "\u003cdiv class=\"post-content\"\u003e\u003cp\u003eHere is a short reference of some points in source code, which should help you to create XenForo 2 add-on. At first, I recommend you follow the official tutorial with an add-on sample.\u003c/p\u003e\u003cp\u003eYou can find it here:\u003cbr/\u003e\u003ca href=\"https://xenforo.com/xf2-docs/dev/lets-build-an-add-on/\" target=\"_blank\" rel=\"noopener\"\u003ehttps://xenforo.com/xf2-docs/dev/lets-build-an-add-on/\u003c/a\u003e\u003c/p\u003e\u003cp\u003eBelow you will find additional information I discovered during writing my add-on.\u003c/p\u003e\u003ch3 id=\"Prepare-environment\"\u003e\u003ca href=\"#Prepare-environment\" class=\"headerlink\" title=\"Prepare environment\"\u003e\u003c/a\u003ePrepare environment\u003c/h3\u003e\u003cp\u003eI usually use Docker for such kind of app. I worked on an app with Memcached, so you will see it in the files below.\u003c/p\u003e\u003cp\u003eHere is the content of \u003ccode\u003eDockerfile\u003c/code\u003e:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs Dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e php:\u003cspan class=\"hljs-number\"\u003e7.2\u003c/span\u003e-apache\n\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e apt-get update \\\n    \u0026amp;\u0026amp; apt-get install -y \\\n    zip \\\n    zlib1g-dev \\\n    libz-dev \\\n    libmemcached-dev \\\n    libpng-dev \\\n    libfreetype6-dev \\\n    libjpeg62-turbo-dev \\\n    libgd-dev\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e a2enmod rewrite \\\n    \u0026amp;\u0026amp; pecl install memcache xdebug-2.6.1 \\\n    \u0026amp;\u0026amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n    \u0026amp;\u0026amp; docker-php-ext-install gd mysqli zip \\\n    \u0026amp;\u0026amp; docker-php-ext-enable memcache xdebug \\\n    \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#34;xdebug.remote_enable=1\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /usr/\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e/etc/php/conf.d/xdebug.ini \\\n    \u0026amp;\u0026amp; \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#34;xdebug.remote_autostart=off\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /usr/\u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e/etc/php/conf.d/xdebug.ini\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAnd the content of \u003ccode\u003edocker-compose.yml\u003c/code\u003e file:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#39;3\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ephp:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./docker/php\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e#path to \u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003econtainer_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ephp_container\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eXDEBUG_CONFIG:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#34;remote_host=172.17.0.1 remote_port=9000\u0026#34;\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ePHP_IDE_CONFIG:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eserverName=localhost\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./app:/var/www/html\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e:80\u003c/span\u003e\n\n  \u003cspan class=\"hljs-attr\"\u003emariadb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emariadb:10.4\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eMYSQL_ROOT_PASSWORD:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epass\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eMYSQL_DATABASE:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edatabase_name\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edb:/var/lib/mysql\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e:3306\u003c/span\u003e\n\n  \u003cspan class=\"hljs-attr\"\u003ememcache:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ememcached:alpine\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e11211\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e:11211\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edb:\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIf you want to use HTTPS locally read the tutorial \u003ca href=\"/localhost-https/\"\u003eHow to get HTTPS working on localhost\u003c/a\u003e to know more.\u003c/p\u003e\u003ch3 id=\"XenForo-2-console-commands\"\u003e\u003ca href=\"#XenForo-2-console-commands\" class=\"headerlink\" title=\"XenForo 2 console commands\"\u003e\u003c/a\u003eXenForo 2 console commands\u003c/h3\u003e\u003cp\u003eEnter a Docker container with command:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003edocker \u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e -it -u www-data php_container bash\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThen you can list all commands and filter them:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs bash\"\u003e$ php cmd.php | grep addon\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAdd-on commands located in src/XF/Cli/Command/AddOn folder.\u003c/p\u003e\u003ch3 id=\"Add-on-data\"\u003e\u003ca href=\"#Add-on-data\" class=\"headerlink\" title=\"Add-on data\"\u003e\u003c/a\u003eAdd-on data\u003c/h3\u003e\u003cp\u003eAll add-ons stored in src/addons folder and \u003ccode\u003exf_addon\u003c/code\u003e table in the database.\u003c/p\u003e\u003ch3 id=\"Setup-script\"\u003e\u003ca href=\"#Setup-script\" class=\"headerlink\" title=\"Setup script\"\u003e\u003c/a\u003eSetup script\u003c/h3\u003e\u003cp\u003eIf you change tables with alters, use available data types from here: \u003ccode\u003esrc/XF/Db/Schema/Column.php::type\u003c/code\u003e.\u003cbr/\u003eChange tables with SchemaManager. See available methods in \u003ccode\u003esrc/XF/Db/SchemaManager.php\u003c/code\u003e, i.e. tableExists(), columnExists() etc.\u003c/p\u003e\u003ch3 id=\"Extend-entity\"\u003e\u003ca href=\"#Extend-entity\" class=\"headerlink\" title=\"Extend entity\"\u003e\u003c/a\u003eExtend entity\u003c/h3\u003e\u003cp\u003eThe simplest way to extend an entity is to add it in the admin panel. See \u003cstrong\u003eDevelopment\u003c/strong\u003e - \u003cstrong\u003eClass extensions\u003c/strong\u003e menu in the admin control panel.\u003c/p\u003e\u003cp\u003eIt will write data to \u003ccode\u003exf_class_extension\u003c/code\u003e table. Classes extensions will be processed here: \u003ccode\u003esrc/XF/Extension.php::extendClass\u003c/code\u003e. XenForo extends with \u003ccode\u003eclass_alias\u003c/code\u003e PHP function. As a parent class, you should specify a class name with “XFCP_” prefix, see how it works here: \u003ccode\u003eforum/src/XF/Extension.php:243\u003c/code\u003e (\u003ccode\u003eresolveExtendedClassToRoot\u003c/code\u003e method).\u003c/p\u003e\u003ch3 id=\"Event-listeners\"\u003e\u003ca href=\"#Event-listeners\" class=\"headerlink\" title=\"Event listeners\"\u003e\u003c/a\u003eEvent listeners\u003c/h3\u003e\u003cp\u003eXenForo 2 sends a lot of events through request processing. See the list of events and event listeners in \u003cstrong\u003eDevelopment\u003c/strong\u003e - \u003cstrong\u003eCode events\u003c/strong\u003e and \u003cstrong\u003eCode event listeners\u003c/strong\u003e in the admin control panel. Data will be stored in database in tables \u003ccode\u003exf_code_event\u003c/code\u003e and \u003ccode\u003exf_code_event_listener\u003c/code\u003e.\u003c/p\u003e\u003cp\u003eIn order to see all events, you could use Xdebug. Set a breakpoint in \u003ccode\u003esrc/XF/Extension.php::fire\u003c/code\u003e function and see event names and hints which you could use.\u003c/p\u003e\u003ch3 id=\"Use-composer-packages\"\u003e\u003ca href=\"#Use-composer-packages\" class=\"headerlink\" title=\"Use composer packages\"\u003e\u003c/a\u003eUse composer packages\u003c/h3\u003e\u003cp\u003eHere is a good tutorial on how to use it:\u003cbr/\u003e\u003ca href=\"https://xenforo.com/community/resources/using-composer-packages-in-xenforo-2-0-addons-tutorial.6588/\" target=\"_blank\" rel=\"noopener\"\u003ehttps://xenforo.com/community/resources/using-composer-packages-in-xenforo-2-0-addons-tutorial.6588/\u003c/a\u003e\u003c/p\u003e\u003ch3 id=\"Template-functions\"\u003e\u003ca href=\"#Template-functions\" class=\"headerlink\" title=\"Template functions\"\u003e\u003c/a\u003eTemplate functions\u003c/h3\u003e\u003cp\u003eSee the list of default functions you can use in templates in file \u003ccode\u003esrc/XF/Template/Templater.php:152\u003c/code\u003e (variable \u003ccode\u003e$defaultFunctions\u003c/code\u003e).\u003c/p\u003e\u003cbr/\u003e\u003cdiv class=\"related-posts\"\u003e\u003chr/\u003e\u003ch3\u003eRelated posts:\u003c/h3\u003e\u003cul class=\"popular-posts\"\u003e\u003cli class=\"popular-posts-item\"\u003e\u003cdiv class=\"popular-posts-title\"\u003e\u003ch3\u003e\u003ca href=\"/Facebook-Log-Id-Symfony/\" title=\"Implement Facebook login button with Symfony\" rel=\"bookmark\"\u003eImplement Facebook login button with Symfony\u003c/a\u003e\u003c/h3\u003e\u003c/div\u003e\u003c/li\u003e\u003cli class=\"popular-posts-item\"\u003e\u003cdiv class=\"popular-posts-title\"\u003e\u003ch3\u003e\u003ca href=\"/Basics-of-sound/\" title=\"Beat detection in Java for Android\" rel=\"bookmark\"\u003eBeat detection in Java for Android\u003c/a\u003e\u003c/h3\u003e\u003c/div\u003e\u003c/li\u003e\u003cli class=\"popular-posts-item\"\u003e\u003cdiv class=\"popular-posts-title\"\u003e\u003ch3\u003e\u003ca href=\"/Nodejs-production-systemd/\" title=\"How to manage Nodejs process using systemd\" rel=\"bookmark\"\u003eHow to manage Nodejs process using systemd\u003c/a\u003e\u003c/h3\u003e\u003c/div\u003e\u003c/li\u003e\u003cli class=\"popular-posts-item\"\u003e\u003cdiv class=\"popular-posts-title\"\u003e\u003ch3\u003e\u003ca href=\"/Telegram-notification-on-SSH-login/\" title=\"Send message to Telegram on any SSH login\" rel=\"bookmark\"\u003eSend message to Telegram on any SSH login\u003c/a\u003e\u003c/h3\u003e\u003c/div\u003e\u003c/li\u003e\u003cli class=\"popular-posts-item\"\u003e\u003cdiv class=\"popular-posts-title\"\u003e\u003ch3\u003e\u003ca href=\"/What-is-Big-O-notation/\" title=\"What is Big-O notation\" rel=\"bookmark\"\u003eWhat is Big-O notation\u003c/a\u003e\u003c/h3\u003e\u003c/div\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003cdiv id=\"comment-container\"\u003e\u003c/div\u003e\u003cdiv id=\"disqus_thread\"\u003e\u003c/div\u003e\u003c/div\u003e",
  "Date": "2020-05-20T00:00:00Z",
  "Author": "Konstantin Bogomolov"
}