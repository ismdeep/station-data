{
  "Source": "bou.ke",
  "Title": "Privacy-conscious Home Automation",
  "Link": "https://bou.ke/blog/lights/",
  "Content": "\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"post\"\u003e\n  \u003ch1\u003ePrivacy-conscious Home Automation\u003c/h1\u003e\n  \u003cp\u003eI bought an apartment last year and one of the things you immediately start doing is figuring out what you want to change about the place. When I bought it there wasn’t any place to put ceiling lights in the center of the living room—I like a nicely lit place so I knew I wanted to make changes. I got a quote from an electrician for installing potlights, adding switches and wiring it all up but it quickly got in the €1000+ range. Therefore I decided to take matters into my own hands!\u003c/p\u003e\n\n\u003cimg src=\"/images/lights/drill.jpg\" alt=\"\" style=\"max-height: min(100vh, 210px)\" loading=\"lazy\"/\u003e\n\u003cp\u003eDrilling holes and pulling wires went \u003cem\u003emostly\u003c/em\u003e fine, what I spent a lot of time on was the switching and home automation part of it. I had these requirements for whatever system I would set-up.\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003eNot WiFi-based—I don’t want my lightbulbs talking to sketchy servers in China.\u003c/li\u003e\n  \u003cli\u003eWireless buttons—I want to install light switches where I want without having to pull wires through the wall.\u003c/li\u003e\n  \u003cli\u003eHomeKit support—I want to be able to control the lights with my Apple watch.\u003c/li\u003e\n  \u003cli\u003eDon’t want multiple ‘bridges’ for separate standards.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eI quickly converged on a Zigbee-based solution. Zigbee is a wireless communication standard that is used by Philips Hue, IKEA and many other devices. Controlling all your devices requires a ‘gateway’—for that I used a device called the \u003ca href=\"https://phoscon.de/en/conbee2\" target=\"_blank\"\u003ePhoscon Conbee\u003c/a\u003e which is a German-produced device that can talk to \u003ca href=\"https://zigbee.blakadder.com/deconz.html\" target=\"_blank\"\u003emany devices\u003c/a\u003e from many manufacturers while having its own pretty straightforward \u003ca href=\"https://phoscon.de/en/conbee2/software#phoscon-app\" target=\"_blank\"\u003econfiguration software\u003c/a\u003e and a \u003ca href=\"https://dresden-elektronik.github.io/deconz-rest-doc/\" target=\"_blank\"\u003eREST API\u003c/a\u003e. The fact that they’re German gives me some confidence that privacy-wise it’s pretty okay since the Germans are obsessed with \u003cem\u003eDatenschutz\u003c/em\u003e.\u003c/p\u003e\n\n\u003cp\u003eI ended up getting the following hardware to go with the gateway:\u003c/p\u003e\n\n\u003ch2 id=\"ecodim-rotary-dimmer\"\u003e\u003ca href=\"https://www.ecodim.nl/en/eco-dim07-zigbee-pro.html\" target=\"_blank\"\u003eEcoDim Rotary Dimmer\u003c/a\u003e\u003c/h2\u003e\n\n\u003cp\u003eThis device I installed where I previously had other dimmers, it’s nice since people can use the switch like a regular switch but you can control it remotely.\u003c/p\u003e\n\n\u003ch2 id=\"ecodim-dimmer-module\"\u003e\u003ca href=\"https://www.ecodim.nl/en/eco-dim10-zigbee.html\" target=\"_blank\"\u003eEcoDim Dimmer Module\u003c/a\u003e\u003c/h2\u003e\n\n\u003cp\u003eAt first I tried a \u003ca href=\"https://lonsonho.com/en-eu/products/lonsonho-tuya-zigbee-smart-switch-module-relay-1-2-3-4-gang-smartlife-wireless-control-alexa-google-home-yandex-alice-compatible\" target=\"_blank\"\u003eLonsonho\u003c/a\u003e dimmer I bought off Aliexpress—it’s $15! Unfortunately I found out that it doesn’t ‘smoothly’ dim, it discretely sets the dim levels. I ended up buying this dimmer module which has been super solid.\u003c/p\u003e\n\n\u003cp\u003eI used it to wire up all the potlights that I put into my ceiling. One module is wired to multiple lights that I can then control as one unit.\u003c/p\u003e\n\n\u003cimg src=\"/images/lights/result.jpg\" alt=\"\" style=\"max-height: min(100vh, 500px)\" loading=\"lazy\"/\u003e\n\u003ch2 id=\"silvercrest-smart-plug\"\u003e\u003ca href=\"https://www.lidl.nl/p/silvercrest-tussenstekker-zigbee-smart-home/p100338119\" target=\"_blank\"\u003eSilvercrest Smart Plug\u003c/a\u003e\u003c/h2\u003e\n\n\u003cp\u003eI have fairy lights on my balcony that I had to run outside into the cold to turn off an on so I got one of these Lidl smart plugs. It’s cheap and has a button on it for manual switching.\u003c/p\u003e\n\n\u003ch2 id=\"trådfri-button-and-dimmer\"\u003eTRÅDFRI \u003ca href=\"https://www.ikea.com/nl/en/p/tradfri-shortcut-button-white-smart-40356381/\" target=\"_blank\"\u003eButton\u003c/a\u003e and \u003ca href=\"https://www.ikea.com/nl/en/p/tradfri-wireless-dimmer-smart-white-70408595/\" target=\"_blank\"\u003eDimmer\u003c/a\u003e\u003c/h2\u003e\n\n\u003cp\u003eIKEA’s home automation products are insanely cheap and work well with Deconz. They’re magnetic and I’ve attached a couple to a radiator next to the door of my living room.\u003c/p\u003e\n\n\u003ch1 id=\"software\"\u003eSoftware\u003c/h1\u003e\n\n\u003cp\u003eOnce I got the hardware I had to set up the software to go with it. For the first couple months I had my Conbee stick plugged into an old Linux laptop I had laying around because of the \u003ca href=\"https://www.jeffgeerling.com/blog/2022/you-cant-buy-raspberry-pi-right-now\" target=\"_blank\"\u003egreat Raspberry Pi shortage of 2022\u003c/a\u003e. I kept a close eye on \u003ca href=\"https://rpilocator.com/\" target=\"_blank\"\u003erpilocator\u003c/a\u003e and did manage get my hands on one.\u003c/p\u003e\n\n\u003cp\u003eAfter installing the Deconz software I recommend you download \u003ca href=\"https://www.hueessentials.com/\" target=\"_blank\"\u003eHue Essentials\u003c/a\u003e for your iPhone/Apple Watch because it’s a decent app, supporting the most basic features like dimming and turning everything off and on at once.\u003c/p\u003e\n\n\u003cp\u003eBecause getting support for Homekit is the most important thing I decided to go with \u003ca href=\"https://homebridge.io/\" target=\"_blank\"\u003eHomebridge\u003c/a\u003e instead of something like \u003ca href=\"https://www.home-assistant.io/\" target=\"_blank\"\u003eHome Assistant\u003c/a\u003e which might be more powerful but looked super daunting to get set up properly. Homebridge was easy, I needed the Deconz plugin after which I had all my devices show up in Homekit on my phone.\u003c/p\u003e\n\n\u003ch2 id=\"nix\"\u003eNix\u003c/h2\u003e\n\n\u003cp\u003eOf course I used \u003ca href=\"https://bou.ke/blog/nix/\" target=\"_blank\"\u003eNix\u003c/a\u003e to set up my Raspberry Pi with the services I needed. This is the config I use:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e{ config, ... }: \n\n{\n  services.tailscale.enable = true;\n  networking = {\n    hostName = \u0026#34;homepi\u0026#34;;\n    firewall = {\n      enable = false;\n      allowedUDPPorts = [ config.services.tailscale.port 5353 1900 ];\n      allowedTCPPorts = [ 22 80 8443 8581 5353 ];\n      trustedInterfaces = [ \u0026#34;tailscale0\u0026#34; ];\n      checkReversePath = \u0026#34;loose\u0026#34;;\n    };\n  };\n  virtualisation.oci-containers = {\n    backend = \u0026#34;podman\u0026#34;;\n    containers = {\n      deconz = {\n        image = \u0026#34;deconzcommunity/deconz:latest\u0026#34;;\n        volumes = [\n          \u0026#34;/opt/deconz:/opt/deCONZ\u0026#34;\n        ];\n        extraOptions = [ \u0026#34;--network=host\u0026#34; \u0026#34;--device=/dev/ttyACM0\u0026#34; ];\n        environment = {\n          TZ = config.time.timeZone;\n          DECONZ_WS_PORT = \u0026#34;8443\u0026#34;;\n        };\n      };\n      homebridge = {\n        image = \u0026#34;oznu/homebridge:latest\u0026#34;;\n        extraOptions = [ \u0026#34;--network=host\u0026#34; ];\n        volumes = [\n          \u0026#34;/home/bouke/.homebridge:/homebridge\u0026#34;\n        ];\n        environment = {\n          HOMEBRIDGE_CONFIG_UI = \u0026#34;1\u0026#34;;\n          HOMEBRIDGE_CONFIG_UI_PORT = \u0026#34;8581\u0026#34;;\n          PGID = \u0026#34;100\u0026#34;;\n          PUID = \u0026#34;1001\u0026#34;;\n          TZ = config.time.timeZone;\n        };\n      };\n    };\n  };\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eI’m happy with how it turned out, I accomplished all the goals I had for the project while not breaking the bank. The system is quite extensible, I created a two \u003ca href=\"https://support.apple.com/en-gb/guide/shortcuts/welcome/ios\" target=\"_blank\"\u003eShortcuts\u003c/a\u003e: one to turn of all the lights and one to slowly fade them on which I’ve scheduled for the morning. Both are using the \u003ca href=\"https://dresden-elektronik.github.io/deconz-rest-doc/\" target=\"_blank\"\u003eREST API\u003c/a\u003e which was straightforward. Would do again!\u003c/p\u003e\n\n  \u003cp\u003e\u003cspan class=\"date\"\u003eNov 2022\u003c/span\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e",
  "Date": "2022-11-01T00:00:00Z",
  "Author": "bou.ke"
}