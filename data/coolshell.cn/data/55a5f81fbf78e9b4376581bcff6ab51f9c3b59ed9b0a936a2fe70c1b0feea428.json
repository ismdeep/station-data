{
  "Source": "coolshell.cn",
  "Title": "面向对象的Shell脚本",
  "Link": "https://coolshell.cn/articles/5035.html",
  "Content": "\u003cdiv class=\"entry-content\"\u003e\n\u003cp\u003e\u003cscript async=\"\" src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3415450859608158\" crossorigin=\"anonymous\" type=\"c163fdab98552663c5c8ad5e-text/javascript\"\u003e\u003c/script\u003e还记得以前那个用\u003ca title=\"检查素数的正则表达式\" href=\"https://coolshell.cn/articles/2704.html\" target=\"_blank\"\u003e算素数的正则表达式\u003c/a\u003e吗？编程这个世界太有趣了，总是能看到一些即别出心裁的东西。你有没有想过在写Shell脚本的时候可以把你的变量和函数放到一个类中？不要以为这不可能，这不，我在\u003ca href=\"http://lab.madscience.nl/oo.sh.txt\" target=\"_blank\"\u003e网上\u003c/a\u003e又看到了一个把Shell脚本整成面向对象的东西。Shell本来是不支持的，需要自己做点东西，能搞出这个事事的人真的是hacker啊。\u003c/p\u003e\n\u003cp\u003e当然，这里并不是真正的面向对象，因为其只是封装罢了，还没有支持继承和多态。最变态的是他居然还支持typeid，靠！\u003c/p\u003e\n\u003cp\u003e下面让我们看看他是怎么来做的。下面的脚本可能会有点费解。本想解释一下，后来想想，还是大家自己专研一下吧，其实看懂也不难，给大家提几个点吧。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e我们可以看到，下面的这个脚本定义了class,  func, var, new 等函数，其实这些就是所谓的关键字。\u003c/li\u003e\n\u003cli\u003eclass是一个函数，主要是记录类名。\u003c/li\u003e\n\u003cli\u003efunc和var实际上是把成员函数名和成员变量记成有相同前缀的各种变量。\u003c/li\u003e\n\u003cli\u003enew方法主要是记录实例。大家重点看看new函数里的那个for循环，最核心的就在那里了。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv\u003e脚本如下所示：\u003c/div\u003e\n\u003cdiv\u003e\u003cspan id=\"more-5035\"\u003e\u003c/span\u003e\u003c/div\u003e\n\u003cpre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\"\u003e#!/bin/bash\n\n# -------------------------------------------------------------------\n# OO support functions\n# Kludged by Pim van Riezen \u0026lt;\u003ca href=\"/cdn-cgi/l/email-protection\" class=\"__cf_email__\" data-cfemail=\"62120b220f030611010b070c01074c0c0e\"\u003e[email protected]\u003c/a\u003e\u0026gt;\n# -------------------------------------------------------------------\nDEFCLASS=\u0026#34;\u0026#34;\nCLASS=\u0026#34;\u0026#34;\nTHIS=0\n\nclass() {\n  DEFCLASS=\u0026#34;$1\u0026#34;\n  eval CLASS_${DEFCLASS}_VARS=\u0026#34;\u0026#34;\n  eval CLASS_${DEFCLASS}_FUNCTIONS=\u0026#34;\u0026#34;\n}\n\nstatic() {\n  return 0\n}\n\nfunc() {\n  local varname=\u0026#34;CLASS_${DEFCLASS}_FUNCTIONS\u0026#34;\n  eval \u0026#34;$varname=\\\u0026#34;\\${$varname}$1 \\\u0026#34;\u0026#34;\n}\n\nvar() {\n  local varname=\u0026#34;CLASS_${DEFCLASS}_VARS\u0026#34;\n  eval $varname=\u0026#34;\\\u0026#34;\\${$varname}$1 \\\u0026#34;\u0026#34;\n}\n\nloadvar() {\n  eval \u0026#34;varlist=\\\u0026#34;\\$CLASS_${CLASS}_VARS\\\u0026#34;\u0026#34;\n  for var in $varlist; do\n    eval \u0026#34;$var=\\\u0026#34;\\$INSTANCE_${THIS}_$var\\\u0026#34;\u0026#34;\n  done\n}\n\nloadfunc() {\n  eval \u0026#34;funclist=\\\u0026#34;\\$CLASS_${CLASS}_FUNCTIONS\\\u0026#34;\u0026#34;\n  for func in $funclist; do\n    eval \u0026#34;${func}() { ${CLASS}::${func} \\\u0026#34;\\$*\\\u0026#34;; return \\$?; }\u0026#34;\n  done\n}\n\nsavevar() {\n  eval \u0026#34;varlist=\\\u0026#34;\\$CLASS_${CLASS}_VARS\\\u0026#34;\u0026#34;\n  for var in $varlist; do\n    eval \u0026#34;INSTANCE_${THIS}_$var=\\\u0026#34;\\$$var\\\u0026#34;\u0026#34;\n  done\n}\n\ntypeof() {\n  eval echo \\$TYPEOF_$1\n}\n\nnew() {\n  local\n  local cvar=\u0026#34;$2\u0026#34;\n  shift\n  shift\n  local id=$(uuidgen | tr A-F a-f | sed -e \u0026#34;s/-//g\u0026#34;)\n  eval TYPEOF_${id}=$class\n  eval $cvar=$id\n  local funclist\n  eval \u0026#34;funclist=\\\u0026#34;\\$CLASS_${class}_FUNCTIONS\\\u0026#34;\u0026#34;\n  for func in $funclist; do\n    eval \u0026#34;${cvar}.${func}() {\n      local t=\\$THIS; THIS=$id; local c=\\$CLASS; CLASS=$class; loadvar;\n      loadfunc; ${class}::${func} \\\u0026#34;\\$*\\\u0026#34;; rt=\\$?; savevar; CLASS=\\$c;\n      THIS=\\$t; return $rt;\n    }\u0026#34;\n\n  done\n  eval \u0026#34;${cvar}.${class} \\\u0026#34;\\$*\\\u0026#34; || true\u0026#34;\n}\u003c/pre\u003e\n\u003cp\u003e下面，让我们来看看例程吧。\u003c/p\u003e\n\u003cpre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\"\u003e# -------------------------------------------------------------------\n# Example code\n# -------------------------------------------------------------------\n\n# class definition\nclass Storpel\n  func Storpel\n  func setName\n  func setQuality\n  func print\n  var name\n  var quality\n\n# class implementation\nStorpel::Storpel() {\n  setName \u0026#34;$1\u0026#34;\n  setQuality \u0026#34;$2\u0026#34;\n  if [ -z \u0026#34;$name\u0026#34; ]; then setName \u0026#34;Generic\u0026#34;; fi\n  if [ -z \u0026#34;$quality\u0026#34; ]; then setQuality \u0026#34;Normal\u0026#34;; fi\n}\n\nStorpel::setName() { name=\u0026#34;$1\u0026#34;; }\nStorpel::setQuality() { quality=\u0026#34;$1\u0026#34;; }\nStorpel::print() { echo \u0026#34;$name ($quality)\u0026#34;; }\n\n# usage\nnew Storpel one \u0026#34;Storpilator 1000\u0026#34; Medium\nnew Storpel two\nnew Storpel three\n\ntwo.setName \u0026#34;Storpilator 2000\u0026#34;\ntwo.setQuality \u0026#34;Strong\u0026#34;\n\none.print\ntwo.print\nthree.print\n\necho \u0026#34;\u0026#34;\n\necho \u0026#34;one: $one ($(typeof $one))\u0026#34;\necho \u0026#34;two: $two ($(typeof $two))\u0026#34;\necho \u0026#34;three: $three ($(typeof $two))\u0026#34;\u003c/pre\u003e\n\u003cp\u003e \u003c/p\u003e\n\u003cp\u003e（全文完）\u003c/p\u003e\n\u003cdiv style=\"margin-top: 15px; font-size: 16px;color: #cc0000;\"\u003e\n\u003cp align=\"center\"\u003e\u003cstrong\u003e（转载本站文章请注明作者和出处 \u003ca href=\"https://coolshell.cn/\"\u003e酷 壳 – CoolShell\u003c/a\u003e ，请勿用于任何商业用途）\u003c/strong\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"wp_rp_wrap  wp_rp_vertical_m\" id=\"wp_rp_first\"\u003e\u003cdiv class=\"wp_rp_content\"\u003e\u003ch3 class=\"related_post_title\"\u003e相关文章\u003c/h3\u003e\u003cul class=\"related_post wp_rp\"\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/19219.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/uploads/2019/03/linux.ninja_-150x150.png\" alt=\"打造高效的工作环境 – Shell 篇\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/19219.html\" class=\"wp_rp_title\"\u003e打造高效的工作环境 – Shell 篇\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/9410.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/uploads/2013/04/figure1-150x150.gif\" alt=\"Unix考古记：一个“遗失”的shell\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/9410.html\" class=\"wp_rp_title\"\u003eUnix考古记：一个“遗失”的shell\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/9070.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/uploads/2013/02/awk-150x150.jpg\" alt=\"AWK 简明教程\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/9070.html\" class=\"wp_rp_title\"\u003eAWK 简明教程\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/8883.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/uploads/2013/01/linux-bash-300x225-150x150.jpg\" alt=\"应该知道的Linux技巧\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/8883.html\" class=\"wp_rp_title\"\u003e应该知道的Linux技巧\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/8745.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/plugins/wordpress-23-related-posts-plugin/static/thumbs/8.jpg\" alt=\"如此理解面向对象编程\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/8745.html\" class=\"wp_rp_title\"\u003e如此理解面向对象编程\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/8619.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/uploads/2012/11/shell.01-150x150.png\" alt=\"你可能不知道的Shell\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/8619.html\" class=\"wp_rp_title\"\u003e你可能不知道的Shell\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv id=\"post-ratings-5035\" class=\"post-ratings\" itemscope=\"\" itemtype=\"https://schema.org/Article\" data-nonce=\"a6ad6e1595\"\u003e\u003cimg id=\"rating_5035_1\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif\" alt=\"好烂啊\" title=\"好烂啊\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5035, 1, \u0026#39;好烂啊\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.3, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-c163fdab98552663c5c8ad5e-=\"\"/\u003e\u003cimg id=\"rating_5035_2\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif\" alt=\"有点差\" title=\"有点差\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5035, 2, \u0026#39;有点差\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.3, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-c163fdab98552663c5c8ad5e-=\"\"/\u003e\u003cimg id=\"rating_5035_3\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif\" alt=\"凑合看看\" title=\"凑合看看\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5035, 3, \u0026#39;凑合看看\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.3, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-c163fdab98552663c5c8ad5e-=\"\"/\u003e\u003cimg id=\"rating_5035_4\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_half.gif\" alt=\"还不错\" title=\"还不错\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5035, 4, \u0026#39;还不错\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.3, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-c163fdab98552663c5c8ad5e-=\"\"/\u003e\u003cimg id=\"rating_5035_5\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_off.gif\" alt=\"很精彩\" title=\"很精彩\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5035, 5, \u0026#39;很精彩\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.3, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-c163fdab98552663c5c8ad5e-=\"\"/\u003e (\u003cstrong\u003e15\u003c/strong\u003e 人打了分，平均分： \u003cstrong\u003e3.33\u003c/strong\u003e )\u003cbr/\u003e\u003cspan class=\"post-ratings-text\" id=\"ratings_5035_text\"\u003e\u003c/span\u003e\u003cmeta itemprop=\"name\" content=\"面向对象的Shell脚本\"/\u003e\u003cmeta itemprop=\"headline\" content=\"面向对象的Shell脚本\"/\u003e\u003cmeta itemprop=\"description\" content=\"还记得以前那个用算素数的正则表达式吗？编程这个世界太有趣了，总是能看到一些即别出心裁的东西。你有没有想过在写Shell脚本的时候可以把你的变量和函数放到一个类中？不要以为这不可能，这不，我在网上又看到了一个把Shell脚本整成面向对象的东西。Shell本来是不支持的，需要自己做点东西，能搞出这个事事的人真的是hacker啊。\n\n当然，这里并不是真正的面向对象，因为其只是封装罢了，还没有支持继承...\"/\u003e\u003cmeta itemprop=\"datePublished\" content=\"2011-07-21T12:39:11+08:00\"/\u003e\u003cmeta itemprop=\"dateModified\" content=\"2011-07-20T23:27:19+08:00\"/\u003e\u003cmeta itemprop=\"url\" content=\"https://coolshell.cn/articles/5035.html\"/\u003e\u003cmeta itemprop=\"author\" content=\"陈皓\"/\u003e\u003cmeta itemprop=\"mainEntityOfPage\" content=\"https://coolshell.cn/articles/5035.html\"/\u003e\u003cdiv style=\"display: none;\" itemprop=\"publisher\" itemscope=\"\" itemtype=\"https://schema.org/Organization\"\u003e\u003cmeta itemprop=\"name\" content=\"酷 壳 - CoolShell\"/\u003e\u003cmeta itemprop=\"url\" content=\"https://coolshell.cn\"/\u003e\u003cdiv itemprop=\"logo\" itemscope=\"\" itemtype=\"https://schema.org/ImageObject\"\u003e\u003cmeta itemprop=\"url\" content=\"\"/\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv style=\"display: none;\" itemprop=\"aggregateRating\" itemscope=\"\" itemtype=\"https://schema.org/AggregateRating\"\u003e\u003cmeta itemprop=\"bestRating\" content=\"5\"/\u003e\u003cmeta itemprop=\"worstRating\" content=\"1\"/\u003e\u003cmeta itemprop=\"ratingValue\" content=\"3.33\"/\u003e\u003cmeta itemprop=\"ratingCount\" content=\"15\"/\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv id=\"post-ratings-5035-loading\" class=\"post-ratings-loading\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif\" width=\"16\" height=\"16\" class=\"post-ratings-image\"/\u003eLoading...\u003c/div\u003e\n\u003c/div\u003e",
  "Date": "2011-07-21T12:39:11+08:00",
  "Author": "陈皓"
}