{
  "Source": "coolshell.cn",
  "Title": "千万不要把 bool 设计成函数参数",
  "Link": "https://coolshell.cn/articles/5444.html",
  "Content": "\u003cdiv class=\"entry-content\"\u003e\n\u003cp\u003e\u003cscript async=\"\" src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3415450859608158\" crossorigin=\"anonymous\" type=\"64c50b4205479cad54ffe257-text/javascript\"\u003e\u003c/script\u003e我们有很多Coding Style 或 代码规范。但这一条可能会经常被我们所遗忘，就是我们经常会在函数的参数里使用bool参数，这会大大地降低代码的可读性。不信？我们先来看看下面的代码。\u003c/p\u003e\n\u003cp\u003e当你读到下面的代码，你会觉得这个代码是什么意思？\u003c/p\u003e\n\u003cp\u003e\u003ccode data-enlighter-language=\"c\" class=\"EnlighterJSRAW\"\u003ewidget-\u0026gt;repaint(false);\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e是不要repaint吗？还是别的什么意思？看了文档后，我们才知道这个参数是immediate， 也就是说，false代表不立即重画，true代码立即重画。\u003c/p\u003e\n\u003cp\u003eWindows API中也有这样一个函数：InvalidateRect，当你看到下面的代码，你会觉得是什么意思？\u003c/p\u003e\n\u003cp\u003e\u003ccode data-enlighter-language=\"c\" class=\"EnlighterJSRAW\"\u003eInvalidateRect(hwnd, lpRect,  false);\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e我们先不说InvalidateRect这个函数名取得有多糟糕，我们先说一下那个false参数？invalidate意为“让XXX无效”，false是什么意思？双重否定？是肯定的意思？如果你看到这样的代码，你会相当的费解的。于是，你要去看一下文档，或是InvalidateRect的函数定义，你会看到那个参数是 \u003cstrong\u003eBOOL\u003c/strong\u003e\u003cem\u003e bErase\u003c/em\u003e，意思是，是否要重画背景。\u003c/p\u003e\n\u003cp\u003e这样的事情有很多，再看下面的代码，想把str中的”%USER%”替换成真实的用户名：\u003c/p\u003e\n\u003cp\u003e\u003ccode data-enlighter-language=\"c\" class=\"EnlighterJSRAW\"\u003estr.replace(\u0026#34;%USER%\u0026#34;, user, false); // Qt 3\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eTNND，那个false是什么意思？不替换吗？还是别的什么意思，看了文档才知道，false代码大小写不敏感的替换。\u003c/p\u003e\n\u003cp\u003e其实，如果你使用枚举变量/常量，而不是bool变量，你会让你的代码更易读，如：\u003c/p\u003e\n\u003cp\u003e\u003cspan id=\"more-5444\"\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cpre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\"\u003ewidget-\u0026gt;repaint(PAINT::immediate);\nwidget-\u0026gt;repaint(PAINT::deffer);\n\nInvalidateRect(hwnd, lpRect,  !RepantBackground);\n\nstr.replace(\u0026#34;%USER%\u0026#34;, user, Qt::CaseInsensitive); // Qt 4\u003c/pre\u003e\n\u003cp\u003e如果对这个事不以为然的话，我们再来看一些别的示例，你不妨猜猜看看下面的代码：\u003c/p\u003e\n\u003cp\u003e\u003ccode data-enlighter-language=\"c\" class=\"EnlighterJSRAW\"\u003ecomponent.setCentered(true, false);\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e这什么玩意儿啊？看了文档你才知道，这原来是 setCentered(centered, autoUpdate);\u003c/p\u003e\n\u003cp\u003e\u003ccode data-enlighter-language=\"c\" class=\"EnlighterJSRAW\"\u003enew Textbox(300, 100, false, true);\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e这又是什么啊？看了文档才知道，这是创建一个文本框，第三个参数是是否要滚动条，第四个是是否要自动换行。TNND。\u003c/p\u003e\n\u003cp\u003e上面的情况还不算最差，看看下面的双重否定。\u003c/p\u003e\n\u003cpre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\"\u003ecomponent.setDisabled(false);\nfilter.setCaseInsensitive(false)\u003c/pre\u003e\n\u003cp\u003e再来一个，如果你读到下面的代码，相信你会和我一样，要么石化了，要么凌乱了。\u003c/p\u003e\n\u003cpre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\"\u003eevent.initKeyEvent(\u0026#34;keypress\u0026#34;, true, true, null, null,\n                    false, false, false, false, 9, 0); \u003c/pre\u003e\n\u003cp\u003e看完这篇文章，我希望你再也不要把bool为作为函数参数了。除非两个原因：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e你100%确认不会带来阅读上的问题，比如Java的 setVisible (bool).\u003c/li\u003e\n\u003cli\u003e你100%确认你想去\u003ca title=\"如何写出无法维护的代码\" href=\"https://coolshell.cn/articles/4758.html\" target=\"_blank\"\u003e写出无法维护很难阅读的代码\u003c/a\u003e。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e【更新2011/9/8】当然，别的参数也会有一样的问题，比如：\u003ccode\u003enew Textbox(300, 100, false, true);\u003c/code\u003e中的300 和 100，不知道是坐标还是长宽，只不过，一般长度或坐标这样的参数都不会被hard code，都会有变量名，而bool这种参数经常性地被传成true 和 false。 bool参数表现得更为明显一些罢了。\u003c/p\u003e\n\u003cp\u003e\u003cspan style=\"color: #cc0000;\"\u003e所以，程序中不要出现magic number，true/false 也是一种 magic number。但是，我想告诉大家，从API设计的角度来说，你无法强制调用者用常量来取代true/false，定义成枚举类型是最好的选择\u003c/span\u003e。\u003c/p\u003e\n\u003cp\u003e最后，如果你想设计一个好的API，强烈推荐你读一下Nokia的Qt的《\u003ca href=\"http://qt-project.org/wiki/API-Design-Principles\" target=\"_blank\"\u003eAPI Design Principles\u003c/a\u003e》，本文就是其中的“\u003ca href=\"http://developer.qt.nokia.com/wiki/API_Design_Principles#e7794937cba47d5e9c54d50a6a32328b\" target=\"_blank\"\u003eBoolean Trap\u003c/a\u003e”。\u003c/p\u003e\n\u003cp\u003e（全文完）\u003c/p\u003e\n\u003cdiv style=\"margin-top: 15px; font-size: 16px;color: #cc0000;\"\u003e\n\u003cp align=\"center\"\u003e\u003cstrong\u003e（转载本站文章请注明作者和出处 \u003ca href=\"https://coolshell.cn/\"\u003e酷 壳 – CoolShell\u003c/a\u003e ，请勿用于任何商业用途）\u003c/strong\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"wp_rp_wrap  wp_rp_vertical_m\" id=\"wp_rp_first\"\u003e\u003cdiv class=\"wp_rp_content\"\u003e\u003ch3 class=\"related_post_title\"\u003e相关文章\u003c/h3\u003e\u003cul class=\"related_post wp_rp\"\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/18024.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/uploads/2017/07/api-design-300x278-2-150x150.jpg\" alt=\"API设计原则 – Qt官网的设计实践总结\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/18024.html\" class=\"wp_rp_title\"\u003eAPI设计原则 – Qt官网的设计实践总结\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/17680.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/uploads/2017/02/gitlab-600-150x150.jpg\" alt=\"从Gitlab误删除数据库想到的\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/17680.html\" class=\"wp_rp_title\"\u003e从Gitlab误删除数据库想到的\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/17459.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/uploads/2016/08/HighAvailability-BK-150x150.png\" alt=\"关于高可用的系统\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/17459.html\" class=\"wp_rp_title\"\u003e关于高可用的系统\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/9949.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/uploads/2013/07/inverted-bookshelf_thumb-150x150.jpg\" alt=\"IoC/DIP其实是一种管理思想\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/9949.html\" class=\"wp_rp_title\"\u003eIoC/DIP其实是一种管理思想\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/6775.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/plugins/wordpress-23-related-posts-plugin/static/thumbs/24.jpg\" alt=\"Bret Victor – Inventing on Principle\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/6775.html\" class=\"wp_rp_title\"\u003eBret Victor – Inventing on Principle\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://coolshell.cn/articles/5686.html\" class=\"wp_rp_thumbnail\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/plugins/wordpress-23-related-posts-plugin/static/thumbs/15.jpg\" alt=\"多些时间能少写些代码\" width=\"150\" height=\"150\"/\u003e\u003c/a\u003e\u003ca href=\"https://coolshell.cn/articles/5686.html\" class=\"wp_rp_title\"\u003e多些时间能少写些代码\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv id=\"post-ratings-5444\" class=\"post-ratings\" itemscope=\"\" itemtype=\"https://schema.org/Article\" data-nonce=\"c188b5df01\"\u003e\u003cimg id=\"rating_5444_1\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif\" alt=\"好烂啊\" title=\"好烂啊\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5444, 1, \u0026#39;好烂啊\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.8, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-64c50b4205479cad54ffe257-=\"\"/\u003e\u003cimg id=\"rating_5444_2\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif\" alt=\"有点差\" title=\"有点差\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5444, 2, \u0026#39;有点差\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.8, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-64c50b4205479cad54ffe257-=\"\"/\u003e\u003cimg id=\"rating_5444_3\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif\" alt=\"凑合看看\" title=\"凑合看看\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5444, 3, \u0026#39;凑合看看\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.8, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-64c50b4205479cad54ffe257-=\"\"/\u003e\u003cimg id=\"rating_5444_4\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_half.gif\" alt=\"还不错\" title=\"还不错\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5444, 4, \u0026#39;还不错\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.8, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-64c50b4205479cad54ffe257-=\"\"/\u003e\u003cimg id=\"rating_5444_5\" src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_off.gif\" alt=\"很精彩\" title=\"很精彩\" onmouseover=\"if (!window.__cfRLUnblockHandlers) return false; current_rating(5444, 5, \u0026#39;很精彩\u0026#39;);\" onmouseout=\"if (!window.__cfRLUnblockHandlers) return false; ratings_off(3.8, 4, 0);\" onclick=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" onkeypress=\"if (!window.__cfRLUnblockHandlers) return false; rate_post();\" style=\"cursor: pointer; border: 0px;\" data-cf-modified-64c50b4205479cad54ffe257-=\"\"/\u003e (\u003cstrong\u003e32\u003c/strong\u003e 人打了分，平均分： \u003cstrong\u003e3.78\u003c/strong\u003e )\u003cbr/\u003e\u003cspan class=\"post-ratings-text\" id=\"ratings_5444_text\"\u003e\u003c/span\u003e\u003cmeta itemprop=\"name\" content=\"千万不要把 bool 设计成函数参数\"/\u003e\u003cmeta itemprop=\"headline\" content=\"千万不要把 bool 设计成函数参数\"/\u003e\u003cmeta itemprop=\"description\" content=\"我们有很多Coding Style 或 代码规范。但这一条可能会经常被我们所遗忘，就是我们经常会在函数的参数里使用bool参数，这会大大地降低代码的可读性。不信？我们先来看看下面的代码。\n\n当你读到下面的代码，你会觉得这个代码是什么意思？\n\n[c]widget-\u0026gt;repaint(false);[/c]\n\n是不要repaint吗？还是别的什么意思？看了文档后，我们才知道这个参数是imme...\"/\u003e\u003cmeta itemprop=\"datePublished\" content=\"2011-09-08T15:35:18+08:00\"/\u003e\u003cmeta itemprop=\"dateModified\" content=\"2012-07-11T18:09:47+08:00\"/\u003e\u003cmeta itemprop=\"url\" content=\"https://coolshell.cn/articles/5444.html\"/\u003e\u003cmeta itemprop=\"author\" content=\"陈皓\"/\u003e\u003cmeta itemprop=\"mainEntityOfPage\" content=\"https://coolshell.cn/articles/5444.html\"/\u003e\u003cdiv style=\"display: none;\" itemprop=\"publisher\" itemscope=\"\" itemtype=\"https://schema.org/Organization\"\u003e\u003cmeta itemprop=\"name\" content=\"酷 壳 - CoolShell\"/\u003e\u003cmeta itemprop=\"url\" content=\"https://coolshell.cn\"/\u003e\u003cdiv itemprop=\"logo\" itemscope=\"\" itemtype=\"https://schema.org/ImageObject\"\u003e\u003cmeta itemprop=\"url\" content=\"\"/\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv style=\"display: none;\" itemprop=\"aggregateRating\" itemscope=\"\" itemtype=\"https://schema.org/AggregateRating\"\u003e\u003cmeta itemprop=\"bestRating\" content=\"5\"/\u003e\u003cmeta itemprop=\"worstRating\" content=\"1\"/\u003e\u003cmeta itemprop=\"ratingValue\" content=\"3.78\"/\u003e\u003cmeta itemprop=\"ratingCount\" content=\"32\"/\u003e\u003c/div\u003e\u003c/div\u003e\u003cdiv id=\"post-ratings-5444-loading\" class=\"post-ratings-loading\"\u003e\u003cimg src=\"https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif\" width=\"16\" height=\"16\" class=\"post-ratings-image\"/\u003eLoading...\u003c/div\u003e\n\u003c/div\u003e",
  "Date": "2011-09-08T15:35:18+08:00",
  "Author": "陈皓"
}