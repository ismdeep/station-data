{
  "Source": "donaldfeury.xyz",
  "Title": "Stack Videos With FFmpeg",
  "Link": "https://donaldfeury.xyz/stack-videos-with-ffmpeg/",
  "Content": "\u003csection class=\"gh-content gh-canvas\"\u003e\n        \u003cp\u003eSomething I had to figure how to do recently to make a Fiverr gig promo video was stack videos together.\u003c/p\u003e\u003cp\u003eThis is when you see two or more videos playing side by side at the same time. It is often used to compare before and after results, such as what I did.\u003c/p\u003e\u003cfigure class=\"kg-card kg-embed-card\"\u003e\u003ciframe width=\"200\" height=\"113\" src=\"https://www.youtube.com/embed/659dOQPwfdQ?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\"\u003e\u003c/iframe\u003e\u003c/figure\u003e\u003ch2 id=\"horizontal-stacking\"\u003eHorizontal Stacking\u003c/h2\u003e\u003cp\u003eSo what does it look like to stack two videos together horizontally? It looks something like this:\u003c/p\u003e\u003cfigure class=\"kg-card kg-image-card\"\u003e\u003cimg src=\"https://dev-to-uploads.s3.amazonaws.com/i/hcezgtwcwwb57pp73i6x.jpg\" class=\"kg-image\" alt=\"Horizontal Stack Example\" loading=\"lazy\"/\u003e\u003c/figure\u003e\u003cp\u003eLet\u0026#39;s see how we achieve this result:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-sh\"\u003effmpeg -i video1.mp4 -i video2.mp4 -filter_complex \\\n\u0026#34;[0:v][1:v]hstack=inputs=2:shortest=1[outv]\u0026#34; \\\n-map \u0026#34;[outv]\u0026#34; hstacked.mp4\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eYou\u0026#39;ll see we are passing in two videos as inputs with the \u003ccode\u003e-i\u003c/code\u003e option, video1.mp4, and video2.mp4.\u003c/p\u003e\u003cp\u003eFor the filter graph we have:\u003c/p\u003e\u003cblockquote\u003e\u0026#34;[0:v][1:v]hstack=inputs=2:shortest=1[outv]\u0026#34;\u003c/blockquote\u003e\u003cp\u003eWe are taking the video streams from the two inputs and passing them into the \u003cstrong\u003ehstack\u003c/strong\u003e filter. The inputs option indicates how many video streams are being used as inputs (defaults to 2) and the shortest option indicates how long the output video stream will be. By default, it will be the length of the longest video stream. Setting \u003ccode\u003eshortest=1\u003c/code\u003e will make it the length of the shortest video stream instead.\u003c/p\u003e\u003cp\u003eAfter that, we just map the video stream created from hstack to the output file and you\u0026#39;re good to go.\u003c/p\u003e\u003cp\u003eOne thing about using \u003cstrong\u003ehstack\u003c/strong\u003e taken from the FFmpeg filter documentation:\u003c/p\u003e\u003cblockquote\u003eAll streams must be of same pixel format and of same height\u003c/blockquote\u003e\u003cp\u003eIf I recall, this means the videos have to be the same height and have the same encoding. Otherwise, the output just doesn\u0026#39;t work.\u003c/p\u003e\u003ch2 id=\"vertical-stacking\"\u003eVertical Stacking\u003c/h2\u003e\u003cp\u003eLet\u0026#39;s see what vertically stacked videos looks like:\u003c/p\u003e\u003cfigure class=\"kg-card kg-image-card\"\u003e\u003cimg src=\"https://dev-to-uploads.s3.amazonaws.com/i/el2h2ibt5u1m24de61kd.jpg\" class=\"kg-image\" alt=\"Vertically Stacked Videos\" loading=\"lazy\"/\u003e\u003c/figure\u003e\u003cp\u003eLet\u0026#39;s see how we achieve this result:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-sh\"\u003effmpeg -i video1.mp4 -i video2.mp4 -filter_complex \\\n\u0026#34;[0:v][1:v]vstack=inputs=2:shortest=1[outv]\u0026#34; \\\n-map \u0026#34;[outv]\u0026#34; hstacked.mp4\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis is almost the same as horizontal stacking but we use \u003cstrong\u003evstack\u003c/strong\u003e instead of \u003cstrong\u003ehstack\u003c/strong\u003e, even the arguments are the same.\u003c/p\u003e\u003cp\u003eThe \u003cstrong\u003evstack\u003c/strong\u003e filter has the same conditions as \u003cstrong\u003ehstack\u003c/strong\u003e but they have to be the same width, instead of height.\u003c/p\u003e\u003ch2 id=\"combining-stacks\"\u003eCombining Stacks\u003c/h2\u003e\u003cp\u003eA weird idea I had after playing around with these was to combine them. After doing so I got this result:\u003c/p\u003e\u003cfigure class=\"kg-card kg-image-card\"\u003e\u003cimg src=\"https://dev-to-uploads.s3.amazonaws.com/i/ko3im7c4seyfbra8b155.jpg\" class=\"kg-image\" alt=\"Double Stacked Videos\" loading=\"lazy\"/\u003e\u003c/figure\u003e\u003cp\u003eThat\u0026#39;s pretty interesting, looks like a 2x2 grid of videos playing.\u003c/p\u003e\u003cp\u003eNow, how did we achieve this effect?\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-sh\"\u003effmpeg -i video1.mp4 -i video2.mp4 -i video3.mp4 -filter_complex \\\n\u0026#34;[0:v][1:v]hstack=inputs=2:shortest=1[row1];\n[0:v][2:v]hstack=inputs=2:shortest=1[row2];\n[row1][row2]vstack=inputs=2:shortest=1[outv]\u0026#34; \\\n-map \u0026#34;[outv]\u0026#34; ow-creation-double-stack.mp4\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eLet\u0026#39;s go over the filter graph:\u003c/p\u003e\u003cblockquote\u003e[0:v][1:v]hstack=inputs=2:shortest=1[row1]\u003c/blockquote\u003e\u003cp\u003eHere we are horizontally stacking the first video stream and the second video stream and calling the new stream [row1].\u003c/p\u003e\u003cblockquote\u003e[0:v][2:v]hstack=inputs=2:shortest=1[row2]\u003c/blockquote\u003e\u003cp\u003eNext, we horizontally stack the first video stream with the third video stream and call that new stream [row2].\u003c/p\u003e\u003cblockquote\u003e[row1][row2]vstack=inputs=2:shortest=1[outv]\u003c/blockquote\u003e\u003cp\u003eFinally, we take the two horizontally stacked video streams, and vertically stack them on top of each other! That is pretty neat.\u003c/p\u003e\u003cp\u003eWith that, you should be able to horizontally and vertically stack videos with \u003cstrong\u003eFFmpeg\u003c/strong\u003e!\u003c/p\u003e\u003cp\u003eThank you for reading!\u003c/p\u003e\u003chr/\u003e\u003cp\u003eDid you find this information useful? If so, consider heading over to my \u003ca href=\"https://donaldfeury.xyz/donate/\"\u003edonation\u003c/a\u003e page and drop me some support.\u003c/p\u003e\u003cp\u003eWant to ask a question or just chat? Contact me \u003ca href=\"https://donaldfeury.xyz/contact\"\u003ehere\u003c/a\u003e\u003c/p\u003e\n    \u003c/section\u003e",
  "Date": "2021-06-27T01:44:45Z",
  "Author": "Donald Feury"
}