{
  "Source": "dunwu",
  "Title": "Ehcache 快速入门",
  "Link": "https://dunwu.github.io/blog/pages/5f7893/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"Ehcache-快速入门\"\u003e\u003ca href=\"#Ehcache-快速入门\" class=\"headerlink\" title=\"Ehcache 快速入门\"\u003e\u003c/a\u003eEhcache 快速入门\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003eEhCache 是一个纯 Java 的进程内缓存框架，具有快速、精干等特点，是 Hibernate 中默认的 CacheProvider。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/technology/cache/ehcache-architecture.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"一、简介\"\u003e\u003ca href=\"#一、简介\" class=\"headerlink\" title=\"一、简介\"\u003e\u003c/a\u003e一、简介\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003eEhcache 虽然也支持分布式模式，但是分布式方案不是很好好，建议只将其作为单机的进程内缓存使用。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"Ehcache-特性\"\u003e\u003ca href=\"#Ehcache-特性\" class=\"headerlink\" title=\"Ehcache 特性\"\u003e\u003c/a\u003eEhcache 特性\u003c/h3\u003e\u003cp\u003e优点\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e快速、简单\u003c/li\u003e\n\u003cli\u003e支持多种缓存策略：LRU、LFU、FIFO 淘汰算法\u003c/li\u003e\n\u003cli\u003e缓存数据有两级：内存和磁盘，因此无需担心容量问题\u003c/li\u003e\n\u003cli\u003e缓存数据会在虚拟机重启的过程中写入磁盘\u003c/li\u003e\n\u003cli\u003e可以通过 RMI、可插入 API 等方式进行分布式缓存\u003c/li\u003e\n\u003cli\u003e具有缓存和缓存管理器的侦听接口\u003c/li\u003e\n\u003cli\u003e支持多缓存管理器实例，以及一个实例的多个缓存区域\u003c/li\u003e\n\u003cli\u003e提供 Hibernate 的缓存实现\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e缺点\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e使用磁盘 Cache 的时候非常占用磁盘空间\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e不保证数据的安全\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e虽然支持分布式缓存，但效率不高（通过组播方式，在不同节点之间同步数据）。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"Ehcache-集群\"\u003e\u003ca href=\"#Ehcache-集群\" class=\"headerlink\" title=\"Ehcache 集群\"\u003e\u003c/a\u003eEhcache 集群\u003c/h3\u003e\u003cp\u003eEhcache 目前支持五种集群方式：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRMI\u003c/li\u003e\n\u003cli\u003eJMS\u003c/li\u003e\n\u003cli\u003eJGroup\u003c/li\u003e\n\u003cli\u003eTerracotta\u003c/li\u003e\n\u003cli\u003eEhcache Server\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"RMI\"\u003e\u003ca href=\"#RMI\" class=\"headerlink\" title=\"RMI\"\u003e\u003c/a\u003eRMI\u003c/h4\u003e\u003cp\u003e使用组播方式通知所有节点同步数据。\u003c/p\u003e\n\u003cp\u003e如果网络有问题，或某台服务宕机，则存在数据无法同步的可能，导致数据不一致。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://www.ehcache.org/images/documentation/rmi_replication.png\" alt=\"Ehcache Image\"/\u003e\u003c/p\u003e\n\u003ch4 id=\"JMS\"\u003e\u003ca href=\"#JMS\" class=\"headerlink\" title=\"JMS\"\u003e\u003c/a\u003eJMS\u003c/h4\u003e\u003cp\u003eJMS 类似 MQ，所有节点订阅消息，当某节点缓存发生变化，就向 JMS 发消息，其他节点感知变化后，同步数据。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://www.ehcache.org/images/documentation/jms_replication.png\" alt=\"Ehcache Image\"/\u003e\u003c/p\u003e\n\u003ch4 id=\"Cache-Server\"\u003e\u003ca href=\"#Cache-Server\" class=\"headerlink\" title=\"Cache Server\"\u003e\u003c/a\u003eCache Server\u003c/h4\u003e\u003cp\u003e\u003cimg src=\"https://www.ehcache.org/images/documentation/loadbalancer_hashing.png\" alt=\"Ehcache Image\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"二、快速入门\"\u003e\u003ca href=\"#二、快速入门\" class=\"headerlink\" title=\"二、快速入门\"\u003e\u003c/a\u003e二、快速入门\u003c/h2\u003e\u003ch3 id=\"引入-Ehcache\"\u003e\u003ca href=\"#引入-Ehcache\" class=\"headerlink\" title=\"引入 Ehcache\"\u003e\u003c/a\u003e引入 Ehcache\u003c/h3\u003e\u003cp\u003e如果你的项目使用 maven 管理，添加以下依赖到你的 pom.xml 中。\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003enet.sf.ehcache\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003eehcache\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e2.10.2\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003etype\u003c/span\u003e\u0026gt;\u003c/span\u003epom\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003etype\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e如果你的项目不使用 maven 管理，请在 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.ehcache.org/downloads/\"\u003eEhcache 官网下载地址\u003c/a\u003e 下载 jar 包。\u003c/p\u003e\n\u003cp\u003eSpring 提供了对于 Ehcache 接口的封装，可以更简便的使用其功能。接入方式如下：\u003c/p\u003e\n\u003cp\u003e如果你的项目使用 maven 管理，添加以下依赖到你的\u003cem\u003epom.xml\u003c/em\u003e中。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003espring-context-support\u003c/code\u003e这个 jar 包中含有 Spring 对于缓存功能的抽象封装接口。\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eorg.springframework\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003espring-context-support\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e4.1.4.RELEASE\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"添加配置文件\"\u003e\u003ca href=\"#添加配置文件\" class=\"headerlink\" title=\"添加配置文件\"\u003e\u003c/a\u003e添加配置文件\u003c/h3\u003e\u003cp\u003e（1）在 classpath 下添加 \u003ccode\u003eehcache.xml\u003c/code\u003e\u003cbr/\u003e添加一个名为 \u003cem\u003ehelloworld\u003c/em\u003e 的缓存。\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e\u0026lt;?xml version=\u003cspan class=\"string\"\u003e\u0026#34;1.0\u0026#34;\u003c/span\u003e encoding=\u003cspan class=\"string\"\u003e\u0026#34;UTF-8\u0026#34;\u003c/span\u003e?\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eehcache\u003c/span\u003e \u003cspan class=\"attr\"\u003exmlns:xsi\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e         \u003cspan class=\"attr\"\u003exsi:noNamespaceSchemaLocation\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;http://ehcache.org/ehcache.xsd\u0026#34;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e\u0026lt;!-- 磁盘缓存位置 --\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ediskStore\u003c/span\u003e \u003cspan class=\"attr\"\u003epath\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;java.io.tmpdir/ehcache\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e\u0026lt;!-- 默认缓存 --\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edefaultCache\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e          \u003cspan class=\"attr\"\u003emaxEntriesLocalHeap\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;10000\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e          \u003cspan class=\"attr\"\u003eeternal\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;false\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e          \u003cspan class=\"attr\"\u003etimeToIdleSeconds\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;120\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e          \u003cspan class=\"attr\"\u003etimeToLiveSeconds\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;120\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e          \u003cspan class=\"attr\"\u003emaxEntriesLocalDisk\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;10000000\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e          \u003cspan class=\"attr\"\u003ediskExpiryThreadIntervalSeconds\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;120\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e          \u003cspan class=\"attr\"\u003ememoryStoreEvictionPolicy\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;LRU\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e\u0026lt;!-- helloworld缓存 --\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ecache\u003c/span\u003e \u003cspan class=\"attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;helloworld\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e         \u003cspan class=\"attr\"\u003emaxElementsInMemory\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;1000\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e         \u003cspan class=\"attr\"\u003eeternal\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;false\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e         \u003cspan class=\"attr\"\u003etimeToIdleSeconds\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;5\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e         \u003cspan class=\"attr\"\u003etimeToLiveSeconds\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;5\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e         \u003cspan class=\"attr\"\u003eoverflowToDisk\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;false\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e         \u003cspan class=\"attr\"\u003ememoryStoreEvictionPolicy\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;LRU\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eehcache\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"Ehcache-工作示例\"\u003e\u003ca href=\"#Ehcache-工作示例\" class=\"headerlink\" title=\"Ehcache 工作示例\"\u003e\u003c/a\u003eEhcache 工作示例\u003c/h3\u003e\u003cp\u003eEhcache 会自动加载 \u003ccode\u003eclasspath\u003c/code\u003e 根目录下名为 \u003ccode\u003eehcache.xml\u003c/code\u003e 文件。\u003c/p\u003e\n\u003cp\u003eEhcacheDemo 的工作步骤如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e在 EhcacheDemo 中，我们引用 \u003ccode\u003eehcache.xml\u003c/code\u003e 声明的名为 \u003cem\u003ehelloworld\u003c/em\u003e 的缓存来创建\u003ccode\u003eCache\u003c/code\u003e对象；\u003c/li\u003e\n\u003cli\u003e然后我们用一个键值对来实例化\u003ccode\u003eElement\u003c/code\u003e对象；\u003c/li\u003e\n\u003cli\u003e将\u003ccode\u003eElement\u003c/code\u003e对象添加到\u003ccode\u003eCache\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003e然后用\u003ccode\u003eCache\u003c/code\u003e的 get 方法获取\u003ccode\u003eElement\u003c/code\u003e对象。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eEhcacheDemo\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003emain\u003c/span\u003e\u003cspan class=\"params\"\u003e(String[] args)\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e Exception {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// Create a cache manager\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003ecacheManager\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eCacheManager\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// create the cache called \u0026#34;helloworld\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eCache\u003c/span\u003e \u003cspan class=\"variable\"\u003ecache\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e cacheManager.getCache(\u003cspan class=\"string\"\u003e\u0026#34;helloworld\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// create a key to map the data to\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eString\u003c/span\u003e \u003cspan class=\"variable\"\u003ekey\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;greeting\u0026#34;\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// Create a data element\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eElement\u003c/span\u003e \u003cspan class=\"variable\"\u003eputGreeting\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eElement\u003c/span\u003e(key, \u003cspan class=\"string\"\u003e\u0026#34;Hello, World!\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// Put the element into the data store\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cache.put(putGreeting);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// Retrieve the data element\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eElement\u003c/span\u003e \u003cspan class=\"variable\"\u003egetGreeting\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e cache.get(key);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// Print the value\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        System.out.println(getGreeting.getObjectValue());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e输出\u003c/p\u003e\n\u003cfigure class=\"highlight autohotkey\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eHello,\u003c/span\u003e World!\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"三、Ehcache-API\"\u003e\u003ca href=\"#三、Ehcache-API\" class=\"headerlink\" title=\"三、Ehcache API\"\u003e\u003c/a\u003e三、Ehcache API\u003c/h2\u003e\u003cp\u003e\u003ccode\u003eElement\u003c/code\u003e、\u003ccode\u003eCache\u003c/code\u003e、\u003ccode\u003eCacheManager\u003c/code\u003e是 Ehcache 最重要的 API。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eElement\u003c/code\u003e - 缓存的元素，它维护着一个键值对。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eCache\u003c/code\u003e - 它是 Ehcache 的核心类，它有多个\u003ccode\u003eElement\u003c/code\u003e，并被\u003ccode\u003eCacheManager\u003c/code\u003e管理。它实现了对缓存的逻辑行为。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eCacheManager\u003c/code\u003e - \u003ccode\u003eCache\u003c/code\u003e的容器对象，并管理着\u003ccode\u003eCache\u003c/code\u003e的生命周期。CacheManager 支持两种创建模式：单例（Singleton mode）和实例（InstanceMode）。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"创建-CacheManager\"\u003e\u003ca href=\"#创建-CacheManager\" class=\"headerlink\" title=\"创建 CacheManager\"\u003e\u003c/a\u003e创建 CacheManager\u003c/h3\u003e\u003cp\u003e下面的代码列举了创建 \u003ccode\u003eCacheManager\u003c/code\u003e 的五种方式。\u003c/p\u003e\n\u003cp\u003e使用静态方法\u003ccode\u003ecreate()\u003c/code\u003e会以默认配置来创建单例的\u003ccode\u003eCacheManager\u003c/code\u003e实例。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enewInstance()\u003c/code\u003e方法是一个工厂方法，以默认配置创建一个新的\u003ccode\u003eCacheManager\u003c/code\u003e实例。\u003c/p\u003e\n\u003cp\u003e此外，\u003ccode\u003enewInstance()\u003c/code\u003e还有几个重载函数，分别可以通过传入\u003ccode\u003eString\u003c/code\u003e、\u003ccode\u003eURL\u003c/code\u003e、\u003ccode\u003eInputStream\u003c/code\u003e参数来加载配置文件，然后创建\u003ccode\u003eCacheManager\u003c/code\u003e实例。\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 使用Ehcache默认配置获取单例的CacheManager实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCacheManager.create();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eString[] cacheNames = CacheManager.getInstance().getCacheNames();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 使用Ehcache默认配置新建一个CacheManager实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCacheManager.newInstance();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eString[] cacheNames = manager.getCacheNames();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 使用不同的配置文件分别创建一个CacheManager实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003emanager1\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e CacheManager.newInstance(\u003cspan class=\"string\"\u003e\u0026#34;src/config/ehcache1.xml\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003emanager2\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e CacheManager.newInstance(\u003cspan class=\"string\"\u003e\u0026#34;src/config/ehcache2.xml\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eString[] cacheNamesForManager1 = manager1.getCacheNames();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eString[] cacheNamesForManager2 = manager2.getCacheNames();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 基于classpath下的配置文件创建CacheManager实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eURL\u003c/span\u003e \u003cspan class=\"variable\"\u003eurl\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e getClass().getResource(\u003cspan class=\"string\"\u003e\u0026#34;/anotherconfigurationname.xml\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003emanager\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e CacheManager.newInstance(url);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 基于文件流得到配置文件，并创建CacheManager实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eInputStream\u003c/span\u003e \u003cspan class=\"variable\"\u003efis\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eFileInputStream\u003c/span\u003e(\u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eFile\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e(\u003cspan class=\"string\"\u003e\u0026#34;src/config/ehcache.xml\u0026#34;\u003c/span\u003e).getAbsolutePath());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003emanager\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e CacheManager.newInstance(fis);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e fis.close();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"添加缓存\"\u003e\u003ca href=\"#添加缓存\" class=\"headerlink\" title=\"添加缓存\"\u003e\u003c/a\u003e添加缓存\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e需要强调一点，\u003ccode\u003eCache\u003c/code\u003e对象在用\u003ccode\u003eaddCache\u003c/code\u003e方法添加到\u003ccode\u003eCacheManager\u003c/code\u003e之前，是无效的。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e使用 CacheManager 的 addCache 方法可以根据缓存名将 ehcache.xml 中声明的 cache 添加到容器中；它也可以直接将 Cache 对象添加到缓存容器中。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCache\u003c/code\u003e有多个构造函数，提供了不同方式去加载缓存的配置参数。\u003c/p\u003e\n\u003cp\u003e有时候，你可能需要使用 API 来动态的添加缓存，下面的例子就提供了这样的范例。\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 除了可以使用xml文件中配置的缓存，你也可以使用API动态增删缓存\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 添加缓存\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emanager.addCache(cacheName);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 使用默认配置添加缓存\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003esingletonManager\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e CacheManager.create();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esingletonManager.addCache(\u003cspan class=\"string\"\u003e\u0026#34;testCache\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCache\u003c/span\u003e \u003cspan class=\"variable\"\u003etest\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e singletonManager.getCache(\u003cspan class=\"string\"\u003e\u0026#34;testCache\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 使用自定义配置添加缓存，注意缓存未添加进CacheManager之前并不可用\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003esingletonManager\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e CacheManager.create();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCache\u003c/span\u003e \u003cspan class=\"variable\"\u003ememoryOnlyCache\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eCache\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;testCache\u0026#34;\u003c/span\u003e, \u003cspan class=\"number\"\u003e5000\u003c/span\u003e, \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"number\"\u003e5\u003c/span\u003e, \u003cspan class=\"number\"\u003e2\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esingletonManager.addCache(memoryOnlyCache);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCache\u003c/span\u003e \u003cspan class=\"variable\"\u003etest\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e singletonManager.getCache(\u003cspan class=\"string\"\u003e\u0026#34;testCache\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 使用特定的配置添加缓存\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003emanager\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e CacheManager.create();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCache\u003c/span\u003e \u003cspan class=\"variable\"\u003etestCache\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eCache\u003c/span\u003e(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eCacheConfiguration\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;testCache\u0026#34;\u003c/span\u003e, maxEntriesLocalHeap)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e .memoryStoreEvictionPolicy(MemoryStoreEvictionPolicy.LFU)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e .eternal(\u003cspan class=\"literal\"\u003efalse\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e .timeToLiveSeconds(\u003cspan class=\"number\"\u003e60\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e .timeToIdleSeconds(\u003cspan class=\"number\"\u003e30\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e .diskExpiryThreadIntervalSeconds(\u003cspan class=\"number\"\u003e0\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e .persistence(\u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003ePersistenceConfiguration\u003c/span\u003e().strategy(Strategy.LOCALTEMPSWAP)));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e manager.addCache(testCache);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"删除缓存\"\u003e\u003ca href=\"#删除缓存\" class=\"headerlink\" title=\"删除缓存\"\u003e\u003c/a\u003e删除缓存\u003c/h3\u003e\u003cp\u003e删除缓存比较简单，你只需要将指定的缓存名传入\u003ccode\u003eremoveCache\u003c/code\u003e方法即可。\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003esingletonManager\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e CacheManager.create();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esingletonManager.removeCache(\u003cspan class=\"string\"\u003e\u0026#34;sampleCache1\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"基本缓存操作\"\u003e\u003ca href=\"#基本缓存操作\" class=\"headerlink\" title=\"基本缓存操作\"\u003e\u003c/a\u003e基本缓存操作\u003c/h3\u003e\u003cp\u003eCache 最重要的两个方法就是 put 和 get，分别用来添加 Element 和获取 Element。\u003c/p\u003e\n\u003cp\u003eCache 还提供了一系列的 get、set 方法来设置或获取缓存参数，这里不一一列举，更多 API 操作可参考\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.ehcache.org/generated/2.10.2/pdf/Ehcache_API_Developer_Guide.pdf\"\u003e官方 API 开发手册\u003c/a\u003e。\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e/**\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e * 测试：使用默认配置或使用指定配置来创建CacheManager\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e * \u003cspan class=\"doctag\"\u003e@author\u003c/span\u003e Zhang Peng\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eCacheOperationTest\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eLogger\u003c/span\u003e \u003cspan class=\"variable\"\u003elog\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e LoggerFactory.getLogger(CacheOperationTest.class);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/**\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e     * 使用Ehcache默认配置(classpath下的ehcache.xml)获取单例的CacheManager实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e     */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"meta\"\u003e@Test\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eoperation\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eCacheManager\u003c/span\u003e \u003cspan class=\"variable\"\u003emanager\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e CacheManager.newInstance(\u003cspan class=\"string\"\u003e\u0026#34;src/test/resources/ehcache/ehcache.xml\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 获得Cache的引用\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eCache\u003c/span\u003e \u003cspan class=\"variable\"\u003ecache\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e manager.getCache(\u003cspan class=\"string\"\u003e\u0026#34;userCache\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 将一个Element添加到Cache\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cache.put(\u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eElement\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;key1\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;value1\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 获取Element，Element类支持序列化，所以下面两种方法都可以用\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eElement\u003c/span\u003e \u003cspan class=\"variable\"\u003eelement1\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e cache.get(\u003cspan class=\"string\"\u003e\u0026#34;key1\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 获取非序列化的值\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        log.debug(\u003cspan class=\"string\"\u003e\u0026#34;key:{}, value:{}\u0026#34;\u003c/span\u003e, element1.getObjectKey(), element1.getObjectValue());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 获取序列化的值\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        log.debug(\u003cspan class=\"string\"\u003e\u0026#34;key:{}, value:{}\u0026#34;\u003c/span\u003e, element1.getKey(), element1.getValue());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 更新Cache中的Element\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cache.put(\u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eElement\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;key1\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;value2\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eElement\u003c/span\u003e \u003cspan class=\"variable\"\u003eelement2\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e cache.get(\u003cspan class=\"string\"\u003e\u0026#34;key1\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        log.debug(\u003cspan class=\"string\"\u003e\u0026#34;key:{}, value:{}\u0026#34;\u003c/span\u003e, element2.getObjectKey(), element2.getObjectValue());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 获取Cache的元素数\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        log.debug(\u003cspan class=\"string\"\u003e\u0026#34;cache size:{}\u0026#34;\u003c/span\u003e, cache.getSize());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 获取MemoryStore的元素数\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        log.debug(\u003cspan class=\"string\"\u003e\u0026#34;MemoryStoreSize:{}\u0026#34;\u003c/span\u003e, cache.getMemoryStoreSize());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 获取DiskStore的元素数\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        log.debug(\u003cspan class=\"string\"\u003e\u0026#34;DiskStoreSize:{}\u0026#34;\u003c/span\u003e, cache.getDiskStoreSize());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 移除Element\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cache.remove(\u003cspan class=\"string\"\u003e\u0026#34;key1\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        log.debug(\u003cspan class=\"string\"\u003e\u0026#34;cache size:{}\u0026#34;\u003c/span\u003e, cache.getSize());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 关闭当前CacheManager对象\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        manager.shutdown();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 关闭CacheManager单例实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        CacheManager.getInstance().shutdown();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"四、Ehcache-配置\"\u003e\u003ca href=\"#四、Ehcache-配置\" class=\"headerlink\" title=\"四、Ehcache 配置\"\u003e\u003c/a\u003e四、Ehcache 配置\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003eEhcache 支持通过 xml 文件和 API 两种方式进行配置。\u003c/p\u003e\n\u003cp\u003e详情参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.ehcache.org/documentation/3.8/xml.html\"\u003eEhcache 官方 XML 配置手册\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"xml-配置方式\"\u003e\u003ca href=\"#xml-配置方式\" class=\"headerlink\" title=\"xml 配置方式\"\u003e\u003c/a\u003exml 配置方式\u003c/h3\u003e\u003cp\u003eEhcache 的\u003ccode\u003eCacheManager\u003c/code\u003e构造函数或工厂方法被调用时，会默认加载 classpath 下名为\u003cem\u003eehcache.xml\u003c/em\u003e的配置文件。如果加载失败，会加载 Ehcache jar 包中的\u003cem\u003eehcache-failsafe.xml\u003c/em\u003e文件，这个文件中含有简单的默认配置。\u003cbr/\u003e\u003cstrong\u003eehcache.xml 配置参数说明：\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003ename\u003c/strong\u003e：缓存名称。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003emaxElementsInMemory\u003c/strong\u003e：缓存最大个数。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eeternal\u003c/strong\u003e：缓存中对象是否为永久的，如果是，超时设置将被忽略，对象从不过期。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003etimeToIdleSeconds\u003c/strong\u003e：置对象在失效前的允许闲置时间（单位：秒）。仅当 eternal=false 对象不是永久有效时使用，可选属性，默认值是 0，也就是可闲置时间无穷大。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003etimeToLiveSeconds\u003c/strong\u003e：缓存数据的生存时间（TTL），也就是一个元素从构建到消亡的最大时间间隔值，这只能在元素不是永久驻留时有效，如果该值是 0 就意味着元素可以停顿无穷长的时间。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003emaxEntriesLocalDisk\u003c/strong\u003e：当内存中对象数量达到 maxElementsInMemory 时，Ehcache 将会对象写到磁盘中。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eoverflowToDisk\u003c/strong\u003e：内存不足时，是否启用磁盘缓存。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ediskSpoolBufferSizeMB\u003c/strong\u003e：这个参数设置 DiskStore（磁盘缓存）的缓存区大小。默认是 30MB。每个 Cache 都应该有自己的一个缓冲区。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003emaxElementsOnDisk\u003c/strong\u003e：硬盘最大缓存个数。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ediskPersistent\u003c/strong\u003e：是否在 VM 重启时存储硬盘的缓存数据。默认值是 false。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ediskExpiryThreadIntervalSeconds\u003c/strong\u003e：磁盘失效线程运行时间间隔，默认是 120 秒。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ememoryStoreEvictionPolicy\u003c/strong\u003e：当达到 maxElementsInMemory 限制时，Ehcache 将会根据指定的策略去清理内存。默认策略是 LRU（最近最少使用）。你可以设置为 FIFO（先进先出）或是 LFU（较少使用）。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eclearOnFlush\u003c/strong\u003e：内存数量最大时是否清除。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"API-配置方式\"\u003e\u003ca href=\"#API-配置方式\" class=\"headerlink\" title=\"API 配置方式\"\u003e\u003c/a\u003eAPI 配置方式\u003c/h3\u003e\u003cp\u003exml 配置的参数也可以直接通过编程方式来动态的进行配置（dynamicConfig 没有设为 false）。\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCache\u003c/span\u003e \u003cspan class=\"variable\"\u003ecache\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e manager.getCache(\u003cspan class=\"string\"\u003e\u0026#34;sampleCache\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCacheConfiguration\u003c/span\u003e \u003cspan class=\"variable\"\u003econfig\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e cache.getCacheConfiguration();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econfig.setTimeToIdleSeconds(\u003cspan class=\"number\"\u003e60\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econfig.setTimeToLiveSeconds(\u003cspan class=\"number\"\u003e120\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econfig.setmaxEntriesLocalHeap(\u003cspan class=\"number\"\u003e10000\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econfig.setmaxEntriesLocalDisk(\u003cspan class=\"number\"\u003e1000000\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e也可以通过\u003ccode\u003edisableDynamicFeatures()\u003c/code\u003e方式关闭动态配置开关。配置以后你将无法再以编程方式配置参数。\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eCache\u003c/span\u003e \u003cspan class=\"variable\"\u003ecache\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e manager.getCache(\u003cspan class=\"string\"\u003e\u0026#34;sampleCache\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecache.disableDynamicFeatures();\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"五、Spring-集成-Ehcache\"\u003e\u003ca href=\"#五、Spring-集成-Ehcache\" class=\"headerlink\" title=\"五、Spring 集成 Ehcache\"\u003e\u003c/a\u003e五、Spring 集成 Ehcache\u003c/h2\u003e\u003cp\u003eSpring3.1 开始添加了对缓存的支持。和事务功能的支持方式类似，缓存抽象允许底层使用不同的缓存解决方案来进行整合。\u003c/p\u003e\n\u003cp\u003eSpring4.1 开始支持 JSR-107 注解。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e注：我本人使用的 Spring 版本为 4.1.4.RELEASE，目前 Spring 版本仅支持 Ehcache2.5 以上版本，但不支持 Ehcache3。\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"绑定-Ehcache\"\u003e\u003ca href=\"#绑定-Ehcache\" class=\"headerlink\" title=\"绑定 Ehcache\"\u003e\u003c/a\u003e绑定 Ehcache\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eorg.springframework.cache.ehcache.EhCacheManagerFactoryBean\u003c/code\u003e这个类的作用是加载 Ehcache 配置文件。\u003cbr/\u003e\u003ccode\u003eorg.springframework.cache.ehcache.EhCacheCacheManager\u003c/code\u003e这个类的作用是支持 net.sf.ehcache.CacheManager。\u003c/p\u003e\n\u003cp\u003e\u003cem\u003espring-ehcache.xml\u003c/em\u003e的配置\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e\u0026lt;?xml version=\u003cspan class=\"string\"\u003e\u0026#34;1.0\u0026#34;\u003c/span\u003e encoding=\u003cspan class=\"string\"\u003e\u0026#34;UTF-8\u0026#34;\u003c/span\u003e?\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ebeans\u003c/span\u003e \u003cspan class=\"attr\"\u003exmlns\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;http://www.springframework.org/schema/beans\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e       \u003cspan class=\"attr\"\u003exmlns:xsi\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e       \u003cspan class=\"attr\"\u003exmlns:cache\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;http://www.springframework.org/schema/cache\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e       \u003cspan class=\"attr\"\u003exsi:schemaLocation\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;http://www.springframework.org/schema/beans\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e\u003cspan class=\"tag\"\u003e        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e\u003cspan class=\"tag\"\u003e        http://www.springframework.org/schema/cache\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e\u003cspan class=\"tag\"\u003e        http://www.springframework.org/schema/cache/spring-cache-3.2.xsd\u0026#34;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edescription\u003c/span\u003e\u0026gt;\u003c/span\u003eehcache缓存配置管理文件\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003edescription\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ebean\u003c/span\u003e \u003cspan class=\"attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;ehcache\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;org.springframework.cache.ehcache.EhCacheManagerFactoryBean\u0026#34;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e \u003cspan class=\"attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;configLocation\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;classpath:ehcache/ehcache.xml\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003ebean\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ebean\u003c/span\u003e \u003cspan class=\"attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;cacheManager\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;org.springframework.cache.ehcache.EhCacheCacheManager\u0026#34;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e \u003cspan class=\"attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;cacheManager\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003eref\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;ehcache\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003ebean\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e\u0026lt;!-- 启用缓存注解开关 --\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ecache:annotation-driven\u003c/span\u003e \u003cspan class=\"attr\"\u003ecache-manager\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;cacheManager\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003ebeans\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"使用-Spring-的缓存注解\"\u003e\u003ca href=\"#使用-Spring-的缓存注解\" class=\"headerlink\" title=\"使用 Spring 的缓存注解\"\u003e\u003c/a\u003e使用 Spring 的缓存注解\u003c/h3\u003e\u003ch4 id=\"开启注解\"\u003e\u003ca href=\"#开启注解\" class=\"headerlink\" title=\"开启注解\"\u003e\u003c/a\u003e开启注解\u003c/h4\u003e\u003cp\u003eSpring 为缓存功能提供了注解功能，但是你必须启动注解。\u003cbr/\u003e你有两个选择：\u003cbr/\u003e(1) 在 xml 中声明\u003cbr/\u003e像上一节 spring-ehcache.xml 中的做法一样，使用\u003ccode\u003e\u0026lt;cache:annotation-driven/\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ecache:annotation-driven\u003c/span\u003e \u003cspan class=\"attr\"\u003ecache-manager\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;cacheManager\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e(2) 使用标记注解\u003cbr/\u003e你也可以通过对一个类进行注解修饰的方式在这个类中使用缓存注解。\u003cbr/\u003e范例如下：\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e@Configuration\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e@EnableCaching\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eAppConfig\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"注解基本使用方法\"\u003e\u003ca href=\"#注解基本使用方法\" class=\"headerlink\" title=\"注解基本使用方法\"\u003e\u003c/a\u003e注解基本使用方法\u003c/h3\u003e\u003cp\u003eSpring 对缓存的支持类似于对事务的支持。\u003cbr/\u003e首先使用注解标记方法，相当于定义了切点，然后使用 Aop 技术在这个方法的调用前、调用后获取方法的入参和返回值，进而实现了缓存的逻辑。\u003cbr/\u003e下面三个注解都是方法级别：\u003c/p\u003e\n\u003ch4 id=\"Cacheable\"\u003e\u003ca href=\"#Cacheable\" class=\"headerlink\" title=\"@Cacheable\"\u003e\u003c/a\u003e@Cacheable\u003c/h4\u003e\u003cp\u003e表明所修饰的方法是可以缓存的：当第一次调用这个方法时，它的结果会被缓存下来，在缓存的有效时间内，以后访问这个方法都直接返回缓存结果，不再执行方法中的代码段。\u003cbr/\u003e这个注解可以用\u003ccode\u003econdition\u003c/code\u003e属性来设置条件，如果不满足条件，就不使用缓存能力，直接执行方法。\u003cbr/\u003e可以使用\u003ccode\u003ekey\u003c/code\u003e属性来指定 key 的生成规则。\u003c/p\u003e\n\u003ch4 id=\"CachePut\"\u003e\u003ca href=\"#CachePut\" class=\"headerlink\" title=\"@CachePut\"\u003e\u003c/a\u003e@CachePut\u003c/h4\u003e\u003cp\u003e与\u003ccode\u003e@Cacheable\u003c/code\u003e不同，\u003ccode\u003e@CachePut\u003c/code\u003e不仅会缓存方法的结果，还会执行方法的代码段。\u003cbr/\u003e它支持的属性和用法都与\u003ccode\u003e@Cacheable\u003c/code\u003e一致。\u003c/p\u003e\n\u003ch4 id=\"CacheEvict\"\u003e\u003ca href=\"#CacheEvict\" class=\"headerlink\" title=\"@CacheEvict\"\u003e\u003c/a\u003e@CacheEvict\u003c/h4\u003e\u003cp\u003e与\u003ccode\u003e@Cacheable\u003c/code\u003e功能相反，\u003ccode\u003e@CacheEvict\u003c/code\u003e表明所修饰的方法是用来删除失效或无用的缓存数据。\u003cbr/\u003e下面是\u003ccode\u003e@Cacheable\u003c/code\u003e、\u003ccode\u003e@CacheEvict\u003c/code\u003e和\u003ccode\u003e@CachePut\u003c/code\u003e基本使用方法的一个集中展示：\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e@Service\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eUserService\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// @Cacheable可以设置多个缓存，形式如：@Cacheable({\u0026#34;books\u0026#34;, \u0026#34;isbns\u0026#34;})\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"meta\"\u003e@Cacheable(value={\u0026#34;users\u0026#34;}, key=\u0026#34;#user.id\u0026#34;)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e User \u003cspan class=\"title function_\"\u003efindUser\u003c/span\u003e\u003cspan class=\"params\"\u003e(User user)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e findUserInDB(user.getId());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"meta\"\u003e@Cacheable(value = \u0026#34;users\u0026#34;, condition = \u0026#34;#user.getId() \u0026lt;= 2\u0026#34;)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e User \u003cspan class=\"title function_\"\u003efindUserInLimit\u003c/span\u003e\u003cspan class=\"params\"\u003e(User user)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e findUserInDB(user.getId());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"meta\"\u003e@CachePut(value = \u0026#34;users\u0026#34;, key = \u0026#34;#user.getId()\u0026#34;)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eupdateUser\u003c/span\u003e\u003cspan class=\"params\"\u003e(User user)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        updateUserInDB(user);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"meta\"\u003e@CacheEvict(value = \u0026#34;users\u0026#34;)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eremoveUser\u003c/span\u003e\u003cspan class=\"params\"\u003e(User user)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        removeUserInDB(user.getId());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"meta\"\u003e@CacheEvict(value = \u0026#34;users\u0026#34;, allEntries = true)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eclear\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        removeAllInDB();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"Caching\"\u003e\u003ca href=\"#Caching\" class=\"headerlink\" title=\"@Caching\"\u003e\u003c/a\u003e@Caching\u003c/h4\u003e\u003cp\u003e如果需要使用同一个缓存注解（\u003ccode\u003e@Cacheable\u003c/code\u003e、\u003ccode\u003e@CacheEvict\u003c/code\u003e或\u003ccode\u003e@CachePut\u003c/code\u003e）多次修饰一个方法，就需要用到\u003ccode\u003e@Caching\u003c/code\u003e。\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e@Caching(evict = { @CacheEvict(\u0026#34;primary\u0026#34;), @CacheEvict(cacheNames=\u0026#34;secondary\u0026#34;, key=\u0026#34;#p0\u0026#34;) })\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e Book \u003cspan class=\"title function_\"\u003eimportBooks\u003c/span\u003e\u003cspan class=\"params\"\u003e(String deposit, Date date)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"CacheConfig\"\u003e\u003ca href=\"#CacheConfig\" class=\"headerlink\" title=\"@CacheConfig\"\u003e\u003c/a\u003e@CacheConfig\u003c/h4\u003e\u003cp\u003e与前面的缓存注解不同，这是一个类级别的注解。\u003cbr/\u003e如果类的所有操作都是缓存操作，你可以使用\u003ccode\u003e@CacheConfig\u003c/code\u003e来指定类，省去一些配置。\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e@CacheConfig(\u0026#34;books\u0026#34;)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eBookRepositoryImpl\u003c/span\u003e \u003cspan class=\"keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"title class_\"\u003eBookRepository\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003cspan class=\"meta\"\u003e@Cacheable\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e Book \u003cspan class=\"title function_\"\u003efindBook\u003c/span\u003e\u003cspan class=\"params\"\u003e(ISBN isbn)\u003c/span\u003e {...}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e官方\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.ehcache.org/\"\u003eEhcache 官网\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/ehcache/ehcache3\"\u003eEhcache Github\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e文章\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://yq.aliyun.com/articles/72885?utm_campaign=wenzhang\u0026amp;utm_medium=article\u0026amp;utm_source=QQ-qun\u0026amp;2017331\u0026amp;utm_content=m_15513\"\u003eEhcache 优缺点以及分布式详解\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://raychase.iteye.com/blog/1545906\"\u003eEhcache 详细解读\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.ibm.com/developerworks/cn/opensource/os-cn-spring-cache/\"\u003e注释驱动的 Spring cache 缓存介绍\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/\"\u003eSpring 官方文档第 36 章缓存抽象\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2022-02-17T14:34:30Z",
  "Author": "钝悟 ◾ Dunwu"
}