{
  "Source": "dunwu",
  "Title": "服务路由",
  "Link": "https://dunwu.github.io/blog/pages/3915e8/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"服务路由\"\u003e\u003ca href=\"#服务路由\" class=\"headerlink\" title=\"服务路由\"\u003e\u003c/a\u003e服务路由\u003c/h1\u003e\u003ch2 id=\"服务路由简介\"\u003e\u003ca href=\"#服务路由简介\" class=\"headerlink\" title=\"服务路由简介\"\u003e\u003c/a\u003e服务路由简介\u003c/h2\u003e\u003ch3 id=\"什么是服务路由\"\u003e\u003ca href=\"#什么是服务路由\" class=\"headerlink\" title=\"什么是服务路由\"\u003e\u003c/a\u003e什么是服务路由\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e服务路由\u003c/strong\u003e是指通过一定的规则从集群中选择合适的节点。\u003c/p\u003e\n\u003ch3 id=\"为什么需要服务路由\"\u003e\u003ca href=\"#为什么需要服务路由\" class=\"headerlink\" title=\"为什么需要服务路由\"\u003e\u003c/a\u003e为什么需要服务路由\u003c/h3\u003e\u003cp\u003e负载均衡的作用和服务路由的功能看上去很近似，二者有什么区别呢？\u003c/p\u003e\n\u003cp\u003e负载均衡的目标是提供服务分发而不是解决路由问题，常见的静态、动态负载均衡算法也无法实现精细化的路由管理，但是负载均衡也可以简单看做是路由方案的一种。\u003c/p\u003e\n\u003cp\u003e服务路由通常用于以下场景，目的在于实现流量隔离：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e分组调用\u003c/strong\u003e：一般来讲，为了保证服务的高可用性，实现异地多活的需求，一个服务往往不止部署在一个数据中心，而且出于节省成本等考虑，有些业务可能不仅在私有机房部署，还会采用公有云部署，甚至采用多家公有云部署。服务节点也会按照不同的数据中心分成不同的分组，这时对于服务消费者来说，选择哪一个分组调用，就必须有相应的路由规则。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e蓝绿发布\u003c/strong\u003e：蓝绿发布场景中，一共有两套服务群组：一套是提供旧版功能的服务群组，标记为\u003cstrong\u003e绿色\u003c/strong\u003e；另一套是提供新版功能的服务群组，标记为\u003cstrong\u003e蓝色\u003c/strong\u003e。两套服务群组都是功能完善的，并且正在运行的系统，只是服务版本和访问流量不同。新版群组（蓝色）通常是为了做内部测试、验收，不对外部用户暴露。\u003cul\u003e\n\u003cli\u003e如果新版群组（蓝色）运行稳定，并测试、验收通过后，则通过服务路由、负载均衡等手段逐步将外部用户流量导向新版群组（蓝色）。\u003c/li\u003e\n\u003cli\u003e如果新版群组（蓝色）运行不稳定，或测试、验收不通过，则排查、解决问题后，再继续测试、验收。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e灰度发布\u003c/strong\u003e：灰度发布（又名金丝雀发布）是指在黑与白之间，能够平滑过渡的一种发布方式。在其上可以进行 A/B 测试，即让一部分用户使用特性 A，一部分用户使用特性 B：如果用户对 B 没有什么反对意见，那么逐步扩大发布范围，直到把所有用户都迁移到 B 上面来。灰度发布可以保证整体系统的稳定，在初始灰度的时候就可以发现、调整问题，以保证其影响度。要支持灰度发布，就要求服务能够根据一定的规则，将流量隔离。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e流量切换\u003c/strong\u003e：在业务线上运行过程中，经常会遇到一些不可抗力因素导致业务故障，比如某个机房的光缆被挖断，或者发生着火等事故导致整个机房的服务都不可用。这个时候就需要按照某个指令，能够把原来调用这个机房服务的流量切换到其他正常的机房。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e线下测试联调\u003c/strong\u003e：线下测试时，可能会缺少相应环境。可以将测试应用注册到线上，然后开启路由规则，在本地进行测试。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e读写分离\u003c/strong\u003e。对于大多数互联网业务来说都是读多写少，所以在进行服务部署的时候，可以把读写分开部署，所有写接口可以部署在一起，而读接口部署在另外的节点上。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"服务路由的规则\"\u003e\u003ca href=\"#服务路由的规则\" class=\"headerlink\" title=\"服务路由的规则\"\u003e\u003c/a\u003e服务路由的规则\u003c/h2\u003e\u003ch3 id=\"条件路由\"\u003e\u003ca href=\"#条件路由\" class=\"headerlink\" title=\"条件路由\"\u003e\u003c/a\u003e条件路由\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e条件路由是基于条件表达式的路由规则\u003c/strong\u003e。各个 RPC 框架的条件路由表达式各不相同。\u003c/p\u003e\n\u003cp\u003e我们不妨参考一下 Dubbo 的条件路由。Dubbo 的条件路由有两种配置粒度，如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e应用粒度\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# app1的消费者只能消费所有端口为20880的服务实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# app2的消费者只能消费所有端口为20881的服务实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e---\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003escope:\u003c/span\u003e \u003cspan class=\"string\"\u003eapplication\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eforce:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eruntime:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eenabled:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003ekey:\u003c/span\u003e \u003cspan class=\"string\"\u003egovernance-conditionrouter-consumer\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003econditions:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003eapplication=app1\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003eaddress=*:20880\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003eapplication=app2\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003eaddress=*:20881\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003e服务粒度\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# DemoService的sayHello方法只能消费所有端口为20880的服务实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# DemoService的sayHi方法只能消费所有端口为20881的服务实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e---\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003escope:\u003c/span\u003e \u003cspan class=\"string\"\u003eservice\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eforce:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eruntime:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eenabled:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003ekey:\u003c/span\u003e \u003cspan class=\"string\"\u003eorg.apache.dubbo.samples.governance.api.DemoService\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003econditions:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003emethod=sayHello\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003eaddress=*:20880\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003emethod=sayHi\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003eaddress=*:20881\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e其中，\u003ccode\u003econditions\u003c/code\u003e 定义具体的路由规则内容。\u003ccode\u003econditions\u003c/code\u003e 部分是规则的主体，由 1 到任意多条规则组成。详见：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://dubbo.apache.org/zh/docs/v2.7/user/examples/routing-rule/\"\u003eDubbo 路由规则\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eDubbo 的条件路由规则由两个条件组成，分别用于对服务消费者和提供者进行匹配。条件路由规则的格式如下：\u003c/p\u003e\n\u003cfigure class=\"highlight inform7\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e[服务消费者匹配条件]\u003c/span\u003e =\u0026gt; \u003cspan class=\"comment\"\u003e[服务提供者匹配条件]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e服务消费者匹配条件：所有参数和消费者的 URL 进行对比，当消费者满足匹配条件时，对该消费者执行后面的过滤规则。\u003c/li\u003e\n\u003cli\u003e服务提供者匹配条件：所有参数和提供者的 URL 进行对比，消费者最终只拿到过滤后的地址列表。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003econdition://\u003c/code\u003e 代表了这是一段用条件表达式编写的路由规则，下面是一个条件路由规则示例：\u003c/p\u003e\n\u003cfigure class=\"highlight abnf\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ehost\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e10.20\u003c/span\u003e.\u003cspan class=\"number\"\u003e153.10\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u0026gt; host \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e10.20\u003c/span\u003e.\u003cspan class=\"number\"\u003e153.11\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e该条规则表示 IP 为 \u003ccode\u003e10.20.153.10\u003c/code\u003e 的服务消费者\u003cstrong\u003e只可\u003c/strong\u003e调用 IP 为 \u003ccode\u003e10.20.153.11\u003c/code\u003e 机器上的服务，不可调用其他机器上的服务。\u003c/p\u003e\n\u003cp\u003e下面列举一些 Dubbo 条件路由的典型应用场景：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e如果服务消费者的匹配条件为空，就表示\u003cstrong\u003e所有的服务消费者都可以访问\u003c/strong\u003e，就像下面的表达式一样。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight excel\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e=\u0026gt; host != \u003cspan class=\"number\"\u003e10.20\u003c/span\u003e.\u003cspan class=\"number\"\u003e153.11\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e如果服务提供者的过滤条件为空，就表示\u003cstrong\u003e禁止所有的服务消费者访问\u003c/strong\u003e，就像下面的表达式一样。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight abnf\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ehost\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e10.20\u003c/span\u003e.\u003cspan class=\"number\"\u003e153.10\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e排除某个服务节点\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight excel\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e=\u0026gt; host != \u003cspan class=\"number\"\u003e172.22\u003c/span\u003e.\u003cspan class=\"number\"\u003e3.91\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e白名单\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight plaintext\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eregister.ip != 10.20.153.10,10.20.153.11 =\u0026gt;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e黑名单\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003eregister\u003c/span\u003e.ip = \u003cspan class=\"number\"\u003e10.20.153.10\u003c/span\u003e,\u003cspan class=\"number\"\u003e10.20.153.11\u003c/span\u003e =\u0026gt;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e只暴露部分机器节点\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight excel\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e=\u0026gt; host = \u003cspan class=\"number\"\u003e172.22\u003c/span\u003e.\u003cspan class=\"number\"\u003e3.1\u003c/span\u003e*,\u003cspan class=\"number\"\u003e172.22\u003c/span\u003e.\u003cspan class=\"number\"\u003e3.2\u003c/span\u003e*\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e为重要应用提供额外的机器节点\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003eapplication\u003c/span\u003e != kylin =\u0026gt; host != \u003cspan class=\"number\"\u003e172.22.3.95\u003c/span\u003e,\u003cspan class=\"number\"\u003e172.22.3.96\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e读写分离\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight oxygene\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003emethod\u003c/span\u003e = \u003cspan class=\"title function_\"\u003efind\u003c/span\u003e*,\u003cspan class=\"title function_\"\u003elist\u003c/span\u003e*,\u003cspan class=\"title function_\"\u003eget\u003c/span\u003e*,\u003cspan class=\"title function_\"\u003eis\u003c/span\u003e* =\u0026gt; \u003cspan class=\"title function_\"\u003ehost\u003c/span\u003e = 172.22.3.94,172.22.3.95,172.22.3.96\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"title function_\"\u003emethod\u003c/span\u003e != \u003cspan class=\"title function_\"\u003efind\u003c/span\u003e*,\u003cspan class=\"title function_\"\u003elist\u003c/span\u003e*,\u003cspan class=\"title function_\"\u003eget\u003c/span\u003e*,\u003cspan class=\"title function_\"\u003eis\u003c/span\u003e* =\u0026gt; \u003cspan class=\"title function_\"\u003ehost\u003c/span\u003e = 172.22.3.97,172.22.3.98\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e前后台分离\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003eapplication\u003c/span\u003e = bops =\u0026gt; host = \u003cspan class=\"number\"\u003e172.22.3.91\u003c/span\u003e,\u003cspan class=\"number\"\u003e172.22.3.92\u003c/span\u003e,\u003cspan class=\"number\"\u003e172.22.3.93\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003eapplication\u003c/span\u003e != bops =\u0026gt; host = \u003cspan class=\"number\"\u003e172.22.3.94\u003c/span\u003e,\u003cspan class=\"number\"\u003e172.22.3.95\u003c/span\u003e,\u003cspan class=\"number\"\u003e172.22.3.96\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e隔离不同机房网段\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ehost\u003c/span\u003e != \u003cspan class=\"number\"\u003e172\u003c/span\u003e.\u003cspan class=\"number\"\u003e22\u003c/span\u003e.\u003cspan class=\"number\"\u003e3\u003c/span\u003e.* =\u0026gt; host != \u003cspan class=\"number\"\u003e172\u003c/span\u003e.\u003cspan class=\"number\"\u003e22\u003c/span\u003e.\u003cspan class=\"number\"\u003e3\u003c/span\u003e.*\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e提供者与消费者部署在同集群内，\u003cstrong\u003e本机只访问本机的服务\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight excel\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e=\u0026gt; host = $host\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"脚本路由\"\u003e\u003ca href=\"#脚本路由\" class=\"headerlink\" title=\"脚本路由\"\u003e\u003c/a\u003e脚本路由\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e脚本路由\u003c/strong\u003e是基于脚本语言的路由规则，常用的脚本语言比如 JavaScript、Groovy、JRuby 等。\u003c/p\u003e\n\u003cfigure class=\"highlight css\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u0026#34;script://\u003cspan class=\"number\"\u003e0.0\u003c/span\u003e.\u003cspan class=\"number\"\u003e0.0\u003c/span\u003e/com.foo.BarService?category=routers\u0026amp;dynamic=false\u0026amp;rule=\u003cspan class=\"string\"\u003e\u0026#34; + URL.encode(\u0026#34;\u003c/span\u003e（function \u003cspan class=\"built_in\"\u003eroute\u003c/span\u003e(invokers) { ... } (invokers)）\u0026#34;)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里面 \u003ccode\u003escript://\u003c/code\u003e 就代表了这是一段脚本语言编写的路由规则，具体规则定义在脚本语言的 route 方法实现里，比如下面这段用 JavaScript 编写的 route() 方法表达的意思是，只有 IP 为 \u003ccode\u003e10.20.153.10\u003c/code\u003e 的服务消费者可以发起服务调用。\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"title function_\"\u003eroute\u003c/span\u003e(\u003cspan class=\"params\"\u003einvokers\u003c/span\u003e){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003evar\u003c/span\u003e result = \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e java.\u003cspan class=\"property\"\u003eutil\u003c/span\u003e.\u003cspan class=\"title class_\"\u003eArrayList\u003c/span\u003e(invokers.\u003cspan class=\"title function_\"\u003esize\u003c/span\u003e());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e(i =\u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; invokers.\u003cspan class=\"title function_\"\u003esize\u003c/span\u003e(); i ++){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;10.20.153.10\u0026#34;\u003c/span\u003e.\u003cspan class=\"title function_\"\u003eequals\u003c/span\u003e(invokers.\u003cspan class=\"title function_\"\u003eget\u003c/span\u003e(i).\u003cspan class=\"title function_\"\u003egetUrl\u003c/span\u003e().\u003cspan class=\"title function_\"\u003egetHost\u003c/span\u003e())){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       result.\u003cspan class=\"title function_\"\u003eadd\u003c/span\u003e(invokers.\u003cspan class=\"title function_\"\u003eget\u003c/span\u003e(i));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e result;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e } (invokers)）;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"标签路由\"\u003e\u003ca href=\"#标签路由\" class=\"headerlink\" title=\"标签路由\"\u003e\u003c/a\u003e标签路由\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e标签路由\u003c/strong\u003e通过将某一个或多个服务的提供者划分到同一个分组，约束流量只在指定分组中流转，从而实现流量隔离的目的，可以作为蓝绿发布、灰度发布等场景的能力基础。\u003c/p\u003e\n\u003cp\u003e标签主要是指对服务提供者的分组，目前有两种方式可以完成实例分组，分别是\u003cstrong\u003e动态规则打标\u003c/strong\u003e和\u003cstrong\u003e静态规则打标\u003c/strong\u003e。一般，动态规则优先级比静态规则更高，当两种规则同时存在且出现冲突时，将以动态规则为准。\u003c/p\u003e\n\u003cp\u003e以 Dubbo 的标签路由用法为例\u003c/p\u003e\n\u003cp\u003e（1）\u003cstrong\u003e动态规则打标\u003c/strong\u003e，可随时在\u003cstrong\u003e服务治理控制台\u003c/strong\u003e下发标签归组规则\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# governance-tagrouter-provider应用增加了两个标签分组tag1和tag2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# tag1包含一个实例 127.0.0.1:20880\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# tag2包含一个实例 127.0.0.1:20881\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e---\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003eforce:\u003c/span\u003e \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003eruntime:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003eenabled:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ekey:\u003c/span\u003e \u003cspan class=\"string\"\u003egovernance-tagrouter-provider\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003etags:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"string\"\u003etag1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003eaddresses:\u003c/span\u003e [\u003cspan class=\"string\"\u003e\u0026#34;127.0.0.1:20880\u0026#34;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"string\"\u003etag2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003eaddresses:\u003c/span\u003e [\u003cspan class=\"string\"\u003e\u0026#34;127.0.0.1:20881\u0026#34;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003cspan class=\"string\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（2）\u003cstrong\u003e静态规则打标\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edubbo:provider\u003c/span\u003e \u003cspan class=\"attr\"\u003etag\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;tag1\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eor\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edubbo:service\u003c/span\u003e \u003cspan class=\"attr\"\u003etag\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;tag1\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eor\u003c/p\u003e\n\u003cfigure class=\"highlight plaintext\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ejava -jar xxx-provider.jar -Ddubbo.provider.tag={the tag you want, may come from OS ENV}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（3）\u003cstrong\u003e服务消费者指定标签路由\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eRpcContext.getContext().setAttachment(Constants.REQUEST_TAG_KEY,\u003cspan class=\"string\"\u003e\u0026#34;tag1\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e请求标签的作用域为每一次 invocation，使用 \u003ccode\u003eattachment\u003c/code\u003e 来传递请求标签，注意保存在 \u003ccode\u003eattachment\u003c/code\u003e 中的值将会在一次完整的远程调用中持续传递，得益于这样的特性，我们只需要在起始调用时，通过一行代码的设置，达到标签的持续传递。\u003c/p\u003e\n\u003ch3 id=\"路由规则获取方式\"\u003e\u003ca href=\"#路由规则获取方式\" class=\"headerlink\" title=\"路由规则获取方式\"\u003e\u003c/a\u003e路由规则获取方式\u003c/h3\u003e\u003cp\u003e路由规则的获取方式主要有三种：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e本地静态配置\u003c/strong\u003e：顾名思义就是路由规则存储在服务消费者本地上。服务消费者发起调用时，从本地固定位置读取路由规则，然后按照路由规则选取一个服务节点发起调用。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e配置中心管理\u003c/strong\u003e：这种方式下，所有的服务消费者都从配置中心获取路由规则，由配置中心来统一管理。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e注册中心动态下发\u003c/strong\u003e：这种方式下，一般是运维人员或者开发人员，通过服务治理平台修改路由规则，服务治理平台调用配置中心接口，把修改后的路由规则持久化到配置中心。因为服务消费者订阅了路由规则的变更，于是就会从配置中心获取最新的路由规则，按照最新的路由规则来执行。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e一般来讲，\u003cstrong\u003e服务路由最好是存储在配置中心\u003c/strong\u003e，由配置中心来统一管理。这样的话，所有的服务消费者就不需要在本地管理服务路由，因为大部分的服务消费者并不关心服务路由的问题，或者说也不需要去了解其中的细节。通过配置中心，统一给各个服务消费者下发统一的服务路由，节省了沟通和管理成本。\u003c/p\u003e\n\u003cp\u003e但也不排除某些服务消费者有特定的需求，需要定制自己的路由规则，这个时候就适合通过本地配置来定制。\u003c/p\u003e\n\u003cp\u003e而动态下发可以理解为一种高级功能，它能够动态地修改路由规则，在某些业务场景下十分有用。比如某个数据中心存在问题，需要把调用这个数据中心的服务消费者都切换到其他数据中心，这时就可以通过动态下发的方式，向配置中心下发一条路由规则，将所有调用这个数据中心的请求都迁移到别的地方。\u003c/p\u003e\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://time.geekbang.org/column/intro/100014401\"\u003e从 0 开始学微服务\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://time.geekbang.org/column/intro/100046201\"\u003eRPC 实战与核心原理\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://time.geekbang.org/course/intro/100003901\"\u003e微服务架构核心 20 讲\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2022-04-19T07:54:25Z",
  "Author": "钝悟 ◾ Dunwu"
}