{
  "Source": "dunwu",
  "Title": "HBase Java API 其他高级特性",
  "Link": "https://dunwu.github.io/blog/pages/ce5ca0/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"HBase-Java-API-其他高级特性\"\u003e\u003ca href=\"#HBase-Java-API-其他高级特性\" class=\"headerlink\" title=\"HBase Java API 其他高级特性\"\u003e\u003c/a\u003eHBase Java API 其他高级特性\u003c/h1\u003e\u003ch2 id=\"计数器\"\u003e\u003ca href=\"#计数器\" class=\"headerlink\" title=\"计数器\"\u003e\u003c/a\u003e计数器\u003c/h2\u003e\u003cp\u003eHBase 提供了一种高级功能：计数器（counter）。\u003cstrong\u003eHBase 计数器可以用于实时统计，无需延时较高的批量处理操作\u003c/strong\u003e。HBase 有一种机制可以将列当作计数器：即读取并修改（其实就是一种 CAS 模式），其保证了在一次操作中的原子性。否则，用户需要对一行数据加锁，然后读取数据，再对当前数据做加法，最后写回 HBase 并释放行锁，这一系列操作会引起大量的资源竞争问题。\u003c/p\u003e\n\u003cp\u003e早期的 HBase 版本会在每次计数器更新操作调用一次 RPC 请求，新版本中可以在一次 RPC 请求中完成多个计数器的更新操作，但是多个计数器必须在同一行。\u003c/p\u003e\n\u003ch3 id=\"计数器使用-Shell-命令行\"\u003e\u003ca href=\"#计数器使用-Shell-命令行\" class=\"headerlink\" title=\"计数器使用 Shell 命令行\"\u003e\u003c/a\u003e计数器使用 Shell 命令行\u003c/h3\u003e\u003cp\u003e计数器不需要初始化，创建一个新列时初始值为 0，第一次 \u003ccode\u003eincr\u003c/code\u003e 操作返回 1。\u003c/p\u003e\n\u003cp\u003e计数器使用 \u003ccode\u003eincr\u003c/code\u003e 命令，增量可以是正数也可以是负数，但是必须是长整数 Long：\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eincr \u003cspan class=\"string\"\u003e\u0026#39;\u0026lt;table\u0026gt;\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;\u0026lt;row\u0026gt;\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;\u0026lt;column\u0026gt;\u0026#39;\u003c/span\u003e,[\u003cspan class=\"string\"\u003e\u0026#39;\u0026lt;increment-value\u0026gt;\u0026#39;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e计数器使用的例子：\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ehbase(main):001:\u003cspan class=\"number\"\u003e0\u003c/span\u003e\u0026gt; create \u003cspan class=\"string\"\u003e\u0026#39;counters\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;daily\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;weekly\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;monthly\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"number\"\u003e0\u003c/span\u003e row(s) \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"number\"\u003e1.2260\u003c/span\u003e seconds\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ehbase(main):002:\u003cspan class=\"number\"\u003e0\u003c/span\u003e\u0026gt; incr \u003cspan class=\"string\"\u003e\u0026#39;counters\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;20190301\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;daily:hites\u0026#39;\u003c/span\u003e,\u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCOUNTER VALUE = \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ehbase(main):003:\u003cspan class=\"number\"\u003e0\u003c/span\u003e\u0026gt; inc\u003cspan class=\"string\"\u003er\u0026#39;counters\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;20190301\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;daily:hites\u0026#39;\u003c/span\u003e,\u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCOUNTER VALUE = \u003cspan class=\"number\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ehbase(main):004:\u003cspan class=\"number\"\u003e0\u003c/span\u003e\u0026gt; get_counter \u003cspan class=\"string\"\u003e\u0026#39;counters\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;20190301\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;daily:hites\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCOUNTER VALUE = \u003cspan class=\"number\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e需要注意的是，增加的参数必须是长整型 Long，如果按照错误的格式更新了计数器（如字符串格式），下次调用 \u003ccode\u003eincr\u003c/code\u003e 会得到错误的结果：\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ehbase(main):005:\u003cspan class=\"number\"\u003e0\u003c/span\u003e\u0026gt; put \u003cspan class=\"string\"\u003e\u0026#39;counters\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;20190301\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;daily:clicks\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"number\"\u003e0\u003c/span\u003e row(s) \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"number\"\u003e1.3250\u003c/span\u003e seconds\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ehbase(main):006:\u003cspan class=\"number\"\u003e0\u003c/span\u003e\u0026gt; inc\u003cspan class=\"string\"\u003er\u0026#39;counters\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;20190301\u0026#39;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#39;daily:clicks\u0026#39;\u003c/span\u003e,\u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCOUNTER VALUE = \u003cspan class=\"number\"\u003e3530822107858468865\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"单计数器\"\u003e\u003ca href=\"#单计数器\" class=\"headerlink\" title=\"单计数器\"\u003e\u003c/a\u003e单计数器\u003c/h3\u003e\u003cp\u003e操作一个计数器，类似 shell 命令 \u003ccode\u003eincr\u003c/code\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eHTable\u003c/span\u003e \u003cspan class=\"variable\"\u003etable\u003c/span\u003e  \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eHTable\u003c/span\u003e(conf, \u003cspan class=\"string\"\u003e\u0026#34;counters\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003elong\u003c/span\u003e \u003cspan class=\"variable\"\u003ecnt1\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e table.incrementColumnValue(Bytes.toBytes(\u003cspan class=\"string\"\u003e\u0026#34;20190301\u0026#34;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Bytes.toBytes(\u003cspan class=\"string\"\u003e\u0026#34;daily\u0026#34;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Bytes.toBytes(\u003cspan class=\"string\"\u003e\u0026#34;hits\u0026#34;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"number\"\u003e1L\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003elong\u003c/span\u003e \u003cspan class=\"variable\"\u003ecnt2\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e table.incrementColumnValue(Bytes.toBytes(\u003cspan class=\"string\"\u003e\u0026#34;20190301\u0026#34;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Bytes.toBytes(\u003cspan class=\"string\"\u003e\u0026#34;daily\u0026#34;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Bytes.toBytes(\u003cspan class=\"string\"\u003e\u0026#34;hits\u0026#34;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"number\"\u003e1L\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003elong\u003c/span\u003e \u003cspan class=\"variable\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e table.incrementColumnValue(Bytes.toBytes(\u003cspan class=\"string\"\u003e\u0026#34;20190301\u0026#34;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Bytes.toBytes(\u003cspan class=\"string\"\u003e\u0026#34;daily\u0026#34;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Bytes.toBytes(\u003cspan class=\"string\"\u003e\u0026#34;hits\u0026#34;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"number\"\u003e0\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"多计数器\"\u003e\u003ca href=\"#多计数器\" class=\"headerlink\" title=\"多计数器\"\u003e\u003c/a\u003e多计数器\u003c/h3\u003e\u003cp\u003e使用 \u003ccode\u003eTable\u003c/code\u003e 的 \u003ccode\u003eincrement()\u003c/code\u003e 方法可以操作一行的多个计数器，需要构建 \u003ccode\u003eIncrement\u003c/code\u003e 实例，并且指定行键：\u003c/p\u003e\n\u003cfigure class=\"highlight cpp\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eHTable table  = \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"built_in\"\u003eHTable\u003c/span\u003e(conf, \u003cspan class=\"string\"\u003e\u0026#34;counters\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eIncrement incr1 = \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"built_in\"\u003eIncrement\u003c/span\u003e(Bytes.\u003cspan class=\"built_in\"\u003etoBytes\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;20190301\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eincr1.\u003cspan class=\"built_in\"\u003eaddColumn\u003c/span\u003e(Bytes.\u003cspan class=\"built_in\"\u003etoBytes\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;daily\u0026#34;\u003c/span\u003e), Bytes.\u003cspan class=\"built_in\"\u003etoBytes\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;clicks\u0026#34;\u003c/span\u003e),\u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eincr1.\u003cspan class=\"built_in\"\u003eaddColumn\u003c/span\u003e(Bytes.\u003cspan class=\"built_in\"\u003etoBytes\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;daily\u0026#34;\u003c/span\u003e), Bytes.\u003cspan class=\"built_in\"\u003etoBytes\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;hits\u0026#34;\u003c/span\u003e), \u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eincr1.\u003cspan class=\"built_in\"\u003eaddColumn\u003c/span\u003e(Bytes.\u003cspan class=\"built_in\"\u003etoBytes\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;weekly\u0026#34;\u003c/span\u003e), Bytes.\u003cspan class=\"built_in\"\u003etoBytes\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;clicks\u0026#34;\u003c/span\u003e), \u003cspan class=\"number\"\u003e2\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eincr1.\u003cspan class=\"built_in\"\u003eaddColumn\u003c/span\u003e(Bytes.\u003cspan class=\"built_in\"\u003etoBytes\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;weekly\u0026#34;\u003c/span\u003e), Bytes.\u003cspan class=\"built_in\"\u003etoBytes\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;hits\u0026#34;\u003c/span\u003e), \u003cspan class=\"number\"\u003e2\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eResult result = table.\u003cspan class=\"built_in\"\u003eincrement\u003c/span\u003e(incr1);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e(Cell cell : result.\u003cspan class=\"built_in\"\u003erawCells\u003c/span\u003e()) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eIncrement 类还有一种构造器：\u003c/p\u003e\n\u003cfigure class=\"highlight csharp\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eIncrement(\u003cspan class=\"built_in\"\u003ebyte\u003c/span\u003e[] row, RowLock rowLock)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003ccode\u003erowLock\u003c/code\u003e 参数可选，可以设置用户自定义锁，可以限制其他写程序操作此行，但是不保证读的操作性。\u003c/p\u003e\n\u003ch2 id=\"连接管理\"\u003e\u003ca href=\"#连接管理\" class=\"headerlink\" title=\"连接管理\"\u003e\u003c/a\u003e连接管理\u003c/h2\u003e\u003ch3 id=\"连接管理简介\"\u003e\u003ca href=\"#连接管理简介\" class=\"headerlink\" title=\"连接管理简介\"\u003e\u003c/a\u003e连接管理简介\u003c/h3\u003e\u003cp\u003e在 HBase Java API 中，\u003ccode\u003eConnection\u003c/code\u003e 类代表了一个集群连接，封装了与多台服务器（Matser/Region Server）的底层连接以及与 zookeeper 的连接。\u003ccode\u003eConnection\u003c/code\u003e 通过 \u003ccode\u003eConnectionFactory\u003c/code\u003e 类实例化，而连接的生命周期则由调用者管理，调用者必须显示调用 \u003ccode\u003eclose()\u003c/code\u003e 来释放连接。\u003ccode\u003eConnection\u003c/code\u003e 是线程安全的。创建 \u003ccode\u003eConnection\u003c/code\u003e 实例的开销很高，因此一个进程只需要实例化一个 \u003ccode\u003eConnection\u003c/code\u003e 即可。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eTable\u003c/code\u003e 接口用于对指定的 HBase 表进行 CRUD 操作。一般，通过 \u003ccode\u003eConnection\u003c/code\u003e 获取 \u003ccode\u003eTable\u003c/code\u003e 实例，用完后，调用 \u003ccode\u003eclose()\u003c/code\u003e 释放连接。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAdmin\u003c/code\u003e 接口主要用于创建、删除、查看、启用/禁用 HBase 表，以及一些其他管理操作。一般，通过 \u003ccode\u003eConnection\u003c/code\u003e 获取 \u003ccode\u003eAdmin\u003c/code\u003e 实例，用完后，调用 \u003ccode\u003eclose()\u003c/code\u003e 释放连接。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eTable\u003c/code\u003e 和 \u003ccode\u003eAdmin\u003c/code\u003e 实例都是轻量级且并非线程安全的。建议每个线程只实例化一个 \u003ccode\u003eTable\u003c/code\u003e 或 \u003ccode\u003eAdmin\u003c/code\u003e 实例。\u003c/p\u003e\n\u003ch3 id=\"连接池\"\u003e\u003ca href=\"#连接池\" class=\"headerlink\" title=\"连接池\"\u003e\u003c/a\u003e连接池\u003c/h3\u003e\u003cp\u003e问题：HBase 为什么没有提供 \u003ccode\u003eConnection\u003c/code\u003e 的连接池来获取更好的性能？是否需要自定义 \u003ccode\u003eConnection\u003c/code\u003e 连接池？\u003c/p\u003e\n\u003cp\u003e答：不需要。官方对于 \u003ccode\u003eConnection\u003c/code\u003e 的使用说明中，明确指出：对于高并发多线程访问的应用程序，一个进程中只需要预先创建一个 \u003ccode\u003eConnection\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e问题：HBase 老版本中 \u003ccode\u003eHTablePool\u003c/code\u003e 为什么废弃？是否需要自定义 Table 的连接池？\u003c/p\u003e\n\u003cp\u003e答：不需要。Table 和 Admin 的连接本质上是复用 Connection，实例化是一个较为轻量级的操作，因此，并不需要缓存或池化。实际上，HBase Java API 官方就是这么建议的。 \u003c/p\u003e\n\u003cp\u003e下面是管理 HBase 连接的一个正确编程模型\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 所有进程共用一个 connection 对象\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econnection = ConnectionFactory.createConnection(config);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// 每个线程使用单独的 table 对象\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTable\u003c/span\u003e \u003cspan class=\"variable\"\u003etable\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e connection.getTable(TableName.valueOf(\u003cspan class=\"string\"\u003e\u0026#34;tableName\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   table.close();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eAdmin\u003c/span\u003e \u003cspan class=\"variable\"\u003eadmin\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e connection.getAdmin();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   admin.close();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://item.jd.com/11321037.html\"\u003e《HBase 权威指南》\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/larsgeorge/hbase-book\"\u003e《HBase 权威指南》官方源码\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://developer.aliyun.com/article/581702\"\u003e连接 HBase 的正确姿势\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2023-03-31T08:20:27Z",
  "Author": "钝悟 ◾ Dunwu"
}