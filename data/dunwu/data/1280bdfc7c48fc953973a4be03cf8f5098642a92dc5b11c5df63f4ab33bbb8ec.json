{
  "Source": "dunwu",
  "Title": "MongoDB 事务",
  "Link": "https://dunwu.github.io/blog/pages/4574fe/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"MongoDB-事务\"\u003e\u003ca href=\"#MongoDB-事务\" class=\"headerlink\" title=\"MongoDB 事务\"\u003e\u003c/a\u003eMongoDB 事务\u003c/h1\u003e\u003cp\u003ewriteConcern 可以决定写操作到达多少个节点才算成功。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e默认：多节点复制集不做任何设定，所以是有可能丢失数据。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ew: \u0026#34;majority\u0026#34;\u003c/code\u003e：大部分节点确认，就视为写成功\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ew: \u0026#34;all\u0026#34;\u003c/code\u003e：全部节点确认，才视为写成功\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ejournal 则定义如何才算成功。取值包括：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003etrue\u003c/code\u003e：写操作落到 journal 文件中才算成功；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003efalse\u003c/code\u003e：写操作达到内存即算作成功。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e【示例】在集群中使用 writeConcern 参数\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003edb.\u003cspan class=\"property\"\u003etransaction\u003c/span\u003e.\u003cspan class=\"title function_\"\u003einsert\u003c/span\u003e({ \u003cspan class=\"attr\"\u003ecount\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e }, { \u003cspan class=\"attr\"\u003ewriteConcern\u003c/span\u003e: { \u003cspan class=\"attr\"\u003ew\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;majoriy\u0026#39;\u003c/span\u003e } })\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edb.\u003cspan class=\"property\"\u003etransaction\u003c/span\u003e.\u003cspan class=\"title function_\"\u003einsert\u003c/span\u003e({ \u003cspan class=\"attr\"\u003ecount\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e }, { \u003cspan class=\"attr\"\u003ewriteConcern\u003c/span\u003e: { \u003cspan class=\"attr\"\u003ew\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;4\u0026#39;\u003c/span\u003e } })\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edb.\u003cspan class=\"property\"\u003etransaction\u003c/span\u003e.\u003cspan class=\"title function_\"\u003einsert\u003c/span\u003e({ \u003cspan class=\"attr\"\u003ecount\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e }, { \u003cspan class=\"attr\"\u003ewriteConcern\u003c/span\u003e: { \u003cspan class=\"attr\"\u003ew\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;all\u0026#39;\u003c/span\u003e } })\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e【示例】配置延迟节点，模拟网络延迟\u003c/p\u003e\n\u003cfigure class=\"highlight routeros\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003econf\u003c/span\u003e=rs.conf()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econf.memebers[2].\u003cspan class=\"attribute\"\u003eslaveDelay\u003c/span\u003e=5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econf.memebers[2].\u003cspan class=\"attribute\"\u003epriority\u003c/span\u003e=0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ers.reconfig(conf)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n    \u003c/div\u003e",
  "Date": "2020-09-20T15:12:17Z",
  "Author": "钝悟 ◾ Dunwu"
}