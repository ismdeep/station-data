{
  "Source": "dunwu",
  "Title": "Hive 常用 DML 操作",
  "Link": "https://dunwu.github.io/blog/pages/45f4c1/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"Hive-常用-DML-操作\"\u003e\u003ca href=\"#Hive-常用-DML-操作\" class=\"headerlink\" title=\"Hive 常用 DML 操作\"\u003e\u003c/a\u003eHive 常用 DML 操作\u003c/h1\u003e\u003ch2 id=\"加载文件数据到表\"\u003e\u003ca href=\"#加载文件数据到表\" class=\"headerlink\" title=\"加载文件数据到表\"\u003e\u003c/a\u003e加载文件数据到表\u003c/h2\u003e\u003ch3 id=\"语法\"\u003e\u003ca href=\"#语法\" class=\"headerlink\" title=\"语法\"\u003e\u003c/a\u003e语法\u003c/h3\u003e\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eLOAD DATA [LOCAL] INPATH \u0026#39;filepath\u0026#39; [OVERWRITE]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eINTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eLOCAL\u003c/code\u003e 关键字代表从本地文件系统加载文件，省略则代表从 HDFS 上加载文件：\u003c/li\u003e\n\u003cli\u003e从本地文件系统加载文件时， \u003ccode\u003efilepath\u003c/code\u003e 可以是绝对路径也可以是相对路径 (建议使用绝对路径)；\u003c/li\u003e\n\u003cli\u003e从 HDFS 加载文件时候，\u003ccode\u003efilepath\u003c/code\u003e 为文件完整的 URL 地址：如 \u003ccode\u003ehdfs://namenode:port/user/hive/project/ data1\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003efilepath\u003c/code\u003e 可以是文件路径 (在这种情况下 Hive 会将文件移动到表中)，也可以目录路径 (在这种情况下，Hive 会将该目录中的所有文件移动到表中)；\u003c/li\u003e\n\u003cli\u003e如果使用 \u003ccode\u003eOVERWRITE\u003c/code\u003e 关键字，则将删除目标表（或分区）的内容，使用新的数据填充；不使用此关键字，则数据以追加的方式加入；\u003c/li\u003e\n\u003cli\u003e加载的目标可以是表或分区。如果是分区表，则必须指定加载数据的分区；\u003c/li\u003e\n\u003cli\u003e加载文件的格式必须与建表时使用 \u003ccode\u003eSTORED AS\u003c/code\u003e 指定的存储格式相同。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e使用建议：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e不论是本地路径还是 URL 都建议使用完整的\u003c/strong\u003e。虽然可以使用不完整的 URL 地址，此时 Hive 将使用 hadoop 中的 fs.default.name 配置来推断地址，但是为避免不必要的错误，建议使用完整的本地路径或 URL 地址；\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e加载对象是分区表时建议显示指定分区\u003c/strong\u003e。在 Hive 3.0 之后，内部将加载 (LOAD) 重写为 INSERT AS SELECT，此时如果不指定分区，INSERT AS SELECT 将假设最后一组列是分区列，如果该列不是表定义的分区，它将抛出错误。为避免错误，还是建议显示指定分区。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"示例\"\u003e\u003ca href=\"#示例\" class=\"headerlink\" title=\"示例\"\u003e\u003c/a\u003e示例\u003c/h3\u003e\u003cp\u003e新建分区表：\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e emp_ptn(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  empno \u003cspan class=\"type\"\u003eINT\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  ename STRING,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  job STRING,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  mgr \u003cspan class=\"type\"\u003eINT\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  hiredate \u003cspan class=\"type\"\u003eTIMESTAMP\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  sal \u003cspan class=\"type\"\u003eDECIMAL\u003c/span\u003e(\u003cspan class=\"number\"\u003e7\u003c/span\u003e,\u003cspan class=\"number\"\u003e2\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  comm \u003cspan class=\"type\"\u003eDECIMAL\u003c/span\u003e(\u003cspan class=\"number\"\u003e7\u003c/span\u003e,\u003cspan class=\"number\"\u003e2\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  PARTITIONED \u003cspan class=\"keyword\"\u003eBY\u003c/span\u003e (deptno \u003cspan class=\"type\"\u003eINT\u003c/span\u003e)   \u003cspan class=\"comment\"\u003e-- 按照部门编号进行分区\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"type\"\u003eROW\u003c/span\u003e FORMAT DELIMITED FIELDS TERMINATED \u003cspan class=\"keyword\"\u003eBY\u003c/span\u003e \u0026#34;\\t\u0026#34;;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e从 HDFS 上加载数据到分区表：\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eLOAD DATA  INPATH \u0026#34;hdfs://hadoop001:8020/mydir/emp.txt\u0026#34; OVERWRITE \u003cspan class=\"keyword\"\u003eINTO\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e emp_ptn \u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e (deptno\u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u003cspan class=\"number\"\u003e20\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eemp.txt 文件可在本仓库的 resources 目录中下载\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e加载后表中数据如下,分区列 deptno 全部赋值成 20：\u003c/p\u003e\n\u003ch2 id=\"查询结果插入到表\"\u003e\u003ca href=\"#查询结果插入到表\" class=\"headerlink\" title=\"查询结果插入到表\"\u003e\u003c/a\u003e查询结果插入到表\u003c/h2\u003e\u003ch3 id=\"语法-1\"\u003e\u003ca href=\"#语法-1\" class=\"headerlink\" title=\"语法\"\u003e\u003c/a\u003e语法\u003c/h3\u003e\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e OVERWRITE \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e tablename1 [\u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e (partcol1\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval1, partcol2\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval2 ...) [IF \u003cspan class=\"keyword\"\u003eNOT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eEXISTS\u003c/span\u003e]]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eselect_statement1 \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e from_statement;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eINTO\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e tablename1 [\u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e (partcol1\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval1, partcol2\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval2 ...)]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eselect_statement1 \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e from_statement;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eHive 0.13.0 开始，建表时可以通过使用 TBLPROPERTIES（“immutable”=“true”）来创建不可变表 (immutable table) ，如果不可以变表中存在数据，则 INSERT INTO 失败。（注：INSERT OVERWRITE 的语句不受 \u003ccode\u003eimmutable\u003c/code\u003e 属性的影响）;\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e可以对表或分区执行插入操作。如果表已分区，则必须通过指定所有分区列的值来指定表的特定分区；\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e从 Hive 1.1.0 开始，TABLE 关键字是可选的；\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e从 Hive 1.2.0 开始 ，可以采用 \u003ccode\u003eINSERT INTO tablename(z，x，c1)\u003c/code\u003e 指明插入列；\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e可以将 SELECT 语句的查询结果插入多个表（或分区），称为多表插入。语法如下：\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e from_statement\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e OVERWRITE \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e tablename1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[\u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e (partcol1\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval1, partcol2\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval2 ...) [IF \u003cspan class=\"keyword\"\u003eNOT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eEXISTS\u003c/span\u003e]] select_statement1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e OVERWRITE \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e tablename2 [\u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e ... [IF \u003cspan class=\"keyword\"\u003eNOT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eEXISTS\u003c/span\u003e]] select_statement2]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eINTO\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e tablename2 [\u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e ...] select_statement2] ...;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"动态插入分区\"\u003e\u003ca href=\"#动态插入分区\" class=\"headerlink\" title=\"动态插入分区\"\u003e\u003c/a\u003e动态插入分区\u003c/h3\u003e\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e OVERWRITE \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e tablename \u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e (partcol1[\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval1], partcol2[\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval2] ...)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eselect_statement \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e from_statement;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eINTO\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e tablename \u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e (partcol1[\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval1], partcol2[\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval2] ...)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eselect_statement \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e from_statement;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e在向分区表插入数据时候，分区列名是必须的，但是列值是可选的。如果给出了分区列值，我们将其称为静态分区，否则它是动态分区。动态分区列必须在 \u003ccode\u003eSELECT\u003c/code\u003e 语句的列中最后指定，并且与它们在 PARTITION() 子句中出现的顺序相同。\u003c/p\u003e\n\u003cp\u003e注意：Hive 0.9.0 之前的版本动态分区插入是默认禁用的，而 0.9.0 之后的版本则默认启用。以下是动态分区的相关配置：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e配置\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003ehive.exec.dynamic.partition\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003etrue\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e需要设置为 true 才能启用动态分区插入\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003ehive.exec.dynamic.partition.mode\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003estrict\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e在严格模式 (strict) 下，用户必须至少指定一个静态分区，以防用户意外覆盖所有分区，在非严格模式下，允许所有分区都是动态的\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003ehive.exec.max.dynamic.partitions.pernode\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e100\u003c/td\u003e\n\u003ctd\u003e允许在每个 mapper/reducer 节点中创建的最大动态分区数\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003ehive.exec.max.dynamic.partitions\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e1000\u003c/td\u003e\n\u003ctd\u003e允许总共创建的最大动态分区数\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003ehive.exec.max.created.files\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e100000\u003c/td\u003e\n\u003ctd\u003e作业中所有 mapper/reducer 创建的 HDFS 文件的最大数量\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003ehive.error.on.empty.partition\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003efalse\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e如果动态分区插入生成空结果，是否抛出异常\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch3 id=\"示例-1\"\u003e\u003ca href=\"#示例-1\" class=\"headerlink\" title=\"示例\"\u003e\u003c/a\u003e示例\u003c/h3\u003e\u003cp\u003e（1）新建 emp 表，作为查询对象表\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e emp(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    empno \u003cspan class=\"type\"\u003eINT\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ename STRING,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    job STRING,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    mgr \u003cspan class=\"type\"\u003eINT\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    hiredate \u003cspan class=\"type\"\u003eTIMESTAMP\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    sal \u003cspan class=\"type\"\u003eDECIMAL\u003c/span\u003e(\u003cspan class=\"number\"\u003e7\u003c/span\u003e,\u003cspan class=\"number\"\u003e2\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    comm \u003cspan class=\"type\"\u003eDECIMAL\u003c/span\u003e(\u003cspan class=\"number\"\u003e7\u003c/span\u003e,\u003cspan class=\"number\"\u003e2\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    deptno \u003cspan class=\"type\"\u003eINT\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"type\"\u003eROW\u003c/span\u003e FORMAT DELIMITED FIELDS TERMINATED \u003cspan class=\"keyword\"\u003eBY\u003c/span\u003e \u0026#34;\\t\u0026#34;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003cspan class=\"comment\"\u003e-- 加载数据到 emp 表中 这里直接从本地加载\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eload data \u003cspan class=\"keyword\"\u003elocal\u003c/span\u003e inpath \u0026#34;/usr/file/emp.txt\u0026#34; \u003cspan class=\"keyword\"\u003einto\u003c/span\u003e \u003cspan class=\"keyword\"\u003etable\u003c/span\u003e emp;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e完成后 \u003ccode\u003eemp\u003c/code\u003e 表中数据如下：\u003c/p\u003e\n\u003cp\u003e（2）为清晰演示，先清空 \u003ccode\u003eemp_ptn\u003c/code\u003e 表中加载的数据：\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eTRUNCATE\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e emp_ptn;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（3）静态分区演示：从 \u003ccode\u003eemp\u003c/code\u003e 表中查询部门编号为 20 的员工数据，并插入 \u003ccode\u003eemp_ptn\u003c/code\u003e 表中，语句如下：\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e OVERWRITE \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e emp_ptn \u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e (deptno\u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u003cspan class=\"number\"\u003e20\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eSELECT\u003c/span\u003e empno,ename,job,mgr,hiredate,sal,comm \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e emp \u003cspan class=\"keyword\"\u003eWHERE\u003c/span\u003e deptno\u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u003cspan class=\"number\"\u003e20\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e完成后 \u003ccode\u003eemp_ptn\u003c/code\u003e 表中数据如下：\u003c/p\u003e\n\u003cp\u003e（4）接着演示动态分区：\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e-- 由于我们只有一个分区，且还是动态分区，所以需要关闭严格默认。因为在严格模式下，用户必须至少指定一个静态分区\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eset\u003c/span\u003e hive.exec.dynamic.partition.mode\u003cspan class=\"operator\"\u003e=\u003c/span\u003enonstrict;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e-- 动态分区   此时查询语句的最后一列为动态分区列，即 deptno\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e OVERWRITE \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e emp_ptn \u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e (deptno)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eSELECT\u003c/span\u003e empno,ename,job,mgr,hiredate,sal,comm,deptno \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e emp \u003cspan class=\"keyword\"\u003eWHERE\u003c/span\u003e deptno\u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u003cspan class=\"number\"\u003e30\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e完成后 \u003ccode\u003eemp_ptn\u003c/code\u003e 表中数据如下：\u003c/p\u003e\n\u003ch2 id=\"使用-SQL-语句插入值\"\u003e\u003ca href=\"#使用-SQL-语句插入值\" class=\"headerlink\" title=\"使用 SQL 语句插入值\"\u003e\u003c/a\u003e使用 SQL 语句插入值\u003c/h2\u003e\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eINTO\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e tablename [\u003cspan class=\"keyword\"\u003ePARTITION\u003c/span\u003e (partcol1[\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval1], partcol2[\u003cspan class=\"operator\"\u003e=\u003c/span\u003eval2] ...)]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eVALUES\u003c/span\u003e ( \u003cspan class=\"keyword\"\u003evalue\u003c/span\u003e [, \u003cspan class=\"keyword\"\u003evalue\u003c/span\u003e ...] )\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e使用时必须为表中的每个列都提供值。不支持只向部分列插入值（可以为缺省值的列提供空值来消除这个弊端）；\u003c/li\u003e\n\u003cli\u003e如果目标表表支持 ACID 及其事务管理器，则插入后自动提交；\u003c/li\u003e\n\u003cli\u003e不支持支持复杂类型 (array, map, struct, union) 的插入。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"更新和删除数据\"\u003e\u003ca href=\"#更新和删除数据\" class=\"headerlink\" title=\"更新和删除数据\"\u003e\u003c/a\u003e更新和删除数据\u003c/h2\u003e\u003ch3 id=\"语法-2\"\u003e\u003ca href=\"#语法-2\" class=\"headerlink\" title=\"语法\"\u003e\u003c/a\u003e语法\u003c/h3\u003e\u003cp\u003e更新和删除的语法比较简单，和关系型数据库一致。需要注意的是这两个操作都只能在支持 ACID 的表，也就是事务表上才能执行。\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e-- 更新\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eUPDATE\u003c/span\u003e tablename \u003cspan class=\"keyword\"\u003eSET\u003c/span\u003e \u003cspan class=\"keyword\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003evalue\u003c/span\u003e [, \u003cspan class=\"keyword\"\u003ecolumn\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003evalue\u003c/span\u003e ...] [\u003cspan class=\"keyword\"\u003eWHERE\u003c/span\u003e expression]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e--删除\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eDELETE\u003c/span\u003e \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e tablename [\u003cspan class=\"keyword\"\u003eWHERE\u003c/span\u003e expression]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"示例-2\"\u003e\u003ca href=\"#示例-2\" class=\"headerlink\" title=\"示例\"\u003e\u003c/a\u003e示例\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e1. 修改配置\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e首先需要更改 \u003ccode\u003ehive-site.xml\u003c/code\u003e，添加如下配置，开启事务支持，配置完成后需要重启 Hive 服务。\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003ehive.support.concurrency\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003etrue\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003ehive.enforce.bucketing\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003etrue\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003ehive.exec.dynamic.partition.mode\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003enonstrict\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003ehive.txn.manager\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003eorg.apache.hadoop.hive.ql.lockmgr.DbTxnManager\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003ehive.compactor.initiator.on\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003etrue\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003ehive.in.test\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003ename\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003etrue\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003evalue\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eproperty\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cstrong\u003e2. 创建测试表\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e创建用于测试的事务表，建表时候指定属性 \u003ccode\u003etransactional = true\u003c/code\u003e 则代表该表是事务表。需要注意的是，按照\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions\"\u003e官方文档\u003c/a\u003e 的说明，目前 Hive 中的事务表有以下限制：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e必须是 buckets Table;\u003c/li\u003e\n\u003cli\u003e仅支持 ORC 文件格式；\u003c/li\u003e\n\u003cli\u003e不支持 LOAD DATA …语句。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e emp_ts(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  empno \u003cspan class=\"type\"\u003eint\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  ename String\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCLUSTERED \u003cspan class=\"keyword\"\u003eBY\u003c/span\u003e (empno) \u003cspan class=\"keyword\"\u003eINTO\u003c/span\u003e \u003cspan class=\"number\"\u003e2\u003c/span\u003e BUCKETS STORED \u003cspan class=\"keyword\"\u003eAS\u003c/span\u003e ORC\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eTBLPROPERTIES (\u0026#34;transactional\u0026#34;\u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u0026#34;true\u0026#34;);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cstrong\u003e3. 插入测试数据\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eINTO\u003c/span\u003e \u003cspan class=\"keyword\"\u003eTABLE\u003c/span\u003e emp_ts  \u003cspan class=\"keyword\"\u003eVALUES\u003c/span\u003e (\u003cspan class=\"number\"\u003e1\u003c/span\u003e,\u0026#34;ming\u0026#34;),(\u003cspan class=\"number\"\u003e2\u003c/span\u003e,\u0026#34;hong\u0026#34;);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e插入数据依靠的是 MapReduce 作业，执行成功后数据如下：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e4. 测试更新和删除\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e--更新数据\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eUPDATE\u003c/span\u003e emp_ts \u003cspan class=\"keyword\"\u003eSET\u003c/span\u003e ename \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u0026#34;lan\u0026#34;  \u003cspan class=\"keyword\"\u003eWHERE\u003c/span\u003e  empno\u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u003cspan class=\"number\"\u003e1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e--删除数据\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eDELETE\u003c/span\u003e \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e emp_ts \u003cspan class=\"keyword\"\u003eWHERE\u003c/span\u003e empno\u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u003cspan class=\"number\"\u003e2\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e更新和删除数据依靠的也是 MapReduce 作业，执行成功后数据如下：\u003c/p\u003e\n\u003ch2 id=\"查询结果写出到文件系统\"\u003e\u003ca href=\"#查询结果写出到文件系统\" class=\"headerlink\" title=\"查询结果写出到文件系统\"\u003e\u003c/a\u003e查询结果写出到文件系统\u003c/h2\u003e\u003ch3 id=\"语法-3\"\u003e\u003ca href=\"#语法-3\" class=\"headerlink\" title=\"语法\"\u003e\u003c/a\u003e语法\u003c/h3\u003e\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e OVERWRITE [\u003cspan class=\"keyword\"\u003eLOCAL\u003c/span\u003e] DIRECTORY directory1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  [\u003cspan class=\"type\"\u003eROW\u003c/span\u003e FORMAT row_format] [STORED \u003cspan class=\"keyword\"\u003eAS\u003c/span\u003e file_format]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eSELECT\u003c/span\u003e ... \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e ...\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eOVERWRITE 关键字表示输出文件存在时，先删除后再重新写入；\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e和 Load 语句一样，建议无论是本地路径还是 URL 地址都使用完整的；\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e写入文件系统的数据被序列化为文本，其中列默认由^A 分隔，行由换行符分隔。如果列不是基本类型，则将其序列化为 JSON 格式。其中行分隔符不允许自定义，但列分隔符可以自定义，如下：\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e-- 定义列分隔符为\u0026#39;\\t\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003einsert\u003c/span\u003e overwrite \u003cspan class=\"keyword\"\u003elocal\u003c/span\u003e directory \u003cspan class=\"string\"\u003e\u0026#39;./test-04\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003erow\u003c/span\u003e format delimited\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eFIELDS TERMINATED \u003cspan class=\"keyword\"\u003eBY\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;\\t\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCOLLECTION ITEMS TERMINATED \u003cspan class=\"keyword\"\u003eBY\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;,\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eMAP KEYS TERMINATED \u003cspan class=\"keyword\"\u003eBY\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eselect\u003c/span\u003e \u003cspan class=\"operator\"\u003e*\u003c/span\u003e \u003cspan class=\"keyword\"\u003efrom\u003c/span\u003e src;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"示例-3\"\u003e\u003ca href=\"#示例-3\" class=\"headerlink\" title=\"示例\"\u003e\u003c/a\u003e示例\u003c/h3\u003e\u003cp\u003e这里我们将上面创建的 \u003ccode\u003eemp_ptn\u003c/code\u003e 表导出到本地文件系统，语句如下：\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eINSERT\u003c/span\u003e OVERWRITE \u003cspan class=\"keyword\"\u003eLOCAL\u003c/span\u003e DIRECTORY \u003cspan class=\"string\"\u003e\u0026#39;/usr/file/ouput\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eROW\u003c/span\u003e FORMAT DELIMITED\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eFIELDS TERMINATED \u003cspan class=\"keyword\"\u003eBY\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;\\t\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"operator\"\u003e*\u003c/span\u003e \u003cspan class=\"keyword\"\u003eFROM\u003c/span\u003e emp_ptn;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e导出结果如下：\u003c/p\u003e\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions\"\u003eHive Transactions\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML\"\u003eHive Data Manipulation Language\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-02-24T13:14:47Z",
  "Author": "钝悟 ◾ Dunwu"
}