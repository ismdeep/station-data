{
  "Source": "dunwu",
  "Title": "RocketMQ FAQ",
  "Link": "https://dunwu.github.io/blog/pages/518800/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"RocketMQ-FAQ\"\u003e\u003ca href=\"#RocketMQ-FAQ\" class=\"headerlink\" title=\"RocketMQ FAQ\"\u003e\u003c/a\u003eRocketMQ FAQ\u003c/h1\u003e\u003ch2 id=\"API-问题\"\u003e\u003ca href=\"#API-问题\" class=\"headerlink\" title=\"API 问题\"\u003e\u003c/a\u003eAPI 问题\u003c/h2\u003e\u003ch3 id=\"connect-to-failed\"\u003e\u003ca href=\"#connect-to-failed\" class=\"headerlink\" title=\"connect to \u0026lt;172.17.0.1:10909\u0026gt; failed\"\u003e\u003c/a\u003econnect to \u003ccode\u003e\u0026lt;172.17.0.1:10909\u0026gt;\u003c/code\u003e failed\u003c/h3\u003e\u003cp\u003e启动后，Producer 客户端连接 RocketMQ 时报错：\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eorg.apache.rocketmq.remoting.exception.RemotingConnectException: connect to \u0026lt;\u003cspan class=\"number\"\u003e172.17\u003c/span\u003e\u003cspan class=\"number\"\u003e.0\u003c/span\u003e\u003cspan class=\"number\"\u003e.1\u003c/span\u003e:\u003cspan class=\"number\"\u003e10909\u003c/span\u003e\u0026gt; failed\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at org.apache.rocketmq.remoting.netty.NettyRemotingClient.invokeSync(NettyRemotingClient.java:\u003cspan class=\"number\"\u003e357\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:\u003cspan class=\"number\"\u003e343\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:\u003cspan class=\"number\"\u003e327\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:\u003cspan class=\"number\"\u003e290\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:\u003cspan class=\"number\"\u003e688\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendSelectImpl(DefaultMQProducerImpl.java:\u003cspan class=\"number\"\u003e901\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:\u003cspan class=\"number\"\u003e878\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:\u003cspan class=\"number\"\u003e873\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:\u003cspan class=\"number\"\u003e369\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at com.emrubik.uc.mdm.sync.utils.MdmInit.sendMessage(MdmInit.java:\u003cspan class=\"number\"\u003e62\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    at com.emrubik.uc.mdm.sync.utils.MdmInit.main(MdmInit.java:\u003cspan class=\"number\"\u003e2149\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e原因：RocketMQ 部署在虚拟机上，内网 ip 为 10.10.30.63，该虚拟机一个 docker0 网卡，ip 为 172.17.0.1。RocketMQ broker 启动时默认使用了 docker0 网卡，Producer 客户端无法连接 172.17.0.1，造成以上问题。\u003c/p\u003e\n\u003cp\u003e解决方案\u003c/p\u003e\n\u003cp\u003e（1）干掉 docker0 网卡或修改网卡名称\u003c/p\u003e\n\u003cp\u003e（2）停掉 broker，修改 broker 配置文件，重启 broker。\u003c/p\u003e\n\u003cp\u003e修改 conf/broker.conf，增加两行来指定启动 broker 的 IP：\u003c/p\u003e\n\u003cfigure class=\"highlight ini\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003enamesrvAddr\u003c/span\u003e = \u003cspan class=\"number\"\u003e10.10\u003c/span\u003e.\u003cspan class=\"number\"\u003e30.63\u003c/span\u003e:\u003cspan class=\"number\"\u003e9876\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003ebrokerIP1\u003c/span\u003e = \u003cspan class=\"number\"\u003e10.10\u003c/span\u003e.\u003cspan class=\"number\"\u003e30.63\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e启动时需要指定配置文件\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003enohup\u003c/span\u003e sh bin/mqbroker -n localhost:9876 -c conf/broker.conf \u0026amp;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n    \u003c/div\u003e",
  "Date": "2022-07-11T23:49:48Z",
  "Author": "钝悟 ◾ Dunwu"
}