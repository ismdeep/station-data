{
  "Source": "dunwu",
  "Title": "MongoDB 的聚合操作",
  "Link": "https://dunwu.github.io/blog/pages/75daa5/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"MongoDB-的聚合操作\"\u003e\u003ca href=\"#MongoDB-的聚合操作\" class=\"headerlink\" title=\"MongoDB 的聚合操作\"\u003e\u003c/a\u003eMongoDB 的聚合操作\u003c/h1\u003e\u003cp\u003e聚合操作处理数据记录并返回计算结果。聚合操作将来自多个 document 的值分组，并可以对分组的数据执行各种操作以返回单个结果。 MongoDB 提供了三种执行聚合的方式：聚合管道，map-reduce 函数和单一目的聚合方法。\u003c/p\u003e\n\u003ch2 id=\"Pipeline\"\u003e\u003ca href=\"#Pipeline\" class=\"headerlink\" title=\"Pipeline\"\u003e\u003c/a\u003ePipeline\u003c/h2\u003e\u003ch3 id=\"Pipeline-简介\"\u003e\u003ca href=\"#Pipeline-简介\" class=\"headerlink\" title=\"Pipeline 简介\"\u003e\u003c/a\u003ePipeline 简介\u003c/h3\u003e\u003cp\u003eMongoDB 的聚合框架以数据处理管道（Pipeline）的概念为模型。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eMongoDB 通过 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/method/db.collection.aggregate/#db.collection.aggregate\"\u003e\u003ccode\u003edb.collection.aggregate()\u003c/code\u003e\u003c/a\u003e 方法支持聚合操作\u003c/strong\u003e。并提供了 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/command/aggregate/#dbcmd.aggregate\"\u003e\u003ccode\u003eaggregate\u003c/code\u003e\u003c/a\u003e 命令来执行 pipeline。\u003c/p\u003e\n\u003cp\u003eMongoDB Pipeline 由多个阶段（\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/#aggregation-pipeline-operator-reference\"\u003estages\u003c/a\u003e）组成。每个阶段在 document 通过 pipeline 时都会对其进行转换。pipeline 阶段不需要为每个输入 document 都生成一个输出 document。例如，某些阶段可能会生成新 document 或过滤 document。\u003c/p\u003e\n\u003cp\u003e同一个阶段可以在 pipeline 中出现多次，但 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/out/#pipe._S_out\"\u003e\u003ccode\u003e$out\u003c/code\u003e\u003c/a\u003e、\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/merge/#pipe._S_merge\"\u003e\u003ccode\u003e$merge\u003c/code\u003e\u003c/a\u003e,和 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/geoNear/#pipe._S_geoNear\"\u003e\u003ccode\u003e$geoNear\u003c/code\u003e\u003c/a\u003e 阶段除外。所有可用 pipeline 阶段可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/#aggregation-pipeline-operator-reference\"\u003eAggregation Pipeline Stages\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20200921092725.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e第一阶段：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e 阶段按状态字段过滤 document，然后将状态等于“ A”的那些 document 传递到下一阶段。\u003c/li\u003e\n\u003cli\u003e第二阶段：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group\"\u003e\u003ccode\u003e$group\u003c/code\u003e\u003c/a\u003e 阶段按 cust_id 字段对 document 进行分组，以计算每个唯一 cust_id 的金额总和。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e最基本的管道阶段提供过滤器，其操作类似于查询和 document 转换（修改输出 document 形式）。\u003c/p\u003e\n\u003cp\u003e其他管道操作提供了用于按特定字段对 document 进行分组和排序的工具，以及用于汇总数组（包括 document 数组）内容的工具。另外，管道阶段可以将运算符用于诸如计算平均值或连接字符串之类的任务。\u003c/p\u003e\n\u003cp\u003e聚合管道也可以在分片 collection 上操作。\u003c/p\u003e\n\u003ch3 id=\"Pipeline-优化\"\u003e\u003ca href=\"#Pipeline-优化\" class=\"headerlink\" title=\"Pipeline 优化\"\u003e\u003c/a\u003ePipeline 优化\u003c/h3\u003e\u003ch4 id=\"投影优化\"\u003e\u003ca href=\"#投影优化\" class=\"headerlink\" title=\"投影优化\"\u003e\u003c/a\u003e投影优化\u003c/h4\u003e\u003cp\u003ePipeline 可以确定是否仅需要 document 中必填字段即可获得结果。\u003c/p\u003e\n\u003ch4 id=\"Pipeline-串行优化\"\u003e\u003ca href=\"#Pipeline-串行优化\" class=\"headerlink\" title=\"Pipeline 串行优化\"\u003e\u003c/a\u003ePipeline 串行优化\u003c/h4\u003e\u003cp\u003e（\u003ccode\u003e$project\u003c/code\u003e、\u003ccode\u003e$unset\u003c/code\u003e、\u003ccode\u003e$addFields\u003c/code\u003e、\u003ccode\u003e$set\u003c/code\u003e） + \u003ccode\u003e$match\u003c/code\u003e 串行优化\u003c/p\u003e\n\u003cp\u003e对于包含投影阶段（\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project\"\u003e\u003ccode\u003e$project\u003c/code\u003e\u003c/a\u003e 或 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/unset/#pipe._S_unset\"\u003e\u003ccode\u003e$unset\u003c/code\u003e\u003c/a\u003e 或 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/#pipe._S_addFields\"\u003e\u003ccode\u003e$addFields\u003c/code\u003e\u003c/a\u003e 或 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/set/#pipe._S_set\"\u003e\u003ccode\u003e$set\u003c/code\u003e\u003c/a\u003e），且后续跟随着 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e 阶段的 Pipeline ，MongoDB 会将所有 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e 阶段中不需要在投影阶段中计算出的值的过滤器，移动一个在投影阶段之前的新 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e 阶段。\u003c/p\u003e\n\u003cp\u003e如果 Pipeline 包含多个投影阶段 和 / 或 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e 阶段，则 MongoDB 将为每个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e 阶段执行此优化，将每个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e 过滤器移动到该过滤器不依赖的所有投影阶段之前。\u003c/p\u003e\n\u003cp\u003e【示例】Pipeline 串行优化示例\u003c/p\u003e\n\u003cp\u003e优化前：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$addFields\u003c/span\u003e: {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003emaxTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$max\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;$times\u0026#34;\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eminTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$min\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;$times\u0026#34;\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$project\u003c/span\u003e: {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e, \u003cspan class=\"attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e, \u003cspan class=\"attr\"\u003etimes\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e, \u003cspan class=\"attr\"\u003emaxTime\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e, \u003cspan class=\"attr\"\u003eminTime\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eavgTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$avg\u003c/span\u003e: [\u003cspan class=\"string\"\u003e\u0026#34;$maxTime\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;$minTime\u0026#34;\u003c/span\u003e] }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$match\u003c/span\u003e: {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;Joe Schmoe\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003emaxTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$lt\u003c/span\u003e: \u003cspan class=\"number\"\u003e20\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eminTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$gt\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eavgTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$gt\u003c/span\u003e: \u003cspan class=\"number\"\u003e7\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} }\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e优化后：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$match\u003c/span\u003e: { \u003cspan class=\"attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;Joe Schmoe\u0026#34;\u003c/span\u003e } },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$addFields\u003c/span\u003e: {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003emaxTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$max\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;$times\u0026#34;\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eminTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$min\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;$times\u0026#34;\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$match\u003c/span\u003e: { \u003cspan class=\"attr\"\u003emaxTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$lt\u003c/span\u003e: \u003cspan class=\"number\"\u003e20\u003c/span\u003e }, \u003cspan class=\"attr\"\u003eminTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$gt\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e } } },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$project\u003c/span\u003e: {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e, \u003cspan class=\"attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e, \u003cspan class=\"attr\"\u003etimes\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e, \u003cspan class=\"attr\"\u003emaxTime\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e, \u003cspan class=\"attr\"\u003eminTime\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eavgTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$avg\u003c/span\u003e: [\u003cspan class=\"string\"\u003e\u0026#34;$maxTime\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;$minTime\u0026#34;\u003c/span\u003e] }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$match\u003c/span\u003e: { \u003cspan class=\"attr\"\u003eavgTime\u003c/span\u003e: { \u003cspan class=\"attr\"\u003e$gt\u003c/span\u003e: \u003cspan class=\"number\"\u003e7\u003c/span\u003e } } }\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e说明：\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e{ name: \u0026#34;Joe Schmoe\u0026#34; }\u003c/code\u003e 不需要计算任何投影阶段的值，所以可以放在最前面。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e{ avgTime: { $gt: 7 } }\u003c/code\u003e 依赖 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project\"\u003e\u003ccode\u003e$project\u003c/code\u003e\u003c/a\u003e 阶段的 \u003ccode\u003eavgTime\u003c/code\u003e 字段，所以不能移动。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003emaxTime\u003c/code\u003e 和 \u003ccode\u003eminTime\u003c/code\u003e 字段被 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/#pipe._S_addFields\"\u003e\u003ccode\u003e$addFields\u003c/code\u003e\u003c/a\u003e 阶段所依赖，但自身不依赖其他，所以会新建一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e 阶段，并将其置于 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project\"\u003e\u003ccode\u003e$project\u003c/code\u003e\u003c/a\u003e 阶段之前。\u003c/p\u003e\n\u003ch4 id=\"Pipeline-并行优化\"\u003e\u003ca href=\"#Pipeline-并行优化\" class=\"headerlink\" title=\"Pipeline 并行优化\"\u003e\u003c/a\u003ePipeline 并行优化\u003c/h4\u003e\u003cp\u003e如果可能，优化阶段会将 Pipeline 阶段合并到其前身。通常，合并发生在任意序列重新排序优化之后。\u003c/p\u003e\n\u003ch5 id=\"sort-limit\"\u003e\u003ca href=\"#sort-limit\" class=\"headerlink\" title=\"$sort + $limit\"\u003e\u003c/a\u003e\u003ccode\u003e$sort\u003c/code\u003e + \u003ccode\u003e$limit\u003c/code\u003e\u003c/h5\u003e\u003cp\u003e当 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort\"\u003e\u003ccode\u003e$sort\u003c/code\u003e\u003c/a\u003e 在 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit\"\u003e\u003ccode\u003e$limit\u003c/code\u003e\u003c/a\u003e 之前时，如果没有中间阶段修改文档数量（例如 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind\"\u003e\u003ccode\u003e$unwind\u003c/code\u003e\u003c/a\u003e、\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group\"\u003e\u003ccode\u003e$group\u003c/code\u003e\u003c/a\u003e），则优化程序可以将 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit\"\u003e\u003ccode\u003e$limit\u003c/code\u003e\u003c/a\u003e 合并到 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort\"\u003e\u003ccode\u003e$sort\u003c/code\u003e\u003c/a\u003e 中。如果有管道阶段更改了 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort\"\u003e\u003ccode\u003e$sort\u003c/code\u003e\u003c/a\u003e 和 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit\"\u003e\u003ccode\u003e$limit\u003c/code\u003e\u003c/a\u003e 阶段之间的文档数，则 MongoDB 不会将 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit\"\u003e\u003ccode\u003e$limit\u003c/code\u003e\u003c/a\u003e 合并到 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort\"\u003e\u003ccode\u003e$sort\u003c/code\u003e\u003c/a\u003e 中。\u003c/p\u003e\n\u003cp\u003e【示例】\u003ccode\u003e$sort\u003c/code\u003e + \u003ccode\u003e$limit\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e优化前：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{ $sort : { age : -\u003cspan class=\"number\"\u003e1\u003c/span\u003e } },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ $project : { age : \u003cspan class=\"number\"\u003e1\u003c/span\u003e, status : \u003cspan class=\"number\"\u003e1\u003c/span\u003e, name : \u003cspan class=\"number\"\u003e1\u003c/span\u003e } },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$limit\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e优化后：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;$sort\u0026#34;\u003c/span\u003e : {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       \u003cspan class=\"string\"\u003e\u0026#34;sortKey\u0026#34;\u003c/span\u003e : {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e          \u003cspan class=\"string\"\u003e\u0026#34;age\u0026#34;\u003c/span\u003e : -\u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       \u003cspan class=\"string\"\u003e\u0026#34;limit\u0026#34;\u003c/span\u003e : \u003cspan class=\"title class_\"\u003eNumberLong\u003c/span\u003e(\u003cspan class=\"number\"\u003e5\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e},\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"string\"\u003e\u0026#34;$project\u0026#34;\u003c/span\u003e : {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         \u003cspan class=\"string\"\u003e\u0026#34;age\u0026#34;\u003c/span\u003e : \u003cspan class=\"number\"\u003e1\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         \u003cspan class=\"string\"\u003e\u0026#34;status\u0026#34;\u003c/span\u003e : \u003cspan class=\"number\"\u003e1\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         \u003cspan class=\"string\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e : \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch5 id=\"limit-limit\"\u003e\u003ca href=\"#limit-limit\" class=\"headerlink\" title=\"$limit + $limit\"\u003e\u003c/a\u003e\u003ccode\u003e$limit\u003c/code\u003e + \u003ccode\u003e$limit\u003c/code\u003e\u003c/h5\u003e\u003cp\u003e如果一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit\"\u003e\u003ccode\u003e$limit\u003c/code\u003e\u003c/a\u003e 紧随另一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit\"\u003e\u003ccode\u003e$limit\u003c/code\u003e\u003c/a\u003e，那么它们可以合并为一。\u003c/p\u003e\n\u003cp\u003e优化前：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$limit\u003c/span\u003e: \u003cspan class=\"number\"\u003e100\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$limit\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e优化后：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003e$limit\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch5 id=\"skip-skip\"\u003e\u003ca href=\"#skip-skip\" class=\"headerlink\" title=\"$skip + $skip\"\u003e\u003c/a\u003e\u003ccode\u003e$skip\u003c/code\u003e + \u003ccode\u003e$skip\u003c/code\u003e\u003c/h5\u003e\u003cp\u003e如果一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip\"\u003e\u003ccode\u003e$skip\u003c/code\u003e\u003c/a\u003e 紧随另一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip\"\u003e\u003ccode\u003e$skip\u003c/code\u003e\u003c/a\u003e ，那么它们可以合并为一。\u003c/p\u003e\n\u003cp\u003e优化前：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$skip\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$skip\u003c/span\u003e: \u003cspan class=\"number\"\u003e2\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e优化后：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003e$skip\u003c/span\u003e: \u003cspan class=\"number\"\u003e7\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch5 id=\"match-match\"\u003e\u003ca href=\"#match-match\" class=\"headerlink\" title=\"$match + $match\"\u003e\u003c/a\u003e\u003ccode\u003e$match\u003c/code\u003e + \u003ccode\u003e$match\u003c/code\u003e\u003c/h5\u003e\u003cp\u003e如果一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip\"\u003e\u003ccode\u003e$skip\u003c/code\u003e\u003c/a\u003e 紧随另一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip\"\u003e\u003ccode\u003e$skip\u003c/code\u003e\u003c/a\u003e ，那么它们可以通过 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/and/#exp._S_and\"\u003e\u003ccode\u003e$and\u003c/code\u003e\u003c/a\u003e 合并为一。\u003c/p\u003e\n\u003cp\u003e优化前：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$match\u003c/span\u003e: { \u003cspan class=\"attr\"\u003eyear\u003c/span\u003e: \u003cspan class=\"number\"\u003e2014\u003c/span\u003e } },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$match\u003c/span\u003e: { \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;A\u0026#34;\u003c/span\u003e } }\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e优化后：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003e$match\u003c/span\u003e: {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e$and\u003c/span\u003e: [{ \u003cspan class=\"attr\"\u003eyear\u003c/span\u003e: \u003cspan class=\"number\"\u003e2014\u003c/span\u003e }, { \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e }]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch5 id=\"lookup-unwind\"\u003e\u003ca href=\"#lookup-unwind\" class=\"headerlink\" title=\"$lookup + $unwind\"\u003e\u003c/a\u003e\u003ccode\u003e$lookup\u003c/code\u003e + \u003ccode\u003e$unwind\u003c/code\u003e\u003c/h5\u003e\u003cp\u003e如果一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind\"\u003e\u003ccode\u003e$unwind\u003c/code\u003e\u003c/a\u003e 紧随另一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup\"\u003e\u003ccode\u003e$lookup\u003c/code\u003e\u003c/a\u003e，并且 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind\"\u003e\u003ccode\u003e$unwind\u003c/code\u003e\u003c/a\u003e 在 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup\"\u003e\u003ccode\u003e$lookup\u003c/code\u003e\u003c/a\u003e 的 as 字段上运行时，优化程序可以将 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind\"\u003e\u003ccode\u003e$unwind\u003c/code\u003e\u003c/a\u003e 合并到 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup\"\u003e\u003ccode\u003e$lookup\u003c/code\u003e\u003c/a\u003e 阶段。这样可以避免创建较大的中间文档。\u003c/p\u003e\n\u003cp\u003e优化前：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003e$lookup\u003c/span\u003e: {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003efrom\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;otherCollection\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eas\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;resultingArray\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003elocalField\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;x\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eforeignField\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;y\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e},\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003cspan class=\"attr\"\u003e$unwind\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;$resultingArray\u0026#34;\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e优化后：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003e$lookup\u003c/span\u003e: {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003efrom\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;otherCollection\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eas\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;resultingArray\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003elocalField\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;x\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eforeignField\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;y\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eunwinding\u003c/span\u003e: { \u003cspan class=\"attr\"\u003epreserveNullAndEmptyArrays\u003c/span\u003e: \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"Pipeline-限制\"\u003e\u003ca href=\"#Pipeline-限制\" class=\"headerlink\" title=\"Pipeline 限制\"\u003e\u003c/a\u003ePipeline 限制\u003c/h3\u003e\u003cp\u003e结果集中的每个文档均受 BSON 文档大小限制（当前为 16 MB）\u003c/p\u003e\n\u003cp\u003ePipeline 的内存限制为 100 MB。\u003c/p\u003e\n\u003ch2 id=\"Map-Reduce\"\u003e\u003ca href=\"#Map-Reduce\" class=\"headerlink\" title=\"Map-Reduce\"\u003e\u003c/a\u003eMap-Reduce\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e聚合 pipeline 比 map-reduce 提供更好的性能和更一致的接口。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eMap-reduce 是一种数据处理范式，用于将大量数据汇总为有用的聚合结果。为了执行 map-reduce 操作，MongoDB 提供了 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/command/mapReduce/#dbcmd.mapReduce\"\u003e\u003ccode\u003emapReduce\u003c/code\u003e\u003c/a\u003e 数据库命令。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20200921155546.svg\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003e在上面的操作中，MongoDB 将 map 阶段应用于每个输入 document（即 collection 中与查询条件匹配的 document）。 map 函数分发出多个键-值对。对于具有多个值的那些键，MongoDB 应用 reduce 阶段，该阶段收集并汇总聚合的数据。然后，MongoDB 将结果存储在 collection 中。可选地，reduce 函数的输出可以通过 finalize 函数来进一步汇总聚合结果。\u003c/p\u003e\n\u003cp\u003eMongoDB 中的所有 map-reduce 函数都是 JavaScript，并在 mongod 进程中运行。 Map-reduce 操作将单个 collection 的 document 作为输入，并且可以在开始 map 阶段之前执行任意排序和限制。 mapReduce 可以将 map-reduce 操作的结果作为 document 返回，也可以将结果写入 collection。\u003c/p\u003e\n\u003ch2 id=\"单一目的聚合方法\"\u003e\u003ca href=\"#单一目的聚合方法\" class=\"headerlink\" title=\"单一目的聚合方法\"\u003e\u003c/a\u003e单一目的聚合方法\u003c/h2\u003e\u003cp\u003eMongoDB 支持一下单一目的的聚合操作：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/method/db.collection.estimatedDocumentCount/#db.collection.estimatedDocumentCount\"\u003e\u003ccode\u003edb.collection.estimatedDocumentCount()\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/method/db.collection.count/#db.collection.count\"\u003e\u003ccode\u003edb.collection.count()\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/method/db.collection.distinct/#db.collection.distinct\"\u003e\u003ccode\u003edb.collection.distinct()\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e所有这些操作都汇总了单个 collection 中的 document。尽管这些操作提供了对常见聚合过程的简单访问，但是它们相比聚合 pipeline 和 map-reduce，缺少灵活性和丰富的功能性。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20200921155935.svg\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"SQL-和-MongoDB-聚合对比\"\u003e\u003ca href=\"#SQL-和-MongoDB-聚合对比\" class=\"headerlink\" title=\"SQL 和 MongoDB 聚合对比\"\u003e\u003c/a\u003eSQL 和 MongoDB 聚合对比\u003c/h2\u003e\u003cp\u003eMongoDB pipeline 提供了许多等价于 SQL 中常见聚合语句的操作。\u003c/p\u003e\n\u003cp\u003e下表概述了常见的 SQL 聚合语句或函数和 MongoDB 聚合操作的映射表：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth align=\"left\"\u003eSQL Terms, Functions, and Concepts\u003c/th\u003e\n\u003cth align=\"left\"\u003eMongoDB Aggregation Operators\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eWHERE\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eGROUP BY\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group\"\u003e\u003ccode\u003e$group\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eHAVING\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\"\u003e\u003ccode\u003e$match\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eSELECT\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project\"\u003e\u003ccode\u003e$project\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eORDER BY\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort\"\u003e\u003ccode\u003e$sort\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eLIMIT\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit\"\u003e\u003ccode\u003e$limit\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eSUM()\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sum/#grp._S_sum\"\u003e\u003ccode\u003e$sum\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eCOUNT()\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sum/#grp._S_sum\"\u003e\u003ccode\u003e$sum\u003c/code\u003e\u003c/a\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sortByCount/#pipe._S_sortByCount\"\u003e\u003ccode\u003e$sortByCount\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eJOIN\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup\"\u003e\u003ccode\u003e$lookup\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eSELECT INTO NEW_TABLE\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/out/#pipe._S_out\"\u003e\u003ccode\u003e$out\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eMERGE INTO TABLE\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/merge/#pipe._S_merge\"\u003e\u003ccode\u003e$merge\u003c/code\u003e\u003c/a\u003e (Available starting in MongoDB 4.2)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eUNION ALL\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/unionWith/#pipe._S_unionWith\"\u003e\u003ccode\u003e$unionWith\u003c/code\u003e\u003c/a\u003e (Available starting in MongoDB 4.4)\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003e【示例】\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e56\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e57\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e59\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e60\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e61\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e62\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e63\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e65\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e66\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e67\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e68\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e69\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e70\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e71\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e72\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e73\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e74\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e75\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e76\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e77\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e78\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e79\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e80\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e81\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e82\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e83\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e84\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e85\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e86\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e87\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e88\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e89\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e90\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e91\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e92\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e93\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e94\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e95\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e96\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e97\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e98\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e99\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e100\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e101\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003edb.\u003cspan class=\"property\"\u003eorders\u003c/span\u003e.\u003cspan class=\"title function_\"\u003einsertMany\u003c/span\u003e([\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e1\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Ant O. Knee\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-01\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e25\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;oranges\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;apples\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e2\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Ant O. Knee\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-08\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e70\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;oranges\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e8\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;chocolates\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e3\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Busby Bee\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-08\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e50\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;oranges\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;pears\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e4\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Busby Bee\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-18\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e25\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [{ \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;oranges\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e }],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Busby Bee\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-19\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e50\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [{ \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;chocolates\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e }],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e6\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Cam Elot\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-19\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e35\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;carrots\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e1.0\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;apples\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e7\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Cam Elot\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-20\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e25\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [{ \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;oranges\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e }],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e8\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Don Quis\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-20\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e75\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;chocolates\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;apples\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e9\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Don Quis\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-20\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e55\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;carrots\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e5\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e1.0\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;apples\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      { \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;oranges\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003e_id\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ecust_id\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;Don Quis\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eord_date\u003c/span\u003e: \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eDate\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;2020-03-23\u0026#39;\u003c/span\u003e),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e25\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eitems\u003c/span\u003e: [{ \u003cspan class=\"attr\"\u003esku\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;oranges\u0026#39;\u003c/span\u003e, \u003cspan class=\"attr\"\u003eqty\u003c/span\u003e: \u003cspan class=\"number\"\u003e10\u003c/span\u003e, \u003cspan class=\"attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"number\"\u003e2.5\u003c/span\u003e }],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e])\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eSQL 和 MongoDB 聚合方式对比：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20200921200556.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e官方\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.mongodb.com/\"\u003eMongoDB 官网\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/mongodb/mongo\"\u003eMongoDB Github\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://university.mongodb.com/\"\u003eMongoDB 官方免费教程\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e教程\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.runoob.com/mongodb/mongodb-tutorial.html\"\u003eMongoDB 教程\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://time.geekbang.org/course/intro/100040001\"\u003eMongoDB 高手课\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-09-21T13:22:57Z",
  "Author": "钝悟 ◾ Dunwu"
}