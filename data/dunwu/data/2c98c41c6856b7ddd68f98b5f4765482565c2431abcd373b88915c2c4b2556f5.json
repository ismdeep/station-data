{
  "Source": "dunwu",
  "Title": "Flink Table API \u0026 SQL",
  "Link": "https://dunwu.github.io/blog/pages/2288d8/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"Flink-Table-API-SQL\"\u003e\u003ca href=\"#Flink-Table-API-SQL\" class=\"headerlink\" title=\"Flink Table API \u0026amp; SQL\"\u003e\u003c/a\u003eFlink Table API \u0026amp; SQL\u003c/h1\u003e\u003cp\u003eApache Flink 有两种关系型 API 来做流批统一处理：Table API 和 SQL。Table API 是用于 Scala 和 Java 语言的查询 API，它可以用一种非常直观的方式来组合使用选取、过滤、join 等关系型算子。Flink SQL 是基于 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://calcite.apache.org/\"\u003eApache Calcite\u003c/a\u003e 来实现的标准 SQL。无论输入是连续的（流式）还是有界的（批处理），在两个接口中指定的查询都具有相同的语义，并指定相同的结果。\u003c/p\u003e\n\u003cp\u003eTable API 和 SQL 两种 API 是紧密集成的，以及 DataStream API。你可以在这些 API 之间，以及一些基于这些 API 的库之间轻松的切换。比如，你可以先用 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/libs/cep/\"\u003eCEP\u003c/a\u003e 从 DataStream 中做模式匹配，然后用 Table API 来分析匹配的结果；或者你可以用 SQL 来扫描、过滤、聚合一个批式的表，然后再跑一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/libs/gelly/overview/\"\u003eGelly 图算法\u003c/a\u003e 来处理已经预处理好的数据。\u003c/p\u003e\n\u003ch2 id=\"jar-依赖\"\u003e\u003ca href=\"#jar-依赖\" class=\"headerlink\" title=\"jar 依赖\"\u003e\u003c/a\u003ejar 依赖\u003c/h2\u003e\u003cp\u003e必要依赖：\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eorg.apache.flink\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003eflink-table-api-java-bridge_2.11\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e1.14.4\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003eprovided\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e除此之外，如果你想在 IDE 本地运行你的程序，你需要添加下面的模块，具体用哪个取决于你使用哪个 Planner：\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eorg.apache.flink\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003eflink-table-planner_2.11\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e1.14.4\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003eprovided\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eorg.apache.flink\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003eflink-streaming-scala_2.11\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e1.14.4\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003eprovided\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e如果你想实现\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sourcessinks/\"\u003e自定义格式或连接器\u003c/a\u003e 用于（反）序列化行或一组\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/functions/udfs/\"\u003e用户定义的函数\u003c/a\u003e，下面的依赖就足够了，编译出来的 jar 文件可以直接给 SQL Client 使用：\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eorg.apache.flink\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003eflink-table-common\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e1.14.4\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003eprovided\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003escope\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"概念与通用-API\"\u003e\u003ca href=\"#概念与通用-API\" class=\"headerlink\" title=\"概念与通用 API\"\u003e\u003c/a\u003e概念与通用 API\u003c/h2\u003e\u003cp\u003eTable API 和 SQL 集成在同一套 API 中。 这套 API 的核心概念是\u003ccode\u003eTable\u003c/code\u003e，用作查询的输入和输出。\u003c/p\u003e\n\u003ch3 id=\"Table-API-和-SQL-程序的结构\"\u003e\u003ca href=\"#Table-API-和-SQL-程序的结构\" class=\"headerlink\" title=\"Table API 和 SQL 程序的结构\"\u003e\u003c/a\u003eTable API 和 SQL 程序的结构\u003c/h3\u003e\u003cp\u003e所有用于批处理和流处理的 Table API 和 SQL 程序都遵循相同的模式。\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e org.apache.flink.table.api.*;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e org.apache.flink.connector.datagen.table.DataGenOptions;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// Create a TableEnvironment for batch or streaming execution.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// See the \u0026#34;Create a TableEnvironment\u0026#34; section for details.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTableEnvironment\u003c/span\u003e \u003cspan class=\"variable\"\u003etableEnv\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e TableEnvironment.create(\u003cspan class=\"comment\"\u003e/*…*/\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// Create a source table\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003etableEnv.createTemporaryTable(\u003cspan class=\"string\"\u003e\u0026#34;SourceTable\u0026#34;\u003c/span\u003e, TableDescriptor.forConnector(\u003cspan class=\"string\"\u003e\u0026#34;datagen\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    .schema(Schema.newBuilder()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      .column(\u003cspan class=\"string\"\u003e\u0026#34;f0\u0026#34;\u003c/span\u003e, DataTypes.STRING())\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      .build())\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    .option(DataGenOptions.ROWS_PER_SECOND, \u003cspan class=\"number\"\u003e100\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    .build())\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// Create a sink table (using SQL DDL)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003etableEnv.executeSql(\u003cspan class=\"string\"\u003e\u0026#34;CREATE TEMPORARY TABLE SinkTable WITH (\u0026#39;connector\u0026#39; = \u0026#39;blackhole\u0026#39;) LIKE SourceTable\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// Create a Table object from a Table API query\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTable\u003c/span\u003e \u003cspan class=\"variable\"\u003etable2\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e tableEnv.from(\u003cspan class=\"string\"\u003e\u0026#34;SourceTable\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// Create a Table object from a SQL query\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTable\u003c/span\u003e \u003cspan class=\"variable\"\u003etable3\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e tableEnv.sqlQuery(\u003cspan class=\"string\"\u003e\u0026#34;SELECT * FROM SourceTable\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// Emit a Table API result Table to a TableSink, same for SQL result\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTableResult\u003c/span\u003e \u003cspan class=\"variable\"\u003etableResult\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e table2.executeInsert(\u003cspan class=\"string\"\u003e\u0026#34;SinkTable\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"创建-TableEnvironment\"\u003e\u003ca href=\"#创建-TableEnvironment\" class=\"headerlink\" title=\"创建 TableEnvironment\"\u003e\u003c/a\u003e创建 \u003ccode\u003eTableEnvironment\u003c/code\u003e\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eTableEnvironment\u003c/code\u003e 是 Table API 和 SQL 的核心概念。它负责:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在内部的 catalog 中注册 \u003ccode\u003eTable\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e注册外部的 catalog\u003c/li\u003e\n\u003cli\u003e加载可插拔模块\u003c/li\u003e\n\u003cli\u003e执行 SQL 查询\u003c/li\u003e\n\u003cli\u003e注册自定义函数 （scalar、table 或 aggregation）\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eDataStream\u003c/code\u003e 和 \u003ccode\u003eTable\u003c/code\u003e 之间的转换(面向 \u003ccode\u003eStreamTableEnvironment\u003c/code\u003e )\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"在-Catalog-中创建表\"\u003e\u003ca href=\"#在-Catalog-中创建表\" class=\"headerlink\" title=\"在 Catalog 中创建表\"\u003e\u003c/a\u003e在 Catalog 中创建表\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eTableEnvironment\u003c/code\u003e 维护着一个由标识符（identifier）创建的表 catalog 的映射。标识符由三个部分组成：catalog 名称、数据库名称以及对象名称。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eTable\u003c/code\u003e 可以是虚拟的（视图 \u003ccode\u003eVIEWS\u003c/code\u003e）也可以是常规的（表 \u003ccode\u003eTABLES\u003c/code\u003e）。视图 \u003ccode\u003eVIEWS\u003c/code\u003e可以从已经存在的\u003ccode\u003eTable\u003c/code\u003e中创建，一般是 Table API 或者 SQL 的查询结果。 表\u003ccode\u003eTABLES\u003c/code\u003e描述的是外部数据，例如文件、数据库表或者消息队列。\u003c/p\u003e\n\u003ch3 id=\"查询表\"\u003e\u003ca href=\"#查询表\" class=\"headerlink\" title=\"查询表\"\u003e\u003c/a\u003e查询表\u003c/h3\u003e\u003cp\u003eTable API 示例\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// get a TableEnvironment\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTableEnvironment\u003c/span\u003e \u003cspan class=\"variable\"\u003etableEnv\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e ...; \u003cspan class=\"comment\"\u003e// see \u0026#34;Create a TableEnvironment\u0026#34; section\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// register Orders table\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// scan registered Orders table\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTable\u003c/span\u003e \u003cspan class=\"variable\"\u003eorders\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e tableEnv.from(\u003cspan class=\"string\"\u003e\u0026#34;Orders\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// compute revenue for all customers from France\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTable\u003c/span\u003e \u003cspan class=\"variable\"\u003erevenue\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e orders\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  .filter($(\u003cspan class=\"string\"\u003e\u0026#34;cCountry\u0026#34;\u003c/span\u003e).isEqual(\u003cspan class=\"string\"\u003e\u0026#34;FRANCE\u0026#34;\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  .groupBy($(\u003cspan class=\"string\"\u003e\u0026#34;cID\u0026#34;\u003c/span\u003e), $(\u003cspan class=\"string\"\u003e\u0026#34;cName\u0026#34;\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  .select($(\u003cspan class=\"string\"\u003e\u0026#34;cID\u0026#34;\u003c/span\u003e), $(\u003cspan class=\"string\"\u003e\u0026#34;cName\u0026#34;\u003c/span\u003e), $(\u003cspan class=\"string\"\u003e\u0026#34;revenue\u0026#34;\u003c/span\u003e).sum().as(\u003cspan class=\"string\"\u003e\u0026#34;revSum\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// emit or convert Table\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// execute query\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eSQL 示例\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// get a TableEnvironment\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTableEnvironment\u003c/span\u003e \u003cspan class=\"variable\"\u003etableEnv\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e ...; \u003cspan class=\"comment\"\u003e// see \u0026#34;Create a TableEnvironment\u0026#34; section\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// register Orders table\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// compute revenue for all customers from France\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eTable\u003c/span\u003e \u003cspan class=\"variable\"\u003erevenue\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e tableEnv.sqlQuery(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;SELECT cID, cName, SUM(revenue) AS revSum \u0026#34;\u003c/span\u003e +\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;FROM Orders \u0026#34;\u003c/span\u003e +\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;WHERE cCountry = \u0026#39;FRANCE\u0026#39; \u0026#34;\u003c/span\u003e +\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;GROUP BY cID, cName\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// emit or convert Table\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// execute query\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"输出表\"\u003e\u003ca href=\"#输出表\" class=\"headerlink\" title=\"输出表\"\u003e\u003c/a\u003e输出表\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eTable\u003c/code\u003e 通过写入 \u003ccode\u003eTableSink\u003c/code\u003e 输出。\u003ccode\u003eTableSink\u003c/code\u003e 是一个通用接口，用于支持多种文件格式（如 CSV、Apache Parquet、Apache Avro）、存储系统（如 JDBC、Apache HBase、Apache Cassandra、Elasticsearch）或消息队列系统（如 Apache Kafka、RabbitMQ）。\u003c/p\u003e\n\u003cp\u003e批处理 \u003ccode\u003eTable\u003c/code\u003e 只能写入 \u003ccode\u003eBatchTableSink\u003c/code\u003e，而流处理 \u003ccode\u003eTable\u003c/code\u003e 需要指定写入 \u003ccode\u003eAppendStreamTableSink\u003c/code\u003e，\u003ccode\u003eRetractStreamTableSink\u003c/code\u003e 或者 \u003ccode\u003eUpsertStreamTableSink\u003c/code\u003e。\u003c/p\u003e\n\u003ch2 id=\"数据类型\"\u003e\u003ca href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"\u003e\u003c/a\u003e数据类型\u003c/h2\u003e\u003cp\u003e通用类型与（嵌套的）复合类型 （如：POJO、tuples、rows、Scala case 类) 都可以作为行的字段。\u003c/p\u003e\n\u003cp\u003e复合类型的字段任意的嵌套可被 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/functions/systemfunctions/#value-access-functions\"\u003e值访问函数\u003c/a\u003e 访问。\u003c/p\u003e\n\u003cp\u003e通用类型将会被视为一个黑箱，且可以被 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/functions/udfs/\"\u003e用户自定义函数\u003c/a\u003e 传递或引用。\u003c/p\u003e\n\u003ch2 id=\"SQL\"\u003e\u003ca href=\"#SQL\" class=\"headerlink\" title=\"SQL\"\u003e\u003c/a\u003eSQL\u003c/h2\u003e\u003cp\u003eFlink 支持以下语句：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/queries/overview/\"\u003eSELECT (Queries)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/create/\"\u003eCREATE TABLE, DATABASE, VIEW, FUNCTION\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/drop/\"\u003eDROP TABLE, DATABASE, VIEW, FUNCTION\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/alter/\"\u003eALTER TABLE, DATABASE, FUNCTION\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/insert/\"\u003eINSERT\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/queries/hints/\"\u003eSQL HINTS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/describe/\"\u003eDESCRIBE\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/explain/\"\u003eEXPLAIN\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/use/\"\u003eUSE\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/show/\"\u003eSHOW\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/load/\"\u003eLOAD\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/sql/unload/\"\u003eUNLOAD\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/dev/table/common/\"\u003eFlink 官方文档之 Flink Table API \u0026amp; SQL\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2022-03-18T06:33:03Z",
  "Author": "钝悟 ◾ Dunwu"
}