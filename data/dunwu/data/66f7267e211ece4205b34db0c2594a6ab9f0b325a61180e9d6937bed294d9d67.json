{
  "Source": "dunwu",
  "Title": "Redis 运维",
  "Link": "https://dunwu.github.io/blog/pages/537098/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"Redis-运维\"\u003e\u003ca href=\"#Redis-运维\" class=\"headerlink\" title=\"Redis 运维\"\u003e\u003c/a\u003eRedis 运维\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eRedis\u003c/strong\u003e 是一个高性能的 key-value 数据库。\u003c/p\u003e\n\u003cp\u003eSET 操作每秒钟 110000 次；GET 操作每秒钟 81000 次。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"Redis-安装\"\u003e\u003ca href=\"#Redis-安装\" class=\"headerlink\" title=\"Redis 安装\"\u003e\u003c/a\u003eRedis 安装\u003c/h2\u003e\u003ch3 id=\"Window-下安装\"\u003e\u003ca href=\"#Window-下安装\" class=\"headerlink\" title=\"Window 下安装\"\u003e\u003c/a\u003eWindow 下安装\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e下载地址：\u003c/strong\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/MSOpenTech/redis/releases\"\u003ehttps://github.com/MSOpenTech/redis/releases\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003eRedis 支持 32 位和 64 位。这个需要根据你系统平台的实际情况选择，这里我们下载 \u003cstrong\u003eRedis-x64-xxx.zip\u003c/strong\u003e压缩包到 C 盘，解压后，将文件夹重新命名为 \u003cstrong\u003eredis\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e打开一个 \u003cstrong\u003ecmd\u003c/strong\u003e 窗口 使用 cd 命令切换目录到 \u003cstrong\u003eC:\\redis\u003c/strong\u003e 运行 \u003cstrong\u003eredis-server.exe redis.windows.conf\u003c/strong\u003e 。\u003c/p\u003e\n\u003cp\u003e如果想方便的话，可以把 redis 的路径加到系统的环境变量里，这样就省得再输路径了，后面的那个 redis.windows.conf 可以省略，如果省略，会启用默认的。\u003c/p\u003e\n\u003cp\u003e这时候另启一个 cmd 窗口，原来的不要关闭，不然就无法访问服务端了。\u003c/p\u003e\n\u003cp\u003e切换到 redis 目录下运行 \u003cstrong\u003eredis-cli.exe -h 127.0.0.1 -p 6379\u003c/strong\u003e 。\u003c/p\u003e\n\u003ch3 id=\"Linux-下安装\"\u003e\u003ca href=\"#Linux-下安装\" class=\"headerlink\" title=\"Linux 下安装\"\u003e\u003c/a\u003eLinux 下安装\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e下载地址：\u003c/strong\u003e \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://redis.io/download%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E6%96%87%E6%A1%A3%E7%89%88%E6%9C%AC%E3%80%82\"\u003ehttp://redis.io/download，下载最新文档版本。\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e下载、解压、编译 Redis\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ewget http://download.redis.io/releases/redis-5.0.4.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003etar xzf redis-5.0.4.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecd redis-5.0.4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emake\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e为了编译 Redis 源码，你需要 gcc-c++和 tcl。如果你的系统是 CentOS，可以直接执行命令：\u003ccode\u003eyum install -y gcc-c++ tcl\u003c/code\u003e 来安装。\u003c/p\u003e\n\u003cp\u003e进入到解压后的 \u003ccode\u003esrc\u003c/code\u003e 目录，通过如下命令启动 Redis:\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esrc/redis-server\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e您可以使用内置的客户端与 Redis 进行交互:\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003esrc/redis-cli\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003eredis\u0026gt; \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u003cspan class=\"built_in\"\u003eset\u003c/span\u003e foo bar\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eOK\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003eredis\u0026gt; \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eget foo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u0026#34;bar\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"Ubuntu-下安装\"\u003e\u003ca href=\"#Ubuntu-下安装\" class=\"headerlink\" title=\"Ubuntu 下安装\"\u003e\u003c/a\u003eUbuntu 下安装\u003c/h3\u003e\u003cp\u003e在 Ubuntu 系统安装 Redis 可以使用以下命令:\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esudo apt-get update\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo apt-get install redis-server\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"开机启动\"\u003e\u003ca href=\"#开机启动\" class=\"headerlink\" title=\"开机启动\"\u003e\u003c/a\u003e开机启动\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e开机启动配置：\u003ccode\u003eecho \u0026#34;/usr/local/bin/redis-server /etc/redis.conf\u0026#34; \u0026gt;\u0026gt; /etc/rc.local\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"开放防火墙端口\"\u003e\u003ca href=\"#开放防火墙端口\" class=\"headerlink\" title=\"开放防火墙端口\"\u003e\u003c/a\u003e开放防火墙端口\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e添加规则：\u003ccode\u003eiptables -I INPUT -p tcp -m tcp --dport 6379 -j ACCEPT\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e保存规则：\u003ccode\u003eservice iptables save\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e重启 iptables：\u003ccode\u003eservice iptables restart\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"Redis-安装脚本\"\u003e\u003ca href=\"#Redis-安装脚本\" class=\"headerlink\" title=\"Redis 安装脚本\"\u003e\u003c/a\u003eRedis 安装脚本\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003eCentOS7 环境安装脚本：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/dunwu/linux-tutorial/tree/master/codes/linux/soft\"\u003e软件运维配置脚本集合\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e安装说明\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e采用编译方式安装 Redis, 并将其注册为 systemd 服务\u003c/li\u003e\n\u003cli\u003e安装路径为：\u003ccode\u003e/usr/local/redis\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e默认下载安装 \u003ccode\u003e5.0.4\u003c/code\u003e 版本，端口号为：\u003ccode\u003e6379\u003c/code\u003e，密码为空\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e使用方法\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e默认安装 - 执行以下任意命令即可：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecurl -o- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewget -qO- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e自定义安装 - 下载脚本到本地，并按照以下格式执行：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esh redis-install.sh [version] [port] [password]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e参数说明：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eversion\u003c/code\u003e - redis 版本号\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eport\u003c/code\u003e - redis 服务端口号\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epassword\u003c/code\u003e - 访问密码\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"Redis-单机使用和配置\"\u003e\u003ca href=\"#Redis-单机使用和配置\" class=\"headerlink\" title=\"Redis 单机使用和配置\"\u003e\u003c/a\u003eRedis 单机使用和配置\u003c/h2\u003e\u003ch3 id=\"启动-Redis\"\u003e\u003ca href=\"#启动-Redis\" class=\"headerlink\" title=\"启动 Redis\"\u003e\u003c/a\u003e启动 Redis\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003e启动 redis 服务\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecd /usr/local/redis/src\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e./redis-server\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cstrong\u003e启动 redis 客户端\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecd /usr/local/redis/src\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e./redis-cli\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cstrong\u003e查看 redis 是否启动\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eredis-cli\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e以上命令将打开以下终端：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eredis 127.0.0.1:6379\u0026gt;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e127.0.0.1 是本机 IP ，6379 是 redis 服务端口。现在我们输入 PING 命令。\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eredis 127.0.0.1:6379\u0026gt; ping\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ePONG\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e以上说明我们已经成功启动了 redis。\u003c/p\u003e\n\u003ch3 id=\"Redis-常见配置\"\u003e\u003ca href=\"#Redis-常见配置\" class=\"headerlink\" title=\"Redis 常见配置\"\u003e\u003c/a\u003eRedis 常见配置\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003eRedis 默认的配置文件是根目录下的 \u003ccode\u003eredis.conf\u003c/code\u003e 文件。\u003c/p\u003e\n\u003cp\u003e如果需要指定特定文件作为配置文件，需要使用命令： \u003ccode\u003e./redis-server -c xxx.conf\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e每次修改配置后，需要重启才能生效。\u003c/p\u003e\n\u003cp\u003eRedis 官方默认配置：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自描述文档 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://raw.githubusercontent.com/antirez/redis/2.8/redis.conf\"\u003eredis.conf for Redis 2.8\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e自描述文档 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://raw.githubusercontent.com/antirez/redis/2.6/redis.conf\"\u003eredis.conf for Redis 2.6\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e自描述文档 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://raw.githubusercontent.com/antirez/redis/2.4/redis.conf\"\u003eredis.conf for Redis 2.4\u003c/a\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e自 Redis2.6 起就可以直接通过命令行传递 Redis 配置参数。这种方法可以用于测试。自 Redis2.6 起就可以直接通过命令行传递 Redis 配置参数。这种方法可以用于测试。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"设为守护进程\"\u003e\u003ca href=\"#设为守护进程\" class=\"headerlink\" title=\"设为守护进程\"\u003e\u003c/a\u003e设为守护进程\u003c/h3\u003e\u003cp\u003eRedis 默认以非守护进程方式启动，而通常我们会将 Redis 设为守护进程启动方式，配置：\u003ccode\u003edaemonize yes\u003c/code\u003e\u003c/p\u003e\n\u003ch4 id=\"远程访问\"\u003e\u003ca href=\"#远程访问\" class=\"headerlink\" title=\"远程访问\"\u003e\u003c/a\u003e远程访问\u003c/h4\u003e\u003cp\u003eRedis 默认绑定 127.0.0.1，这样就只能本机才能访问，若要 Redis 允许远程访问，需要配置：\u003ccode\u003ebind 0.0.0.0\u003c/code\u003e\u003c/p\u003e\n\u003ch4 id=\"设置密码\"\u003e\u003ca href=\"#设置密码\" class=\"headerlink\" title=\"设置密码\"\u003e\u003c/a\u003e设置密码\u003c/h4\u003e\u003cp\u003eRedis 默认访问不需要密码，如果需要设置密码，需要如下配置：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eprotected-mode yes\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003erequirepass \u0026lt;密码\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"配置参数表\"\u003e\u003ca href=\"#配置参数表\" class=\"headerlink\" title=\"配置参数表\"\u003e\u003c/a\u003e配置参数表\u003c/h4\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth align=\"left\"\u003e配置项\u003c/th\u003e\n\u003cth align=\"left\"\u003e说明\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003edaemonize no\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003eRedis 默认不是以守护进程的方式运行，可以通过该配置项修改，使用 yes 启用守护进程（Windows 不支持守护线程的配置为 no ）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003epidfile /var/run/redis.pid\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e当 Redis 以守护进程方式运行时，Redis 默认会把 pid 写入 /var/run/redis.pid 文件，可以通过 pidfile 指定\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eport 6379\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定 Redis 监听端口，默认端口为 6379，作者在自己的一篇博文中解释了为什么选用 6379 作为默认端口，因为 6379 在手机按键上 MERZ 对应的号码，而 MERZ 取自意大利歌女 Alessia Merz 的名字\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003ebind 127.0.0.1\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e绑定的主机地址\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003etimeout 300\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e当客户端闲置多长时间后关闭连接，如果指定为 0，表示关闭该功能\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eloglevel notice\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定日志记录级别，Redis 总共支持四个级别：debug、verbose、notice、warning，默认为 notice\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003elogfile stdout\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e日志记录方式，默认为标准输出，如果配置 Redis 为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发送给 /dev/null\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003edatabases 16\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e设置数据库的数量，默认数据库为 0，可以使用 SELECT 命令在连接上指定数据库 id\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003esave \u0026lt;seconds\u0026gt; \u0026lt;changes\u0026gt;\u003c/code\u003e Redis 默认配置文件中提供了三个条件：\u003cstrong\u003esave 900 1\u003c/strong\u003e、\u003cstrong\u003esave 300 10\u003c/strong\u003e、\u003cstrong\u003esave 60 10000\u003c/strong\u003e 分别表示 900 秒（15 分钟）内有 1 个更改，300 秒（5 分钟）内有 10 个更改以及 60 秒内有 10000 个更改。\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003erdbcompression yes\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定存储至本地数据库时是否压缩数据，默认为 yes，Redis 采用 LZF 压缩，如果为了节省 CPU 时间，可以关闭该选项，但会导致数据库文件变的巨大\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003edbfilename dump.rdb\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定本地数据库文件名，默认值为 dump.rdb\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003edir ./\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定本地数据库存放目录\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eslaveof \u0026lt;masterip\u0026gt; \u0026lt;masterport\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e设置当本机为 slav 服务时，设置 master 服务的 IP 地址及端口，在 Redis 启动时，它会自动从 master 进行数据同步\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003emasterauth \u0026lt;master-password\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e当 master 服务设置了密码保护时，slav 服务连接 master 的密码\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003erequirepass foobared\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e设置 Redis 连接密码，如果配置了连接密码，客户端在连接 Redis 时需要通过 \u003ccode\u003eAUTH \u0026lt;password\u0026gt;\u003c/code\u003e 命令提供密码，默认关闭\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003emaxclients 128\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e设置同一时间最大客户端连接数，默认无限制，Redis 可以同时打开的客户端连接数为 Redis 进程可以打开的最大文件描述符数，如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis 会关闭新的连接并向客户端返回 max number of clients reached 错误信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003emaxmemory \u0026lt;bytes\u0026gt;\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定 Redis 最大内存限制，Redis 在启动时会把数据加载到内存中，达到最大内存后，Redis 会先尝试清除已到期或即将到期的 Key，当此方法处理 后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis 新的 vm 机制，会把 Key 存放内存，Value 会存放在 swap 区\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eappendonly no\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定是否在每次更新操作后进行日志记录，Redis 在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为 redis 本身同步数据文件是按上面 save 条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为 no\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eappendfilename appendonly.aof\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定更新日志文件名，默认为 appendonly.aof\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eappendfsync everysec\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定更新日志条件，共有 3 个可选值：\u003cstrong\u003eno\u003c/strong\u003e：表示等操作系统进行数据缓存同步到磁盘（快）\u003cstrong\u003ealways\u003c/strong\u003e：表示每次更新操作后手动调用 fsync() 将数据写到磁盘（慢，安全）\u003cstrong\u003eeverysec\u003c/strong\u003e：表示每秒同步一次（折中，默认值）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003evm-enabled no\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定是否启用虚拟内存机制，默认值为 no，简单的介绍一下，VM 机制将数据分页存放，由 Redis 将访问量较少的页即冷数据 swap 到磁盘上，访问多的页面由磁盘自动换出到内存中（在后面的文章我会仔细分析 Redis 的 VM 机制）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003evm-swap-file /tmp/redis.swap\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e虚拟内存文件路径，默认值为 /tmp/redis.swap，不可多个 Redis 实例共享\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003evm-max-memory 0\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e将所有大于 vm-max-memory 的数据存入虚拟内存，无论 vm-max-memory 设置多小，所有索引数据都是内存存储的(Redis 的索引数据 就是 keys)，也就是说，当 vm-max-memory 设置为 0 的时候，其实是所有 value 都存在于磁盘。默认值为 0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003evm-page-size 32\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003eRedis swap 文件分成了很多的 page，一个对象可以保存在多个 page 上面，但一个 page 上不能被多个对象共享，vm-page-size 是要根据存储的 数据大小来设定的，作者建议如果存储很多小对象，page 大小最好设置为 32 或者 64bytes；如果存储很大大对象，则可以使用更大的 page，如果不确定，就使用默认值\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003evm-pages 134217728\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e设置 swap 文件中的 page 数量，由于页表（一种表示页面空闲或使用的 bitmap）是在放在内存中的，，在磁盘上每 8 个 pages 将消耗 1byte 的内存。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003evm-max-threads 4\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e设置访问 swap 文件的线程数,最好不要超过机器的核数,如果设置为 0,那么所有对 swap 文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为 4\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eglueoutputbuf yes\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e设置在向客户端应答时，是否把较小的包合并为一个包发送，默认为开启\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003ehash-max-zipmap-entries 64 hash-max-zipmap-value 512\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003eactiverehashing yes\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定是否激活重置哈希，默认为开启（后面在介绍 Redis 的哈希算法时具体介绍）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003e\u003ccode\u003einclude /path/to/local.conf\u003c/code\u003e\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定包含其它的配置文件，可以在同一主机上多个 Redis 实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch3 id=\"压力测试\"\u003e\u003ca href=\"#压力测试\" class=\"headerlink\" title=\"压力测试\"\u003e\u003c/a\u003e压力测试\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e参考官方文档：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/topics/benchmarks\"\u003eHow fast is Redis?\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eRedis 自带了一个性能测试工具：\u003ccode\u003eredis-benchmark\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e（1）基本测试\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eredis-benchmark -q -n 100000\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-q\u003c/code\u003e 表示静默（quiet）执行\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-n 100000\u003c/code\u003e 请求 10 万次\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e（2）测试指定读写指令\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eredis-benchmark -t \u003cspan class=\"built_in\"\u003eset\u003c/span\u003e,lpush -n 100000 -q\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eSET: 74239.05 requests per second\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eLPUSH: 79239.30 requests per second\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cstrong\u003e（3）测试 pipeline 模式下指定读写指令\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eredis-benchmark -n 1000000 -t set,get -P 16 -q\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eSET: 403063.28 requests per second\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eGET: 508388.41 requests per second\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"Redis-集群使用和配置\"\u003e\u003ca href=\"#Redis-集群使用和配置\" class=\"headerlink\" title=\"Redis 集群使用和配置\"\u003e\u003c/a\u003eRedis 集群使用和配置\u003c/h2\u003e\u003cp\u003eRedis 3.0 后支持集群模式。\u003c/p\u003e\n\u003ch3 id=\"集群规划\"\u003e\u003ca href=\"#集群规划\" class=\"headerlink\" title=\"集群规划\"\u003e\u003c/a\u003e集群规划\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eRedis\u003c/code\u003e 集群一般由 \u003cstrong\u003e多个节点\u003c/strong\u003e 组成，节点数量至少为 \u003ccode\u003e6\u003c/code\u003e 个，才能保证组成 \u003cstrong\u003e完整高可用\u003c/strong\u003e 的集群。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2019/10/10/16db5250b0d1c392?w=1467\u0026amp;h=803\u0026amp;f=png\u0026amp;s=43428\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003e理想情况当然是所有节点各自在不同的机器上，首先于资源，本人在部署 Redis 集群时，只得到 3 台服务器。所以，我计划每台服务器部署 2 个 Redis 节点。\u003c/p\u003e\n\u003cp\u003e【示例】最简高可用 Redis 集群规划\u003c/p\u003e\n\u003cp\u003e机器配置：16G 内存 + 8 核 CPU + 1T 磁盘\u003c/p\u003e\n\u003cp\u003eRedis 进程分配 10 G 内存。一般线上生产环境，Redis 的内存尽量不要超过 10g，超过 10g 可能会有问题。\u003c/p\u003e\n\u003cp\u003e集群拓扑：三主三从；三哨兵，每个哨兵监听所有主节点。\u003c/p\u003e\n\u003cp\u003e估算性能：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e容量：三主，占用 30 G 内存，所以最大存储容量为 30 G。假设每条数据记录平均 大小为 10 K，则最大能存储 300 万条数据。\u003c/li\u003e\n\u003cli\u003e吞吐量：单机一般 TPS/QPS 为 五万到八万左右。假设为五万，那么三主三从架构理论上能达到 TPS 15 万，QPS 30 万。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"部署集群\"\u003e\u003ca href=\"#部署集群\" class=\"headerlink\" title=\"部署集群\"\u003e\u003c/a\u003e部署集群\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003eRedis 集群节点的安装与单节点服务相同，差异仅在于部署方式。\u003c/p\u003e\n\u003cp\u003e注意：为了演示方便，本示例将所有 Redis 集群节点都部署在一台机器上，实际生产环境中，基本都会将节点部署在不同机器上。要求更高的，可能还要考虑多机房部署。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e（1）创建节点目录\u003c/p\u003e\n\u003cp\u003e我个人偏好将软件放在 \u003ccode\u003e/opt\u003c/code\u003e 目录下，在我的机器中，Redis 都安装在 \u003ccode\u003e/usr/local/redis\u003c/code\u003e 目录下。所以，下面的命令和配置都假设 Redis 安装目录为 \u003ccode\u003e/usr/local/redis\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e确保机器上已经安装了 Redis 后，执行以下命令，创建 Redis 集群节点实例目录：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esudo mkdir -p /usr/local/redis/conf/7001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo mkdir -p /usr/local/redis/conf/7002\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo mkdir -p /usr/local/redis/conf/7003\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo mkdir -p /usr/local/redis/conf/7004\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo mkdir -p /usr/local/redis/conf/7005\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo mkdir -p /usr/local/redis/conf/7006\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（2）配置集群节点\u003c/p\u003e\n\u003cp\u003e每个实例目录下，新建 \u003ccode\u003eredis.conf\u003c/code\u003e 配置文件。\u003c/p\u003e\n\u003cp\u003e实例配置模板以 7001 节点为例（其他节点，完全替换配置中的端口号 7001 即可），如下：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e端口号\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eport 7001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e绑定的主机端口（0.0.0.0 表示允许远程访问）\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ebind 0.0.0.0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e以守护进程方式启动\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edaemonize yes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e开启集群模式\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecluster-enabled yes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e集群的配置，配置文件首次启动自动生成\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecluster-config-file /usr/local/redis/conf/7001/7001.conf\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e请求超时时间，设置 10 秒\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecluster-node-timeout 10000\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e开启 AOF 持久化\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eappendonly yes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e数据存放目录\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edir /usr/local/redis/conf/7001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e进程文件\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epidfile /usr/local/redis/conf/7001/7001.pid\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e日志文件\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003elogfile /usr/local/redis/conf/7001/7001.log\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（3）批量启动 Redis 节点\u003c/p\u003e\n\u003cp\u003eRedis 的 utils/create-cluster 目录下自带了一个名为 create-cluster 的脚本工具，可以利用它来新建、启动、停止、重启 Redis 节点。\u003c/p\u003e\n\u003cp\u003e脚本中有几个关键参数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ePORT\u003c/code\u003e=30000 - 初始端口号\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eTIMEOUT\u003c/code\u003e=2000 - 超时时间\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eNODES\u003c/code\u003e=6 - 节点数\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eREPLICAS\u003c/code\u003e=1 - 备份数\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e脚本中的每个命令项会根据初始端口号，以及设置的节点数，遍历的去执行操作。\u003c/p\u003e\n\u003cp\u003e由于前面的规划中，节点端口是从 7001 ~ 7006，所以需要将 PORT 变量设为 7000。\u003c/p\u003e\n\u003cp\u003e脚本中启动每个 Redis 节点是通过指定命令行参数来配置属性。所以，我们需要改一下：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ePORT=7000\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eTIMEOUT=2000\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eNODES=6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eENDPORT=$((PORT+NODES))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eif [ \u0026#34;$1\u0026#34; == \u0026#34;start\u0026#34; ]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ethen\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    while [ $((PORT \u0026lt; ENDPORT)) != \u0026#34;0\u0026#34; ]; do\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        PORT=$((PORT+1))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo \u0026#34;Starting $PORT\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        /usr/local/redis/src/redis-server /usr/local/redis/conf/${PORT}/redis.conf\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    done\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    exit 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efi\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e好了，在每台服务器上，都执行 \u003ccode\u003e./create-cluster start\u003c/code\u003e 来启动节点。\u003c/p\u003e\n\u003cp\u003e然后，通过 ps 命令来确认 Redis 进程是否已经工作：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eroot @ dbClusterDev01 \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e /usr/local/redis/conf [11:07:55]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eps -ef | grep redis\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eroot      4604     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7001 [cluster]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eroot      4609     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7002 [cluster]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eroot      4614     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7003 [cluster]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eroot      4619     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7004 [cluster]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eroot      4624     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7005 [cluster]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eroot      4629     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7006 [cluster]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（4）启动集群\u003c/p\u003e\n\u003cp\u003e通过 \u003ccode\u003eredis-cli --cluster create\u003c/code\u003e 命令可以自动配置集群，如下：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e./redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.2:7003 127.0.0.2:7004 127.0.0.3:7005 127.0.0.3:7006 --cluster-replicas 1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eredis-cluster 会根据设置的节点数和副本数自动分片（分配 Hash 虚拟槽 slot），如果满意，输入 yes ，直接开始分片。\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u0026gt;\u0026gt; Performing \u003cspan class=\"built_in\"\u003ehash\u003c/span\u003e slots allocation on 6 nodes...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eMaster[0] -\u0026gt; Slots 0 - 5460\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eMaster[1] -\u0026gt; Slots 5461 - 10922\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eMaster[2] -\u0026gt; Slots 10923 - 16383\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eAdding replica 127.0.0.2:7004 to 127.0.0.1:7001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eAdding replica 127.0.0.3:7006 to 127.0.0.2:7003\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eAdding replica 127.0.0.1:7002 to 127.0.0.3:7005\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eM: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   slots:[0-5460] (5461 slots) master\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eS: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eM: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.2:7003\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   slots:[5461-10922] (5462 slots) master\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eS: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.2:7004\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eM: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.3:7005\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   slots:[10923-16383] (5461 slots) master\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eS: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.3:7006\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   replicates 91523c0391a044da6cc9f53bb965aabe89502187\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCan I set the above configuration? (type \u0026#39;yes\u0026#39; to accept): yes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u0026gt;\u0026gt; Nodes configuration updated\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u0026gt;\u0026gt; Assign a different config epoch to each node\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u0026gt;\u0026gt; Sending CLUSTER MEET messages to \u003cspan class=\"built_in\"\u003ejoin\u003c/span\u003e the cluster\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eWaiting for the cluster to join\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e....\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u0026gt;\u0026gt; Performing Cluster Check (using node 127.0.0.1:7001)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eM: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   slots:[0-5460] (5461 slots) master\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   1 additional replica(s)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eS: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.1:7006\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   slots: (0 slots) slave\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   replicates 91523c0391a044da6cc9f53bb965aabe89502187\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eM: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.1:7003\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   slots:[5461-10922] (5462 slots) master\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   1 additional replica(s)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eM: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.1:7005\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   slots:[10923-16383] (5461 slots) master\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   1 additional replica(s)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eS: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.1:7004\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   slots: (0 slots) slave\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eS: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   slots: (0 slots) slave\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[OK] All nodes agree about slots configuration.\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u0026gt;\u0026gt; Check \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e open slots...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u0026gt;\u0026gt; Check slots coverage...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[OK] All 16384 slots covered.\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（5）日常维护操作\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e关闭集群 - \u003ccode\u003e./create-cluster stop\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e检查集群是否健康（指定任意节点即可）：\u003ccode\u003e./redis-cli --cluster check \u0026lt;ip:port\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e尝试修复集群节点：\u003ccode\u003e./redis-cli --cluster fix \u0026lt;ip:port\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"部署哨兵\"\u003e\u003ca href=\"#部署哨兵\" class=\"headerlink\" title=\"部署哨兵\"\u003e\u003c/a\u003e部署哨兵\u003c/h3\u003e\u003cp\u003eredis-cluster 实现了 Redis 的分片、复制。\u003c/p\u003e\n\u003cp\u003e但 redis-cluster 没有解决故障转移问题，一旦任意分片的 Master 节点宕机、网络不通，就会导致 redis-cluster 的集群不能工作。为了解决高可用的问题，Redis 提供了 Redis 哨兵来监控 Redis 节点状态，并且会在 Master 宕机时，发起选举，将这个 Master 的一个 Slave 节点选举为 Master。\u003c/p\u003e\n\u003cp\u003e（1）创建节点目录\u003c/p\u003e\n\u003cp\u003e我个人偏好将软件放在 \u003ccode\u003e/opt\u003c/code\u003e 目录下，在我的机器中，Redis 都安装在 \u003ccode\u003e/usr/local/redis\u003c/code\u003e 目录下。所以，下面的命令和配置都假设 Redis 安装目录为 \u003ccode\u003e/usr/local/redis\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e确保机器上已经安装了 Redis 后，执行以下命令，创建 Redis 集群节点实例目录：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esudo mkdir -p /usr/local/redis/conf/27001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo mkdir -p /usr/local/redis/conf/27002\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo mkdir -p /usr/local/redis/conf/27003\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（2）配置集群节点\u003c/p\u003e\n\u003cp\u003e每个实例目录下，新建 \u003ccode\u003eredis.conf\u003c/code\u003e 配置文件。\u003c/p\u003e\n\u003cp\u003e实例配置模板以 7001 节点为例（其他节点，完全替换配置中的端口号 7001 即可），如下：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eport 27001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edaemonize yes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esentinel monitor redis-master 172.22.6.3 7001 2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esentinel down-after-milliseconds redis-master 5000\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esentinel failover-timeout redis-master 900000\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esentinel parallel-syncs redis-master 1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e#\u003c/span\u003e\u003cspan class=\"language-bash\"\u003esentinel auth-pass redis-master 123456\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003elogfile /usr/local/redis/conf/27001/27001.log\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（3）批量启动哨兵节点\u003c/p\u003e\n\u003cfigure class=\"highlight awk\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"regexp\"\u003e/opt/\u003c/span\u003eredis\u003cspan class=\"regexp\"\u003e/src/\u003c/span\u003eredis-sentinel \u003cspan class=\"regexp\"\u003e/usr/\u003c/span\u003elocal\u003cspan class=\"regexp\"\u003e/redis/\u003c/span\u003econf\u003cspan class=\"regexp\"\u003e/27001/\u003c/span\u003esentinel.conf\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"regexp\"\u003e/opt/\u003c/span\u003eredis\u003cspan class=\"regexp\"\u003e/src/\u003c/span\u003eredis-sentinel \u003cspan class=\"regexp\"\u003e/usr/\u003c/span\u003elocal\u003cspan class=\"regexp\"\u003e/redis/\u003c/span\u003econf\u003cspan class=\"regexp\"\u003e/27002/\u003c/span\u003esentinel.conf\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"regexp\"\u003e/opt/\u003c/span\u003eredis\u003cspan class=\"regexp\"\u003e/src/\u003c/span\u003eredis-sentinel \u003cspan class=\"regexp\"\u003e/usr/\u003c/span\u003elocal\u003cspan class=\"regexp\"\u003e/redis/\u003c/span\u003econf\u003cspan class=\"regexp\"\u003e/27003/\u003c/span\u003esentinel.conf\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"扩容\"\u003e\u003ca href=\"#扩容\" class=\"headerlink\" title=\"扩容\"\u003e\u003c/a\u003e扩容\u003c/h3\u003e\u003cp\u003e（1）查看信息\u003c/p\u003e\n\u003cp\u003e进入任意节点\u003c/p\u003e\n\u003cfigure class=\"highlight avrasm\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e./redis-\u003cspan class=\"keyword\"\u003ecli\u003c/span\u003e -h \u003cspan class=\"number\"\u003e172.22\u003c/span\u003e\u003cspan class=\"number\"\u003e.6\u003c/span\u003e\u003cspan class=\"number\"\u003e.3\u003c/span\u003e -p \u003cspan class=\"number\"\u003e7001\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003ecluster info 查看集群节点状态\u003c/p\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e172\u003c/span\u003e.\u003cspan class=\"number\"\u003e22\u003c/span\u003e.\u003cspan class=\"number\"\u003e6\u003c/span\u003e.\u003cspan class=\"number\"\u003e3\u003c/span\u003e:\u003cspan class=\"number\"\u003e7001\u003c/span\u003e\u0026gt; cluster nodes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ef158bf70bb2767cac271ce4efcfc14ba0b7ca98b\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7006\u003c/span\u003e@\u003cspan class=\"number\"\u003e17006\u003c/span\u003e slave e7aa182e756b76ec85b471797db9b66e4b2da725 \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594528179000\u003c/span\u003e \u003cspan class=\"number\"\u003e6\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ef348e67648460c7a800120d69b4977bf2e4524cb\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7001\u003c/span\u003e@\u003cspan class=\"number\"\u003e17001\u003c/span\u003e myself,master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594528179000\u003c/span\u003e \u003cspan class=\"number\"\u003e1\u003c/span\u003e connected \u003cspan class=\"number\"\u003e0\u003c/span\u003e-\u003cspan class=\"number\"\u003e5460\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e52601e2d4af0e64b83f4cc6d20e8316d0ac38b99\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7004\u003c/span\u003e@\u003cspan class=\"number\"\u003e17004\u003c/span\u003e slave \u003cspan class=\"number\"\u003e4802\u003c/span\u003efafe897160c46392c6e569d6f5e466cca696 \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594528178000\u003c/span\u003e \u003cspan class=\"number\"\u003e4\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ec6c6a68674ae8aac3c6ec792c8af4dc1228c6c31\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7005\u003c/span\u003e@\u003cspan class=\"number\"\u003e17005\u003c/span\u003e slave f348e67648460c7a800120d69b4977bf2e4524cb \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594528179852\u003c/span\u003e \u003cspan class=\"number\"\u003e5\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ee7aa182e756b76ec85b471797db9b66e4b2da725\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7002\u003c/span\u003e@\u003cspan class=\"number\"\u003e17002\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594528178000\u003c/span\u003e \u003cspan class=\"number\"\u003e2\u003c/span\u003e connected \u003cspan class=\"number\"\u003e5461\u003c/span\u003e-\u003cspan class=\"number\"\u003e10922\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e4802fafe897160c46392c6e569d6f5e466cca696\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7003\u003c/span\u003e@\u003cspan class=\"number\"\u003e17003\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594528178000\u003c/span\u003e \u003cspan class=\"number\"\u003e3\u003c/span\u003e connected \u003cspan class=\"number\"\u003e10923\u003c/span\u003e-\u003cspan class=\"number\"\u003e16383\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003ecluster info 查看集群信息\u003c/p\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e172\u003c/span\u003e.\u003cspan class=\"number\"\u003e22\u003c/span\u003e.\u003cspan class=\"number\"\u003e6\u003c/span\u003e.\u003cspan class=\"number\"\u003e3\u003c/span\u003e:\u003cspan class=\"number\"\u003e7001\u003c/span\u003e\u0026gt; cluster info\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_state\u003c/span\u003e:ok\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_slots_assigned\u003c/span\u003e:\u003cspan class=\"number\"\u003e16384\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_slots_ok\u003c/span\u003e:\u003cspan class=\"number\"\u003e16384\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_slots_pfail\u003c/span\u003e:\u003cspan class=\"number\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_slots_fail\u003c/span\u003e:\u003cspan class=\"number\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_known_nodes\u003c/span\u003e:\u003cspan class=\"number\"\u003e6\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_size\u003c/span\u003e:\u003cspan class=\"number\"\u003e3\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_current_epoch\u003c/span\u003e:\u003cspan class=\"number\"\u003e6\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_my_epoch\u003c/span\u003e:\u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_stats_messages_ping_sent\u003c/span\u003e:\u003cspan class=\"number\"\u003e3406\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_stats_messages_pong_sent\u003c/span\u003e:\u003cspan class=\"number\"\u003e3569\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_stats_messages_publish_sent\u003c/span\u003e:\u003cspan class=\"number\"\u003e5035\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_stats_messages_sent\u003c/span\u003e:\u003cspan class=\"number\"\u003e12010\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_stats_messages_ping_received\u003c/span\u003e:\u003cspan class=\"number\"\u003e3564\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_stats_messages_pong_received\u003c/span\u003e:\u003cspan class=\"number\"\u003e3406\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_stats_messages_meet_received\u003c/span\u003e:\u003cspan class=\"number\"\u003e5\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_stats_messages_publish_received\u003c/span\u003e:\u003cspan class=\"number\"\u003e5033\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ecluster_stats_messages_received\u003c/span\u003e:\u003cspan class=\"number\"\u003e12008\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（2）添加节点到集群\u003c/p\u003e\n\u003cp\u003e将已启动的节点实例添加到集群中\u003c/p\u003e\n\u003cfigure class=\"highlight smali\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eredis-cli --cluster\u003cspan class=\"built_in\"\u003e add-node \u003c/span\u003e127.0.0.1:7007 127.0.0.1:7008\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cstrong\u003e添加主节点\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e添加一组主节点\u003c/p\u003e\n\u003cfigure class=\"highlight smali\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e.\u003c/span\u003e/redis-cli --cluster\u003cspan class=\"built_in\"\u003e add-node \u003c/span\u003e172.22.6.3:7007 172.22.6.3:7001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e.\u003c/span\u003e/redis-cli --cluster\u003cspan class=\"built_in\"\u003e add-node \u003c/span\u003e172.22.6.3:7008 172.22.6.3:7001\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e.\u003c/span\u003e/redis-cli --cluster\u003cspan class=\"built_in\"\u003e add-node \u003c/span\u003e172.22.6.3:7009 172.22.6.3:7001\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e查看节点状态\u003c/p\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e172\u003c/span\u003e.\u003cspan class=\"number\"\u003e22\u003c/span\u003e.\u003cspan class=\"number\"\u003e6\u003c/span\u003e.\u003cspan class=\"number\"\u003e3\u003c/span\u003e:\u003cspan class=\"number\"\u003e7001\u003c/span\u003e\u0026gt; cluster nodes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ef158bf70bb2767cac271ce4efcfc14ba0b7ca98b\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7006\u003c/span\u003e@\u003cspan class=\"number\"\u003e17006\u003c/span\u003e slave e7aa182e756b76ec85b471797db9b66e4b2da725 \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529342575\u003c/span\u003e \u003cspan class=\"number\"\u003e6\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ef348e67648460c7a800120d69b4977bf2e4524cb\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7001\u003c/span\u003e@\u003cspan class=\"number\"\u003e17001\u003c/span\u003e myself,master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529340000\u003c/span\u003e \u003cspan class=\"number\"\u003e1\u003c/span\u003e connected \u003cspan class=\"number\"\u003e0\u003c/span\u003e-\u003cspan class=\"number\"\u003e5460\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e55cacf121662833a4a19dbeb4a5df712cfedf77f\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7009\u003c/span\u003e@\u003cspan class=\"number\"\u003e17009\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529342000\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ec6c6a68674ae8aac3c6ec792c8af4dc1228c6c31\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7005\u003c/span\u003e@\u003cspan class=\"number\"\u003e17005\u003c/span\u003e slave f348e67648460c7a800120d69b4977bf2e4524cb \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529341573\u003c/span\u003e \u003cspan class=\"number\"\u003e5\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e4802fafe897160c46392c6e569d6f5e466cca696\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7003\u003c/span\u003e@\u003cspan class=\"number\"\u003e17003\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529343577\u003c/span\u003e \u003cspan class=\"number\"\u003e3\u003c/span\u003e connected \u003cspan class=\"number\"\u003e10923\u003c/span\u003e-\u003cspan class=\"number\"\u003e16383\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ee7aa182e756b76ec85b471797db9b66e4b2da725\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7002\u003c/span\u003e@\u003cspan class=\"number\"\u003e17002\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529342000\u003c/span\u003e \u003cspan class=\"number\"\u003e2\u003c/span\u003e connected \u003cspan class=\"number\"\u003e5461\u003c/span\u003e-\u003cspan class=\"number\"\u003e10922\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ee5ba78fe629115977a74fbbe1478caf8868d6d55\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7007\u003c/span\u003e@\u003cspan class=\"number\"\u003e17007\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529341000\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e52601e2d4af0e64b83f4cc6d20e8316d0ac38b99\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7004\u003c/span\u003e@\u003cspan class=\"number\"\u003e17004\u003c/span\u003e slave \u003cspan class=\"number\"\u003e4802\u003c/span\u003efafe897160c46392c6e569d6f5e466cca696 \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529340000\u003c/span\u003e \u003cspan class=\"number\"\u003e4\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e79d4fffc2cec210556c3b4c44e63ab506e87eda3\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7008\u003c/span\u003e@\u003cspan class=\"number\"\u003e17008\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529340000\u003c/span\u003e \u003cspan class=\"number\"\u003e7\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e可以发现，新加入的三个主节点，还没有分配哈希槽，所以，暂时还无法访问。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e添加从节点\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e–slave：设置该参数，则新节点以 slave 的角色加入集群\u003cbr/\u003e–master-id：这个参数需要设置了–slave 才能生效，–master-id 用来指定新节点的 master 节点。如果不设置该参数，则会随机为节点选择 master 节点。\u003c/p\u003e\n\u003cp\u003e语法\u003c/p\u003e\n\u003cfigure class=\"highlight smali\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eredis-cli --cluster\u003cspan class=\"built_in\"\u003e add-node \u003c/span\u003e 新节点IP地址：端口    存在节点IP：端口 --cluster-slave （从节点） --cluster-master-id （master节点的ID）\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eredis-cli --cluster\u003cspan class=\"built_in\"\u003e add-node \u003c/span\u003e  10.42.141.119:6379  10.42.166.105:6379  --cluster-slave   --cluster-master-id  dfa238fff8a7a49230cff7eb74f573f5645c8ec5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e示例\u003c/p\u003e\n\u003cfigure class=\"highlight smali\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e.\u003c/span\u003e/redis-cli --cluster\u003cspan class=\"built_in\"\u003e add-node \u003c/span\u003e172.22.6.3:7010 172.22.6.3:7007 --cluster-slave\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e.\u003c/span\u003e/redis-cli --cluster\u003cspan class=\"built_in\"\u003e add-node \u003c/span\u003e172.22.6.3:7011 172.22.6.3:7008 --cluster-slave\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e.\u003c/span\u003e/redis-cli --cluster\u003cspan class=\"built_in\"\u003e add-node \u003c/span\u003e172.22.6.3:7012 172.22.6.3:7009 --cluster-slave\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e查看状态\u003c/p\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e172\u003c/span\u003e.\u003cspan class=\"number\"\u003e22\u003c/span\u003e.\u003cspan class=\"number\"\u003e6\u003c/span\u003e.\u003cspan class=\"number\"\u003e3\u003c/span\u003e:\u003cspan class=\"number\"\u003e7001\u003c/span\u003e\u0026gt; cluster nodes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003eef5c1b9ce4cc795dc12b2c1e8736a572647b4c3e\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7011\u003c/span\u003e@\u003cspan class=\"number\"\u003e17011\u003c/span\u003e slave \u003cspan class=\"number\"\u003e79\u003c/span\u003ed4fffc2cec210556c3b4c44e63ab506e87eda3 \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529492043\u003c/span\u003e \u003cspan class=\"number\"\u003e7\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ef158bf70bb2767cac271ce4efcfc14ba0b7ca98b\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7006\u003c/span\u003e@\u003cspan class=\"number\"\u003e17006\u003c/span\u003e slave e7aa182e756b76ec85b471797db9b66e4b2da725 \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529491943\u003c/span\u003e \u003cspan class=\"number\"\u003e6\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ef348e67648460c7a800120d69b4977bf2e4524cb\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7001\u003c/span\u003e@\u003cspan class=\"number\"\u003e17001\u003c/span\u003e myself,master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529488000\u003c/span\u003e \u003cspan class=\"number\"\u003e1\u003c/span\u003e connected \u003cspan class=\"number\"\u003e0\u003c/span\u003e-\u003cspan class=\"number\"\u003e5460\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e5140d1129ed850df59c51cf818c4eb74545d9959\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7010\u003c/span\u003e@\u003cspan class=\"number\"\u003e17010\u003c/span\u003e slave e5ba78fe629115977a74fbbe1478caf8868d6d55 \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529488000\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e55cacf121662833a4a19dbeb4a5df712cfedf77f\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7009\u003c/span\u003e@\u003cspan class=\"number\"\u003e17009\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529488000\u003c/span\u003e \u003cspan class=\"number\"\u003e8\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ec6c6a68674ae8aac3c6ec792c8af4dc1228c6c31\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7005\u003c/span\u003e@\u003cspan class=\"number\"\u003e17005\u003c/span\u003e slave f348e67648460c7a800120d69b4977bf2e4524cb \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529490000\u003c/span\u003e \u003cspan class=\"number\"\u003e5\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e4802fafe897160c46392c6e569d6f5e466cca696\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7003\u003c/span\u003e@\u003cspan class=\"number\"\u003e17003\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529489939\u003c/span\u003e \u003cspan class=\"number\"\u003e3\u003c/span\u003e connected \u003cspan class=\"number\"\u003e10923\u003c/span\u003e-\u003cspan class=\"number\"\u003e16383\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ee7aa182e756b76ec85b471797db9b66e4b2da725\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7002\u003c/span\u003e@\u003cspan class=\"number\"\u003e17002\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529491000\u003c/span\u003e \u003cspan class=\"number\"\u003e2\u003c/span\u003e connected \u003cspan class=\"number\"\u003e5461\u003c/span\u003e-\u003cspan class=\"number\"\u003e10922\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ee5ba78fe629115977a74fbbe1478caf8868d6d55\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7007\u003c/span\u003e@\u003cspan class=\"number\"\u003e17007\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529490942\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e52601e2d4af0e64b83f4cc6d20e8316d0ac38b99\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7004\u003c/span\u003e@\u003cspan class=\"number\"\u003e17004\u003c/span\u003e slave \u003cspan class=\"number\"\u003e4802\u003c/span\u003efafe897160c46392c6e569d6f5e466cca696 \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529491000\u003c/span\u003e \u003cspan class=\"number\"\u003e4\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e02e9f57b5b45c350dc57acf1c8efa8db136db7b7\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7012\u003c/span\u003e@\u003cspan class=\"number\"\u003e17012\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529489000\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e79d4fffc2cec210556c3b4c44e63ab506e87eda3\u003c/span\u003e \u003cspan class=\"number\"\u003e172.22.6.3:7008\u003c/span\u003e@\u003cspan class=\"number\"\u003e17008\u003c/span\u003e master - \u003cspan class=\"number\"\u003e0\u003c/span\u003e \u003cspan class=\"number\"\u003e1594529489000\u003c/span\u003e \u003cspan class=\"number\"\u003e7\u003c/span\u003e connected\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e分配哈希槽\u003c/p\u003e\n\u003cp\u003e执行 \u003ccode\u003e./redis-cli --cluster rebalance 172.22.6.3:7001 --cluster-threshold 1 --cluster-use-empty-masters\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e参数说明：\u003c/p\u003e\n\u003cp\u003erebalance：表明让 Redis 自动根据节点数进行均衡哈希槽分配。\u003c/p\u003e\n\u003cp\u003e–cluster-use-empty-masters：表明\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20200712125827.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003e执行结束后，查看状态：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20200712130234.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"Redis-命令\"\u003e\u003ca href=\"#Redis-命令\" class=\"headerlink\" title=\"Redis 命令\"\u003e\u003c/a\u003eRedis 命令\u003c/h2\u003e\u003ch3 id=\"通用命令\"\u003e\u003ca href=\"#通用命令\" class=\"headerlink\" title=\"通用命令\"\u003e\u003c/a\u003e通用命令\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e命令详细用法，请参考 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/commands\"\u003e\u003cstrong\u003eRedis 命令官方文档\u003c/strong\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e搬迁两张 cheat sheet 图，原址：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.cheatography.com/tasjaevan/cheat-sheets/redis/\"\u003ehttps://www.cheatography.com/tasjaevan/cheat-sheets/redis/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2019/10/10/16db5250b0b8ea57?w=2230\u0026amp;h=2914\u0026amp;f=png\u0026amp;s=246433\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-gold-cdn.xitu.io/2019/10/10/16db5250b0e9ba3c?w=2229\u0026amp;h=2890\u0026amp;f=png\u0026amp;s=192997\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"集群命令\"\u003e\u003ca href=\"#集群命令\" class=\"headerlink\" title=\"集群命令\"\u003e\u003c/a\u003e集群命令\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e集群\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ecluster info\u003c/code\u003e - 打印集群的信息\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster nodes\u003c/code\u003e - 列出集群当前已知的所有节点（ node），以及这些节点的相关信息。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e节点\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ecluster meet \u0026lt;ip\u0026gt; \u0026lt;port\u0026gt;\u003c/code\u003e - 将 ip 和 port 所指定的节点添加到集群当中，让它成为集群的一份子。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster forget \u0026lt;node_id\u0026gt;\u003c/code\u003e - 从集群中移除 node_id 指定的节点。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster replicate \u0026lt;node_id\u0026gt;\u003c/code\u003e - 将当前节点设置为 node_id 指定的节点的从节点。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster saveconfig\u003c/code\u003e - 将节点的配置文件保存到硬盘里面。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e槽(slot)\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ecluster addslots \u0026lt;slot\u0026gt; [slot ...]\u003c/code\u003e - 将一个或多个槽（ slot）指派（ assign）给当前节点。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster delslots \u0026lt;slot\u0026gt; [slot ...]\u003c/code\u003e - 移除一个或多个槽对当前节点的指派。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster flushslots\u003c/code\u003e - 移除指派给当前节点的所有槽，让当前节点变成一个没有指派任何槽的节点。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster setslot \u0026lt;slot\u0026gt; node \u0026lt;node_id\u0026gt;\u003c/code\u003e - 将槽 slot 指派给 node_id 指定的节点，如果槽已经指派给另一个节点，那么先让另一个节点删除该槽\u0026gt;，然后再进行指派。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster setslot \u0026lt;slot\u0026gt; migrating \u0026lt;node_id\u0026gt;\u003c/code\u003e - 将本节点的槽 slot 迁移到 node_id 指定的节点中。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster setslot \u0026lt;slot\u0026gt; importing \u0026lt;node_id\u0026gt;\u003c/code\u003e - 从 node_id 指定的节点中导入槽 slot 到本节点。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster setslot \u0026lt;slot\u0026gt; stable\u003c/code\u003e - 取消对槽 slot 的导入（ import）或者迁移（ migrate）。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e键\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ecluster keyslot \u0026lt;key\u0026gt;\u003c/code\u003e - 计算键 key 应该被放置在哪个槽上。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster countkeysinslot \u0026lt;slot\u0026gt;\u003c/code\u003e - 返回槽 slot 目前包含的键值对数量。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecluster getkeysinslot \u0026lt;slot\u0026gt; \u0026lt;count\u0026gt;\u003c/code\u003e - 返回 count 个 slot 槽中的键。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"重新分片\"\u003e\u003ca href=\"#重新分片\" class=\"headerlink\" title=\"重新分片\"\u003e\u003c/a\u003e重新分片\u003c/h3\u003e\u003cp\u003e添加节点：./redis-cli –cluster add-node 192.168.1.136:7007 192.168.1.136:7001 –cluster-slave\u003c/p\u003e\n\u003cp\u003eredis-cli –cluster reshard 172.22.6.3 7001\u003c/p\u003e\n\u003ch2 id=\"客户端\"\u003e\u003ca href=\"#客户端\" class=\"headerlink\" title=\"客户端\"\u003e\u003c/a\u003e客户端\u003c/h2\u003e\u003cp\u003e推荐使用 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/uglide/RedisDesktopManager\"\u003e\u003cstrong\u003eRedisDesktopManager\u003c/strong\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e官网\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/\"\u003eRedis 官网\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/antirez/redis\"\u003eRedis Github\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://redis.cn/\"\u003eRedis 官方文档中文版\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e书籍\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://item.jd.com/11791607.html\"\u003e《Redis 实战》\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://item.jd.com/11486101.html\"\u003e《Redis 设计与实现》\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e教程\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://redisdoc.com/\"\u003eRedis 命令参考\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e文章\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://juejin.im/post/5b8fc5536fb9a05d2d01fb11\"\u003e深入剖析 Redis 系列(三) - Redis 集群模式搭建与原理详解\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-06-24T02:45:38Z",
  "Author": "钝悟 ◾ Dunwu"
}