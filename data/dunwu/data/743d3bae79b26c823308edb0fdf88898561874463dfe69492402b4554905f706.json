{
  "Source": "dunwu",
  "Title": "MongoDB 索引",
  "Link": "https://dunwu.github.io/blog/pages/10c674/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"MongoDB-索引\"\u003e\u003ca href=\"#MongoDB-索引\" class=\"headerlink\" title=\"MongoDB 索引\"\u003e\u003c/a\u003eMongoDB 索引\u003c/h1\u003e\u003ch2 id=\"MongoDB-索引简介\"\u003e\u003ca href=\"#MongoDB-索引简介\" class=\"headerlink\" title=\"MongoDB 索引简介\"\u003e\u003c/a\u003eMongoDB 索引简介\u003c/h2\u003e\u003ch3 id=\"索引的作用\"\u003e\u003ca href=\"#索引的作用\" class=\"headerlink\" title=\"索引的作用\"\u003e\u003c/a\u003e索引的作用\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eMongoDB 在 collection 数据级别上定义索引\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e索引通常能够极大的提高查询的效率。如果\u003cstrong\u003e没有索引\u003c/strong\u003e，MongoDB 在读取数据时\u003cstrong\u003e必须扫描 collection 中的每个 document\u003c/strong\u003e 并选取那些符合查询条件的记录。\u003c/p\u003e\n\u003cp\u003e这种扫描全集合的查询是非常低效的，特别是在处理大量的数据时。查询可能要花费几十秒甚至几分钟，这种性能开销是不可接受的。\u003c/p\u003e\n\u003cp\u003e索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20200921210621.svg\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"createIndex-方法\"\u003e\u003ca href=\"#createIndex-方法\" class=\"headerlink\" title=\"createIndex() 方法\"\u003e\u003c/a\u003ecreateIndex() 方法\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eMongoDB 使用 \u003ccode\u003ecreateIndex()\u003c/code\u003e 方法来创建索引\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecreateIndex()\u003c/code\u003e 语法如下：\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003edb.\u003cspan class=\"property\"\u003ecollection\u003c/span\u003e.\u003cspan class=\"title function_\"\u003ecreateIndex\u003c/span\u003e( \u0026lt;key and index type specification\u0026gt;, \u0026lt;options\u0026gt; )\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003ccode\u003ecreateIndex()\u003c/code\u003e 可选参数列表如下：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth align=\"left\"\u003eParameter\u003c/th\u003e\n\u003cth align=\"left\"\u003eType\u003c/th\u003e\n\u003cth align=\"left\"\u003eDescription\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd align=\"left\"\u003ebackground\u003c/td\u003e\n\u003ctd align=\"left\"\u003eBoolean\u003c/td\u003e\n\u003ctd align=\"left\"\u003e建索引过程会阻塞其它数据库操作，background 可指定以后台方式创建索引，即增加 “background” 可选参数。 “background” 默认值为\u003cstrong\u003efalse\u003c/strong\u003e。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003eunique\u003c/td\u003e\n\u003ctd align=\"left\"\u003eBoolean\u003c/td\u003e\n\u003ctd align=\"left\"\u003e建立的索引是否唯一。指定为 true 创建唯一索引。默认值为\u003cstrong\u003efalse\u003c/strong\u003e.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003ename\u003c/td\u003e\n\u003ctd align=\"left\"\u003estring\u003c/td\u003e\n\u003ctd align=\"left\"\u003e索引的名称。如果未指定，MongoDB 的通过连接索引的字段名和排序顺序生成一个索引名称。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003edropDups\u003c/td\u003e\n\u003ctd align=\"left\"\u003eBoolean\u003c/td\u003e\n\u003ctd align=\"left\"\u003e\u003cstrong\u003e3.0+版本已废弃。\u003c/strong\u003e在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引。默认值为 \u003cstrong\u003efalse\u003c/strong\u003e.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003esparse\u003c/td\u003e\n\u003ctd align=\"left\"\u003eBoolean\u003c/td\u003e\n\u003ctd align=\"left\"\u003e对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为 true 的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 \u003cstrong\u003efalse\u003c/strong\u003e.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003eexpireAfterSeconds\u003c/td\u003e\n\u003ctd align=\"left\"\u003einteger\u003c/td\u003e\n\u003ctd align=\"left\"\u003e指定一个以秒为单位的数值，完成 TTL 设定，设定集合的生存时间。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003ev\u003c/td\u003e\n\u003ctd align=\"left\"\u003eindex version\u003c/td\u003e\n\u003ctd align=\"left\"\u003e索引的版本号。默认的索引版本取决于 mongod 创建索引时运行的版本。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003eweights\u003c/td\u003e\n\u003ctd align=\"left\"\u003edocument\u003c/td\u003e\n\u003ctd align=\"left\"\u003e索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003edefault_language\u003c/td\u003e\n\u003ctd align=\"left\"\u003estring\u003c/td\u003e\n\u003ctd align=\"left\"\u003e对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"left\"\u003elanguage_override\u003c/td\u003e\n\u003ctd align=\"left\"\u003estring\u003c/td\u003e\n\u003ctd align=\"left\"\u003e对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的 language，默认值为 language.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003e【示例】使用 name 作为索引，并且按照降序排序\u003c/p\u003e\n\u003cfigure class=\"highlight sas\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003edb.collection.\u003cspan class=\"keyword\"\u003ecreate\u003c/span\u003e\u003cspan class=\"meta\"\u003eIndex\u003c/span\u003e( { name: -1 } )\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e官方\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.mongodb.com/\"\u003eMongoDB 官网\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/mongodb/mongo\"\u003eMongoDB Github\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://university.mongodb.com/\"\u003eMongoDB 官方免费教程\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e教程\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.runoob.com/mongodb/mongodb-tutorial.html\"\u003eMongoDB 教程\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://time.geekbang.org/course/intro/100040001\"\u003eMongoDB 高手课\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-09-21T13:22:57Z",
  "Author": "钝悟 ◾ Dunwu"
}