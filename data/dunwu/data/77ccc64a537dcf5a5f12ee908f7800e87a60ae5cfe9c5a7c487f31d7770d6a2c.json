{
  "Source": "dunwu",
  "Title": "Redis å¤åˆ¶",
  "Link": "https://dunwu.github.io/blog/pages/379cd8/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"Redis-å¤åˆ¶\"\u003e\u003ca href=\"#Redis-å¤åˆ¶\" class=\"headerlink\" title=\"Redis å¤åˆ¶\"\u003e\u003c/a\u003eRedis å¤åˆ¶\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003eåœ¨ Redis ä¸­ï¼Œ\u003cstrong\u003eå¯ä»¥é€šè¿‡æ‰§è¡Œ \u003ccode\u003eSLAVEOF\u003c/code\u003e å‘½ä»¤æˆ–è®¾ç½® \u003ccode\u003eslaveof\u003c/code\u003e é€‰é¡¹ï¼Œè®©ä¸€ä¸ªæœåŠ¡å™¨å»å¤åˆ¶ï¼ˆreplicateï¼‰å¦ä¸€ä¸ªæœåŠ¡å™¨\u003c/strong\u003eï¼Œå…¶ä¸­ï¼Œåè€…å«ä¸»æœåŠ¡å™¨ï¼ˆmasterï¼‰ï¼Œå‰è€…å«ä»æœåŠ¡å™¨ï¼ˆslaveï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003eRedis 2.8 ä»¥å‰çš„å¤åˆ¶ä¸èƒ½é«˜æ•ˆå¤„ç†æ–­çº¿åé‡å¤åˆ¶çš„æƒ…å†µï¼Œè€Œ Redis 2.8 æ–°æ·»çš„éƒ¨åˆ†é‡åŒæ­¥å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eå…³é”®è¯ï¼š\u003ccode\u003eSLAVEOF\u003c/code\u003eã€\u003ccode\u003eSYNC\u003c/code\u003eã€\u003ccode\u003ePSYNC\u003c/code\u003eã€\u003ccode\u003eå‘½ä»¤ä¼ æ’­\u003c/code\u003eã€\u003ccode\u003eå¿ƒè·³\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"å¤åˆ¶ç®€ä»‹\"\u003e\u003ca href=\"#å¤åˆ¶ç®€ä»‹\" class=\"headerlink\" title=\"å¤åˆ¶ç®€ä»‹\"\u003e\u003c/a\u003eå¤åˆ¶ç®€ä»‹\u003c/h2\u003e\u003cp\u003eRedis é€šè¿‡ \u003ccode\u003eslaveof host port\u003c/code\u003e å‘½ä»¤æ¥è®©ä¸€ä¸ªæœåŠ¡å™¨æˆä¸ºå¦ä¸€ä¸ªæœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eä¸€ä¸ªä¸»æœåŠ¡å™¨å¯ä»¥æœ‰å¤šä¸ªä»æœåŠ¡å™¨\u003c/strong\u003eã€‚ä¸ä»…ä¸»æœåŠ¡å™¨å¯ä»¥æœ‰ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„ä»æœåŠ¡å™¨ï¼Œ å¤šä¸ªä»æœåŠ¡å™¨ä¹‹é—´å¯ä»¥æ„æˆä¸€ä¸ªä¸»ä»é“¾ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eä¸€ä¸ªä»æœåŠ¡å™¨åªèƒ½æœ‰ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¸æ”¯æŒä¸»ä¸»å¤åˆ¶\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå¯ä»¥é€šè¿‡å¤åˆ¶åŠŸèƒ½æ¥è®©ä¸»æœåŠ¡å™¨å…äºæ‰§è¡ŒæŒä¹…åŒ–æ“ä½œï¼š åªè¦å…³é—­ä¸»æœåŠ¡å™¨çš„æŒä¹…åŒ–åŠŸèƒ½ï¼Œ ç„¶åç”±ä»æœåŠ¡å™¨å»æ‰§è¡ŒæŒä¹…åŒ–æ“ä½œå³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ä½¿ç”¨ Redis å¤åˆ¶åŠŸèƒ½æ—¶çš„è®¾ç½®ä¸­ï¼Œå¼ºçƒˆå»ºè®®åœ¨ master å’Œåœ¨ slave ä¸­å¯ç”¨æŒä¹…åŒ–ã€‚å½“ä¸å¯ç”¨æ—¶ï¼Œä¾‹å¦‚ç”±äºéå¸¸æ…¢çš„ç£ç›˜æ€§èƒ½è€Œå¯¼è‡´çš„å»¶è¿Ÿé—®é¢˜ï¼Œ\u003cstrong\u003eåº”è¯¥é…ç½®å®ä¾‹æ¥é¿å…é‡ç½®åè‡ªåŠ¨é‡å¯\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eä» Redis 2.6 å¼€å§‹ï¼Œ ä»æœåŠ¡å™¨æ”¯æŒåªè¯»æ¨¡å¼ï¼Œ å¹¶ä¸”è¯¥æ¨¡å¼ä¸ºä»æœåŠ¡å™¨çš„é»˜è®¤æ¨¡å¼ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eåªè¯»æ¨¡å¼ç”± \u003ccode\u003eredis.conf\u003c/code\u003e æ–‡ä»¶ä¸­çš„ \u003ccode\u003eslave-read-only\u003c/code\u003e é€‰é¡¹æ§åˆ¶ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://redisdoc.com/configure/config_set.html#config-set\"\u003eCONFIG SET parameter value\u003c/a\u003e å‘½ä»¤æ¥å¼€å¯æˆ–å…³é—­è¿™ä¸ªæ¨¡å¼ã€‚\u003c/li\u003e\n\u003cli\u003eåªè¯»ä»æœåŠ¡å™¨ä¼šæ‹’ç»æ‰§è¡Œä»»ä½•å†™å‘½ä»¤ï¼Œ æ‰€ä»¥ä¸ä¼šå‡ºç°å› ä¸ºæ“ä½œå¤±è¯¯è€Œå°†æ•°æ®ä¸å°å¿ƒå†™å…¥åˆ°äº†ä»æœåŠ¡å™¨çš„æƒ…å†µã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"æ—§ç‰ˆå¤åˆ¶\"\u003e\u003ca href=\"#æ—§ç‰ˆå¤åˆ¶\" class=\"headerlink\" title=\"æ—§ç‰ˆå¤åˆ¶\"\u003e\u003c/a\u003eæ—§ç‰ˆå¤åˆ¶\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003eRedis 2.8 ç‰ˆæœ¬ä»¥å‰å®ç°æ–¹å¼ï¼š\u003ccode\u003eSYNC\u003c/code\u003e å‘½ä»¤\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eRedis çš„å¤åˆ¶åŠŸèƒ½åˆ†ä¸ºåŒæ­¥ï¼ˆsyncï¼‰å’Œå‘½ä»¤ä¼ æ’­ï¼ˆcommand propagateï¼‰ä¸¤ä¸ªæ“ä½œï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eåŒæ­¥ï¼ˆsyncï¼‰\u003c/code\u003e\u003c/strong\u003e - ç”¨äºå°†ä»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸»æœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eå‘½ä»¤ä¼ æ’­ï¼ˆcommand propagateï¼‰\u003c/code\u003e\u003c/strong\u003e - å½“ä¸»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€è¢«ä¿®æ”¹ï¼Œå¯¼è‡´ä¸»ä»æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´æ—¶ï¼Œè®©ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®åº“é‡æ–°å›åˆ°ä¸€è‡´çŠ¶æ€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"åŒæ­¥\"\u003e\u003ca href=\"#åŒæ­¥\" class=\"headerlink\" title=\"åŒæ­¥\"\u003e\u003c/a\u003eåŒæ­¥\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eSYNC\u003c/code\u003e å‘½ä»¤çš„æ‰§è¡Œæ­¥éª¤ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€ \u003ccode\u003eSYNC\u003c/code\u003e å‘½ä»¤ã€‚\u003c/li\u003e\n\u003cli\u003eæ”¶åˆ° \u003ccode\u003eSYNC\u003c/code\u003e å‘½ä»¤çš„ä¸»æœåŠ¡å™¨æ‰§è¡Œ \u003ccode\u003eBGSAVE\u003c/code\u003e å‘½ä»¤ï¼Œåœ¨åå°ç”Ÿæˆä¸€ä¸ª RDB æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºè®°å½•ä»ç°åœ¨å¼€å§‹æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ã€‚\u003c/li\u003e\n\u003cli\u003eä¸»æœåŠ¡å™¨æ‰§è¡Œ \u003ccode\u003eBGSAVE\u003c/code\u003e å®Œæ¯•åï¼Œä¸»æœåŠ¡å™¨ä¼šå°†ç”Ÿæˆçš„ RDB æ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ã€‚ä»æœåŠ¡å™¨æ¥æ”¶å¹¶è½½å…¥ RDB æ–‡ä»¶ï¼Œæ›´æ–°è‡ªå·±çš„æ•°æ®åº“çŠ¶æ€ã€‚\u003c/li\u003e\n\u003cli\u003eä¸»æœåŠ¡å™¨å°†è®°å½•åœ¨ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œæ›´æ–°è‡ªå·±çš„æ•°æ®åº“çŠ¶æ€ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/202309172035716.png\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"å‘½ä»¤ä¼ æ’­\"\u003e\u003ca href=\"#å‘½ä»¤ä¼ æ’­\" class=\"headerlink\" title=\"å‘½ä»¤ä¼ æ’­\"\u003e\u003c/a\u003eå‘½ä»¤ä¼ æ’­\u003c/h3\u003e\u003cp\u003eåŒæ­¥æ“ä½œå®Œæˆåï¼Œä¸»ä»æ•°æ®åº“çš„æ•°æ®åº“çŠ¶æ€å°†è¾¾åˆ°ä¸€è‡´ã€‚æ¯å½“ä¸»æœåŠ¡å™¨æ‰§è¡Œå®¢æˆ·ç«¯å‘é€çš„å†™å‘½ä»¤æ—¶ï¼Œä¸»ä»æ•°æ®åº“çŠ¶æ€ä¸å†ä¸€è‡´ã€‚éœ€è¦å°†å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨æ‰§è¡Œï¼Œä½¿å¾—äºŒè€…çš„æ•°æ®åº“çŠ¶æ€é‡æ–°è¾¾åˆ°ä¸€è‡´ã€‚\u003c/p\u003e\n\u003ch3 id=\"æ—§ç‰ˆå¤åˆ¶çš„ç¼ºé™·\"\u003e\u003ca href=\"#æ—§ç‰ˆå¤åˆ¶çš„ç¼ºé™·\" class=\"headerlink\" title=\"æ—§ç‰ˆå¤åˆ¶çš„ç¼ºé™·\"\u003e\u003c/a\u003eæ—§ç‰ˆå¤åˆ¶çš„ç¼ºé™·\u003c/h3\u003e\u003cp\u003eä»æœåŠ¡å™¨å¯¹ä¸»æœåŠ¡å™¨çš„å¤åˆ¶å­˜åœ¨ä¸¤ç§æƒ…å†µï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eåˆæ¬¡å¤åˆ¶\u003c/strong\u003e - ä»æœåŠ¡å™¨ä»¥å‰æ²¡æœ‰å¤åˆ¶è¿‡å°†è¦å¤åˆ¶çš„ä¸»æœåŠ¡å™¨ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ–­çº¿åé‡å¤åˆ¶\u003c/strong\u003e - å¤„äºå‘½ä»¤ä¼ æ’­é˜¶æ®µçš„ä¸»ä»æœåŠ¡å™¨å› ä¸ºç½‘ç»œåŸå› è€Œä¸­æ–­äº†å¤åˆ¶ï¼Œå½“ä»æœåŠ¡å™¨é€šè¿‡è‡ªåŠ¨é‡è¿é‡æ–°è¿ä¸Šäº†ä¸»æœåŠ¡å™¨åï¼Œç»§ç»­å¤åˆ¶ä¸»æœåŠ¡å™¨ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¯¹äºåˆæ¬¡å¤åˆ¶ï¼Œæ—§ç‰ˆå¤åˆ¶åŠŸèƒ½å¯ç”¨å¾ˆå¥½å®Œæˆä»»åŠ¡ï¼›ä½†æ˜¯\u003cstrong\u003eå¯¹äºæ–­çº¿åé‡å¤åˆ¶ï¼Œç”±äºæ¯æ¬¡ä»»ç„¶éœ€è¦ç”Ÿæˆ RDB å¹¶ä¼ è¾“ï¼Œæ•ˆç‡å¾ˆä½\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eğŸ”” æ³¨æ„ï¼š\u003cstrong\u003eSYNC å‘½ä»¤æ˜¯ä¸€ä¸ªéå¸¸è€—è´¹èµ„æºçš„æ“ä½œã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¸»æœåŠ¡å™¨æ‰§è¡Œ \u003ccode\u003eBGSAVE\u003c/code\u003e å‘½ä»¤ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œè¿™ä¸ªæ“ä½œä¼šè€—è´¹ä¸»æœåŠ¡å™¨å¤§é‡çš„ CPUã€å†…å­˜å’Œç£ç›˜ I/O èµ„æºã€‚\u003c/li\u003e\n\u003cli\u003eä¸»æœåŠ¡å™¨ä¼ è¾“ RDB æ–‡ä»¶ç»™ä»æœåŠ¡å™¨ï¼Œè¿™ä¸ªæ“ä½œä¼šè€—è´¹ä¸»ä»æœåŠ¡å™¨å¤§é‡çš„ç½‘ç»œèµ„æºï¼Œå¹¶å¯¹ä¸»æœåŠ¡å™¨å“åº”æ—¶å»¶äº§ç”Ÿå½±å“ã€‚\u003c/li\u003e\n\u003cli\u003eä»æœåŠ¡å™¨è½½å…¥ RDB æ–‡ä»¶æœŸé—´ï¼Œä¼šé˜»å¡å…¶ä»–å‘½ä»¤è¯·æ±‚ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"æ–°ç‰ˆå¤åˆ¶\"\u003e\u003ca href=\"#æ–°ç‰ˆå¤åˆ¶\" class=\"headerlink\" title=\"æ–°ç‰ˆå¤åˆ¶\"\u003e\u003c/a\u003eæ–°ç‰ˆå¤åˆ¶\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003eRedis 2.8 ç‰ˆæœ¬ä»¥åçš„æ–°å®ç°æ–¹å¼ï¼šä½¿ç”¨ \u003ccode\u003ePSYNC\u003c/code\u003e å‘½ä»¤æ›¿ä»£ \u003ccode\u003eSYNC\u003c/code\u003e å‘½ä»¤ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003ePSYNC\u003c/code\u003e å‘½ä»¤å…·æœ‰å®Œæ•´é‡åŒæ­¥å’Œéƒ¨åˆ†é‡åŒæ­¥ä¸¤ç§æ¨¡å¼ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eå®Œæ•´é‡åŒæ­¥ï¼ˆfull resychronizationï¼‰\u003c/code\u003e\u003c/strong\u003e - ç”¨äºåˆæ¬¡å¤åˆ¶ã€‚æ‰§è¡Œæ­¥éª¤ä¸ \u003ccode\u003eSYNC\u003c/code\u003e å‘½ä»¤åŸºæœ¬ä¸€è‡´ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eéƒ¨åˆ†é‡åŒæ­¥ï¼ˆpartial resychronizationï¼‰\u003c/code\u003e\u003c/strong\u003e - ç”¨äºæ–­çº¿åé‡å¤åˆ¶ã€‚\u003cstrong\u003eå¦‚æœæ¡ä»¶å…è®¸ï¼Œä¸»æœåŠ¡å™¨å¯ä»¥å°†ä¸»ä»æœåŠ¡å™¨è¿æ¥æ–­å¼€æœŸé—´æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨\u003c/strong\u003eï¼Œä»æœåŠ¡å™¨åªéœ€æ¥æ”¶å¹¶æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œå³å¯å°†ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€ä¿æŒä¸€è‡´ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"éƒ¨åˆ†é‡åŒæ­¥\"\u003e\u003ca href=\"#éƒ¨åˆ†é‡åŒæ­¥\" class=\"headerlink\" title=\"éƒ¨åˆ†é‡åŒæ­¥\"\u003e\u003c/a\u003eéƒ¨åˆ†é‡åŒæ­¥\u003c/h3\u003e\u003cp\u003eéƒ¨åˆ†é‡åŒæ­¥åŠŸèƒ½å®ç°ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¸»ä»æœåŠ¡å™¨çš„\u003cstrong\u003eå¤åˆ¶åç§»é‡ï¼ˆreplication offsetï¼‰\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eä¸»æœåŠ¡å™¨çš„\u003cstrong\u003eå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼ˆreplication backlogï¼‰\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæœåŠ¡å™¨çš„è¿è¡Œ ID\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"å¤åˆ¶åç§»é‡\"\u003e\u003ca href=\"#å¤åˆ¶åç§»é‡\" class=\"headerlink\" title=\"å¤åˆ¶åç§»é‡\"\u003e\u003c/a\u003eå¤åˆ¶åç§»é‡\u003c/h4\u003e\u003cp\u003eä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨ä¼šåˆ†åˆ«ç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¦‚æœä¸»ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡ç›¸åŒï¼Œåˆ™è¯´æ˜äºŒè€…çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ï¼›\u003c/li\u003e\n\u003cli\u003eåä¹‹ï¼Œåˆ™è¯´æ˜äºŒè€…çš„æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/202309172031325.png\"/\u003e\u003c/p\u003e\n\u003ch4 id=\"å¤åˆ¶ç§¯å‹ç¼“å†²åŒº\"\u003e\u003ca href=\"#å¤åˆ¶ç§¯å‹ç¼“å†²åŒº\" class=\"headerlink\" title=\"å¤åˆ¶ç§¯å‹ç¼“å†²åŒº\"\u003e\u003c/a\u003eå¤åˆ¶ç§¯å‹ç¼“å†²åŒº\u003c/h4\u003e\u003cp\u003e\u003cstrong\u003eå¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯ä¸»æœåŠ¡å™¨ç»´æŠ¤çš„ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰é˜Ÿåˆ—\u003c/strong\u003eï¼Œé»˜è®¤å¤§å°ä¸º \u003ccode\u003e1MB\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¼šä¿å­˜ä¸€éƒ¨åˆ†æœ€è¿‘ä¼ æ’­çš„å†™å‘½ä»¤ï¼Œå¹¶ä¸”å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¼šä¸ºé˜Ÿåˆ—ä¸­çš„æ¯ä¸ªå­—èŠ‚è®°å½•ç›¸åº”çš„å¤åˆ¶åç§»é‡ã€‚\u003c/p\u003e\n\u003cp\u003eå½“ä»æœåŠ¡å™¨æ–­çº¿é‡è¿ä¸»æœåŠ¡æ—¶ï¼Œä»æœåŠ¡å™¨ä¼šé€šè¿‡ \u003ccode\u003ePSYNC\u003c/code\u003e å‘½ä»¤å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡ offset å‘é€ç»™ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨ä¼šæ ¹æ®è¿™ä¸ªå¤åˆ¶åç§»é‡æ¥å†³å®šå¯¹ä»æœåŠ¡å™¨æ‰§è¡Œä½•ç§åŒæ­¥æ“ä½œã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¦‚æœ offset ä¹‹åçš„æ•°æ®ä»ç„¶åœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œåˆ™ä¸»æœåŠ¡å™¨å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥æ“ä½œã€‚\u003c/li\u003e\n\u003cli\u003eåä¹‹ï¼Œåˆ™ä¸»æœåŠ¡å™¨å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå®Œæ•´é‡åŒæ­¥æ“ä½œã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eğŸ”” æ³¨æ„ï¼š\u003cstrong\u003eåˆç†è°ƒæ•´å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eRedis å¤åˆ¶ç§¯å‹ç¼“å†²åŒºé»˜è®¤å¤§å°ä¸º \u003ccode\u003e1MB\u003c/code\u003eã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eå¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„æœ€å°å¤§å°å¯ä»¥æ ¹æ®å…¬å¼ \u003ccode\u003esecond * write_size_per_second\u003c/code\u003e ä¼°ç®—ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"æœåŠ¡å™¨çš„è¿è¡Œ-ID\"\u003e\u003ca href=\"#æœåŠ¡å™¨çš„è¿è¡Œ-ID\" class=\"headerlink\" title=\"æœåŠ¡å™¨çš„è¿è¡Œ ID\"\u003e\u003c/a\u003eæœåŠ¡å™¨çš„è¿è¡Œ ID\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003eæ¯ä¸ª Redis æœåŠ¡å™¨ï¼Œéƒ½æœ‰è¿è¡Œ IDï¼Œç”¨äºå”¯ä¸€è¯†åˆ«èº«ä»½ã€‚\u003c/li\u003e\n\u003cli\u003eè¿è¡Œ ID åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œç”± 40 ä¸ªéšæœºçš„åå…­è¿›åˆ¶å­—ç¬¦ç»„æˆã€‚ä¾‹å¦‚ï¼š132e358005e29741f8d7b0a42d666aace286edda\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä»æœåŠ¡å™¨å¯¹ä¸»æœåŠ¡å™¨è¿›è¡Œåˆæ¬¡å¤åˆ¶æ—¶ï¼Œä¸»æœåŠ¡å™¨ä¼šå°†è‡ªå·±çš„è¿è¡Œ ID ä¼ é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨ä¼šå°†è¿™ä¸ªè¿è¡Œ ID ä¿å­˜ä¸‹æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eå½“ä»æœåŠ¡å™¨æ–­çº¿é‡è¿ä¸€ä¸ªä¸»æœåŠ¡å™¨æ—¶ï¼Œä»æœåŠ¡å™¨ä¼šå‘é€ä¹‹å‰ä¿å­˜çš„è¿è¡Œ IDï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¦‚æœä¿å­˜çš„è¿è¡Œ ID å’Œå½“å‰ä¸»æœåŠ¡å™¨çš„è¿è¡Œ ID ä¸€è‡´ï¼Œåˆ™è¯´æ˜ä»æœåŠ¡å™¨æ–­çº¿ä¹‹å‰è¿æ¥çš„å°±æ˜¯è¿™ä¸ªä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨å¯ä»¥ç»§ç»­å°è¯•æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥æ“ä½œï¼›\u003c/li\u003e\n\u003cli\u003eåä¹‹ï¼Œè‹¥è¿è¡Œ ID ä¸ä¸€è‡´ï¼Œåˆ™è¯´æ˜ä»æœåŠ¡å™¨æ–­çº¿ä¹‹å‰è¿æ¥çš„ä¸æ˜¯è¿™ä¸ªä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨å°†å¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå®Œæ•´é‡åŒæ­¥æ“ä½œã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"PSYNC-å‘½ä»¤\"\u003e\u003ca href=\"#PSYNC-å‘½ä»¤\" class=\"headerlink\" title=\"PSYNC å‘½ä»¤\"\u003e\u003c/a\u003ePSYNC å‘½ä»¤\u003c/h3\u003e\u003cp\u003eäº†è§£äº†éƒ¨åˆ†é‡åŒæ­¥çš„å®ç°ï¼ŒPSYNC çš„å®ç°å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå®ƒçš„åŸºæœ¬å·¥ä½œåŸç†å¤§è‡´å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eå½“ä»æœåŠ¡æ¥æ”¶åˆ° \u003ccode\u003eSLAVEOF\u003c/code\u003e å‘½ä»¤æ—¶ï¼Œå…ˆåˆ¤æ–­ä»æœåŠ¡å™¨ä»¥å‰æ˜¯å¦æ‰§è¡Œè¿‡å¤åˆ¶æ“ä½œã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¦‚æœæ²¡æœ‰å¤åˆ¶è¿‡ä»»ä½•ä¸»æœåŠ¡å™¨ï¼Œå‘è¦å¤åˆ¶çš„ä¸»æœåŠ¡å™¨\u003cstrong\u003eå‘é€ \u003ccode\u003ePSYNC ? -1\u003c/code\u003e å‘½ä»¤ï¼Œä¸»åŠ¨è¯·æ±‚è¿›è¡Œå®Œæ•´é‡åŒæ­¥\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003eåä¹‹ï¼Œå‘è¦å¤åˆ¶çš„ä¸»æœåŠ¡å™¨å‘é€ \u003ccode\u003ePSYNC \u0026lt;runid\u0026gt; \u0026lt;offset\u0026gt;\u003c/code\u003e å‘½ä»¤ã€‚\u003cul\u003e\n\u003cli\u003e\u003ccode\u003erunid\u003c/code\u003e æ˜¯ä¸Šä¸€æ¬¡å¤åˆ¶çš„ä¸»æœåŠ¡å™¨çš„è¿è¡Œ IDã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eoffset\u003c/code\u003e æ˜¯å¤åˆ¶åç§»é‡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ¥æ”¶åˆ° \u003ccode\u003ePSYNC \u0026lt;runid\u0026gt; \u0026lt;offset\u0026gt;\u003c/code\u003e å‘½ä»¤çš„ä¸»æœåŠ¡ä¼šè¿›è¡Œåˆ†æï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå‡å¦‚ä¸»ä»æœåŠ¡å™¨çš„ \u003cstrong\u003emaster run id ç›¸åŒ\u003c/strong\u003eï¼Œå¹¶ä¸”\u003cstrong\u003eæŒ‡å®šçš„åç§»é‡ï¼ˆoffsetï¼‰åœ¨å†…å­˜ç¼“å†²åŒºä¸­è¿˜æœ‰æ•ˆ\u003c/strong\u003eï¼Œå¤åˆ¶å°±ä¼šä»ä¸Šæ¬¡ä¸­æ–­çš„ç‚¹å¼€å§‹ç»§ç»­ã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœå…¶ä¸­ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¼šè¿›è¡Œå®Œå…¨é‡æ–°åŒæ­¥ï¼ˆåœ¨ 2.8 ç‰ˆæœ¬ä¹‹å‰å°±æ˜¯ç›´æ¥è¿›è¡Œå®Œå…¨é‡æ–°åŒæ­¥ï¼‰ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/202309172030499.png\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"å¿ƒè·³æ£€æµ‹\"\u003e\u003ca href=\"#å¿ƒè·³æ£€æµ‹\" class=\"headerlink\" title=\"å¿ƒè·³æ£€æµ‹\"\u003e\u003c/a\u003eå¿ƒè·³æ£€æµ‹\u003c/h2\u003e\u003cp\u003eåœ¨\u003cstrong\u003eå‘½ä»¤ä¼ æ’­\u003c/strong\u003eé˜¶æ®µï¼Œä»æœåŠ¡å™¨é»˜è®¤ä¼šä»¥\u003cstrong\u003eæ¯ç§’ä¸€æ¬¡\u003c/strong\u003eçš„é¢‘ç‡ï¼Œå‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eREPLCONF ACK \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ereplication_offset\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eå…¶ä¸­ï¼Œ\u003ccode\u003ereplication_offset\u003c/code\u003e æ˜¯ä»æœåŠ¡å™¨å½“å‰çš„å¤åˆ¶åç§»é‡ã€‚\u003c/p\u003e\n\u003cp\u003eå‘é€ \u003ccode\u003eREPLCONF ACK\u003c/code\u003e å‘½ä»¤å¯¹äºä¸»ä»æœåŠ¡å™¨æœ‰ä¸‰ä¸ªä½œç”¨ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ£€æµ‹ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€ã€‚\u003c/li\u003e\n\u003cli\u003eè¾…åŠ©å®ç° min-slaves é€‰é¡¹ã€‚\u003c/li\u003e\n\u003cli\u003eæ£€æµ‹å‘½ä»¤ä¸¢å¤±ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"æ£€æµ‹ä¸»ä»è¿æ¥çŠ¶æ€\"\u003e\u003ca href=\"#æ£€æµ‹ä¸»ä»è¿æ¥çŠ¶æ€\" class=\"headerlink\" title=\"æ£€æµ‹ä¸»ä»è¿æ¥çŠ¶æ€\"\u003e\u003c/a\u003eæ£€æµ‹ä¸»ä»è¿æ¥çŠ¶æ€\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eå¯ä»¥é€šè¿‡å‘é€å’Œæ¥æ”¶ \u003ccode\u003eREPLCONF ACK\u003c/code\u003e å‘½ä»¤æ¥æ£€æŸ¥ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥\u003c/strong\u003eæ˜¯å¦æ­£å¸¸ï¼šå¦‚æœä¸»æœåŠ¡å™¨è¶…è¿‡ä¸€ç§’æ²¡æœ‰æ”¶åˆ°ä»æœåŠ¡å™¨å‘æ¥çš„ \u003ccode\u003eREPLCONF ACK\u003c/code\u003e å‘½ä»¤ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°±çŸ¥é“ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥å‡ºç°é—®é¢˜äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå¯ä»¥é€šè¿‡å‘ä¸»æœåŠ¡å™¨å‘é€ \u003ccode\u003eINFO replication\u003c/code\u003e å‘½ä»¤ï¼Œåœ¨åˆ—å‡ºçš„ä»æœåŠ¡å™¨åˆ—è¡¨çš„ lag ä¸€æ ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€ \u003ccode\u003eREPLCONF ACK\u003c/code\u003e å‘½ä»¤å·²ç»è¿‡å»å¤šå°‘ç§’ã€‚\u003c/p\u003e\n\u003ch3 id=\"è¾…åŠ©å®ç°-min-slaves-é€‰é¡¹\"\u003e\u003ca href=\"#è¾…åŠ©å®ç°-min-slaves-é€‰é¡¹\" class=\"headerlink\" title=\"è¾…åŠ©å®ç° min-slaves é€‰é¡¹\"\u003e\u003c/a\u003eè¾…åŠ©å®ç° min-slaves é€‰é¡¹\u003c/h3\u003e\u003cp\u003eRedis çš„ \u003cstrong\u003e\u003ccode\u003emin-slaves-to-write\u003c/code\u003e å’Œ \u003ccode\u003emin-slaves-max-lag\u003c/code\u003e ä¸¤ä¸ªé€‰é¡¹å¯ä»¥é˜²æ­¢ä¸»æœåŠ¡å™¨åœ¨ä¸å®‰å…¨çš„æƒ…å†µä¸‹æ‰§è¡Œå†™å‘½ä»¤\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eã€ç¤ºä¾‹ã€‘min-slaves é…ç½®é¡¹\u003c/p\u003e\n\u003cfigure class=\"highlight livecodeserver\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003emin\u003c/span\u003e-slaves-\u003cspan class=\"built_in\"\u003eto\u003c/span\u003e-\u003cspan class=\"built_in\"\u003ewrite\u003c/span\u003e \u003cspan class=\"number\"\u003e3\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003emin\u003c/span\u003e-slaves-\u003cspan class=\"built_in\"\u003emax\u003c/span\u003e-lag \u003cspan class=\"number\"\u003e10\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eä»¥ä¸Šé…ç½®è¡¨ç¤ºï¼šä»æœåŠ¡å™¨å°äº 3 ä¸ªï¼Œæˆ–ä¸‰ä¸ªä»æœåŠ¡å™¨çš„å»¶è¿Ÿï¼ˆlagï¼‰éƒ½å¤§äºç­‰äº 10 ç§’æ—¶ï¼Œä¸»æœåŠ¡å™¨å°†æ‹’ç»æ‰§è¡Œå†™å‘½ä»¤ã€‚\u003c/p\u003e\n\u003ch3 id=\"æ£€æµ‹å‘½ä»¤ä¸¢å¤±\"\u003e\u003ca href=\"#æ£€æµ‹å‘½ä»¤ä¸¢å¤±\" class=\"headerlink\" title=\"æ£€æµ‹å‘½ä»¤ä¸¢å¤±\"\u003e\u003c/a\u003eæ£€æµ‹å‘½ä»¤ä¸¢å¤±\u003c/h3\u003e\u003cp\u003eå¦‚æœå› ä¸ºç½‘ç»œæ•…éšœï¼Œä¸»æœåŠ¡ä¼ æ’­ç»™ä»æœåŠ¡å™¨çš„å†™å‘½ä»¤ä¸¢å¤±ï¼Œé‚£ä¹ˆä»æœåŠ¡å™¨å®šæ—¶å‘ä¸»æœåŠ¡å™¨å‘é€ \u003ccode\u003eREPLCONF ACK\u003c/code\u003e å‘½ä»¤æ—¶ï¼Œä¸»æœåŠ¡å™¨å°†å‘è§‰ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡å°‘äºè‡ªå·±çš„ã€‚ç„¶åï¼Œä¸»æœåŠ¡å™¨å°±ä¼šæ ¹æ®ä»æœåŠ¡å™¨æäº¤çš„å¤åˆ¶åç§»é‡ï¼Œåœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­æ‰¾åˆ°ä»æœåŠ¡å™¨ç¼ºå°‘çš„æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®é‡æ–°å‘é€ç»™ä»æœåŠ¡å™¨ã€‚\u003c/p\u003e\n\u003ch2 id=\"å¤åˆ¶çš„æµç¨‹\"\u003e\u003ca href=\"#å¤åˆ¶çš„æµç¨‹\" class=\"headerlink\" title=\"å¤åˆ¶çš„æµç¨‹\"\u003e\u003c/a\u003eå¤åˆ¶çš„æµç¨‹\u003c/h2\u003e\u003cp\u003eé€šè¿‡å‘ä»æœåŠ¡å™¨å‘é€å¦‚ä¸‹ SLAVEOF å‘½ä»¤ï¼Œå¯ä»¥è®©ä¸€ä¸ªä»æœåŠ¡å™¨å»å¤åˆ¶ä¸€ä¸ªä¸»æœåŠ¡å™¨ã€‚\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eSLAVEOF \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003emaster_ip\u003c/span\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003emaster_port\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"æ­¥éª¤-1-è®¾ç½®ä¸»ä»æœåŠ¡å™¨\"\u003e\u003ca href=\"#æ­¥éª¤-1-è®¾ç½®ä¸»ä»æœåŠ¡å™¨\" class=\"headerlink\" title=\"æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æœåŠ¡å™¨\"\u003e\u003c/a\u003eæ­¥éª¤ 1. è®¾ç½®ä¸»ä»æœåŠ¡å™¨\u003c/h3\u003e\u003cp\u003eé…ç½®ä¸€ä¸ªä»æœåŠ¡å™¨éå¸¸ç®€å•ï¼Œ åªè¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹çš„è¿™ä¸€è¡Œå°±å¯ä»¥äº†ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003eslaveof\u003c/span\u003e \u003cspan class=\"number\"\u003e127.0.0.1\u003c/span\u003e \u003cspan class=\"number\"\u003e6379\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eå½“ç„¶ï¼Œ ä½ éœ€è¦å°†ä»£ç ä¸­çš„ \u003ccode\u003e127.0.0.1\u003c/code\u003e å’Œ \u003ccode\u003e6379\u003c/code\u003e æ›¿æ¢æˆä½ çš„ä¸»æœåŠ¡å™¨çš„ IP å’Œç«¯å£å·ã€‚\u003c/p\u003e\n\u003cp\u003eå¦å¤–ä¸€ç§æ–¹æ³•æ˜¯è°ƒç”¨ \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://redisdoc.com/replication/slaveof.html#slaveof\"\u003eSLAVEOF host port\u003c/a\u003e å‘½ä»¤ï¼Œ è¾“å…¥ä¸»æœåŠ¡å™¨çš„ IP å’Œç«¯å£ï¼Œ ç„¶ååŒæ­¥å°±ä¼šå¼€å§‹ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003e127\u003c/span\u003e.\u003cspan class=\"number\"\u003e0\u003c/span\u003e.\u003cspan class=\"number\"\u003e0\u003c/span\u003e.\u003cspan class=\"number\"\u003e1\u003c/span\u003e:\u003cspan class=\"number\"\u003e6379\u003c/span\u003e\u0026gt; SLAVEOF \u003cspan class=\"number\"\u003e127.0.0.1\u003c/span\u003e \u003cspan class=\"number\"\u003e10086\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003eOK\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"æ­¥éª¤-2-ä¸»ä»æœåŠ¡å™¨å»ºç«‹-TCP-è¿æ¥ã€‚\"\u003e\u003ca href=\"#æ­¥éª¤-2-ä¸»ä»æœåŠ¡å™¨å»ºç«‹-TCP-è¿æ¥ã€‚\" class=\"headerlink\" title=\"æ­¥éª¤ 2. ä¸»ä»æœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ã€‚\"\u003e\u003c/a\u003eæ­¥éª¤ 2. ä¸»ä»æœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ã€‚\u003c/h3\u003e\u003ch3 id=\"æ­¥éª¤-3-å‘é€-PING-æ£€æŸ¥é€šä¿¡çŠ¶æ€ã€‚\"\u003e\u003ca href=\"#æ­¥éª¤-3-å‘é€-PING-æ£€æŸ¥é€šä¿¡çŠ¶æ€ã€‚\" class=\"headerlink\" title=\"æ­¥éª¤ 3. å‘é€ PING æ£€æŸ¥é€šä¿¡çŠ¶æ€ã€‚\"\u003e\u003c/a\u003eæ­¥éª¤ 3. å‘é€ PING æ£€æŸ¥é€šä¿¡çŠ¶æ€ã€‚\u003c/h3\u003e\u003ch3 id=\"æ­¥éª¤-4-èº«ä»½éªŒè¯ã€‚\"\u003e\u003ca href=\"#æ­¥éª¤-4-èº«ä»½éªŒè¯ã€‚\" class=\"headerlink\" title=\"æ­¥éª¤ 4. èº«ä»½éªŒè¯ã€‚\"\u003e\u003c/a\u003eæ­¥éª¤ 4. èº«ä»½éªŒè¯ã€‚\u003c/h3\u003e\u003cp\u003eå¦‚æœä¸»æœåŠ¡å™¨æ²¡æœ‰è®¾ç½® \u003ccode\u003erequirepass\u003c/code\u003e ï¼Œä»æœåŠ¡å™¨æ²¡æœ‰è®¾ç½® \u003ccode\u003emasterauth\u003c/code\u003eï¼Œåˆ™ä¸è¿›è¡Œèº«ä»½éªŒè¯ï¼›åä¹‹ï¼Œåˆ™éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœèº«ä»½éªŒè¯å¤±è´¥ï¼Œåˆ™æ”¾å¼ƒæ‰§è¡Œå¤åˆ¶å·¥ä½œã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœä¸»æœåŠ¡å™¨é€šè¿‡ \u003ccode\u003erequirepass\u003c/code\u003e é€‰é¡¹è®¾ç½®äº†å¯†ç ï¼Œ é‚£ä¹ˆä¸ºäº†è®©ä»æœåŠ¡å™¨çš„åŒæ­¥æ“ä½œå¯ä»¥é¡ºåˆ©è¿›è¡Œï¼Œ æˆ‘ä»¬ä¹Ÿå¿…é¡»ä¸ºä»æœåŠ¡å™¨è¿›è¡Œç›¸åº”çš„èº«ä»½éªŒè¯è®¾ç½®ã€‚\u003c/p\u003e\n\u003cp\u003eå¯¹äºä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨ï¼Œ å¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight arduino\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003econfig set masterauth \u0026lt;password\u0026gt;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eè¦æ°¸ä¹…åœ°è®¾ç½®è¿™ä¸ªå¯†ç ï¼Œ é‚£ä¹ˆå¯ä»¥å°†å®ƒåŠ å…¥åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emasterauth \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003epassword\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eå¦å¤–è¿˜æœ‰å‡ ä¸ªé€‰é¡¹ï¼Œ å®ƒä»¬å’Œä¸»æœåŠ¡å™¨æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥æ—¶æ‰€ä½¿ç”¨çš„å¤åˆ¶æµç¼“å†²åŒºæœ‰å…³ï¼Œ è¯¦ç»†çš„ä¿¡æ¯å¯ä»¥å‚è€ƒ Redis æºç ä¸­é™„å¸¦çš„ \u003ccode\u003eredis.conf\u003c/code\u003e ç¤ºä¾‹æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003ch3 id=\"æ­¥éª¤-5-å‘é€ç«¯å£ä¿¡æ¯ã€‚\"\u003e\u003ca href=\"#æ­¥éª¤-5-å‘é€ç«¯å£ä¿¡æ¯ã€‚\" class=\"headerlink\" title=\"æ­¥éª¤ 5. å‘é€ç«¯å£ä¿¡æ¯ã€‚\"\u003e\u003c/a\u003eæ­¥éª¤ 5. å‘é€ç«¯å£ä¿¡æ¯ã€‚\u003c/h3\u003e\u003cp\u003eä»æœåŠ¡å™¨æ‰§è¡Œ \u003ccode\u003eREPLCONF listening-port \u0026lt;port-number\u0026gt;\u003c/code\u003e ï¼Œå‘ä¸»æœåŠ¡å™¨å‘é€ä»æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£å·ã€‚\u003c/p\u003e\n\u003ch3 id=\"æ­¥éª¤-6-åŒæ­¥ã€‚\"\u003e\u003ca href=\"#æ­¥éª¤-6-åŒæ­¥ã€‚\" class=\"headerlink\" title=\"æ­¥éª¤ 6. åŒæ­¥ã€‚\"\u003e\u003c/a\u003eæ­¥éª¤ 6. åŒæ­¥ã€‚\u003c/h3\u003e\u003cp\u003eå‰æ–‡å·²ä»‹ç»ï¼Œæ­¤å¤„ä¸èµ˜è¿°ã€‚\u003c/p\u003e\n\u003ch3 id=\"æ­¥éª¤-7-å‘½ä»¤ä¼ æ’­ã€‚\"\u003e\u003ca href=\"#æ­¥éª¤-7-å‘½ä»¤ä¼ æ’­ã€‚\" class=\"headerlink\" title=\"æ­¥éª¤ 7. å‘½ä»¤ä¼ æ’­ã€‚\"\u003e\u003c/a\u003eæ­¥éª¤ 7. å‘½ä»¤ä¼ æ’­ã€‚\u003c/h3\u003e\u003cp\u003eåœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä»æœåŠ¡å™¨é»˜è®¤ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ï¼Œå‘ä¸»æœåŠ¡å‘é€å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eREPLCONF ACK \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003ereplication_coffset\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eå‘½ä»¤çš„ä½œç”¨ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ£€æµ‹ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€ã€‚\u003c/li\u003e\n\u003cli\u003eè¾…åŠ©å®ç° min-slave é€‰é¡¹ã€‚\u003c/li\u003e\n\u003cli\u003eæ£€æµ‹å‘½ä»¤ä¸¢å¤±ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å¤åˆ¶çš„é…ç½®é¡¹\"\u003e\u003ca href=\"#å¤åˆ¶çš„é…ç½®é¡¹\" class=\"headerlink\" title=\"å¤åˆ¶çš„é…ç½®é¡¹\"\u003e\u003c/a\u003eå¤åˆ¶çš„é…ç½®é¡¹\u003c/h2\u003e\u003cp\u003eä» Redis 2.8 å¼€å§‹ï¼Œ ä¸ºäº†ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œ å¯ä»¥é€šè¿‡é…ç½®ï¼Œ è®©ä¸»æœåŠ¡å™¨åªåœ¨æœ‰è‡³å°‘ N ä¸ªå½“å‰å·²è¿æ¥ä»æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œ æ‰æ‰§è¡Œå†™å‘½ä»¤ã€‚\u003c/p\u003e\n\u003cp\u003eä¸è¿‡ï¼Œ å› ä¸º Redis ä½¿ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œ æ‰€ä»¥ä¸»æœåŠ¡å™¨å‘é€çš„å†™æ•°æ®å¹¶ä¸ä¸€å®šä¼šè¢«ä»æœåŠ¡å™¨æ¥æ”¶åˆ°ï¼Œ å› æ­¤ï¼Œ æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§ä»ç„¶æ˜¯å­˜åœ¨çš„ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸‹æ˜¯è¿™ä¸ªç‰¹æ€§çš„è¿ä½œåŸç†ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä»æœåŠ¡å™¨ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ PING ä¸»æœåŠ¡å™¨ä¸€æ¬¡ï¼Œ å¹¶æŠ¥å‘Šå¤åˆ¶æµçš„å¤„ç†æƒ…å†µã€‚\u003c/li\u003e\n\u003cli\u003eä¸»æœåŠ¡å™¨ä¼šè®°å½•å„ä¸ªä»æœåŠ¡å™¨æœ€åä¸€æ¬¡å‘å®ƒå‘é€ PING çš„æ—¶é—´ã€‚\u003c/li\u003e\n\u003cli\u003eç”¨æˆ·å¯ä»¥é€šè¿‡é…ç½®ï¼Œ æŒ‡å®šç½‘ç»œå»¶è¿Ÿçš„æœ€å¤§å€¼ \u003ccode\u003emin-slaves-max-lag\u003c/code\u003e ï¼Œ ä»¥åŠæ‰§è¡Œå†™æ“ä½œæ‰€éœ€çš„è‡³å°‘ä»æœåŠ¡å™¨æ•°é‡ \u003ccode\u003emin-slaves-to-write\u003c/code\u003e ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¦‚æœè‡³å°‘æœ‰ \u003ccode\u003emin-slaves-to-write\u003c/code\u003e ä¸ªä»æœåŠ¡å™¨ï¼Œ å¹¶ä¸”è¿™äº›æœåŠ¡å™¨çš„å»¶è¿Ÿå€¼éƒ½å°‘äº \u003ccode\u003emin-slaves-max-lag\u003c/code\u003eç§’ï¼Œ é‚£ä¹ˆä¸»æœåŠ¡å™¨å°±ä¼šæ‰§è¡Œå®¢æˆ·ç«¯è¯·æ±‚çš„å†™æ“ä½œã€‚\u003c/p\u003e\n\u003cp\u003eä½ å¯ä»¥å°†è¿™ä¸ªç‰¹æ€§çœ‹ä½œ CAP ç†è®ºä¸­çš„ C çš„æ¡ä»¶æ”¾å®½ç‰ˆæœ¬ï¼š å°½ç®¡ä¸èƒ½ä¿è¯å†™æ“ä½œçš„æŒä¹…æ€§ï¼Œ ä½†èµ·ç ä¸¢å¤±æ•°æ®çš„çª—å£ä¼šè¢«ä¸¥æ ¼é™åˆ¶åœ¨æŒ‡å®šçš„ç§’æ•°ä¸­ã€‚\u003c/p\u003e\n\u003cp\u003eå¦ä¸€æ–¹é¢ï¼Œ å¦‚æœæ¡ä»¶è¾¾ä¸åˆ° \u003ccode\u003emin-slaves-to-write\u003c/code\u003e å’Œ \u003ccode\u003emin-slaves-max-lag\u003c/code\u003e æ‰€æŒ‡å®šçš„æ¡ä»¶ï¼Œ é‚£ä¹ˆå†™æ“ä½œå°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œ ä¸»æœåŠ¡å™¨ä¼šå‘è¯·æ±‚æ‰§è¡Œå†™æ“ä½œçš„å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸‹æ˜¯è¿™ä¸ªç‰¹æ€§çš„ä¸¤ä¸ªé€‰é¡¹å’Œå®ƒä»¬æ‰€éœ€çš„å‚æ•°ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003emin-slaves-to-write \u0026lt;number of slaves\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emin-slaves-max-lag \u0026lt;number of seconds\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¯¦ç»†çš„ä¿¡æ¯å¯ä»¥å‚è€ƒ Redis æºç ä¸­é™„å¸¦çš„ \u003ccode\u003eredis.conf\u003c/code\u003e ç¤ºä¾‹æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒèµ„æ–™\"\u003e\u003ca href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"\u003e\u003c/a\u003eå‚è€ƒèµ„æ–™\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/docs/management/replication/\"\u003eRedis å®˜æ–¹æ–‡æ¡£ä¹‹å¤åˆ¶\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://item.jd.com/11486101.html\"\u003eã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-06-24T02:45:38Z",
  "Author": "é’æ‚Ÿ â—¾ Dunwu"
}