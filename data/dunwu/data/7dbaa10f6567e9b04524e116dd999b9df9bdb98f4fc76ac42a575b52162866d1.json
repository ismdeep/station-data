{
  "Source": "dunwu",
  "Title": "Redis 发布订阅",
  "Link": "https://dunwu.github.io/blog/pages/a329e5/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"Redis-发布订阅\"\u003e\u003ca href=\"#Redis-发布订阅\" class=\"headerlink\" title=\"Redis 发布订阅\"\u003e\u003c/a\u003eRedis 发布订阅\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003eRedis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。Redis 客户端可以订阅任意数量的频道。\u003c/p\u003e\n\u003cp\u003eRedis 有两种发布订阅模式\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e基于频道（Channel）的发布订阅\u003c/li\u003e\n\u003cli\u003e基于模式（Pattern）的发布订阅\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e关键词：\u003ccode\u003e订阅\u003c/code\u003e、\u003ccode\u003eSUBSCRIBE\u003c/code\u003e、\u003ccode\u003ePSUBSCRIBE\u003c/code\u003e、\u003ccode\u003ePUBLISH\u003c/code\u003e、\u003ccode\u003e观察者模式\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"观察者模式\"\u003e\u003ca href=\"#观察者模式\" class=\"headerlink\" title=\"观察者模式\"\u003e\u003c/a\u003e观察者模式\u003c/h2\u003e\u003cp\u003eRedis 发布订阅应用了设计模式中经典的“观察者模式”。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e观察者模式\u003c/strong\u003e（Observer）是一种行为设计模式，允许你定义一种订阅机制，可在对象事件发生时通知多个 “观察” 该对象的其他对象。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e当一个对象状态的改变需要改变其他对象，或实际对象是事先未知的或动态变化的时，可使用观察者模式。\u003c/li\u003e\n\u003cli\u003e当应用中的一些对象必须观察其他对象时，可使用该模式。但仅能在有限时间内或特定情况下使用。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://d1.awsstatic.com/product-marketing/Messaging/sns_img_topic.e024462ec88e79ed63d690a2eed6e050e33fb36f.png\" alt=\"观察者模式\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"Redis-订阅模式\"\u003e\u003ca href=\"#Redis-订阅模式\" class=\"headerlink\" title=\"Redis 订阅模式\"\u003e\u003c/a\u003eRedis 订阅模式\u003c/h2\u003e\u003cp\u003eRedis 有两种发布订阅模式：\u003c/p\u003e\n\u003cp\u003e（1）\u003cstrong\u003e基于频道（Channel）的发布订阅\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e服务器状态在 \u003ccode\u003epubsub_channels\u003c/code\u003e 字典保存了所有频道的订阅关系： \u003ccode\u003eSUBSCRIBE\u003c/code\u003e 命令负责将客户端和被订阅的频道关联到这个字典里面， 而 \u003ccode\u003eUNSUBSCRIBE\u003c/code\u003e 命令则负责解除客户端和被退订频道之间的关联。\u003c/p\u003e\n\u003cp\u003e【示例】订阅指定频道示例\u003c/p\u003e\n\u003cp\u003e打开客户端一，执行以下命令\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt; \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eSUBSCRIBE first second\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eReading messages... (press Ctrl-C to quit)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e1) \u0026#34;subscribe\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2) \u0026#34;first\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3) (integer) 1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e1) \u0026#34;subscribe\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2) \u0026#34;second\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3) (integer) 2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e打开客户端二，执行以下命令\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt; \u003c/span\u003e\u003cspan class=\"language-bash\"\u003ePUBLISH second Hello\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e1) \u0026#34;1\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e此时，客户端一会收到以下内容\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1) \u0026#34;message\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2) \u0026#34;second\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3) \u0026#34;Hello\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e（2）\u003cstrong\u003e基于模式（Pattern）的发布订阅\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e服务器状态在 \u003ccode\u003epubsub_patterns\u003c/code\u003e 链表保存了所有模式的订阅关系： \u003ccode\u003ePSUBSCRIBE\u003c/code\u003e 命令负责将客户端和被订阅的模式记录到这个链表中， 而 \u003ccode\u003eUNSUBSCRIBE\u003c/code\u003e 命令则负责移除客户端和被退订模式在链表中的记录。\u003c/p\u003e\n\u003cp\u003e【示例】订阅符合指定模式的频道\u003c/p\u003e\n\u003cp\u003e打开客户端一，执行以下命令\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt; \u003c/span\u003e\u003cspan class=\"language-bash\"\u003ePSUBSCRIBE news.*\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eReading messages... (press Ctrl-C to quit)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e1) \u0026#34;psubscribe\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2) \u0026#34;news.*\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3) (integer) 1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e打开客户端二，执行以下命令\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt; \u003c/span\u003e\u003cspan class=\"language-bash\"\u003ePUBLISH news.A Hello\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e1) \u0026#34;1\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e打开客户端三，执行以下命令\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u0026gt; \u003c/span\u003e\u003cspan class=\"language-bash\"\u003ePUBLISH news.B World\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e1) \u0026#34;1\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e此时，客户端一会收到以下内容\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1) \u0026#34;pmessage\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2) \u0026#34;news.*\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3) \u0026#34;news.A\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4) \u0026#34;Hello\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e1) \u0026#34;pmessage\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2) \u0026#34;news.*\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3) \u0026#34;news.B\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4) \u0026#34;World\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"发布订阅命令\"\u003e\u003ca href=\"#发布订阅命令\" class=\"headerlink\" title=\"发布订阅命令\"\u003e\u003c/a\u003e发布订阅命令\u003c/h2\u003e\u003cp\u003eRedis 提供了以下与订阅发布有关的命令：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e命令\u003c/th\u003e\n\u003cth\u003e描述\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/commands/subscribe/\"\u003e\u003ccode\u003eSUBSCRIBE\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e订阅指定频道\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/commands/unsubscribe\"\u003e\u003ccode\u003eUNSUBSCRIBE\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e取消订阅指定频道\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/commands/psubscribe\"\u003e\u003ccode\u003ePSUBSCRIBE\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e订阅符合指定模式的频道\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/commands/punsubscribe\"\u003e\u003ccode\u003ePUNSUBSCRIBE\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e取消订阅符合指定模式的频道\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/commands/publish/\"\u003e\u003ccode\u003ePUBLISH\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e发送信息到指定的频道\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://redis.io/commands/pubsub/\"\u003e\u003ccode\u003ePUBSUB\u003c/code\u003e\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e查看发布订阅状态\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://item.jd.com/11486101.html\"\u003e《Redis 设计与实现》\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2023-09-11T14:22:30Z",
  "Author": "钝悟 ◾ Dunwu"
}