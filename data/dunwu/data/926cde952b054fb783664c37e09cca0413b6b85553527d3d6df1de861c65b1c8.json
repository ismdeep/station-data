{
  "Source": "dunwu",
  "Title": "短地址服务",
  "Link": "https://dunwu.github.io/blog/pages/c72587/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"设计-Pastebin-com-或者-Bit-ly\"\u003e\u003ca href=\"#设计-Pastebin-com-或者-Bit-ly\" class=\"headerlink\" title=\"设计 Pastebin.com (或者 Bit.ly)\"\u003e\u003c/a\u003e设计 Pastebin.com (或者 Bit.ly)\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003e本文搬运自 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/solutions/system_design/pastebin/README-zh-Hans.md\"\u003e设计 Pastebin.com (或者 Bit.ly)\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e注意: 为了避免重复，当前文档会直接链接到\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%BB%E9%A2%98%E7%9A%84%E7%B4%A2%E5%BC%95\"\u003e系统设计主题\u003c/a\u003e的相关区域，请参考链接内容以获得综合的讨论点、权衡和替代方案。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e设计 Bit.ly\u003c/strong\u003e - 是一个类似的问题，区别是 pastebin 需要存储的是 paste 的内容，而不是原始的未短化的 url。\u003c/p\u003e\n\u003ch2 id=\"步骤一、需求分析\"\u003e\u003ca href=\"#步骤一、需求分析\" class=\"headerlink\" title=\"步骤一、需求分析\"\u003e\u003c/a\u003e步骤一、需求分析\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e收集这个问题的需求和范畴。\u003cbr/\u003e问相关问题来明确用例和约束。\u003cbr/\u003e讨论一些假设。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"用例\"\u003e\u003ca href=\"#用例\" class=\"headerlink\" title=\"用例\"\u003e\u003c/a\u003e用例\u003c/h3\u003e\u003ch4 id=\"问题范围\"\u003e\u003ca href=\"#问题范围\" class=\"headerlink\" title=\"问题范围\"\u003e\u003c/a\u003e问题范围\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e用户\u003c/strong\u003e 输入一段文本，然后得到一个随机生成的链接\u003cul\u003e\n\u003cli\u003e过期设置\u003cul\u003e\n\u003cli\u003e默认的设置是不会过期的\u003c/li\u003e\n\u003cli\u003e可以选择设置一个过期的时间\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e用户\u003c/strong\u003e 输入一个 paste 的 url 后，可以看到它存储的内容\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e用户\u003c/strong\u003e 是匿名的\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eService\u003c/strong\u003e 跟踪页面分析\u003cul\u003e\n\u003cli\u003e一个月的访问统计\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eService\u003c/strong\u003e 删除过期的 pastes\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eService\u003c/strong\u003e 需要高可用\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"超出范畴的用例\"\u003e\u003ca href=\"#超出范畴的用例\" class=\"headerlink\" title=\"超出范畴的用例\"\u003e\u003c/a\u003e超出范畴的用例\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e用户\u003c/strong\u003e 可以注册一个账户\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e用户\u003c/strong\u003e 通过验证邮箱\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e用户\u003c/strong\u003e 可以用注册的账户登录\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e用户\u003c/strong\u003e 可以编辑文档\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e用户\u003c/strong\u003e 可以设置可见性\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e用户\u003c/strong\u003e 可以设置短链接\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"约束和假设\"\u003e\u003ca href=\"#约束和假设\" class=\"headerlink\" title=\"约束和假设\"\u003e\u003c/a\u003e约束和假设\u003c/h3\u003e\u003ch4 id=\"状态假设\"\u003e\u003ca href=\"#状态假设\" class=\"headerlink\" title=\"状态假设\"\u003e\u003c/a\u003e状态假设\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003e访问流量不是均匀分布的\u003c/li\u003e\n\u003cli\u003e打开一个短链接应该是很快的\u003c/li\u003e\n\u003cli\u003epastes 只能是文本\u003c/li\u003e\n\u003cli\u003e页面访问分析数据可以不用实时\u003c/li\u003e\n\u003cli\u003e一千万的用户量\u003c/li\u003e\n\u003cli\u003e每个月一千万的 paste 写入量\u003c/li\u003e\n\u003cli\u003e每个月一亿的 paste 读取量\u003c/li\u003e\n\u003cli\u003e读写比例在 10:1\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"性能估算\"\u003e\u003ca href=\"#性能估算\" class=\"headerlink\" title=\"性能估算\"\u003e\u003c/a\u003e性能估算\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003e每个 paste 的大小\u003cul\u003e\n\u003cli\u003e每一个 paste 1 KB\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eshortlink\u003c/code\u003e - 7 bytes\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eexpiration_length_in_minutes\u003c/code\u003e - 4 bytes\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecreated_at\u003c/code\u003e - 5 bytes\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epaste_path\u003c/code\u003e - 255 bytes\u003c/li\u003e\n\u003cli\u003e总共 = ~1.27 KB\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e每个月新的 paste 内容在 12.7GB\u003cul\u003e\n\u003cli\u003e(1.27 * 10000000)KB / 月的 paste\u003c/li\u003e\n\u003cli\u003e三年内将近 450GB 的新 paste 内容\u003c/li\u003e\n\u003cli\u003e三年内 3.6 亿短链接\u003c/li\u003e\n\u003cli\u003e假设大部分都是新的 paste，而不是需要更新已存在的 paste\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e平均 4paste/s 的写入速度\u003c/li\u003e\n\u003cli\u003e平均 40paste/s 的读取速度\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e简单的转换指南:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e2.5 百万 req/s\u003c/li\u003e\n\u003cli\u003e1 req/s = 2.5 百万 req/month\u003c/li\u003e\n\u003cli\u003e40 req/s = 1 亿 req/month\u003c/li\u003e\n\u003cli\u003e400 req/s = 10 亿 req/month\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"步骤二、顶层设计\"\u003e\u003ca href=\"#步骤二、顶层设计\" class=\"headerlink\" title=\"步骤二、顶层设计\"\u003e\u003c/a\u003e步骤二、顶层设计\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e概述一个包括所有重要的组件的高层次设计\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/BKsBnmG.png\" alt=\"Imgur\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"步骤三、核心组件设计\"\u003e\u003ca href=\"#步骤三、核心组件设计\" class=\"headerlink\" title=\"步骤三、核心组件设计\"\u003e\u003c/a\u003e步骤三、核心组件设计\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e深入每一个核心组件的细节\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"用例：用户输入一段文本，然后得到一个随机生成的链接\"\u003e\u003ca href=\"#用例：用户输入一段文本，然后得到一个随机生成的链接\" class=\"headerlink\" title=\"用例：用户输入一段文本，然后得到一个随机生成的链接\"\u003e\u003c/a\u003e用例：用户输入一段文本，然后得到一个随机生成的链接\u003c/h3\u003e\u003cp\u003e我们可以用一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Frdbms\"\u003e关系型数据库\u003c/a\u003e作为一个大的哈希表，用来把生成的 url 映射到一个包含 paste 文件的文件服务器和路径上。\u003c/p\u003e\n\u003cp\u003e为了避免托管一个文件服务器，我们可以用一个托管的\u003cstrong\u003e对象存储\u003c/strong\u003e，比如 Amazon 的 S3 或者\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B%E5%AD%98%E5%82%A8\"\u003eNoSQL 文档类型存储\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e作为一个大的哈希表的关系型数据库的替代方案，我们可以用\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E9%94%AE-%E5%80%BC%E5%AD%98%E5%82%A8\"\u003eNoSQL 键值存储\u003c/a\u003e。我们需要讨论\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#sql-%E8%BF%98%E6%98%AF-nosql\"\u003e选择 SQL 或 NoSQL 之间的权衡\u003c/a\u003e。下面的讨论是使用关系型数据库方法。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e客户端\u003c/strong\u003e 发送一个创建 paste 的请求到作为一个\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8\"\u003e反向代理\u003c/a\u003e启动的 \u003cstrong\u003eWeb 服务器\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eWeb 服务器\u003c/strong\u003e 转发请求给 \u003cstrong\u003e写接口\u003c/strong\u003e 服务器\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e写接口\u003c/strong\u003e 服务器执行如下操作：\u003cul\u003e\n\u003cli\u003e生成一个唯一的 url\u003cul\u003e\n\u003cli\u003e检查这个 url 在 \u003cstrong\u003eSQL 数据库\u003c/strong\u003e 里面是否是唯一的\u003c/li\u003e\n\u003cli\u003e如果这个 url 不是唯一的，生成另外一个 url\u003c/li\u003e\n\u003cli\u003e如果我们支持自定义 url，我们可以使用用户提供的 url（也需要检查是否重复）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e把生成的 url 存储到 \u003cstrong\u003eSQL 数据库\u003c/strong\u003e 的 \u003ccode\u003epastes\u003c/code\u003e 表里面\u003c/li\u003e\n\u003cli\u003e存储 paste 的内容数据到 \u003cstrong\u003e对象存储\u003c/strong\u003e 里面\u003c/li\u003e\n\u003cli\u003e返回生成的 url\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e向面试官阐明你需要写多少代码\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003epastes\u003c/code\u003e 表可以有如下结构：\u003c/p\u003e\n\u003cfigure class=\"highlight sql\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eshortlink \u003cspan class=\"type\"\u003echar\u003c/span\u003e(\u003cspan class=\"number\"\u003e7\u003c/span\u003e) \u003cspan class=\"keyword\"\u003eNOT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eNULL\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eexpiration_length_in_minutes \u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"keyword\"\u003eNOT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eNULL\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecreated_at datetime \u003cspan class=\"keyword\"\u003eNOT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eNULL\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epaste_path \u003cspan class=\"type\"\u003evarchar\u003c/span\u003e(\u003cspan class=\"number\"\u003e255\u003c/span\u003e) \u003cspan class=\"keyword\"\u003eNOT\u003c/span\u003e \u003cspan class=\"keyword\"\u003eNULL\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ePRIMARY\u003c/span\u003e KEY(shortlink)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e我们将在 \u003ccode\u003eshortlink\u003c/code\u003e 字段和 \u003ccode\u003ecreated_at\u003c/code\u003e 字段上创建一个\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%BD%BF%E7%94%A8%E6%AD%A3%E7%A1%AE%E7%9A%84%E7%B4%A2%E5%BC%95\"\u003e数据库索引\u003c/a\u003e，用来提高查询的速度（避免因为扫描全表导致的长时间查询）并将数据保存在内存中，从内存里面顺序读取 1MB 的数据需要大概 250 微秒，而从 SSD 上读取则需要花费 4 倍的时间，从硬盘上则需要花费 80 倍的时间。\u003csup\u003e\u003ca href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#每个程序员都应该知道的延迟数\"\u003e 1\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cp\u003e为了生成唯一的 url，我们可以：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e使用 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/MD5\"\u003e\u003cstrong\u003eMD5\u003c/strong\u003e\u003c/a\u003e 来哈希用户的 IP 地址 + 时间戳\u003cul\u003e\n\u003cli\u003eMD5 是一个普遍用来生成一个 128-bit 长度的哈希值的一种哈希方法\u003c/li\u003e\n\u003cli\u003eMD5 是一致分布的\u003c/li\u003e\n\u003cli\u003e或者我们也可以用 MD5 哈希一个随机生成的数据\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e用 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.kerstner.at/2012/07/shortening-strings-using-base-62-encoding/\"\u003e\u003cstrong\u003eBase 62\u003c/strong\u003e\u003c/a\u003e 编码 MD5 哈希值\u003cul\u003e\n\u003cli\u003e对于 urls，使用 Base 62 编码 \u003ccode\u003e[a-zA-Z0-9]\u003c/code\u003e 是比较合适的\u003c/li\u003e\n\u003cli\u003e对于每一个原始输入只会有一个 hash 结果，Base 62 是确定的（不涉及随机性）\u003c/li\u003e\n\u003cli\u003eBase 64 是另外一个流行的编码方案，但是对于 urls，会因为额外的 \u003ccode\u003e+\u003c/code\u003e 和 \u003ccode\u003e-\u003c/code\u003e 字符串而产生一些问题\u003c/li\u003e\n\u003cli\u003e以下 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://stackoverflow.com/questions/742013/how-to-code-a-url-shortener\"\u003eBase 62 伪代码\u003c/a\u003e 执行的时间复杂度是 O(k)，k 是数字的数量 = 7：\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003ebase_encode\u003c/span\u003e(\u003cspan class=\"params\"\u003enum, base=\u003cspan class=\"number\"\u003e62\u003c/span\u003e\u003c/span\u003e):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    digits = []\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e num \u0026gt; \u003cspan class=\"number\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      remainder = modulo(num, base)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      digits.push(remainder)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      num = divide(num, base)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    digits = digits.reverse\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e取输出的前 7 个字符，结果会有 62^7 个可能的值，应该足以满足在 3 年内处理 3.6 亿个短链接的约束：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eurl = base_encode(md5(ip_address+timestamp))[:URL_LENGTH]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e我们将会用一个公开的 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%A1%A8%E8%BF%B0%E6%80%A7%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BBrest\"\u003e\u003cstrong\u003eREST 风格接口\u003c/strong\u003e\u003c/a\u003e：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003ecurl -X POST --data \u003cspan class=\"string\"\u003e\u0026#39;{\u0026#34;expiration_length_in_minutes\u0026#34;:\u0026#34;60\u0026#34;, \\\u0026#34;paste_contents\u0026#34;:\u0026#34;Hello World!\u0026#34;}\u0026#39;\u003c/span\u003e https://pastebin.com/api/v1/paste\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eResponse:\u003c/p\u003e\n\u003cfigure class=\"highlight json\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"punctuation\"\u003e{\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003e\u0026#34;shortlink\u0026#34;\u003c/span\u003e\u003cspan class=\"punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;foobar\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e用于内部通信，我们可以用 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AErpc\"\u003eRPC\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 id=\"用例：用户输入一个-paste-的-url-后可以看到它存储的内容\"\u003e\u003ca href=\"#用例：用户输入一个-paste-的-url-后可以看到它存储的内容\" class=\"headerlink\" title=\"用例：用户输入一个 paste 的 url 后可以看到它存储的内容\"\u003e\u003c/a\u003e用例：用户输入一个 paste 的 url 后可以看到它存储的内容\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e客户端\u003c/strong\u003e 发送一个获取 paste 请求到 \u003cstrong\u003eWeb Server\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eWeb Server\u003c/strong\u003e 转发请求给 \u003cstrong\u003e读取接口\u003c/strong\u003e 服务器\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e读取接口\u003c/strong\u003e 服务器执行如下操作：\u003cul\u003e\n\u003cli\u003e在 \u003cstrong\u003eSQL 数据库\u003c/strong\u003e 检查这个生成的 url\u003cul\u003e\n\u003cli\u003e如果这个 url 在 \u003cstrong\u003eSQL 数据库\u003c/strong\u003e 里面，则从 \u003cstrong\u003e对象存储\u003c/strong\u003e 获取这个 paste 的内容\u003c/li\u003e\n\u003cli\u003e否则，返回一个错误页面给用户\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eREST API：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecurl https://pastebin.com/api/v1/paste?shortlink=foobar\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eResponse:\u003c/p\u003e\n\u003cfigure class=\"highlight json\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"punctuation\"\u003e{\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003e\u0026#34;paste_contents\u0026#34;\u003c/span\u003e\u003cspan class=\"punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Hello World\u0026#34;\u003c/span\u003e\u003cspan class=\"punctuation\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003e\u0026#34;created_at\u0026#34;\u003c/span\u003e\u003cspan class=\"punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;YYYY-MM-DD HH:MM:SS\u0026#34;\u003c/span\u003e\u003cspan class=\"punctuation\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003e\u0026#34;expiration_length_in_minutes\u0026#34;\u003c/span\u003e\u003cspan class=\"punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;60\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"用例：-服务跟踪分析页面\"\u003e\u003ca href=\"#用例：-服务跟踪分析页面\" class=\"headerlink\" title=\"用例： 服务跟踪分析页面\"\u003e\u003c/a\u003e用例： 服务跟踪分析页面\u003c/h3\u003e\u003cp\u003e因为实时分析不是必须的，所以我们可以简单的 \u003cstrong\u003eMapReduce\u003c/strong\u003e \u003cstrong\u003eWeb Server\u003c/strong\u003e 的日志，用来生成点击次数。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eHitCounts\u003c/span\u003e(\u003cspan class=\"title class_ inherited__\"\u003eMRJob\u003c/span\u003e):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003eextract_url\u003c/span\u003e(\u003cspan class=\"params\"\u003eself, line\u003c/span\u003e):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u0026#34;Extract the generated url from the log line.\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        ...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003eextract_year_month\u003c/span\u003e(\u003cspan class=\"params\"\u003eself, line\u003c/span\u003e):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u0026#34;Return the year and month portions of the timestamp.\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        ...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003emapper\u003c/span\u003e(\u003cspan class=\"params\"\u003eself, _, line\u003c/span\u003e):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u0026#34;Parse each log line, extract and transform relevant lines.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        Emit key value pairs of the form:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        (2016-01, url0), 1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        (2016-01, url0), 1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        (2016-01, url1), 1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        url = self.extract_url(line)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        period = self.extract_year_month(line)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eyield\u003c/span\u003e (period, url), \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003ereducer\u003c/span\u003e(\u003cspan class=\"params\"\u003eself, key, values\u003c/span\u003e):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u0026#34;Sum values for each key.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        (2016-01, url0), 2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        (2016-01, url1), 1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eyield\u003c/span\u003e key, \u003cspan class=\"built_in\"\u003esum\u003c/span\u003e(values)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"用例：-服务删除过期的-pastes\"\u003e\u003ca href=\"#用例：-服务删除过期的-pastes\" class=\"headerlink\" title=\"用例： 服务删除过期的 pastes\"\u003e\u003c/a\u003e用例： 服务删除过期的 pastes\u003c/h3\u003e\u003cp\u003e为了删除过期的 pastes，我们可以直接搜索 \u003cstrong\u003eSQL 数据库\u003c/strong\u003e 中所有的过期时间比当前时间更早的记录，\u003cbr/\u003e所有过期的记录将从这张表里面删除（或者将其标记为过期）。\u003c/p\u003e\n\u003ch2 id=\"步骤四、扩展设计\"\u003e\u003ca href=\"#步骤四、扩展设计\" class=\"headerlink\" title=\"步骤四、扩展设计\"\u003e\u003c/a\u003e步骤四、扩展设计\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e给定约束条件，识别和解决瓶颈。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/4edXG0T.png\" alt=\"Imgur\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e重要提示: 不要简单的从最初的设计直接跳到最终的设计\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e说明您将迭代地执行这样的操作：1)\u003cstrong\u003eBenchmark/Load 测试\u003c/strong\u003e，2)\u003cstrong\u003eProfile\u003c/strong\u003e 出瓶颈，3)在评估替代方案和权衡时解决瓶颈，4)重复前面，可以参考在 AWS 上设计一个可以支持百万用户的系统这个用来解决如何迭代地扩展初始设计的例子。\u003c/p\u003e\n\u003cp\u003e重要的是讨论在初始设计中可能遇到的瓶颈，以及如何解决每个瓶颈。比如，在多个 \u003cstrong\u003eWeb 服务器\u003c/strong\u003e 上添加 \u003cstrong\u003e负载平衡器\u003c/strong\u003e 可以解决哪些问题？ \u003cstrong\u003eCDN\u003c/strong\u003e 解决哪些问题？\u003cstrong\u003eMaster-Slave Replicas\u003c/strong\u003e 解决哪些问题? 替代方案是什么和怎么对每一个替代方案进行权衡比较？\u003c/p\u003e\n\u003cp\u003e我们将介绍一些组件来完成设计，并解决可伸缩性问题。内部的负载平衡器并不能减少杂乱。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e为了避免重复的讨论\u003c/strong\u003e， 参考以下\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%BB%E9%A2%98%E7%9A%84%E7%B4%A2%E5%BC%95\"\u003e系统设计主题\u003c/a\u003e获取主要讨论要点、权衡和替代方案：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F\"\u003eDNS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%86%85%E5%AE%B9%E5%88%86%E5%8F%91%E7%BD%91%E7%BB%9Ccdn\"\u003eCDN\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8\"\u003e负载均衡器\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%B0%B4%E5%B9%B3%E6%89%A9%E5%B1%95\"\u003e水平扩展\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8\"\u003e反向代理（web 服务器）\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%BA%94%E7%94%A8%E5%B1%82\"\u003e应用层\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%BC%93%E5%AD%98\"\u003e缓存\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Frdbms\"\u003e关系型数据库管理系统 (RDBMS)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%95%85%E9%9A%9C%E5%88%87%E6%8D%A2\"\u003eSQL write master-slave failover\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6\"\u003e主从复制\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%BC%8F\"\u003e一致性模式\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%AF%E7%94%A8%E6%80%A7%E6%A8%A1%E5%BC%8F\"\u003e可用性模式\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e分析存储数据库\u003c/strong\u003e 可以用比如 Amazon Redshift 或者 Google BigQuery 这样的数据仓库解决方案。\u003c/p\u003e\n\u003cp\u003e一个像 Amazon S3 这样的 \u003cstrong\u003e对象存储\u003c/strong\u003e，可以轻松处理每月 12.7 GB 的新内容约束。\u003c/p\u003e\n\u003cp\u003e要处理 \u003cem\u003e平均\u003c/em\u003e 每秒 40 读请求(峰值更高)，其中热点内容的流量应该由 \u003cstrong\u003e内存缓存\u003c/strong\u003e 处理，而不是数据库。\u003cstrong\u003e内存缓存\u003c/strong\u003e 对于处理分布不均匀的流量和流量峰值也很有用。只要副本没有陷入复制写的泥潭，\u003cstrong\u003eSQL Read Replicas\u003c/strong\u003e 应该能够处理缓存丢失。\u003c/p\u003e\n\u003cp\u003e对于单个 \u003cstrong\u003eSQL Write Master-Slave\u003c/strong\u003e，\u003cem\u003e平均\u003c/em\u003e 每秒 4paste 写入 (峰值更高) 应该是可以做到的。否则，我们需要使用额外的 SQL 扩展模式:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%81%94%E5%90%88\"\u003e联合\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%86%E7%89%87\"\u003e分片\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E9%9D%9E%E8%A7%84%E8%8C%83%E5%8C%96\"\u003e非规范化\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#SQL%E8%B0%83%E4%BC%98\"\u003eSQL 调优\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我们还应该考虑将一些数据移动到 \u003cstrong\u003eNoSQL 数据库\u003c/strong\u003e。\u003c/p\u003e\n\u003ch2 id=\"额外的话题\"\u003e\u003ca href=\"#额外的话题\" class=\"headerlink\" title=\"额外的话题\"\u003e\u003c/a\u003e额外的话题\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e是否更深入探讨额外主题，取决于问题的范围和面试剩余的时间。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"NoSQL\"\u003e\u003ca href=\"#NoSQL\" class=\"headerlink\" title=\"NoSQL\"\u003e\u003c/a\u003eNoSQL\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E9%94%AE-%E5%80%BC%E5%AD%98%E5%82%A8\"\u003e键值存储\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B%E5%AD%98%E5%82%A8\"\u003e文档存储\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%97%E5%9E%8B%E5%AD%98%E5%82%A8\"\u003e列型存储\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93\"\u003e图数据库\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#sql-%E8%BF%98%E6%98%AF-nosql\"\u003esql 还是 nosql\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"缓存\"\u003e\u003ca href=\"#缓存\" class=\"headerlink\" title=\"缓存\"\u003e\u003c/a\u003e缓存\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e在哪缓存\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98\"\u003e客户端缓存\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#cdn-%E7%BC%93%E5%AD%98\"\u003eCDN 缓存\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%93%E5%AD%98\"\u003eWeb 服务器缓存\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%93%E5%AD%98\"\u003e数据库缓存\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98\"\u003e应用缓存\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e缓存什么\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98\"\u003e数据库查询级别的缓存\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%AF%B9%E8%B1%A1%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98\"\u003e对象级别的缓存\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e何时更新缓存\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F\"\u003e缓存模式\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%9B%B4%E5%86%99%E6%A8%A1%E5%BC%8F\"\u003e直写模式\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%9B%9E%E5%86%99%E6%A8%A1%E5%BC%8F\"\u003e回写模式\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%B7%E6%96%B0\"\u003e刷新\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"异步和微服务\"\u003e\u003ca href=\"#异步和微服务\" class=\"headerlink\" title=\"异步和微服务\"\u003e\u003c/a\u003e异步和微服务\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97\"\u003e消息队列\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97\"\u003e任务队列\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%83%8C%E5%8E%8B\"\u003e背压\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%BE%AE%E6%9C%8D%E5%8A%A1\"\u003e微服务\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"通信\"\u003e\u003ca href=\"#通信\" class=\"headerlink\" title=\"通信\"\u003e\u003c/a\u003e通信\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e讨论权衡:\u003cul\u003e\n\u003cli\u003e跟客户端之间的外部通信 - \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%A1%A8%E8%BF%B0%E6%80%A7%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BBrest\"\u003eHTTP APIs following REST\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e内部通信 - \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AErpc\"\u003eRPC\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0\"\u003e服务发现\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"安全\"\u003e\u003ca href=\"#安全\" class=\"headerlink\" title=\"安全\"\u003e\u003c/a\u003e安全\u003c/h3\u003e\u003cp\u003e参考\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%AE%89%E5%85%A8\"\u003e安全\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 id=\"延迟数字\"\u003e\u003ca href=\"#延迟数字\" class=\"headerlink\" title=\"延迟数字\"\u003e\u003c/a\u003e延迟数字\u003c/h3\u003e\u003cp\u003e见\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%AF%8F%E4%B8%AA%E7%A8%8B%E5%BA%8F%E5%91%98%E9%83%BD%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%E5%BB%B6%E8%BF%9F%E6%95%B0\"\u003e每个程序员都应该知道的延迟数\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 id=\"持续进行\"\u003e\u003ca href=\"#持续进行\" class=\"headerlink\" title=\"持续进行\"\u003e\u003c/a\u003e持续进行\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e继续对系统进行基准测试和监控，以在瓶颈出现时解决它们\u003c/li\u003e\n\u003cli\u003e扩展是一个迭代的过程\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2021-11-08T00:15:33Z",
  "Author": "钝悟 ◾ Dunwu"
}