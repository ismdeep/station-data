{
  "Source": "dunwu",
  "Title": "Javaé”",
  "Link": "https://dunwu.github.io/blog/pages/e2e047/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"æ·±å…¥ç†è§£-Java-å¹¶å‘é”\"\u003e\u003ca href=\"#æ·±å…¥ç†è§£-Java-å¹¶å‘é”\" class=\"headerlink\" title=\"æ·±å…¥ç†è§£ Java å¹¶å‘é”\"\u003e\u003c/a\u003eæ·±å…¥ç†è§£ Java å¹¶å‘é”\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003eæœ¬æ–‡å…ˆé˜è¿° Java ä¸­å„ç§é”çš„æ¦‚å¿µã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åï¼Œä»‹ç»é”çš„æ ¸å¿ƒå®ç° AQSã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åï¼Œé‡ç‚¹ä»‹ç» Lock å’Œ Condition ä¸¤ä¸ªæ¥å£åŠå…¶å®ç°ã€‚å¹¶å‘ç¼–ç¨‹æœ‰ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šåŒæ­¥å’Œäº’æ–¥ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eäº’æ–¥\u003c/strong\u003eï¼Œå³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼›\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eåŒæ­¥\u003c/strong\u003eï¼Œå³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ã€åä½œã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸¤å¤§é—®é¢˜ï¼Œç®¡ç¨‹ï¼ˆ\u003ccode\u003esychronized\u003c/code\u003eï¼‰éƒ½æ˜¯èƒ½å¤Ÿè§£å†³çš„ã€‚\u003cstrong\u003eJ.U.C åŒ…è¿˜æä¾›äº† Lock å’Œ Condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨‹ï¼Œå…¶ä¸­ Lock ç”¨äºè§£å†³äº’æ–¥é—®é¢˜ï¼ŒCondition ç”¨äºè§£å†³åŒæ­¥é—®é¢˜\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"å¹¶å‘é”ç®€ä»‹\"\u003e\u003ca href=\"#å¹¶å‘é”ç®€ä»‹\" class=\"headerlink\" title=\"å¹¶å‘é”ç®€ä»‹\"\u003e\u003c/a\u003eå¹¶å‘é”ç®€ä»‹\u003c/h2\u003e\u003cp\u003eç¡®ä¿çº¿ç¨‹å®‰å…¨æœ€å¸¸è§çš„åšæ³•æ˜¯åˆ©ç”¨é”æœºåˆ¶ï¼ˆ\u003ccode\u003eLock\u003c/code\u003eã€\u003ccode\u003esychronized\u003c/code\u003eï¼‰æ¥å¯¹å…±äº«æ•°æ®åšäº’æ–¥åŒæ­¥ï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—ï¼Œé‚£ä¹ˆæ“ä½œå¿…ç„¶æ˜¯åŸå­æ€§çš„ï¼Œçº¿ç¨‹å®‰å…¨çš„ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨å·¥ä½œã€é¢è¯•ä¸­ï¼Œç»å¸¸ä¼šå¬åˆ°å„ç§äº”èŠ±å…«é—¨çš„é”ï¼Œå¬çš„äººäº‘é‡Œé›¾é‡Œã€‚é”çš„æ¦‚å¿µæœ¯è¯­å¾ˆå¤šï¼Œå®ƒä»¬æ˜¯é’ˆå¯¹ä¸åŒçš„é—®é¢˜æ‰€æå‡ºçš„ï¼Œé€šè¿‡ç®€å•çš„æ¢³ç†ï¼Œä¹Ÿä¸éš¾ç†è§£ã€‚\u003c/p\u003e\n\u003ch3 id=\"å¯é‡å…¥é”\"\u003e\u003ca href=\"#å¯é‡å…¥é”\" class=\"headerlink\" title=\"å¯é‡å…¥é”\"\u003e\u003c/a\u003eå¯é‡å…¥é”\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eå¯é‡å…¥é”ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥é‡å¤è·å–åŒä¸€æŠŠé”\u003c/strong\u003eã€‚å³åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–äº†é”ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå¯é‡å…¥é”å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…æ­»é”\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e ã€\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e æ˜¯å¯é‡å…¥é”\u003c/strong\u003eã€‚è¿™ç‚¹ï¼Œä»å…¶å‘½åä¹Ÿä¸éš¾çœ‹å‡ºã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003esynchronized\u003c/code\u003e ä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å…¥é”\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã€ç¤ºä¾‹ã€‘\u003ccode\u003esynchronized\u003c/code\u003e çš„å¯é‡å…¥ç¤ºä¾‹\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003esynchronized\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003esetA\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e Exception{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Thread.sleep(\u003cspan class=\"number\"\u003e1000\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    setB();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003esynchronized\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003esetB\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e Exception{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Thread.sleep(\u003cspan class=\"number\"\u003e1000\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ªå…¸å‹åœºæ™¯ï¼šå¦‚æœä½¿ç”¨çš„é”ä¸æ˜¯å¯é‡å…¥é”çš„è¯ï¼Œ\u003ccode\u003esetB\u003c/code\u003e å¯èƒ½ä¸ä¼šè¢«å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œä»è€Œé€ æˆæ­»é”ã€‚\u003c/p\u003e\n\u003cp\u003eã€ç¤ºä¾‹ã€‘\u003ccode\u003eReentrantLock\u003c/code\u003e çš„å¯é‡å…¥ç¤ºä¾‹\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eTask\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"type\"\u003eint\u003c/span\u003e value;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eLock\u003c/span\u003e \u003cspan class=\"variable\"\u003elock\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eReentrantLock\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"title function_\"\u003eTask\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003ethis\u003c/span\u003e.value = \u003cspan class=\"number\"\u003e0\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"title function_\"\u003eget\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// è·å–é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        lock.lock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e value;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e// ä¿è¯é”èƒ½é‡Šæ”¾\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            lock.unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eaddOne\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// è·å–é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        lock.lock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e// æ³¨æ„ï¼šæ­¤å¤„å·²ç»æˆåŠŸè·å–é”ï¼Œè¿›å…¥ get æ–¹æ³•åï¼Œåˆå°è¯•è·å–é”ï¼Œ\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e// å¦‚æœé”ä¸æ˜¯å¯é‡å…¥çš„ï¼Œä¼šå¯¼è‡´æ­»é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            value = \u003cspan class=\"number\"\u003e1\u003c/span\u003e + get();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e// ä¿è¯é”èƒ½é‡Šæ”¾\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            lock.unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"å…¬å¹³é”ä¸éå…¬å¹³é”\"\u003e\u003ca href=\"#å…¬å¹³é”ä¸éå…¬å¹³é”\" class=\"headerlink\" title=\"å…¬å¹³é”ä¸éå…¬å¹³é”\"\u003e\u003c/a\u003eå…¬å¹³é”ä¸éå…¬å¹³é”\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå…¬å¹³é”\u003c/strong\u003e - å…¬å¹³é”æ˜¯æŒ‡ \u003cstrong\u003eå¤šçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eéå…¬å¹³é”\u003c/strong\u003e - éå…¬å¹³é”æ˜¯æŒ‡ \u003cstrong\u003eå¤šçº¿ç¨‹ä¸æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”\u003c/strong\u003e ã€‚è¿™å°±å¯èƒ½ä¼šå‡ºç°ä¼˜å…ˆçº§åè½¬ï¼ˆåæ¥è€…å±…ä¸Šï¼‰æˆ–è€…é¥¥é¥¿ç°è±¡ï¼ˆæŸçº¿ç¨‹æ€»æ˜¯æŠ¢ä¸è¿‡åˆ«çš„çº¿ç¨‹ï¼Œå¯¼è‡´å§‹ç»ˆæ— æ³•æ‰§è¡Œï¼‰ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå…¬å¹³é”ä¸ºäº†ä¿è¯çº¿ç¨‹ç”³è¯·é¡ºåºï¼ŒåŠ¿å¿…è¦ä»˜å‡ºä¸€å®šçš„æ€§èƒ½ä»£ä»·ï¼Œå› æ­¤å…¶ååé‡ä¸€èˆ¬ä½äºéå…¬å¹³é”ã€‚\u003c/p\u003e\n\u003cp\u003eå…¬å¹³é”ä¸éå…¬å¹³é” åœ¨ Java ä¸­çš„å…¸å‹å®ç°ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003esynchronized\u003c/code\u003e åªæ”¯æŒéå…¬å¹³é”\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e ã€\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003eï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œä½†æ”¯æŒå…¬å¹³é”\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ç‹¬äº«é”ä¸å…±äº«é”\"\u003e\u003ca href=\"#ç‹¬äº«é”ä¸å…±äº«é”\" class=\"headerlink\" title=\"ç‹¬äº«é”ä¸å…±äº«é”\"\u003e\u003c/a\u003eç‹¬äº«é”ä¸å…±äº«é”\u003c/h3\u003e\u003cp\u003eç‹¬äº«é”ä¸å…±äº«é”æ˜¯ä¸€ç§å¹¿ä¹‰ä¸Šçš„è¯´æ³•ï¼Œä»å®é™…ç”¨é€”ä¸Šæ¥çœ‹ï¼Œä¹Ÿå¸¸è¢«ç§°ä¸ºäº’æ–¥é”ä¸è¯»å†™é”ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eç‹¬äº«é”\u003c/strong\u003e - ç‹¬äº«é”æ˜¯æŒ‡ \u003cstrong\u003eé”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå…±äº«é”\u003c/strong\u003e - å…±äº«é”æ˜¯æŒ‡ \u003cstrong\u003eé”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç‹¬äº«é”ä¸å…±äº«é”åœ¨ Java ä¸­çš„å…¸å‹å®ç°ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003esynchronized\u003c/code\u003e ã€\u003ccode\u003eReentrantLock\u003c/code\u003e åªæ”¯æŒç‹¬äº«é”\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e å…¶å†™é”æ˜¯ç‹¬äº«é”ï¼Œå…¶è¯»é”æ˜¯å…±äº«é”\u003c/strong\u003eã€‚è¯»é”æ˜¯å…±äº«é”ä½¿å¾—å¹¶å‘è¯»æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œè¯»å†™ï¼Œå†™è¯» ï¼Œå†™å†™çš„è¿‡ç¨‹æ˜¯äº’æ–¥çš„ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"æ‚²è§‚é”ä¸ä¹è§‚é”\"\u003e\u003ca href=\"#æ‚²è§‚é”ä¸ä¹è§‚é”\" class=\"headerlink\" title=\"æ‚²è§‚é”ä¸ä¹è§‚é”\"\u003e\u003c/a\u003eæ‚²è§‚é”ä¸ä¹è§‚é”\u003c/h3\u003e\u003cp\u003eä¹è§‚é”ä¸æ‚²è§‚é”ä¸æ˜¯æŒ‡å…·ä½“çš„ä»€ä¹ˆç±»å‹çš„é”ï¼Œè€Œæ˜¯\u003cstrong\u003eå¤„ç†å¹¶å‘åŒæ­¥çš„ç­–ç•¥\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eæ‚²è§‚é”\u003c/strong\u003e - æ‚²è§‚é”å¯¹äºå¹¶å‘é‡‡å–æ‚²è§‚çš„æ€åº¦ï¼Œè®¤ä¸ºï¼š\u003cstrong\u003eä¸åŠ é”çš„å¹¶å‘æ“ä½œä¸€å®šä¼šå‡ºé—®é¢˜\u003c/strong\u003eã€‚\u003cstrong\u003eæ‚²è§‚é”é€‚åˆå†™æ“ä½œé¢‘ç¹çš„åœºæ™¯\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eä¹è§‚é”\u003c/strong\u003e - ä¹è§‚é”å¯¹äºå¹¶å‘é‡‡å–ä¹è§‚çš„æ€åº¦ï¼Œè®¤ä¸ºï¼š\u003cstrong\u003eä¸åŠ é”çš„å¹¶å‘æ“ä½œä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ˜¯ä¸ä¼šå‘ç”Ÿä¿®æ”¹çš„\u003c/strong\u003eã€‚åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¼šé‡‡ç”¨ä¸æ–­å°è¯•æ›´æ–°çš„æ–¹å¼æ›´æ–°æ•°æ®ã€‚\u003cstrong\u003eä¹è§‚é”é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ‚²è§‚é”ä¸ä¹è§‚é”åœ¨ Java ä¸­çš„å…¸å‹å®ç°ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eæ‚²è§‚é”åœ¨ Java ä¸­çš„åº”ç”¨å°±æ˜¯é€šè¿‡ä½¿ç”¨ \u003ccode\u003esynchronized\u003c/code\u003e å’Œ \u003ccode\u003eLock\u003c/code\u003e æ˜¾ç¤ºåŠ é”æ¥è¿›è¡Œäº’æ–¥åŒæ­¥ï¼Œè¿™æ˜¯ä¸€ç§é˜»å¡åŒæ­¥ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eä¹è§‚é”åœ¨ Java ä¸­çš„åº”ç”¨å°±æ˜¯é‡‡ç”¨ \u003ccode\u003eCAS\u003c/code\u003e æœºåˆ¶ï¼ˆ\u003ccode\u003eCAS\u003c/code\u003e æ“ä½œé€šè¿‡ \u003ccode\u003eUnsafe\u003c/code\u003e ç±»æä¾›ï¼Œä½†è¿™ä¸ªç±»ä¸ç›´æ¥æš´éœ²ä¸º APIï¼Œæ‰€ä»¥éƒ½æ˜¯é—´æ¥ä½¿ç”¨ï¼Œå¦‚å„ç§åŸå­ç±»ï¼‰ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”\"\u003e\u003ca href=\"#åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”\" class=\"headerlink\" title=\"åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”\"\u003e\u003c/a\u003eåå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”\u003c/h3\u003e\u003cp\u003eæ‰€è°“è½»é‡çº§é”ä¸é‡é‡çº§é”ï¼ŒæŒ‡çš„æ˜¯é”æ§åˆ¶ç²’åº¦çš„ç²—ç»†ã€‚æ˜¾ç„¶ï¼Œæ§åˆ¶ç²’åº¦è¶Šç»†ï¼Œé˜»å¡å¼€é”€è¶Šå°ï¼Œå¹¶å‘æ€§ä¹Ÿå°±è¶Šé«˜ã€‚\u003c/p\u003e\n\u003cp\u003eJava 1.6 ä»¥å‰ï¼Œé‡é‡çº§é”ä¸€èˆ¬æŒ‡çš„æ˜¯ \u003ccode\u003esynchronized\u003c/code\u003e ï¼Œè€Œè½»é‡çº§é”æŒ‡çš„æ˜¯ \u003ccode\u003evolatile\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eJava 1.6 ä»¥åï¼Œé’ˆå¯¹ \u003ccode\u003esynchronized\u003c/code\u003e åšäº†å¤§é‡ä¼˜åŒ–ï¼Œå¼•å…¥ 4 ç§é”çŠ¶æ€ï¼š æ— é”çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”å¯ä»¥å•å‘çš„ä»åå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œå†ä»è½»é‡çº§é”å‡çº§åˆ°é‡é‡çº§é” ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eåå‘é”\u003c/strong\u003e - åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ã€‚é™ä½è·å–é”çš„ä»£ä»·ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eè½»é‡çº§é”\u003c/strong\u003e - æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eé‡é‡çº§é”\u003c/strong\u003e - æ˜¯æŒ‡å½“é”ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è™½ç„¶æ˜¯è‡ªæ—‹ï¼Œä½†è‡ªæ—‹ä¸ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œå½“è‡ªæ—‹ä¸€å®šæ¬¡æ•°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡ï¼Œè¯¥é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·çš„çº¿ç¨‹è¿›å…¥é˜»å¡ï¼Œæ€§èƒ½é™ä½ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"åˆ†æ®µé”\"\u003e\u003ca href=\"#åˆ†æ®µé”\" class=\"headerlink\" title=\"åˆ†æ®µé”\"\u003e\u003c/a\u003eåˆ†æ®µé”\u003c/h3\u003e\u003cp\u003eåˆ†æ®µé”å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ã€‚æ‰€è°“åˆ†æ®µé”ï¼Œå°±æ˜¯æŠŠé”çš„å¯¹è±¡åˆ†æˆå¤šæ®µï¼Œæ¯æ®µç‹¬ç«‹æ§åˆ¶ï¼Œä½¿å¾—é”ç²’åº¦æ›´ç»†ï¼Œå‡å°‘é˜»å¡å¼€é”€ï¼Œä»è€Œæé«˜å¹¶å‘æ€§ã€‚è¿™å…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±åƒé«˜é€Ÿå…¬è·¯ä¸Šçš„æ”¶è´¹ç«™ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæ”¶è´¹å£ï¼Œé‚£æ‰€æœ‰çš„è½¦åªèƒ½æ’æˆä¸€æ¡é˜Ÿç¼´è´¹ï¼›å¦‚æœæœ‰å¤šä¸ªæ”¶è´¹å£ï¼Œå°±å¯ä»¥åˆ†æµäº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eHashtable\u003c/code\u003e ä½¿ç”¨ \u003ccode\u003esynchronized\u003c/code\u003e ä¿®é¥°æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼Œé‚£ä¹ˆé¢å¯¹çº¿ç¨‹çš„è®¿é—®ï¼ŒHashtable å°±ä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰çš„å…¶å®ƒçº¿ç¨‹åªèƒ½ç­‰å¾…ï¼Œè¿™ç§é˜»å¡æ–¹å¼çš„ååé‡æ˜¾ç„¶å¾ˆä½ã€‚\u003c/p\u003e\n\u003cp\u003eJava 1.7 ä»¥å‰çš„ \u003ccode\u003eConcurrentHashMap\u003c/code\u003e å°±æ˜¯åˆ†æ®µé”çš„å…¸å‹æ¡ˆä¾‹ã€‚\u003ccode\u003eConcurrentHashMap\u003c/code\u003e ç»´æŠ¤äº†ä¸€ä¸ª \u003ccode\u003eSegment\u003c/code\u003e æ•°ç»„ï¼Œä¸€èˆ¬ç§°ä¸ºåˆ†æ®µæ¡¶ã€‚\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e Segment\u0026lt;K,V\u0026gt;[] segments;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eå½“æœ‰çº¿ç¨‹è®¿é—® \u003ccode\u003eConcurrentHashMap\u003c/code\u003e çš„æ•°æ®æ—¶ï¼Œ\u003ccode\u003eConcurrentHashMap\u003c/code\u003e ä¼šå…ˆæ ¹æ® hashCode è®¡ç®—å‡ºæ•°æ®åœ¨å“ªä¸ªæ¡¶ï¼ˆå³å“ªä¸ª Segmentï¼‰ï¼Œç„¶åé”ä½è¿™ä¸ª \u003ccode\u003eSegment\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch3 id=\"æ˜¾ç¤ºé”å’Œå†…ç½®é”\"\u003e\u003ca href=\"#æ˜¾ç¤ºé”å’Œå†…ç½®é”\" class=\"headerlink\" title=\"æ˜¾ç¤ºé”å’Œå†…ç½®é”\"\u003e\u003c/a\u003eæ˜¾ç¤ºé”å’Œå†…ç½®é”\u003c/h3\u003e\u003cp\u003eJava 1.5 ä¹‹å‰ï¼Œåè°ƒå¯¹å…±äº«å¯¹è±¡çš„è®¿é—®æ—¶å¯ä»¥ä½¿ç”¨çš„æœºåˆ¶åªæœ‰ \u003ccode\u003esynchronized\u003c/code\u003e å’Œ \u003ccode\u003evolatile\u003c/code\u003eã€‚è¿™ä¸¤ä¸ªéƒ½å±äºå†…ç½®é”ï¼Œå³é”çš„ç”³è¯·å’Œé‡Šæ”¾éƒ½æ˜¯ç”± JVM æ‰€æ§åˆ¶ã€‚\u003c/p\u003e\n\u003cp\u003eJava 1.5 ä¹‹åï¼Œå¢åŠ äº†æ–°çš„æœºåˆ¶ï¼š\u003ccode\u003eReentrantLock\u003c/code\u003eã€\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e ï¼Œè¿™ç±»é”çš„ç”³è¯·å’Œé‡Šæ”¾éƒ½å¯ä»¥ç”±ç¨‹åºæ‰€æ§åˆ¶ï¼Œæ‰€ä»¥å¸¸è¢«ç§°ä¸ºæ˜¾ç¤ºé”ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eğŸ’¡ \u003ccode\u003esynchronized\u003c/code\u003e çš„ç”¨æ³•å’ŒåŸç†å¯ä»¥å‚è€ƒï¼š\u003ca href=\"https://dunwu.github.io/waterdrop/pages/2c6488/#%E4%BA%8Csynchronized\"\u003eJava å¹¶å‘åŸºç¡€æœºåˆ¶ - synchronized\u003c/a\u003e ã€‚\u003c/p\u003e\n\u003cp\u003e:bell: æ³¨æ„ï¼šå¦‚æœä¸éœ€è¦ \u003ccode\u003eReentrantLock\u003c/code\u003eã€\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e æ‰€æä¾›çš„é«˜çº§åŒæ­¥ç‰¹æ€§ï¼Œ\u003cstrong\u003eåº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ \u003ccode\u003esynchronized\u003c/code\u003e\u003c/strong\u003e ã€‚ç†ç”±å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eJava 1.6 ä»¥åï¼Œ\u003ccode\u003esynchronized\u003c/code\u003e åšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå…¶æ€§èƒ½å·²ç»ä¸ \u003ccode\u003eReentrantLock\u003c/code\u003eã€\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e åŸºæœ¬ä¸ŠæŒå¹³ã€‚\u003c/li\u003e\n\u003cli\u003eä»è¶‹åŠ¿æ¥çœ‹ï¼ŒJava æœªæ¥æ›´å¯èƒ½ä¼šä¼˜åŒ– \u003ccode\u003esynchronized\u003c/code\u003e ï¼Œè€Œä¸æ˜¯ \u003ccode\u003eReentrantLock\u003c/code\u003eã€\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e ï¼Œå› ä¸º \u003ccode\u003esynchronized\u003c/code\u003e æ˜¯ JVM å†…ç½®å±æ€§ï¼Œå®ƒèƒ½æ‰§è¡Œä¸€äº›ä¼˜åŒ–ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock\u003c/code\u003eã€\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e ç”³è¯·å’Œé‡Šæ”¾é”éƒ½æ˜¯ç”±ç¨‹åºæ§åˆ¶ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½é€ æˆæ­»é”ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eä»¥ä¸‹å¯¹æ¯”ä¸€ä¸‹æ˜¾ç¤ºé”å’Œå†…ç½®é”çš„å·®å¼‚ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eä¸»åŠ¨è·å–é”å’Œé‡Šæ”¾é”\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esynchronized\u003c/code\u003e ä¸èƒ½ä¸»åŠ¨è·å–é”å’Œé‡Šæ”¾é”ã€‚è·å–é”å’Œé‡Šæ”¾é”éƒ½æ˜¯ JVM æ§åˆ¶çš„ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e å¯ä»¥ä¸»åŠ¨è·å–é”å’Œé‡Šæ”¾é”ã€‚ï¼ˆå¦‚æœå¿˜è®°é‡Šæ”¾é”ï¼Œå°±å¯èƒ½äº§ç”Ÿæ­»é”ï¼‰ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå“åº”ä¸­æ–­\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esynchronized\u003c/code\u003e ä¸èƒ½å“åº”ä¸­æ–­ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e å¯ä»¥å“åº”ä¸­æ–­ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eè¶…æ—¶æœºåˆ¶\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esynchronized\u003c/code\u003e æ²¡æœ‰è¶…æ—¶æœºåˆ¶ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e æœ‰è¶…æ—¶æœºåˆ¶ã€‚\u003ccode\u003eReentrantLock\u003c/code\u003e å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶åè‡ªåŠ¨é‡Šæ”¾é”ï¼Œé¿å…ä¸€ç›´ç­‰å¾…ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ”¯æŒå…¬å¹³é”\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esynchronized\u003c/code\u003e åªæ”¯æŒéå…¬å¹³é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e æ”¯æŒéå…¬å¹³é”å’Œå…¬å¹³é”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ˜¯å¦æ”¯æŒå…±äº«\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003eè¢« \u003ccode\u003esynchronized\u003c/code\u003e ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—ï¼Œåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼ˆç‹¬äº«ï¼‰ã€‚å¦‚æœè¿™ä¸ªçº¿ç¨‹è¢«é˜»å¡ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿåªèƒ½ç­‰å¾…\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e å¯ä»¥åŸºäº \u003ccode\u003eCondition\u003c/code\u003e çµæ´»çš„æ§åˆ¶åŒæ­¥æ¡ä»¶ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ˜¯å¦æ”¯æŒè¯»å†™åˆ†ç¦»\u003c/strong\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esynchronized\u003c/code\u003e ä¸æ”¯æŒè¯»å†™é”åˆ†ç¦»ï¼›\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e æ”¯æŒè¯»å†™é”ï¼Œä»è€Œä½¿é˜»å¡è¯»å†™çš„æ“ä½œåˆ†å¼€ï¼Œæœ‰æ•ˆæé«˜å¹¶å‘æ€§ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"Lock-å’Œ-Condition\"\u003e\u003ca href=\"#Lock-å’Œ-Condition\" class=\"headerlink\" title=\"Lock å’Œ Condition\"\u003e\u003c/a\u003eLock å’Œ Condition\u003c/h2\u003e\u003ch3 id=\"ä¸ºä½•å¼•å…¥-Lock-å’Œ-Condition\"\u003e\u003ca href=\"#ä¸ºä½•å¼•å…¥-Lock-å’Œ-Condition\" class=\"headerlink\" title=\"ä¸ºä½•å¼•å…¥ Lock å’Œ Condition\"\u003e\u003c/a\u003eä¸ºä½•å¼•å…¥ Lock å’Œ Condition\u003c/h3\u003e\u003cp\u003eå¹¶å‘ç¼–ç¨‹é¢†åŸŸï¼Œæœ‰ä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼šä¸€ä¸ªæ˜¯\u003cstrong\u003eäº’æ–¥\u003c/strong\u003eï¼Œå³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼›å¦ä¸€ä¸ªæ˜¯\u003cstrong\u003eåŒæ­¥\u003c/strong\u003eï¼Œå³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ã€åä½œã€‚è¿™ä¸¤å¤§é—®é¢˜ï¼Œç®¡ç¨‹éƒ½æ˜¯èƒ½å¤Ÿè§£å†³çš„ã€‚\u003cstrong\u003eJava SDK å¹¶å‘åŒ…é€šè¿‡ Lock å’Œ Condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨‹ï¼Œå…¶ä¸­ Lock ç”¨äºè§£å†³äº’æ–¥é—®é¢˜ï¼ŒCondition ç”¨äºè§£å†³åŒæ­¥é—®é¢˜\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003esynchronized æ˜¯ç®¡ç¨‹çš„ä¸€ç§å®ç°ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œä½•å¿…å†æä¾› Lock å’Œ Conditionã€‚\u003c/p\u003e\n\u003cp\u003eJDK 1.6 ä»¥å‰ï¼Œsynchronized è¿˜æ²¡æœ‰åšä¼˜åŒ–ï¼Œæ€§èƒ½è¿œä½äº Lockã€‚ä½†æ˜¯ï¼Œæ€§èƒ½ä¸æ˜¯å¼•å…¥ Lock çš„æœ€é‡è¦å› ç´ ã€‚çœŸæ­£å…³é”®åœ¨äºï¼šsynchronized ä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šå‡ºç°æ­»é”ã€‚\u003c/p\u003e\n\u003cp\u003esynchronized æ— æ³•é€šè¿‡\u003cstrong\u003eç ´åä¸å¯æŠ¢å æ¡ä»¶\u003c/strong\u003eæ¥é¿å…æ­»é”ã€‚åŸå› æ˜¯ synchronized ç”³è¯·èµ„æºçš„æ—¶å€™ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€äº†ï¼Œè€Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå•¥éƒ½å¹²ä¸äº†ï¼Œä¹Ÿé‡Šæ”¾ä¸äº†çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æºã€‚\u003c/p\u003e\n\u003cp\u003eä¸å†…ç½®é” \u003ccode\u003esynchronized\u003c/code\u003e ä¸åŒçš„æ˜¯ï¼Œ**\u003ccode\u003eLock\u003c/code\u003e æä¾›äº†ä¸€ç»„æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„ã€å®šæ—¶çš„ä»¥åŠå¯ä¸­æ–­çš„é”æ“ä½œ**ï¼Œæ‰€æœ‰è·å–é”ã€é‡Šæ”¾é”çš„æ“ä½œéƒ½æ˜¯æ˜¾å¼çš„æ“ä½œã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eèƒ½å¤Ÿå“åº”ä¸­æ–­\u003c/strong\u003eã€‚synchronized çš„é—®é¢˜æ˜¯ï¼ŒæŒæœ‰é” A åï¼Œå¦‚æœå°è¯•è·å–é” B å¤±è´¥ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸€æ—¦å‘ç”Ÿæ­»é”ï¼Œå°±æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å”¤é†’é˜»å¡çš„çº¿ç¨‹ã€‚ä½†å¦‚æœé˜»å¡çŠ¶æ€çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ç»™é˜»å¡çš„çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå”¤é†’å®ƒï¼Œé‚£å®ƒå°±æœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é” Aã€‚è¿™æ ·å°±ç ´åäº†ä¸å¯æŠ¢å æ¡ä»¶äº†ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ”¯æŒè¶…æ—¶\u003c/strong\u003eã€‚å¦‚æœçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰è·å–åˆ°é”ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eéé˜»å¡åœ°è·å–é”\u003c/strong\u003eã€‚å¦‚æœå°è¯•è·å–é”å¤±è´¥ï¼Œå¹¶ä¸è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"Lock-æ¥å£\"\u003e\u003ca href=\"#Lock-æ¥å£\" class=\"headerlink\" title=\"Lock æ¥å£\"\u003e\u003c/a\u003eLock æ¥å£\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eLock\u003c/code\u003e çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"title class_\"\u003eLock\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003elock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003elockInterruptibly\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e InterruptedException;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003etryLock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003etryLock\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003elong\u003c/span\u003e time, TimeUnit unit)\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e InterruptedException;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eunlock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Condition \u003cspan class=\"title function_\"\u003enewCondition\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003elock()\u003c/code\u003e - è·å–é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eunlock()\u003c/code\u003e - é‡Šæ”¾é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etryLock()\u003c/code\u003e - å°è¯•è·å–é”ï¼Œä»…åœ¨è°ƒç”¨æ—¶é”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„æƒ…å†µä¸‹ï¼Œæ‰è·å–è¯¥é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etryLock(long time, TimeUnit unit)\u003c/code\u003e - å’Œ \u003ccode\u003etryLock()\u003c/code\u003e ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºé™å®šæ—¶é—´ï¼Œå¦‚æœé™å®šæ—¶é—´å†…æœªè·å–åˆ°é”ï¼Œè§†ä¸ºå¤±è´¥ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003elockInterruptibly()\u003c/code\u003e - é”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œä¸”çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½è·å–é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003enewCondition()\u003c/code\u003e - è¿”å›ä¸€ä¸ªç»‘å®šåˆ° \u003ccode\u003eLock\u003c/code\u003e å¯¹è±¡ä¸Šçš„ \u003ccode\u003eCondition\u003c/code\u003e å®ä¾‹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"Condition\"\u003e\u003ca href=\"#Condition\" class=\"headerlink\" title=\"Condition\"\u003e\u003c/a\u003eCondition\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eCondition å®ç°äº†ç®¡ç¨‹æ¨¡å‹é‡Œé¢çš„æ¡ä»¶å˜é‡\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå‰æ–‡ä¸­æè¿‡ \u003ccode\u003eLock\u003c/code\u003e æ¥å£ä¸­ æœ‰ä¸€ä¸ª \u003ccode\u003enewCondition()\u003c/code\u003e æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªç»‘å®šåˆ° \u003ccode\u003eLock\u003c/code\u003e å¯¹è±¡ä¸Šçš„ \u003ccode\u003eCondition\u003c/code\u003e å®ä¾‹ã€‚\u003ccode\u003eCondition\u003c/code\u003e æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿæœ¬èŠ‚å°†ä¸€ä¸€è®²è§£ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨å•çº¿ç¨‹ä¸­ï¼Œä¸€æ®µä»£ç çš„æ‰§è¡Œå¯èƒ½ä¾èµ–äºæŸä¸ªçŠ¶æ€ï¼Œå¦‚æœä¸æ»¡è¶³çŠ¶æ€æ¡ä»¶ï¼Œä»£ç å°±ä¸ä¼šè¢«æ‰§è¡Œï¼ˆå…¸å‹çš„åœºæ™¯ï¼Œå¦‚ï¼š\u003ccode\u003eif ... else ...\u003c/code\u003eï¼‰ã€‚åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­æŸä¸ªçŠ¶æ€æ¡ä»¶æ—¶ï¼Œå…¶çŠ¶æ€å¯èƒ½æ˜¯ç”±äºå…¶ä»–çº¿ç¨‹çš„æ“ä½œè€Œæ”¹å˜ï¼Œè¿™æ—¶å°±éœ€è¦æœ‰ä¸€å®šçš„åè°ƒæœºåˆ¶æ¥ç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»ï¼Œæ•°æ®åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”ä¿®æ”¹ï¼Œä¸”ä¿®æ”¹çš„æ•°æ®çŠ¶æ€è¢«æ‰€æœ‰çº¿ç¨‹æ‰€æ„ŸçŸ¥ã€‚\u003c/p\u003e\n\u003cp\u003eJava 1.5 ä¹‹å‰ï¼Œä¸»è¦æ˜¯åˆ©ç”¨ \u003ccode\u003eObject\u003c/code\u003e ç±»ä¸­çš„ \u003ccode\u003ewait\u003c/code\u003eã€\u003ccode\u003enotify\u003c/code\u003eã€\u003ccode\u003enotifyAll\u003c/code\u003e é…åˆ \u003ccode\u003esynchronized\u003c/code\u003e æ¥è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡ï¼ˆå¦‚æœä¸äº†è§£å…¶ç‰¹æ€§ï¼Œå¯ä»¥å‚è€ƒï¼š\u003ca href=\"https://dunwu.github.io/javacore/#/concurrent/java-thread?id=waitnotifynotifyall\"\u003eJava çº¿ç¨‹åŸºç¡€ - wait/notify/notifyAll\u003c/a\u003eï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ewait\u003c/code\u003eã€\u003ccode\u003enotify\u003c/code\u003eã€\u003ccode\u003enotifyAll\u003c/code\u003e éœ€è¦é…åˆ \u003ccode\u003esynchronized\u003c/code\u003e ä½¿ç”¨ï¼Œä¸é€‚ç”¨äº \u003ccode\u003eLock\u003c/code\u003eã€‚è€Œä½¿ç”¨ \u003ccode\u003eLock\u003c/code\u003e çš„çº¿ç¨‹ï¼Œå½¼æ­¤é—´é€šä¿¡åº”è¯¥ä½¿ç”¨ \u003ccode\u003eCondition\u003c/code\u003e ã€‚è¿™å¯ä»¥ç†è§£ä¸ºï¼Œä»€ä¹ˆæ ·çš„é”é…ä»€ä¹ˆæ ·çš„é’¥åŒ™ã€‚\u003cstrong\u003eå†…ç½®é”ï¼ˆ\u003ccode\u003esynchronized\u003c/code\u003eï¼‰é…åˆå†…ç½®æ¡ä»¶é˜Ÿåˆ—ï¼ˆ\u003ccode\u003ewait\u003c/code\u003eã€\u003ccode\u003enotify\u003c/code\u003eã€\u003ccode\u003enotifyAll\u003c/code\u003e ï¼‰ï¼Œæ˜¾å¼é”ï¼ˆ\u003ccode\u003eLock\u003c/code\u003eï¼‰é…åˆæ˜¾å¼æ¡ä»¶é˜Ÿåˆ—ï¼ˆ\u003ccode\u003eCondition\u003c/code\u003e ï¼‰\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003ch4 id=\"Condition-çš„ç‰¹æ€§\"\u003e\u003ca href=\"#Condition-çš„ç‰¹æ€§\" class=\"headerlink\" title=\"Condition çš„ç‰¹æ€§\"\u003e\u003c/a\u003eCondition çš„ç‰¹æ€§\u003c/h4\u003e\u003cp\u003e\u003ccode\u003eCondition\u003c/code\u003e æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"title class_\"\u003eCondition\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eawait\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e InterruptedException;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eawaitUninterruptibly\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"type\"\u003elong\u003c/span\u003e \u003cspan class=\"title function_\"\u003eawaitNanos\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003elong\u003c/span\u003e nanosTimeout)\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e InterruptedException;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003eawait\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003elong\u003c/span\u003e time, TimeUnit unit)\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e InterruptedException;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003eawaitUntil\u003c/span\u003e\u003cspan class=\"params\"\u003e(Date deadline)\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e InterruptedException;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003esignal\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003esignalAll\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eå…¶ä¸­ï¼Œ\u003ccode\u003eawait\u003c/code\u003eã€\u003ccode\u003esignal\u003c/code\u003eã€\u003ccode\u003esignalAll\u003c/code\u003e ä¸ \u003ccode\u003ewait\u003c/code\u003eã€\u003ccode\u003enotify\u003c/code\u003eã€\u003ccode\u003enotifyAll\u003c/code\u003e ç›¸å¯¹åº”ï¼ŒåŠŸèƒ½ä¹Ÿç›¸ä¼¼ã€‚é™¤æ­¤ä»¥å¤–ï¼Œ\u003ccode\u003eCondition\u003c/code\u003e ç›¸æ¯”å†…ç½®æ¡ä»¶é˜Ÿåˆ—ï¼ˆ \u003ccode\u003ewait\u003c/code\u003eã€\u003ccode\u003enotify\u003c/code\u003eã€\u003ccode\u003enotifyAll\u003c/code\u003e ï¼‰ï¼Œæä¾›äº†æ›´ä¸ºä¸°å¯Œçš„åŠŸèƒ½ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ¯ä¸ªé”ï¼ˆ\u003ccode\u003eLock\u003c/code\u003eï¼‰ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ª \u003ccode\u003eCondition\u003c/code\u003eï¼Œè¿™æ„å‘³ç€é”çš„çŠ¶æ€æ¡ä»¶å¯ä»¥æœ‰å¤šä¸ªã€‚\u003c/li\u003e\n\u003cli\u003eæ”¯æŒå…¬å¹³çš„æˆ–éå…¬å¹³çš„é˜Ÿåˆ—æ“ä½œã€‚\u003c/li\u003e\n\u003cli\u003eæ”¯æŒå¯ä¸­æ–­çš„æ¡ä»¶ç­‰å¾…ï¼Œç›¸å…³æ–¹æ³•ï¼š\u003ccode\u003eawaitUninterruptibly()\u003c/code\u003e ã€‚\u003c/li\u003e\n\u003cli\u003eæ”¯æŒå¯å®šæ—¶çš„ç­‰å¾…ï¼Œç›¸å…³æ–¹æ³•ï¼š\u003ccode\u003eawaitNanos(long)\u003c/code\u003e ã€\u003ccode\u003eawait(long, TimeUnit)\u003c/code\u003eã€\u003ccode\u003eawaitUntil(Date)\u003c/code\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"Condition-çš„ç”¨æ³•\"\u003e\u003ca href=\"#Condition-çš„ç”¨æ³•\" class=\"headerlink\" title=\"Condition çš„ç”¨æ³•\"\u003e\u003c/a\u003eCondition çš„ç”¨æ³•\u003c/h4\u003e\u003cp\u003eè¿™é‡Œä»¥ \u003ccode\u003eCondition\u003c/code\u003e æ¥å®ç°ä¸€ä¸ªæ¶ˆè´¹è€…ã€ç”Ÿäº§è€…æ¨¡å¼ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e:bell: æ³¨æ„ï¼šäº‹å®ä¸Šï¼Œè§£å†³æ­¤ç±»é—®é¢˜ä½¿ç”¨ \u003ccode\u003eCountDownLatch\u003c/code\u003eã€\u003ccode\u003eSemaphore\u003c/code\u003e ç­‰å·¥å…·æ›´ä¸ºä¾¿æ·ã€å®‰å…¨ã€‚æƒ³äº†è§£è¯¦æƒ…ï¼Œå¯ä»¥å‚è€ƒ \u003ca href=\"https://dunwu.github.io/javacore/#/concurrent/java-concurrent-tools\"\u003eJava å¹¶å‘å·¥å…·ç±»\u003c/a\u003e ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eäº§å“ç±»\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e56\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e57\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e59\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMessage\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eLock\u003c/span\u003e \u003cspan class=\"variable\"\u003elock\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eReentrantLock\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eCondition\u003c/span\u003e \u003cspan class=\"variable\"\u003eproducedMsg\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e lock.newCondition();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eCondition\u003c/span\u003e \u003cspan class=\"variable\"\u003econsumedMsg\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e lock.newCondition();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e String message;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e state;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e end;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003econsume\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e//lock\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        lock.lock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e// no new message wait for new message\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e (!state) { producedMsg.await(); }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            System.out.println(\u003cspan class=\"string\"\u003e\u0026#34;consume message : \u0026#34;\u003c/span\u003e + message);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            state = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e// message consumed, notify waiting thread\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            consumedMsg.signal();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003ecatch\u003c/span\u003e (InterruptedException ie) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            System.out.println(\u003cspan class=\"string\"\u003e\u0026#34;Thread interrupted - viewMessage\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            lock.unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eproduce\u003c/span\u003e\u003cspan class=\"params\"\u003e(String message)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        lock.lock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e// last message not consumed, wait for it be consumed\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e (state) { consumedMsg.await(); }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            System.out.println(\u003cspan class=\"string\"\u003e\u0026#34;produce msg: \u0026#34;\u003c/span\u003e + message);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"built_in\"\u003ethis\u003c/span\u003e.message = message;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            state = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e// new message added, notify waiting thread\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            producedMsg.signal();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003ecatch\u003c/span\u003e (InterruptedException ie) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            System.out.println(\u003cspan class=\"string\"\u003e\u0026#34;Thread interrupted - publishMessage\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            lock.unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003eisEnd\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e end;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003esetEnd\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eboolean\u003c/span\u003e end)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003ethis\u003c/span\u003e.end = end;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eæ¶ˆè´¹è€…\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMessageConsumer\u003c/span\u003e \u003cspan class=\"keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"title class_\"\u003eRunnable\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e Message message;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"title function_\"\u003eMessageConsumer\u003c/span\u003e\u003cspan class=\"params\"\u003e(Message msg)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        message = msg;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"meta\"\u003e@Override\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003erun\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e (!message.isEnd()) { message.consume(); }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eç”Ÿäº§è€…\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMessageProducer\u003c/span\u003e \u003cspan class=\"keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"title class_\"\u003eRunnable\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e Message message;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"title function_\"\u003eMessageProducer\u003c/span\u003e\u003cspan class=\"params\"\u003e(Message msg)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        message = msg;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"meta\"\u003e@Override\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003erun\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        produce();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eproduce\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        List\u0026lt;String\u0026gt; msgs = \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eArrayList\u003c/span\u003e\u0026lt;\u0026gt;();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        msgs.add(\u003cspan class=\"string\"\u003e\u0026#34;Begin\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        msgs.add(\u003cspan class=\"string\"\u003e\u0026#34;Msg1\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        msgs.add(\u003cspan class=\"string\"\u003e\u0026#34;Msg2\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e (String msg : msgs) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            message.produce(msg);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                Thread.sleep(\u003cspan class=\"number\"\u003e100\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            } \u003cspan class=\"keyword\"\u003ecatch\u003c/span\u003e (InterruptedException e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                e.printStackTrace();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        message.produce(\u003cspan class=\"string\"\u003e\u0026#34;End\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        message.setEnd(\u003cspan class=\"literal\"\u003etrue\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eæµ‹è¯•\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eLockConditionDemo\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003emain\u003c/span\u003e\u003cspan class=\"params\"\u003e(String[] args)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eMessage\u003c/span\u003e \u003cspan class=\"variable\"\u003emsg\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMessage\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eThread\u003c/span\u003e \u003cspan class=\"variable\"\u003eproducer\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eThread\u003c/span\u003e(\u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMessageProducer\u003c/span\u003e(msg));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eThread\u003c/span\u003e \u003cspan class=\"variable\"\u003econsumer\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eThread\u003c/span\u003e(\u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMessageConsumer\u003c/span\u003e(msg));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        producer.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        consumer.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"ReentrantLock\"\u003e\u003ca href=\"#ReentrantLock\" class=\"headerlink\" title=\"ReentrantLock\"\u003e\u003c/a\u003eReentrantLock\u003c/h2\u003e\u003cp\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e ç±»æ˜¯ \u003ccode\u003eLock\u003c/code\u003e æ¥å£çš„å…·ä½“å®ç°ï¼Œä¸å†…ç½®é” \u003ccode\u003esynchronized\u003c/code\u003e ç›¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯ä¸€ä¸ª\u003cstrong\u003eå¯é‡å…¥é”\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003ch3 id=\"ReentrantLock-çš„ç‰¹æ€§\"\u003e\u003ca href=\"#ReentrantLock-çš„ç‰¹æ€§\" class=\"headerlink\" title=\"ReentrantLock çš„ç‰¹æ€§\"\u003e\u003c/a\u003eReentrantLock çš„ç‰¹æ€§\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e çš„ç‰¹æ€§å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e æä¾›äº†ä¸ \u003ccode\u003esynchronized\u003c/code\u003e ç›¸åŒçš„äº’æ–¥æ€§ã€å†…å­˜å¯è§æ€§å’Œå¯é‡å…¥æ€§\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e \u003cstrong\u003eæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”\u003c/strong\u003eï¼ˆé»˜è®¤ï¼‰ä¸¤ç§æ¨¡å¼ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e å®ç°äº† \u003ccode\u003eLock\u003c/code\u003e æ¥å£ï¼Œæ”¯æŒäº† \u003ccode\u003esynchronized\u003c/code\u003e æ‰€ä¸å…·å¤‡çš„\u003cstrong\u003eçµæ´»æ€§\u003c/strong\u003eã€‚\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esynchronized\u003c/code\u003e æ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esynchronized\u003c/code\u003e æ— æ³•åœ¨è¯·æ±‚è·å–ä¸€ä¸ªé”æ—¶æ— ä¼‘æ­¢åœ°ç­‰å¾…\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ReentrantLock-çš„ç”¨æ³•\"\u003e\u003ca href=\"#ReentrantLock-çš„ç”¨æ³•\" class=\"headerlink\" title=\"ReentrantLock çš„ç”¨æ³•\"\u003e\u003c/a\u003eReentrantLock çš„ç”¨æ³•\u003c/h3\u003e\u003cp\u003eå‰æ–‡äº†è§£äº† \u003ccode\u003eReentrantLock\u003c/code\u003e çš„ç‰¹æ€§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è®²è¿°å…¶å…·ä½“ç”¨æ³•ã€‚\u003c/p\u003e\n\u003ch4 id=\"ReentrantLock-çš„æ„é€ æ–¹æ³•\"\u003e\u003ca href=\"#ReentrantLock-çš„æ„é€ æ–¹æ³•\" class=\"headerlink\" title=\"ReentrantLock çš„æ„é€ æ–¹æ³•\"\u003e\u003c/a\u003eReentrantLock çš„æ„é€ æ–¹æ³•\u003c/h4\u003e\u003cp\u003e\u003ccode\u003eReentrantLock\u003c/code\u003e æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"title function_\"\u003eReentrantLock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"title function_\"\u003eReentrantLock\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eboolean\u003c/span\u003e fair)\u003c/span\u003e {}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock()\u003c/code\u003e - é»˜è®¤æ„é€ æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ª\u003cstrong\u003eéå…¬å¹³é”ï¼ˆNonfairSyncï¼‰\u003c/strong\u003eï¼›\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock(boolean)\u003c/code\u003e - \u003ccode\u003enew ReentrantLock(true)\u003c/code\u003e ä¼šåˆå§‹åŒ–ä¸€ä¸ª\u003cstrong\u003eå…¬å¹³é”ï¼ˆFairSyncï¼‰\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"lock-å’Œ-unlock-æ–¹æ³•\"\u003e\u003ca href=\"#lock-å’Œ-unlock-æ–¹æ³•\" class=\"headerlink\" title=\"lock å’Œ unlock æ–¹æ³•\"\u003e\u003c/a\u003elock å’Œ unlock æ–¹æ³•\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003elock()\u003c/code\u003e - \u003cstrong\u003eæ— æ¡ä»¶è·å–é”\u003c/strong\u003eã€‚å¦‚æœå½“å‰çº¿ç¨‹æ— æ³•è·å–é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ä¸å¯ç”¨ï¼Œç›´è‡³å½“å‰çº¿ç¨‹è·å–åˆ°é”ã€‚å¦‚æœè¯¥é”æ²¡æœ‰è¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œåˆ™è·å–è¯¥é”å¹¶ç«‹å³è¿”å›ï¼Œå°†é”çš„æŒæœ‰è®¡æ•°è®¾ç½®ä¸º 1ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eunlock()\u003c/code\u003e - ç”¨äº\u003cstrong\u003eé‡Šæ”¾é”\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e:bell: æ³¨æ„ï¼šè¯·åŠ¡å¿…ç‰¢è®°ï¼Œè·å–é”æ“ä½œ \u003cstrong\u003e\u003ccode\u003elock()\u003c/code\u003e å¿…é¡»åœ¨ \u003ccode\u003etry catch\u003c/code\u003e å—ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å°†é‡Šæ”¾é”æ“ä½œ \u003ccode\u003eunlock()\u003c/code\u003e æ”¾åœ¨ \u003ccode\u003efinally\u003c/code\u003e å—ä¸­è¿›è¡Œï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿ\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eç¤ºä¾‹ï¼š\u003ccode\u003eReentrantLock\u003c/code\u003e çš„åŸºæœ¬æ“ä½œ\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e56\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e57\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e59\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e60\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e61\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e62\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e63\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e65\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e66\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e67\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eReentrantLockDemo\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003emain\u003c/span\u003e\u003cspan class=\"params\"\u003e(String[] args)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eTask\u003c/span\u003e \u003cspan class=\"variable\"\u003etask\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eTask\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eMyThread\u003c/span\u003e \u003cspan class=\"variable\"\u003etA\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMyThread\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;Thread-A\u0026#34;\u003c/span\u003e, task);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eMyThread\u003c/span\u003e \u003cspan class=\"variable\"\u003etB\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMyThread\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;Thread-B\u0026#34;\u003c/span\u003e, task);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eMyThread\u003c/span\u003e \u003cspan class=\"variable\"\u003etC\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMyThread\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;Thread-C\u0026#34;\u003c/span\u003e, task);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        tA.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        tB.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        tC.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMyThread\u003c/span\u003e \u003cspan class=\"keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"title class_\"\u003eThread\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e Task task;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"title function_\"\u003eMyThread\u003c/span\u003e\u003cspan class=\"params\"\u003e(String name, Task task)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"built_in\"\u003esuper\u003c/span\u003e(name);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"built_in\"\u003ethis\u003c/span\u003e.task = task;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"meta\"\u003e@Override\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003erun\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            task.execute();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eTask\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"type\"\u003eReentrantLock\u003c/span\u003e \u003cspan class=\"variable\"\u003elock\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eReentrantLock\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eexecute\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            lock.lock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003ei\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"number\"\u003e3\u003c/span\u003e; i++) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    System.out.println(lock.toString());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    \u003cspan class=\"comment\"\u003e// æŸ¥è¯¢å½“å‰çº¿ç¨‹ hold ä½æ­¤é”çš„æ¬¡æ•°\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    System.out.println(\u003cspan class=\"string\"\u003e\u0026#34;\\t holdCount: \u0026#34;\u003c/span\u003e + lock.getHoldCount());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    \u003cspan class=\"comment\"\u003e// æŸ¥è¯¢æ­£ç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹æ•°\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    System.out.println(\u003cspan class=\"string\"\u003e\u0026#34;\\t queuedLength: \u0026#34;\u003c/span\u003e + lock.getQueueLength());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    \u003cspan class=\"comment\"\u003e// æ˜¯å¦ä¸ºå…¬å¹³é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    System.out.println(\u003cspan class=\"string\"\u003e\u0026#34;\\t isFair: \u0026#34;\u003c/span\u003e + lock.isFair());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    \u003cspan class=\"comment\"\u003e// æ˜¯å¦è¢«é”ä½\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    System.out.println(\u003cspan class=\"string\"\u003e\u0026#34;\\t isLocked: \u0026#34;\u003c/span\u003e + lock.isLocked());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    \u003cspan class=\"comment\"\u003e// æ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    System.out.println(\u003cspan class=\"string\"\u003e\u0026#34;\\t isHeldByCurrentThread: \u0026#34;\u003c/span\u003e + lock.isHeldByCurrentThread());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        Thread.sleep(\u003cspan class=\"number\"\u003e500\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    } \u003cspan class=\"keyword\"\u003ecatch\u003c/span\u003e (InterruptedException e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        e.printStackTrace();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                lock.unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eè¾“å‡ºç»“æœï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ejava.util.concurrent.locks.ReentrantLock@64fcd88a[Locked by thread Thread-A]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t holdCount: \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t queuedLength: \u003cspan class=\"number\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t isFair: \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t isLocked: \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t isHeldByCurrentThread: \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ejava.util.concurrent.locks.ReentrantLock@64fcd88a[Locked by thread Thread-C]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t holdCount: \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t queuedLength: \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t isFair: \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t isLocked: \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t isHeldByCurrentThread: \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"tryLock-æ–¹æ³•\"\u003e\u003ca href=\"#tryLock-æ–¹æ³•\" class=\"headerlink\" title=\"tryLock æ–¹æ³•\"\u003e\u003c/a\u003etryLock æ–¹æ³•\u003c/h4\u003e\u003cp\u003eä¸æ— æ¡ä»¶è·å–é”ç›¸æ¯”ï¼ŒtryLock æœ‰æ›´å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003etryLock()\u003c/code\u003e - \u003cstrong\u003eå¯è½®è¯¢è·å–é”\u003c/strong\u003eã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› falseã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•\u003cstrong\u003eæ— è®ºæˆè´¥éƒ½ä¼šç«‹å³è¿”å›\u003c/strong\u003eï¼Œè·å–ä¸åˆ°é”ï¼ˆé”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰æ—¶ä¸ä¼šä¸€ç›´ç­‰å¾…ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etryLock(long, TimeUnit)\u003c/code\u003e - \u003cstrong\u003eå¯å®šæ—¶è·å–é”\u003c/strong\u003eã€‚å’Œ \u003ccode\u003etryLock()\u003c/code\u003e ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨\u003cstrong\u003eè·å–ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´\u003c/strong\u003eï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜è·å–ä¸åˆ°é”ï¼Œå°±è¿”å› falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å› trueã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç¤ºä¾‹ï¼š\u003ccode\u003eReentrantLock\u003c/code\u003e çš„ \u003ccode\u003etryLock()\u003c/code\u003e æ“ä½œ\u003c/p\u003e\n\u003cp\u003eä¿®æ”¹ä¸Šä¸ªç¤ºä¾‹ä¸­çš„ \u003ccode\u003eexecute()\u003c/code\u003e æ–¹æ³•\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eexecute\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (lock.tryLock()) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003ei\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"number\"\u003e3\u003c/span\u003e; i++) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e               \u003cspan class=\"comment\"\u003e// ç•¥...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            lock.unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    } \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        System.out.println(Thread.currentThread().getName() + \u003cspan class=\"string\"\u003e\u0026#34; è·å–é”å¤±è´¥\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eç¤ºä¾‹ï¼š\u003ccode\u003eReentrantLock\u003c/code\u003e çš„ \u003ccode\u003etryLock(long, TimeUnit)\u003c/code\u003e æ“ä½œ\u003c/p\u003e\n\u003cp\u003eä¿®æ”¹ä¸Šä¸ªç¤ºä¾‹ä¸­çš„ \u003ccode\u003eexecute()\u003c/code\u003e æ–¹æ³•\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eexecute\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (lock.tryLock(\u003cspan class=\"number\"\u003e2\u003c/span\u003e, TimeUnit.SECONDS)) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003ei\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"number\"\u003e3\u003c/span\u003e; i++) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                    \u003cspan class=\"comment\"\u003e// ç•¥...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                lock.unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            System.out.println(Thread.currentThread().getName() + \u003cspan class=\"string\"\u003e\u0026#34; è·å–é”å¤±è´¥\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    } \u003cspan class=\"keyword\"\u003ecatch\u003c/span\u003e (InterruptedException e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        System.out.println(Thread.currentThread().getName() + \u003cspan class=\"string\"\u003e\u0026#34; è·å–é”è¶…æ—¶\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        e.printStackTrace();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"lockInterruptibly-æ–¹æ³•\"\u003e\u003ca href=\"#lockInterruptibly-æ–¹æ³•\" class=\"headerlink\" title=\"lockInterruptibly æ–¹æ³•\"\u003e\u003c/a\u003elockInterruptibly æ–¹æ³•\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003elockInterruptibly()\u003c/code\u003e - \u003cstrong\u003eå¯ä¸­æ–­è·å–é”\u003c/strong\u003eã€‚å¯ä¸­æ–­è·å–é”å¯ä»¥åœ¨è·å¾—é”çš„åŒæ—¶ä¿æŒå¯¹ä¸­æ–­çš„å“åº”ã€‚å¯ä¸­æ–­è·å–é”æ¯”å…¶å®ƒè·å–é”çš„æ–¹å¼ç¨å¾®å¤æ‚ä¸€äº›ï¼Œéœ€è¦ä¸¤ä¸ª \u003ccode\u003etry-catch\u003c/code\u003e å—ï¼ˆå¦‚æœåœ¨è·å–é”çš„æ“ä½œä¸­æŠ›å‡ºäº† \u003ccode\u003eInterruptedException\u003c/code\u003e ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ \u003ccode\u003etry-finally\u003c/code\u003e åŠ é”æ¨¡å¼ï¼‰ã€‚\u003cul\u003e\n\u003cli\u003eä¸¾ä¾‹æ¥è¯´ï¼šå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ \u003ccode\u003elock.lockInterruptibly()\u003c/code\u003e è·å–æŸä¸ªé”æ—¶ï¼Œè‹¥çº¿ç¨‹ A è·å–åˆ°äº†é”ï¼Œåˆ™çº¿ç¨‹ B åªèƒ½ç­‰å¾…ã€‚è‹¥æ­¤æ—¶å¯¹çº¿ç¨‹ B è°ƒç”¨ \u003ccode\u003ethreadB.interrupt()\u003c/code\u003e æ–¹æ³•èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹ B çš„ç­‰å¾…è¿‡ç¨‹ã€‚ç”±äº \u003ccode\u003elockInterruptibly()\u003c/code\u003e çš„å£°æ˜ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰€ä»¥ \u003ccode\u003elock.lockInterruptibly()\u003c/code\u003e å¿…é¡»æ”¾åœ¨ \u003ccode\u003etry\u003c/code\u003e å—ä¸­æˆ–è€…åœ¨è°ƒç”¨ \u003ccode\u003elockInterruptibly()\u003c/code\u003e çš„æ–¹æ³•å¤–å£°æ˜æŠ›å‡º \u003ccode\u003eInterruptedException\u003c/code\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e:bell: æ³¨æ„ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ä¹‹åï¼Œæ˜¯ä¸ä¼šè¢« \u003ccode\u003einterrupt()\u003c/code\u003e æ–¹æ³•ä¸­æ–­çš„ã€‚å•ç‹¬è°ƒç”¨ \u003ccode\u003einterrupt()\u003c/code\u003e æ–¹æ³•ä¸èƒ½ä¸­æ–­æ­£åœ¨è¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹ï¼Œåªèƒ½ä¸­æ–­é˜»å¡çŠ¶æ€ä¸­çš„çº¿ç¨‹ã€‚å› æ­¤å½“é€šè¿‡ \u003ccode\u003elockInterruptibly()\u003c/code\u003e æ–¹æ³•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœæœªè·å–åˆ°é”ï¼Œåªæœ‰åœ¨ç­‰å¾…çš„çŠ¶æ€ä¸‹ï¼Œæ‰å¯ä»¥å“åº”ä¸­æ–­ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eç¤ºä¾‹ï¼š\u003ccode\u003eReentrantLock\u003c/code\u003e çš„ \u003ccode\u003elockInterruptibly()\u003c/code\u003e æ“ä½œ\u003c/p\u003e\n\u003cp\u003eä¿®æ”¹ä¸Šä¸ªç¤ºä¾‹ä¸­çš„ \u003ccode\u003eexecute()\u003c/code\u003e æ–¹æ³•\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eexecute\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        lock.lockInterruptibly();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003ei\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"number\"\u003e3\u003c/span\u003e; i++) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e// ç•¥...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    } \u003cspan class=\"keyword\"\u003ecatch\u003c/span\u003e (InterruptedException e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        System.out.println(Thread.currentThread().getName() + \u003cspan class=\"string\"\u003e\u0026#34;è¢«ä¸­æ–­\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        e.printStackTrace();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        lock.unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"newCondition-æ–¹æ³•\"\u003e\u003ca href=\"#newCondition-æ–¹æ³•\" class=\"headerlink\" title=\"newCondition æ–¹æ³•\"\u003e\u003c/a\u003enewCondition æ–¹æ³•\u003c/h4\u003e\u003cp\u003e\u003ccode\u003enewCondition()\u003c/code\u003e - è¿”å›ä¸€ä¸ªç»‘å®šåˆ° \u003ccode\u003eLock\u003c/code\u003e å¯¹è±¡ä¸Šçš„ \u003ccode\u003eCondition\u003c/code\u003e å®ä¾‹ã€‚\u003ccode\u003eCondition\u003c/code\u003e çš„ç‰¹æ€§å’Œå…·ä½“æ–¹æ³•è¯·é˜…è¯»ä¸‹æ–‡ \u003ca href=\"#%E4%BA%94condition\"\u003e\u003ccode\u003eCondition\u003c/code\u003e\u003c/a\u003eã€‚\u003c/p\u003e\n\u003ch3 id=\"ReentrantLock-çš„åŸç†\"\u003e\u003ca href=\"#ReentrantLock-çš„åŸç†\" class=\"headerlink\" title=\"ReentrantLock çš„åŸç†\"\u003e\u003c/a\u003eReentrantLock çš„åŸç†\u003c/h3\u003e\u003ch4 id=\"ReentrantLock-çš„å¯è§æ€§\"\u003e\u003ca href=\"#ReentrantLock-çš„å¯è§æ€§\" class=\"headerlink\" title=\"ReentrantLock çš„å¯è§æ€§\"\u003e\u003c/a\u003eReentrantLock çš„å¯è§æ€§\u003c/h4\u003e\u003cfigure class=\"highlight csharp\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title\"\u003eX\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e final Lock rtl =\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e ReentrantLock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"built_in\"\u003eint\u003c/span\u003e \u003cspan class=\"keyword\"\u003evalue\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003eaddOne\u003c/span\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// è·å–é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    rtl.\u003cspan class=\"keyword\"\u003elock\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003evalue\u003c/span\u003e+=\u003cspan class=\"number\"\u003e1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"comment\"\u003e// ä¿è¯é”èƒ½é‡Šæ”¾\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      rtl.unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eReentrantLockï¼Œå†…éƒ¨æŒæœ‰ä¸€ä¸ª volatile çš„æˆå‘˜å˜é‡ stateï¼Œè·å–é”çš„æ—¶å€™ï¼Œä¼šè¯»å†™ state çš„å€¼ï¼›è§£é”çš„æ—¶å€™ï¼Œä¹Ÿä¼šè¯»å†™ state çš„å€¼ï¼ˆç®€åŒ–åçš„ä»£ç å¦‚ä¸‹é¢æ‰€ç¤ºï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œ value+=1 ä¹‹å‰ï¼Œç¨‹åºå…ˆè¯»å†™äº†ä¸€æ¬¡ volatile å˜é‡ stateï¼Œåœ¨æ‰§è¡Œ value+=1 ä¹‹åï¼Œåˆè¯»å†™äº†ä¸€æ¬¡ volatile å˜é‡ stateã€‚æ ¹æ®ç›¸å…³çš„ Happens-Before è§„åˆ™ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eé¡ºåºæ€§è§„åˆ™\u003c/strong\u003eï¼šå¯¹äºçº¿ç¨‹ T1ï¼Œvalue+=1 Happens-Before é‡Šæ”¾é”çš„æ“ä½œ unlock()ï¼›\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003evolatile å˜é‡è§„åˆ™\u003c/strong\u003eï¼šç”±äº state = 1 ä¼šå…ˆè¯»å– stateï¼Œæ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock() æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œï¼›\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eä¼ é€’æ€§è§„åˆ™\u003c/strong\u003eï¼šçº¿ç¨‹ T1 çš„ value+=1 Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4 id=\"ReentrantLock-çš„æ•°æ®ç»“æ„\"\u003e\u003ca href=\"#ReentrantLock-çš„æ•°æ®ç»“æ„\" class=\"headerlink\" title=\"ReentrantLock çš„æ•°æ®ç»“æ„\"\u003e\u003c/a\u003eReentrantLock çš„æ•°æ®ç»“æ„\u003c/h4\u003e\u003cp\u003eé˜…è¯» \u003ccode\u003eReentrantLock\u003c/code\u003e çš„æºç ï¼Œå¯ä»¥å‘ç°å®ƒæœ‰ä¸€ä¸ªæ ¸å¿ƒå­—æ®µï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e Sync sync;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esync\u003c/code\u003e - å†…éƒ¨æŠ½è±¡ç±» \u003ccode\u003eReentrantLock.Sync\u003c/code\u003e å¯¹è±¡ï¼Œ\u003ccode\u003eSync\u003c/code\u003e ç»§æ‰¿è‡ª AQSã€‚å®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock.FairSync\u003c/code\u003e - å…¬å¹³é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantLock.NonfairSync\u003c/code\u003e - éå…¬å¹³é”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œ\u003ccode\u003eReentrantLock\u003c/code\u003e å®ç° \u003ccode\u003eLock\u003c/code\u003e æ¥å£å…¶å®æ˜¯è°ƒç”¨ \u003ccode\u003eReentrantLock.FairSync\u003c/code\u003e æˆ– \u003ccode\u003eReentrantLock.NonfairSync\u003c/code\u003e ä¸­å„è‡ªçš„å®ç°ï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ã€‚\u003c/p\u003e\n\u003ch4 id=\"ReentrantLock-çš„è·å–é”å’Œé‡Šæ”¾é”\"\u003e\u003ca href=\"#ReentrantLock-çš„è·å–é”å’Œé‡Šæ”¾é”\" class=\"headerlink\" title=\"ReentrantLock çš„è·å–é”å’Œé‡Šæ”¾é”\"\u003e\u003c/a\u003eReentrantLock çš„è·å–é”å’Œé‡Šæ”¾é”\u003c/h4\u003e\u003cp\u003eReentrantLock è·å–é”å’Œé‡Šæ”¾é”çš„æ¥å£ï¼Œä»è¡¨è±¡çœ‹ï¼Œæ˜¯è°ƒç”¨ \u003ccode\u003eReentrantLock.FairSync\u003c/code\u003e æˆ– \u003ccode\u003eReentrantLock.NonfairSync\u003c/code\u003e ä¸­å„è‡ªçš„å®ç°ï¼›ä»æœ¬è´¨ä¸Šçœ‹ï¼Œæ˜¯åŸºäº AQS çš„å®ç°ã€‚\u003c/p\u003e\n\u003cp\u003eä»”ç»†é˜…è¯»æºç å¾ˆå®¹æ˜“å‘ç°ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003evoid lock()\u003c/code\u003e è°ƒç”¨ Sync çš„ lock() æ–¹æ³•ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003evoid lockInterruptibly()\u003c/code\u003e ç›´æ¥è°ƒç”¨ AQS çš„ \u003ca href=\"#%E8%8E%B7%E5%8F%96%E5%8F%AF%E4%B8%AD%E6%96%AD%E7%9A%84%E7%8B%AC%E5%8D%A0%E9%94%81\"\u003eè·å–å¯ä¸­æ–­çš„ç‹¬å é”\u003c/a\u003e æ–¹æ³• \u003ccode\u003elockInterruptibly()\u003c/code\u003eã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eboolean tryLock()\u003c/code\u003e è°ƒç”¨ Sync çš„ \u003ccode\u003enonfairTryAcquire()\u003c/code\u003e ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eboolean tryLock(long time, TimeUnit unit)\u003c/code\u003e ç›´æ¥è°ƒç”¨ AQS çš„ \u003ca href=\"#%E8%8E%B7%E5%8F%96%E8%B6%85%E6%97%B6%E7%AD%89%E5%BE%85%E5%BC%8F%E7%9A%84%E7%8B%AC%E5%8D%A0%E9%94%81\"\u003eè·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”\u003c/a\u003e æ–¹æ³• \u003ccode\u003etryAcquireNanos(int arg, long nanosTimeout)\u003c/code\u003eã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003evoid unlock()\u003c/code\u003e ç›´æ¥è°ƒç”¨ AQS çš„ \u003ca href=\"#%E9%87%8A%E6%94%BE%E7%8B%AC%E5%8D%A0%E9%94%81\"\u003eé‡Šæ”¾ç‹¬å é”\u003c/a\u003e æ–¹æ³• \u003ccode\u003erelease(int arg)\u003c/code\u003e ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç›´æ¥è°ƒç”¨ AQS æ¥å£çš„æ–¹æ³•å°±ä¸å†èµ˜è¿°äº†ï¼Œå…¶åŸç†åœ¨ [AQS çš„åŸç†](#AQS çš„åŸç†) ä¸­å·²ç»ç”¨å¾ˆå¤§ç¯‡å¹…è¿›è¡Œè¿‡è®²è§£ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enonfairTryAcquire\u003c/code\u003e æ–¹æ³•æºç å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// å…¬å¹³é”å’Œéå…¬å¹³é”éƒ½ä¼šç”¨è¿™ä¸ªæ–¹æ³•åŒºå°è¯•è·å–é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003enonfairTryAcquire\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eint\u003c/span\u003e acquires)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eThread\u003c/span\u003e \u003cspan class=\"variable\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e Thread.currentThread();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003ec\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e getState();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (c == \u003cspan class=\"number\"\u003e0\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (compareAndSetState(\u003cspan class=\"number\"\u003e0\u003c/span\u003e, acquires)) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         \u003cspan class=\"comment\"\u003e// å¦‚æœåŒæ­¥çŠ¶æ€ä¸º0ï¼Œå°†å…¶è®¾ä¸º acquiresï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            setExclusiveOwnerThread(current);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (current == getExclusiveOwnerThread()) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003enextc\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e c + acquires;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (nextc \u0026lt; \u003cspan class=\"number\"\u003e0\u003c/span\u003e) \u003cspan class=\"comment\"\u003e// overflow\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;Maximum lock count exceeded\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        setState(nextc);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eå¤„ç†æµç¨‹å¾ˆç®€å•ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¦‚æœåŒæ­¥çŠ¶æ€ä¸º 0ï¼Œè®¾ç½®åŒæ­¥çŠ¶æ€è®¾ä¸º acquiresï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹ï¼Œç„¶åè¿”å› trueï¼Œè·å–é”æˆåŠŸã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœåŒæ­¥çŠ¶æ€ä¸ä¸º 0 ä¸”å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹ï¼Œè®¾ç½®åŒæ­¥çŠ¶æ€ä¸ºå½“å‰çŠ¶æ€å€¼+acquires å€¼ï¼Œç„¶åè¿”å› trueï¼Œè·å–é”æˆåŠŸã€‚\u003c/li\u003e\n\u003cli\u003eå¦åˆ™ï¼Œè¿”å› falseï¼Œè·å–é”å¤±è´¥ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"å…¬å¹³é”å’Œéå…¬å¹³é”\"\u003e\u003ca href=\"#å…¬å¹³é”å’Œéå…¬å¹³é”\" class=\"headerlink\" title=\"å…¬å¹³é”å’Œéå…¬å¹³é”\"\u003e\u003c/a\u003eå…¬å¹³é”å’Œéå…¬å¹³é”\u003c/h4\u003e\u003cp\u003eReentrantLock è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ— å‚æ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ä¼ å…¥ fair å‚æ•°çš„æ„é€ å‡½æ•°ã€‚fair å‚æ•°ä»£è¡¨çš„æ˜¯é”çš„å…¬å¹³ç­–ç•¥ï¼Œå¦‚æœä¼ å…¥ true å°±è¡¨ç¤ºéœ€è¦æ„é€ ä¸€ä¸ªå…¬å¹³é”ï¼Œåä¹‹åˆ™è¡¨ç¤ºè¦æ„é€ ä¸€ä¸ªéå…¬å¹³é”ã€‚\u003c/p\u003e\n\u003cp\u003eé”éƒ½å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰è·å¾—é”ï¼Œå°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå½“æœ‰çº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå°±éœ€è¦ä»ç­‰å¾…é˜Ÿåˆ—ä¸­å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ã€‚å¦‚æœæ˜¯å…¬å¹³é”ï¼Œå”¤é†’çš„ç­–ç•¥å°±æ˜¯è°ç­‰å¾…çš„æ—¶é—´é•¿ï¼Œå°±å”¤é†’è°ï¼Œå¾ˆå…¬å¹³ï¼›å¦‚æœæ˜¯éå…¬å¹³é”ï¼Œåˆ™ä¸æä¾›è¿™ä¸ªå…¬å¹³ä¿è¯ï¼Œæœ‰å¯èƒ½ç­‰å¾…æ—¶é—´çŸ­çš„çº¿ç¨‹åè€Œå…ˆè¢«å”¤é†’ã€‚\u003c/p\u003e\n\u003cp\u003elock æ–¹æ³•åœ¨å…¬å¹³é”å’Œéå…¬å¹³é”ä¸­çš„å®ç°ï¼š\u003c/p\u003e\n\u003cp\u003eäºŒè€…çš„åŒºåˆ«ä»…åœ¨äºç”³è¯·éå…¬å¹³é”æ—¶ï¼Œå¦‚æœåŒæ­¥çŠ¶æ€ä¸º 0ï¼Œå°è¯•å°†å…¶è®¾ä¸º 1ï¼Œå¦‚æœæˆåŠŸï¼Œç›´æ¥å°†å½“å‰çº¿ç¨‹ç½®ä¸ºæ’å®ƒçº¿ç¨‹ï¼›å¦åˆ™å’Œå…¬å¹³é”ä¸€æ ·ï¼Œè°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³• \u003ccode\u003eacquire\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// éå…¬å¹³é”å®ç°\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003elock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (compareAndSetState(\u003cspan class=\"number\"\u003e0\u003c/span\u003e, \u003cspan class=\"number\"\u003e1\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// å¦‚æœåŒæ­¥çŠ¶æ€ä¸º0ï¼Œå°†å…¶è®¾ä¸º1ï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        setExclusiveOwnerThread(Thread.currentThread());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³• acquire\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        acquire(\u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// å…¬å¹³é”å®ç°\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003elock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³• acquire\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    acquire(\u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"ReentrantReadWriteLock\"\u003e\u003ca href=\"#ReentrantReadWriteLock\" class=\"headerlink\" title=\"ReentrantReadWriteLock\"\u003e\u003c/a\u003eReentrantReadWriteLock\u003c/h2\u003e\u003cp\u003e\u003ccode\u003eReadWriteLock\u003c/code\u003e é€‚ç”¨äº\u003cstrong\u003eè¯»å¤šå†™å°‘çš„åœºæ™¯\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e ç±»æ˜¯ \u003ccode\u003eReadWriteLock\u003c/code\u003e æ¥å£çš„å…·ä½“å®ç°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯é‡å…¥çš„è¯»å†™é”ã€‚\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e ç»´æŠ¤äº†ä¸€å¯¹è¯»å†™é”ï¼Œå°†è¯»å†™é”åˆ†å¼€ï¼Œæœ‰åˆ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚\u003c/p\u003e\n\u003cp\u003eè¯»å†™é”ï¼Œå¹¶ä¸æ˜¯ Java è¯­è¨€ç‰¹æœ‰çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªå¹¿ä¸ºä½¿ç”¨çš„é€šç”¨æŠ€æœ¯ï¼Œæ‰€æœ‰çš„è¯»å†™é”éƒ½éµå®ˆä»¥ä¸‹ä¸‰æ¡åŸºæœ¬åŸåˆ™ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡ï¼›\u003c/li\u003e\n\u003cli\u003eåªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…±äº«å˜é‡ï¼›\u003c/li\u003e\n\u003cli\u003eå¦‚æœä¸€ä¸ªå†™çº¿ç¨‹æ­£åœ¨æ‰§è¡Œå†™æ“ä½œï¼Œæ­¤æ—¶ç¦æ­¢è¯»çº¿ç¨‹è¯»å…±äº«å˜é‡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¯»å†™é”ä¸äº’æ–¥é”çš„ä¸€ä¸ªé‡è¦åŒºåˆ«å°±æ˜¯\u003cstrong\u003eè¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡\u003c/strong\u003eï¼Œè€Œäº’æ–¥é”æ˜¯ä¸å…è®¸çš„ï¼Œè¿™æ˜¯è¯»å†™é”åœ¨è¯»å¤šå†™å°‘åœºæ™¯ä¸‹æ€§èƒ½ä¼˜äºäº’æ–¥é”çš„å…³é”®ã€‚ä½†\u003cstrong\u003eè¯»å†™é”çš„å†™æ“ä½œæ˜¯äº’æ–¥çš„\u003c/strong\u003eï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨å†™å…±äº«å˜é‡çš„æ—¶å€™ï¼Œæ˜¯ä¸å…è®¸å…¶ä»–çº¿ç¨‹æ‰§è¡Œå†™æ“ä½œå’Œè¯»æ“ä½œã€‚\u003c/p\u003e\n\u003ch3 id=\"ReentrantReadWriteLock-çš„ç‰¹æ€§\"\u003e\u003ca href=\"#ReentrantReadWriteLock-çš„ç‰¹æ€§\" class=\"headerlink\" title=\"ReentrantReadWriteLock çš„ç‰¹æ€§\"\u003e\u003c/a\u003eReentrantReadWriteLock çš„ç‰¹æ€§\u003c/h3\u003e\u003cp\u003eReentrantReadWriteLock çš„ç‰¹æ€§å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯\u003c/strong\u003eã€‚å¦‚æœæ˜¯å†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œç”±äº \u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e å…¶å†…éƒ¨å®ç°æ¯” \u003ccode\u003eReentrantLock\u003c/code\u003e å¤æ‚ï¼Œæ€§èƒ½å¯èƒ½åè€Œè¦å·®ä¸€äº›ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚ç”±äº \u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e çš„è¯»å†™é”ï¼ˆ\u003ccode\u003eReadLock\u003c/code\u003eã€\u003ccode\u003eWriteLock\u003c/code\u003eï¼‰éƒ½å®ç°äº† \u003ccode\u003eLock\u003c/code\u003e æ¥å£ï¼Œæ‰€ä»¥è¦æ›¿æ¢ä¸º \u003ccode\u003eReentrantLock\u003c/code\u003e ä¹Ÿè¾ƒä¸ºå®¹æ˜“ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e å®ç°äº† \u003ccode\u003eReadWriteLock\u003c/code\u003e æ¥å£ï¼Œæ”¯æŒäº† \u003ccode\u003eReentrantLock\u003c/code\u003e æ‰€ä¸å…·å¤‡çš„è¯»å†™é”åˆ†ç¦»ã€‚\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e ç»´æŠ¤äº†ä¸€å¯¹è¯»å†™é”ï¼ˆ\u003ccode\u003eReadLock\u003c/code\u003eã€\u003ccode\u003eWriteLock\u003c/code\u003eï¼‰ã€‚å°†è¯»å†™é”åˆ†å¼€ï¼Œæœ‰åˆ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e çš„åŠ é”ç­–ç•¥æ˜¯ï¼š\u003cstrong\u003eå…è®¸å¤šä¸ªè¯»æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä½†æ¯æ¬¡åªå…è®¸ä¸€ä¸ªå†™æ“ä½œ\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e ä¸ºè¯»å†™é”éƒ½æä¾›äº†å¯é‡å…¥çš„åŠ é”è¯­ä¹‰ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰ä¸¤ç§æ¨¡å¼ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003eReadWriteLock\u003c/code\u003e æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"title class_\"\u003eReadWriteLock\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Lock \u003cspan class=\"title function_\"\u003ereadLock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Lock \u003cspan class=\"title function_\"\u003ewriteLock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ereadLock\u003c/code\u003e - è¿”å›ç”¨äºè¯»æ“ä½œçš„é”ï¼ˆ\u003ccode\u003eReadLock\u003c/code\u003eï¼‰ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewriteLock\u003c/code\u003e - è¿”å›ç”¨äºå†™æ“ä½œçš„é”ï¼ˆ\u003ccode\u003eWriteLock\u003c/code\u003eï¼‰ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåœ¨è¯»å†™é”å’Œå†™å…¥é”ä¹‹é—´çš„äº¤äº’å¯ä»¥é‡‡ç”¨å¤šç§å®ç°æ–¹å¼ï¼Œ\u003ccode\u003eReadWriteLock\u003c/code\u003e çš„ä¸€äº›å¯é€‰å®ç°åŒ…æ‹¬ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eé‡Šæ”¾ä¼˜å…ˆ\u003c/strong\u003e - å½“ä¸€ä¸ªå†™å…¥æ“ä½œé‡Šæ”¾å†™é”ï¼Œå¹¶ä¸”é˜Ÿåˆ—ä¸­åŒæ—¶å­˜åœ¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹ï¼Œé‚£ä¹ˆåº”è¯¥ä¼˜å…ˆé€‰æ‹©è¯»çº¿ç¨‹ã€å†™çº¿ç¨‹ï¼Œè¿˜æ˜¯æœ€å…ˆå‘å‡ºè¯·æ±‚çš„çº¿ç¨‹ï¼Ÿ\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eè¯»çº¿ç¨‹æ’é˜Ÿ\u003c/strong\u003e - å¦‚æœé”æ˜¯ç”±è¯»çº¿ç¨‹æŒæœ‰ï¼Œä½†æœ‰å†™çº¿ç¨‹æ­£åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆæ–°åˆ°è¾¾çš„è¯»çº¿ç¨‹èƒ½å¦ç«‹å³è·å¾—è®¿é—®æƒï¼Œè¿˜æ˜¯åº”è¯¥åœ¨å†™çº¿ç¨‹åé¢ç­‰å¾…ï¼Ÿå¦‚æœå…è®¸è¯»çº¿ç¨‹æ’é˜Ÿåˆ°å†™çº¿ç¨‹ä¹‹å‰ï¼Œé‚£ä¹ˆå°†æé«˜å¹¶å‘æ€§ï¼Œä½†å¯èƒ½é€ æˆçº¿ç¨‹é¥¥é¥¿é—®é¢˜ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eé‡å…¥æ€§\u003c/strong\u003e - è¯»é”å’Œå†™é”æ˜¯å¦æ˜¯å¯é‡å…¥çš„ï¼Ÿ\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eé™çº§\u003c/strong\u003e - å¦‚æœä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™å…¥é”ï¼Œé‚£ä¹ˆå®ƒèƒ½å¦åœ¨ä¸é‡Šæ”¾è¯¥é”çš„æƒ…å†µä¸‹è·å¾—è¯»é”ï¼Ÿè¿™å¯èƒ½ä¼šä½¿å¾—å†™é”è¢«é™çº§ä¸ºè¯»é”ï¼ŒåŒæ—¶ä¸å…è®¸å…¶ä»–å†™çº¿ç¨‹ä¿®æ”¹è¢«ä¿æŠ¤çš„èµ„æºã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå‡çº§\u003c/strong\u003e - è¯»é”èƒ½å¦ä¼˜å…ˆäºå…¶ä»–æ­£åœ¨ç­‰å¾…çš„è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹è€Œå‡çº§ä¸ºä¸€ä¸ªå†™é”ï¼Ÿåœ¨å¤§å¤šæ•°çš„è¯»å†™é”å®ç°ä¸­å¹¶ä¸æ”¯æŒå‡çº§ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰æ˜¾å¼çš„å‡çº§æ“ä½œï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“é€ æˆæ­»é”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ReentrantReadWriteLock-çš„ç”¨æ³•\"\u003e\u003ca href=\"#ReentrantReadWriteLock-çš„ç”¨æ³•\" class=\"headerlink\" title=\"ReentrantReadWriteLock çš„ç”¨æ³•\"\u003e\u003c/a\u003eReentrantReadWriteLock çš„ç”¨æ³•\u003c/h3\u003e\u003cp\u003eå‰æ–‡äº†è§£äº† \u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e çš„ç‰¹æ€§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è®²è¿°å…¶å…·ä½“ç”¨æ³•ã€‚\u003c/p\u003e\n\u003ch4 id=\"ReentrantReadWriteLock-çš„æ„é€ æ–¹æ³•\"\u003e\u003ca href=\"#ReentrantReadWriteLock-çš„æ„é€ æ–¹æ³•\" class=\"headerlink\" title=\"ReentrantReadWriteLock çš„æ„é€ æ–¹æ³•\"\u003e\u003c/a\u003eReentrantReadWriteLock çš„æ„é€ æ–¹æ³•\u003c/h4\u003e\u003cp\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e å’Œ \u003ccode\u003eReentrantLock\u003c/code\u003e ä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸”ç”¨æ³•ç›¸ä¼¼ã€‚\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"title function_\"\u003eReentrantReadWriteLock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"title function_\"\u003eReentrantReadWriteLock\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eboolean\u003c/span\u003e fair)\u003c/span\u003e {}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eReentrantReadWriteLock()\u003c/code\u003e - é»˜è®¤æ„é€ æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ª\u003cstrong\u003eéå…¬å¹³é”ï¼ˆNonfairSyncï¼‰\u003c/strong\u003eã€‚åœ¨éå…¬å¹³çš„é”ä¸­ï¼Œçº¿ç¨‹è·å¾—é”çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚å†™çº¿ç¨‹é™çº§ä¸ºè¯»çº¿ç¨‹æ˜¯å¯ä»¥çš„ï¼Œä½†è¯»çº¿ç¨‹å‡çº§ä¸ºå†™çº¿ç¨‹æ˜¯ä¸å¯ä»¥çš„ï¼ˆè¿™æ ·ä¼šå¯¼è‡´æ­»é”ï¼‰ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReentrantReadWriteLock(boolean)\u003c/code\u003e - \u003ccode\u003enew ReentrantLock(true)\u003c/code\u003e ä¼šåˆå§‹åŒ–ä¸€ä¸ª\u003cstrong\u003eå…¬å¹³é”ï¼ˆFairSyncï¼‰\u003c/strong\u003eã€‚å¯¹äºå…¬å¹³é”ï¼Œç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹å°†ä¼˜å…ˆè·å¾—é”ã€‚å¦‚æœè¿™ä¸ªé”æ˜¯è¯»çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å¦ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™é”ï¼Œé‚£ä¹ˆå…¶ä»–è¯»çº¿ç¨‹éƒ½ä¸èƒ½è·å¾—è¯»é”ï¼Œç›´åˆ°å†™çº¿ç¨‹é‡Šæ”¾å†™é”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"ReentrantReadWriteLock-çš„ä½¿ç”¨å®ä¾‹\"\u003e\u003ca href=\"#ReentrantReadWriteLock-çš„ä½¿ç”¨å®ä¾‹\" class=\"headerlink\" title=\"ReentrantReadWriteLock çš„ä½¿ç”¨å®ä¾‹\"\u003e\u003c/a\u003eReentrantReadWriteLock çš„ä½¿ç”¨å®ä¾‹\u003c/h4\u003e\u003cp\u003eåœ¨ \u003ca href=\"#reentrantreadwritelock-%E7%9A%84%E7%89%B9%E6%80%A7\"\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e çš„ç‰¹æ€§\u003c/a\u003e ä¸­å·²ç»ä»‹ç»è¿‡ï¼Œ\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e çš„è¯»å†™é”ï¼ˆ\u003ccode\u003eReadLock\u003c/code\u003eã€\u003ccode\u003eWriteLock\u003c/code\u003eï¼‰éƒ½å®ç°äº† \u003ccode\u003eLock\u003c/code\u003e æ¥å£ï¼Œæ‰€ä»¥å…¶å„è‡ªç‹¬ç«‹çš„ä½¿ç”¨æ–¹å¼ä¸ \u003ccode\u003eReentrantLock\u003c/code\u003e ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e ä¸ \u003ccode\u003eReentrantLock\u003c/code\u003e ç”¨æ³•ä¸Šçš„å·®å¼‚ï¼Œä¸»è¦åœ¨äºè¯»å†™é”çš„é…åˆä½¿ç”¨ã€‚æœ¬æ–‡ä»¥ä¸€ä¸ªå…¸å‹ä½¿ç”¨åœºæ™¯æ¥è¿›è¡Œè®²è§£ã€‚\u003c/p\u003e\n\u003cp\u003eã€ç¤ºä¾‹ã€‘åŸºäº \u003ccode\u003eReadWriteLock\u003c/code\u003e å®ç°ä¸€ä¸ªç®€å•çš„æ³›å‹æ— ç•Œç¼“å­˜\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e/**\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e * ç®€å•çš„æ— ç•Œç¼“å­˜å®ç°\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e * \u0026lt;p\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e * ä½¿ç”¨ WeakHashMap å­˜å‚¨é”®å€¼å¯¹ã€‚WeakHashMap ä¸­å­˜å‚¨çš„å¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼ŒJVM GC æ—¶ä¼šè‡ªåŠ¨æ¸…é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eUnboundedCache\u003c/span\u003e\u0026lt;K, V\u0026gt; {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e Map\u0026lt;K, V\u0026gt; cacheMap = \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eWeakHashMap\u003c/span\u003e\u0026lt;\u0026gt;();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eReadWriteLock\u003c/span\u003e \u003cspan class=\"variable\"\u003ecacheLock\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eReentrantReadWriteLock\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e V \u003cspan class=\"title function_\"\u003eget\u003c/span\u003e\u003cspan class=\"params\"\u003e(K key)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cacheLock.readLock().lock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        V value;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            value = cacheMap.get(key);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"type\"\u003eString\u003c/span\u003e \u003cspan class=\"variable\"\u003elog\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e String.format(\u003cspan class=\"string\"\u003e\u0026#34;%s è¯»æ•°æ® %s:%s\u0026#34;\u003c/span\u003e, Thread.currentThread().getName(), key, value);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            System.out.println(log);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            cacheLock.readLock().unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e value;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e V \u003cspan class=\"title function_\"\u003eput\u003c/span\u003e\u003cspan class=\"params\"\u003e(K key, V value)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cacheLock.writeLock().lock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            cacheMap.put(key, value);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"type\"\u003eString\u003c/span\u003e \u003cspan class=\"variable\"\u003elog\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e String.format(\u003cspan class=\"string\"\u003e\u0026#34;%s å†™å…¥æ•°æ® %s:%s\u0026#34;\u003c/span\u003e, Thread.currentThread().getName(), key, value);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            System.out.println(log);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            cacheLock.writeLock().unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e value;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e V \u003cspan class=\"title function_\"\u003eremove\u003c/span\u003e\u003cspan class=\"params\"\u003e(K key)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cacheLock.writeLock().lock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e cacheMap.remove(key);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            cacheLock.writeLock().unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eclear\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cacheLock.writeLock().lock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"built_in\"\u003ethis\u003c/span\u003e.cacheMap.clear();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            cacheLock.writeLock().unlock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eè¯´æ˜ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä½¿ç”¨ \u003ccode\u003eWeakHashMap\u003c/code\u003e è€Œä¸æ˜¯ \u003ccode\u003eHashMap\u003c/code\u003e æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚\u003ccode\u003eWeakHashMap\u003c/code\u003e ä¸­å­˜å‚¨çš„å¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼ŒJVM GC æ—¶ä¼šè‡ªåŠ¨æ¸…é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚\u003c/li\u003e\n\u003cli\u003eå‘ \u003ccode\u003eMap\u003c/code\u003e å†™æ•°æ®å‰åŠ å†™é”ï¼Œå†™å®Œåï¼Œé‡Šæ”¾å†™é”ã€‚\u003c/li\u003e\n\u003cli\u003eå‘ \u003ccode\u003eMap\u003c/code\u003e è¯»æ•°æ®å‰åŠ è¯»é”ï¼Œè¯»å®Œåï¼Œé‡Šæ”¾è¯»é”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæµ‹è¯•å…¶çº¿ç¨‹å®‰å…¨æ€§ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e/**\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e * \u003cspan class=\"doctag\"\u003e@author\u003c/span\u003e \u0026lt;a href=\u0026#34;mailto:forbreak@163.com\u0026#34;\u0026gt;Zhang Peng\u0026lt;/a\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e * \u003cspan class=\"doctag\"\u003e@since\u003c/span\u003e 2020-01-01\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eReentrantReadWriteLockDemo\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e UnboundedCache\u0026lt;Integer, Integer\u0026gt; cache = \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eUnboundedCache\u003c/span\u003e\u0026lt;\u0026gt;();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003emain\u003c/span\u003e\u003cspan class=\"params\"\u003e(String[] args)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eExecutorService\u003c/span\u003e \u003cspan class=\"variable\"\u003eexecutorService\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e Executors.newCachedThreadPool();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003ei\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"number\"\u003e20\u003c/span\u003e; i++) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            executorService.execute(\u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMyThread\u003c/span\u003e());\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            cache.get(\u003cspan class=\"number\"\u003e0\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        executorService.shutdown();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** çº¿ç¨‹ä»»åŠ¡æ¯æ¬¡å‘ç¼“å­˜ä¸­å†™å…¥ 3 ä¸ªéšæœºå€¼ï¼Œkey å›ºå®š */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMyThread\u003c/span\u003e \u003cspan class=\"keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"title class_\"\u003eRunnable\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"meta\"\u003e@Override\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003erun\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"type\"\u003eRandom\u003c/span\u003e \u003cspan class=\"variable\"\u003erandom\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eRandom\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003ei\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"number\"\u003e3\u003c/span\u003e; i++) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                cache.put(i, random.nextInt(\u003cspan class=\"number\"\u003e100\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eè¯´æ˜ï¼šç¤ºä¾‹ä¸­ï¼Œé€šè¿‡çº¿ç¨‹æ± å¯åŠ¨ 20 ä¸ªå¹¶å‘ä»»åŠ¡ã€‚ä»»åŠ¡æ¯æ¬¡å‘ç¼“å­˜ä¸­å†™å…¥ 3 ä¸ªéšæœºå€¼ï¼Œkey å›ºå®šï¼›ç„¶åä¸»çº¿ç¨‹æ¯æ¬¡å›ºå®šè¯»å–ç¼“å­˜ä¸­ç¬¬ä¸€ä¸ª key çš„å€¼ã€‚\u003c/p\u003e\n\u003cp\u003eè¾“å‡ºç»“æœï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight subunit\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emain è¯»æ•°æ® 0:null\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epool\u003cspan class=\"string\"\u003e-1\u003c/span\u003e-thread\u003cspan class=\"string\"\u003e-1\u003c/span\u003e å†™å…¥æ•°æ® 0:16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epool\u003cspan class=\"string\"\u003e-1\u003c/span\u003e-thread\u003cspan class=\"string\"\u003e-1\u003c/span\u003e å†™å…¥æ•°æ® 1:58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epool\u003cspan class=\"string\"\u003e-1\u003c/span\u003e-thread\u003cspan class=\"string\"\u003e-1\u003c/span\u003e å†™å…¥æ•°æ® 2:50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emain è¯»æ•°æ® 0:16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epool\u003cspan class=\"string\"\u003e-1\u003c/span\u003e-thread\u003cspan class=\"string\"\u003e-1\u003c/span\u003e å†™å…¥æ•°æ® 0:85\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epool\u003cspan class=\"string\"\u003e-1\u003c/span\u003e-thread\u003cspan class=\"string\"\u003e-1\u003c/span\u003e å†™å…¥æ•°æ® 1:76\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epool\u003cspan class=\"string\"\u003e-1\u003c/span\u003e-thread\u003cspan class=\"string\"\u003e-1\u003c/span\u003e å†™å…¥æ•°æ® 2:46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epool\u003cspan class=\"string\"\u003e-1\u003c/span\u003e-thread\u003cspan class=\"string\"\u003e-2\u003c/span\u003e å†™å…¥æ•°æ® 0:21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epool\u003cspan class=\"string\"\u003e-1\u003c/span\u003e-thread\u003cspan class=\"string\"\u003e-2\u003c/span\u003e å†™å…¥æ•°æ® 1:41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epool\u003cspan class=\"string\"\u003e-1\u003c/span\u003e-thread\u003cspan class=\"string\"\u003e-2\u003c/span\u003e å†™å…¥æ•°æ® 2:63\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emain è¯»æ•°æ® 0:21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emain è¯»æ•°æ® 0:21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e// ...\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"ReentrantReadWriteLock-çš„åŸç†\"\u003e\u003ca href=\"#ReentrantReadWriteLock-çš„åŸç†\" class=\"headerlink\" title=\"ReentrantReadWriteLock çš„åŸç†\"\u003e\u003c/a\u003eReentrantReadWriteLock çš„åŸç†\u003c/h3\u003e\u003cp\u003eå‰é¢äº†è§£äº† \u003ccode\u003eReentrantLock\u003c/code\u003e çš„åŸç†ï¼Œç†è§£ \u003ccode\u003eReentrantReadWriteLock\u003c/code\u003e å°±å®¹æ˜“å¤šäº†ã€‚\u003c/p\u003e\n\u003ch4 id=\"ReentrantReadWriteLock-çš„æ•°æ®ç»“æ„\"\u003e\u003ca href=\"#ReentrantReadWriteLock-çš„æ•°æ®ç»“æ„\" class=\"headerlink\" title=\"ReentrantReadWriteLock çš„æ•°æ®ç»“æ„\"\u003e\u003c/a\u003eReentrantReadWriteLock çš„æ•°æ®ç»“æ„\u003c/h4\u003e\u003cp\u003eé˜…è¯» ReentrantReadWriteLock çš„æºç ï¼Œå¯ä»¥å‘ç°å®ƒæœ‰ä¸‰ä¸ªæ ¸å¿ƒå­—æ®µï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e/** Inner class providing readlock */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e ReentrantReadWriteLock.ReadLock readerLock;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e/** Inner class providing writelock */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e ReentrantReadWriteLock.WriteLock writerLock;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e/** Performs all synchronization mechanics */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e Sync sync;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e ReentrantReadWriteLock.WriteLock \u003cspan class=\"title function_\"\u003ewriteLock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e { \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e writerLock; }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e ReentrantReadWriteLock.ReadLock  \u003cspan class=\"title function_\"\u003ereadLock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e  { \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e readerLock; }\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esync\u003c/code\u003e - å†…éƒ¨ç±» \u003ccode\u003eReentrantReadWriteLock.Sync\u003c/code\u003e å¯¹è±¡ã€‚ä¸ \u003ccode\u003eReentrantLock\u003c/code\u003e ç±»ä¼¼ï¼Œå®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š\u003ccode\u003eReentrantReadWriteLock.FairSync\u003c/code\u003e å’Œ \u003ccode\u003eReentrantReadWriteLock.NonfairSync\u003c/code\u003e ï¼Œåˆ†åˆ«è¡¨ç¤ºå…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ereaderLock\u003c/code\u003e - å†…éƒ¨ç±» \u003ccode\u003eReentrantReadWriteLock.ReadLock\u003c/code\u003e å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠè¯»é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewriterLock\u003c/code\u003e - å†…éƒ¨ç±» \u003ccode\u003eReentrantReadWriteLock.WriteLock\u003c/code\u003e å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠå†™é”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"ReentrantReadWriteLock-çš„è·å–é”å’Œé‡Šæ”¾é”\"\u003e\u003ca href=\"#ReentrantReadWriteLock-çš„è·å–é”å’Œé‡Šæ”¾é”\" class=\"headerlink\" title=\"ReentrantReadWriteLock çš„è·å–é”å’Œé‡Šæ”¾é”\"\u003e\u003c/a\u003eReentrantReadWriteLock çš„è·å–é”å’Œé‡Šæ”¾é”\u003c/h4\u003e\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eReadLock\u003c/span\u003e \u003cspan class=\"keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"title class_\"\u003eLock\u003c/span\u003e, java.io.Serializable {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// è°ƒç”¨ AQS è·å–å…±äº«é”æ–¹æ³•\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003elock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        sync.acquireShared(\u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// è°ƒç”¨ AQS é‡Šæ”¾å…±äº«é”æ–¹æ³•\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eunlock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        sync.releaseShared(\u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eWriteLock\u003c/span\u003e \u003cspan class=\"keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"title class_\"\u003eLock\u003c/span\u003e, java.io.Serializable {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³•\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003elock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        sync.acquire(\u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// è°ƒç”¨ AQS é‡Šæ”¾ç‹¬å é”æ–¹æ³•\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eunlock\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        sync.release(\u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"StampedLock\"\u003e\u003ca href=\"#StampedLock\" class=\"headerlink\" title=\"StampedLock\"\u003e\u003c/a\u003eStampedLock\u003c/h2\u003e\u003cp\u003eReadWriteLock æ”¯æŒä¸¤ç§æ¨¡å¼ï¼šä¸€ç§æ˜¯è¯»é”ï¼Œä¸€ç§æ˜¯å†™é”ã€‚è€Œ StampedLock æ”¯æŒä¸‰ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š\u003cstrong\u003eå†™é”\u003c/strong\u003eã€\u003cstrong\u003eæ‚²è§‚è¯»é”\u003c/strong\u003eå’Œ\u003cstrong\u003eä¹è§‚è¯»\u003c/strong\u003eã€‚å…¶ä¸­ï¼Œå†™é”ã€æ‚²è§‚è¯»é”çš„è¯­ä¹‰å’Œ ReadWriteLock çš„å†™é”ã€è¯»é”çš„è¯­ä¹‰éå¸¸ç±»ä¼¼ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–æ‚²è§‚è¯»é”ï¼Œä½†æ˜¯åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”ï¼Œå†™é”å’Œæ‚²è§‚è¯»é”æ˜¯äº’æ–¥çš„ã€‚ä¸åŒçš„æ˜¯ï¼šStampedLock é‡Œçš„å†™é”å’Œæ‚²è§‚è¯»é”åŠ é”æˆåŠŸä¹‹åï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ª stampï¼›ç„¶åè§£é”çš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥è¿™ä¸ª stampã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ³¨æ„è¿™é‡Œï¼Œç”¨çš„æ˜¯â€œä¹è§‚è¯»â€è¿™ä¸ªè¯ï¼Œè€Œä¸æ˜¯â€œä¹è§‚è¯»é”â€ï¼Œæ˜¯è¦æé†’ä½ ï¼Œ\u003cstrong\u003eä¹è§‚è¯»è¿™ä¸ªæ“ä½œæ˜¯æ— é”çš„\u003c/strong\u003eï¼Œæ‰€ä»¥ç›¸æ¯”è¾ƒ ReadWriteLock çš„è¯»é”ï¼Œä¹è§‚è¯»çš„æ€§èƒ½æ›´å¥½ä¸€äº›ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eStampedLock çš„æ€§èƒ½ä¹‹æ‰€ä»¥æ¯” ReadWriteLock è¿˜è¦å¥½ï¼Œå…¶å…³é”®æ˜¯ \u003cstrong\u003eStampedLock æ”¯æŒä¹è§‚è¯»\u003c/strong\u003eçš„æ–¹å¼ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eReadWriteLock æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ï¼Œä½†æ˜¯å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å†™æ“ä½œä¼šè¢«é˜»å¡ï¼›\u003c/li\u003e\n\u003cli\u003eè€Œ StampedLock æä¾›çš„ä¹è§‚è¯»ï¼Œæ˜¯å…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸æ˜¯æ‰€æœ‰çš„å†™æ“ä½œéƒ½è¢«é˜»å¡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¯¹äºè¯»å¤šå†™å°‘çš„åœºæ™¯ StampedLock æ€§èƒ½å¾ˆå¥½ï¼Œç®€å•çš„åº”ç”¨åœºæ™¯åŸºæœ¬ä¸Šå¯ä»¥æ›¿ä»£ ReadWriteLockï¼Œä½†æ˜¯\u003cstrong\u003eStampedLock çš„åŠŸèƒ½ä»…ä»…æ˜¯ ReadWriteLock çš„å­é›†\u003c/strong\u003eï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿˜æ˜¯æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eStampedLock ä¸æ”¯æŒé‡å…¥\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eStampedLock çš„æ‚²è§‚è¯»é”ã€å†™é”éƒ½ä¸æ”¯æŒæ¡ä»¶å˜é‡ã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœçº¿ç¨‹é˜»å¡åœ¨ StampedLock çš„ readLock() æˆ–è€… writeLock() ä¸Šæ—¶ï¼Œæ­¤æ—¶è°ƒç”¨è¯¥é˜»å¡çº¿ç¨‹çš„ interrupt() æ–¹æ³•ï¼Œä¼šå¯¼è‡´ CPU é£™å‡ã€‚**ä½¿ç”¨ StampedLock ä¸€å®šä¸è¦è°ƒç”¨ä¸­æ–­æ“ä½œï¼Œå¦‚æœéœ€è¦æ”¯æŒä¸­æ–­åŠŸèƒ½ï¼Œä¸€å®šä½¿ç”¨å¯ä¸­æ–­çš„æ‚²è§‚è¯»é” readLockInterruptibly() å’Œå†™é” writeLockInterruptibly()**ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eã€ç¤ºä¾‹ã€‘StampedLock é˜»å¡æ—¶ï¼Œè°ƒç”¨ interrupt() å¯¼è‡´ CPU é£™å‡\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eStampedLock\u003c/span\u003e \u003cspan class=\"variable\"\u003elock\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eStampedLock\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eThread\u003c/span\u003e \u003cspan class=\"variable\"\u003eT1\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eThread\u003c/span\u003e(()-\u0026gt;{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e// è·å–å†™é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  lock.writeLock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e// æ°¸è¿œé˜»å¡åœ¨æ­¤å¤„ï¼Œä¸é‡Šæ”¾å†™é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  LockSupport.park();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e});\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eT1.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// ä¿è¯ T1 è·å–å†™é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eThread.sleep(\u003cspan class=\"number\"\u003e100\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003eThread\u003c/span\u003e \u003cspan class=\"variable\"\u003eT2\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eThread\u003c/span\u003e(()-\u0026gt;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e// é˜»å¡åœ¨æ‚²è§‚è¯»é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  lock.readLock()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eT2.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// ä¿è¯ T2 é˜»å¡åœ¨è¯»é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eThread.sleep(\u003cspan class=\"number\"\u003e100\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// ä¸­æ–­çº¿ç¨‹ T2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// ä¼šå¯¼è‡´çº¿ç¨‹ T2 æ‰€åœ¨ CPU é£™å‡\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eT2.interrupt();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eT2.join();\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eã€ç¤ºä¾‹ã€‘StampedLock è¯»æ¨¡æ¿ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eStampedLock\u003c/span\u003e \u003cspan class=\"variable\"\u003esl\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eStampedLock\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// ä¹è§‚è¯»\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003elong\u003c/span\u003e \u003cspan class=\"variable\"\u003estamp\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  sl.tryOptimisticRead();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// è¯»å…¥æ–¹æ³•å±€éƒ¨å˜é‡\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e......\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// æ ¡éªŒ stamp\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (!sl.validate(stamp)){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e// å‡çº§ä¸ºæ‚²è§‚è¯»é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  stamp = sl.readLock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// è¯»å…¥æ–¹æ³•å±€éƒ¨å˜é‡\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    .....\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  } \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// é‡Šæ”¾æ‚²è§‚è¯»é”\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    sl.unlockRead(stamp);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// ä½¿ç”¨æ–¹æ³•å±€éƒ¨å˜é‡æ‰§è¡Œä¸šåŠ¡æ“ä½œ\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e......\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eã€ç¤ºä¾‹ã€‘StampedLock å†™æ¨¡æ¿ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003elong\u003c/span\u003e \u003cspan class=\"variable\"\u003estamp\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e sl.writeLock();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e// å†™å…±äº«å˜é‡\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  ......\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} \u003cspan class=\"keyword\"\u003efinally\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  sl.unlockWrite(stamp);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"AQS\"\u003e\u003ca href=\"#AQS\" class=\"headerlink\" title=\"AQS\"\u003e\u003c/a\u003eAQS\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eAbstractQueuedSynchronizer\u003c/code\u003eï¼ˆç®€ç§° \u003cstrong\u003eAQS\u003c/strong\u003eï¼‰æ˜¯\u003cstrong\u003eé˜Ÿåˆ—åŒæ­¥å™¨\u003c/strong\u003eï¼Œé¡¾åæ€ä¹‰ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å¤„ç†åŒæ­¥ã€‚å®ƒæ˜¯å¹¶å‘é”å’Œå¾ˆå¤šåŒæ­¥å·¥å…·ç±»çš„å®ç°åŸºçŸ³ï¼ˆå¦‚ \u003ccode\u003eReentrantLock\u003c/code\u003eã€\u003ccode\u003eReentrantReadWriteLock\u003c/code\u003eã€\u003ccode\u003eCountDownLatch\u003c/code\u003eã€\u003ccode\u003eSemaphore\u003c/code\u003eã€\u003ccode\u003eFutureTask\u003c/code\u003e ç­‰ï¼‰ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"AQS-çš„è¦ç‚¹\"\u003e\u003ca href=\"#AQS-çš„è¦ç‚¹\" class=\"headerlink\" title=\"AQS çš„è¦ç‚¹\"\u003e\u003c/a\u003eAQS çš„è¦ç‚¹\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eAQS æä¾›äº†å¯¹ç‹¬äº«é”ä¸å…±äº«é”çš„æ”¯æŒ\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ \u003ccode\u003ejava.util.concurrent.locks\u003c/code\u003e åŒ…ä¸­çš„ç›¸å…³é”ï¼ˆå¸¸ç”¨çš„æœ‰ \u003ccode\u003eReentrantLock\u003c/code\u003eã€ \u003ccode\u003eReadWriteLock\u003c/code\u003eï¼‰éƒ½æ˜¯åŸºäº AQS æ¥å®ç°ã€‚è¿™äº›é”éƒ½æ²¡æœ‰ç›´æ¥ç»§æ‰¿ AQSï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ä¸ª \u003ccode\u003eSync\u003c/code\u003e ç±»å»ç»§æ‰¿ AQSã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·å‘¢ï¼Ÿå› ä¸ºé”é¢å‘çš„æ˜¯ä½¿ç”¨ç”¨æˆ·ï¼Œè€ŒåŒæ­¥å™¨é¢å‘çš„åˆ™æ˜¯çº¿ç¨‹æ§åˆ¶ï¼Œé‚£ä¹ˆåœ¨é”çš„å®ç°ä¸­èšåˆåŒæ­¥å™¨è€Œä¸æ˜¯ç›´æ¥ç»§æ‰¿ AQS å°±å¯ä»¥å¾ˆå¥½çš„éš”ç¦»äºŒè€…æ‰€å…³æ³¨çš„äº‹æƒ…ã€‚\u003c/p\u003e\n\u003ch3 id=\"AQS-çš„åº”ç”¨\"\u003e\u003ca href=\"#AQS-çš„åº”ç”¨\" class=\"headerlink\" title=\"AQS çš„åº”ç”¨\"\u003e\u003c/a\u003eAQS çš„åº”ç”¨\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eAQS æä¾›äº†å¯¹ç‹¬äº«é”ä¸å…±äº«é”çš„æ”¯æŒ\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003ch4 id=\"ç‹¬äº«é”-API\"\u003e\u003ca href=\"#ç‹¬äº«é”-API\" class=\"headerlink\" title=\"ç‹¬äº«é” API\"\u003e\u003c/a\u003eç‹¬äº«é” API\u003c/h4\u003e\u003cp\u003eè·å–ã€é‡Šæ”¾ç‹¬äº«é”çš„ä¸»è¦ API å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eacquire\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eint\u003c/span\u003e arg)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eacquireInterruptibly\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eint\u003c/span\u003e arg)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003etryAcquireNanos\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eint\u003c/span\u003e arg, \u003cspan class=\"type\"\u003elong\u003c/span\u003e nanosTimeout)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003erelease\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eint\u003c/span\u003e arg)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eacquire\u003c/code\u003e - è·å–ç‹¬å é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eacquireInterruptibly\u003c/code\u003e - è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etryAcquireNanos\u003c/code\u003e - å°è¯•åœ¨æŒ‡å®šæ—¶é—´å†…è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚åœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸‹å›è¿”å›ï¼š\u003cul\u003e\n\u003cli\u003eåœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œå½“å‰çº¿ç¨‹æˆåŠŸè·å–äº†é”ï¼›\u003c/li\u003e\n\u003cli\u003eå½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…è¢«ä¸­æ–­ï¼›\u003c/li\u003e\n\u003cli\u003eè¶…æ—¶æ—¶é—´ç»“æŸï¼Œä»æœªè·å¾—é”è¿”å› falseã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003erelease\u003c/code\u003e - é‡Šæ”¾ç‹¬å é”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"å…±äº«é”-API\"\u003e\u003ca href=\"#å…±äº«é”-API\" class=\"headerlink\" title=\"å…±äº«é” API\"\u003e\u003c/a\u003eå…±äº«é” API\u003c/h4\u003e\u003cp\u003eè·å–ã€é‡Šæ”¾å…±äº«é”çš„ä¸»è¦ API å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eacquireShared\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eint\u003c/span\u003e arg)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eacquireSharedInterruptibly\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eint\u003c/span\u003e arg)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003etryAcquireSharedNanos\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eint\u003c/span\u003e arg, \u003cspan class=\"type\"\u003elong\u003c/span\u003e nanosTimeout)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eboolean\u003c/span\u003e \u003cspan class=\"title function_\"\u003ereleaseShared\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003eint\u003c/span\u003e arg)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eacquireShared\u003c/code\u003e - è·å–å…±äº«é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eacquireSharedInterruptibly\u003c/code\u003e - è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etryAcquireSharedNanos\u003c/code\u003e - å°è¯•åœ¨æŒ‡å®šæ—¶é—´å†…è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003erelease\u003c/code\u003e - é‡Šæ”¾å…±äº«é”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"AQS-çš„åŸç†\"\u003e\u003ca href=\"#AQS-çš„åŸç†\" class=\"headerlink\" title=\"AQS çš„åŸç†\"\u003e\u003c/a\u003eAQS çš„åŸç†\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003eASQ åŸç†è¦ç‚¹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAQS ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ \u003ccode\u003evolatile\u003c/code\u003e å˜é‡æ¥ \u003cstrong\u003eç»´æŠ¤åŒæ­¥çŠ¶æ€\u003c/strong\u003eã€‚çŠ¶æ€çš„æ„ä¹‰ç”±å­ç±»èµ‹äºˆã€‚\u003c/li\u003e\n\u003cli\u003eAQS ç»´æŠ¤äº†ä¸€ä¸ª FIFO çš„åŒé“¾è¡¨ï¼Œç”¨æ¥å­˜å‚¨è·å–é”å¤±è´¥çš„çº¿ç¨‹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAQS å›´ç»•åŒæ­¥çŠ¶æ€æä¾›ä¸¤ç§åŸºæœ¬æ“ä½œâ€œè·å–â€å’Œâ€œé‡Šæ”¾â€ï¼Œå¹¶æä¾›ä¸€ç³»åˆ—åˆ¤æ–­å’Œå¤„ç†æ–¹æ³•ï¼Œç®€å•è¯´å‡ ç‚¹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003estate æ˜¯ç‹¬å çš„ï¼Œè¿˜æ˜¯å…±äº«çš„ï¼›\u003c/li\u003e\n\u003cli\u003estate è¢«è·å–åï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼›\u003c/li\u003e\n\u003cli\u003estate è¢«é‡Šæ”¾åï¼Œå”¤é†’ç­‰å¾…çº¿ç¨‹ï¼›\u003c/li\u003e\n\u003cli\u003eçº¿ç¨‹ç­‰ä¸åŠæ—¶ï¼Œå¦‚ä½•é€€å‡ºç­‰å¾…ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè‡³äºçº¿ç¨‹æ˜¯å¦å¯ä»¥è·å¾— stateï¼Œå¦‚ä½•é‡Šæ”¾ stateï¼Œå°±ä¸æ˜¯ AQS å…³å¿ƒçš„äº†ï¼Œè¦ç”±å­ç±»å…·ä½“å®ç°ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"AQS-çš„æ•°æ®ç»“æ„\"\u003e\u003ca href=\"#AQS-çš„æ•°æ®ç»“æ„\" class=\"headerlink\" title=\"AQS çš„æ•°æ®ç»“æ„\"\u003e\u003c/a\u003eAQS çš„æ•°æ®ç»“æ„\u003c/h4\u003e\u003cp\u003eé˜…è¯» AQS çš„æºç ï¼Œå¯ä»¥å‘ç°ï¼šAQS ç»§æ‰¿è‡ª \u003ccode\u003eAbstractOwnableSynchronize\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eabstract\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eAbstractQueuedSynchronizer\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"title class_\"\u003eAbstractOwnableSynchronizer\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"title class_\"\u003ejava\u003c/span\u003e.io.Serializable {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå¤´ï¼Œæ‡’åŠ è½½ã€‚åªèƒ½é€šè¿‡ setHead æ–¹æ³•ä¿®æ”¹ã€‚ */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003etransient\u003c/span\u003e \u003cspan class=\"keyword\"\u003evolatile\u003c/span\u003e Node head;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œæ‡’åŠ è½½ã€‚åªèƒ½é€šè¿‡ enq æ–¹æ³•æ·»åŠ æ–°çš„ç­‰å¾…èŠ‚ç‚¹ã€‚*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003etransient\u003c/span\u003e \u003cspan class=\"keyword\"\u003evolatile\u003c/span\u003e Node tail;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** åŒæ­¥çŠ¶æ€ */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003evolatile\u003c/span\u003e \u003cspan class=\"type\"\u003eint\u003c/span\u003e state;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003estate\u003c/code\u003e - AQS ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ \u003ccode\u003evolatile\u003c/code\u003e å˜é‡æ¥ \u003cstrong\u003eç»´æŠ¤åŒæ­¥çŠ¶æ€\u003c/strong\u003eã€‚\u003cul\u003e\n\u003cli\u003eè¿™ä¸ªæ•´æ•°çŠ¶æ€çš„æ„ä¹‰ç”±å­ç±»æ¥èµ‹äºˆï¼Œå¦‚\u003ccode\u003eReentrantLock\u003c/code\u003e ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºæ‰€æœ‰è€…çº¿ç¨‹å·²ç»é‡å¤è·å–è¯¥é”çš„æ¬¡æ•°ï¼Œ\u003ccode\u003eSemaphore\u003c/code\u003e ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºå‰©ä½™çš„è®¸å¯æ•°é‡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehead\u003c/code\u003e å’Œ \u003ccode\u003etail\u003c/code\u003e - AQS \u003cstrong\u003eç»´æŠ¤äº†ä¸€ä¸ª \u003ccode\u003eNode\u003c/code\u003e ç±»å‹ï¼ˆAQS çš„å†…éƒ¨ç±»ï¼‰çš„åŒé“¾è¡¨æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†\u003c/strong\u003eã€‚è¿™ä¸ªåŒé“¾è¡¨æ˜¯ä¸€ä¸ªåŒå‘çš„ FIFO é˜Ÿåˆ—ï¼Œé€šè¿‡ \u003ccode\u003ehead\u003c/code\u003e å’Œ \u003ccode\u003etail\u003c/code\u003e æŒ‡é’ˆè¿›è¡Œè®¿é—®ã€‚å½“ \u003cstrong\u003eæœ‰çº¿ç¨‹è·å–é”å¤±è´¥åï¼Œå°±è¢«æ·»åŠ åˆ°é˜Ÿåˆ—æœ«å°¾\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javacore/concurrent/aqs_1.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003eå†æ¥çœ‹ä¸€ä¸‹ \u003ccode\u003eNode\u003c/code\u003e çš„æºç \u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eNode\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** è¯¥ç­‰å¾…åŒæ­¥çš„èŠ‚ç‚¹å¤„äºå…±äº«æ¨¡å¼ */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eNode\u003c/span\u003e \u003cspan class=\"variable\"\u003eSHARED\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eNode\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** è¯¥ç­‰å¾…åŒæ­¥çš„èŠ‚ç‚¹å¤„äºç‹¬å æ¨¡å¼ */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eNode\u003c/span\u003e \u003cspan class=\"variable\"\u003eEXCLUSIVE\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"literal\"\u003enull\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** çº¿ç¨‹ç­‰å¾…çŠ¶æ€ï¼ŒçŠ¶æ€å€¼æœ‰: 0ã€1ã€-1ã€-2ã€-3 */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evolatile\u003c/span\u003e \u003cspan class=\"type\"\u003eint\u003c/span\u003e waitStatus;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003eCANCELLED\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e  \u003cspan class=\"number\"\u003e1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003eSIGNAL\u003c/span\u003e    \u003cspan class=\"operator\"\u003e=\u003c/span\u003e -\u003cspan class=\"number\"\u003e1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003eCONDITION\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e -\u003cspan class=\"number\"\u003e2\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003ePROPAGATE\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e -\u003cspan class=\"number\"\u003e3\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** å‰é©±èŠ‚ç‚¹ */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evolatile\u003c/span\u003e Node prev;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** åç»§èŠ‚ç‚¹ */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evolatile\u003c/span\u003e Node next;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e/** ç­‰å¾…é”çš„çº¿ç¨‹ */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evolatile\u003c/span\u003e Thread thread;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \t\u003cspan class=\"comment\"\u003e/** å’ŒèŠ‚ç‚¹æ˜¯å¦å…±äº«æœ‰å…³ */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Node nextWaiter;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eå¾ˆæ˜¾ç„¶ï¼ŒNode æ˜¯ä¸€ä¸ªåŒé“¾è¡¨ç»“æ„ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ewaitStatus\u003c/code\u003e - \u003ccode\u003eNode\u003c/code\u003e ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ \u003ccode\u003evolatile\u003c/code\u003e å˜é‡æ¥ ç»´æŠ¤ AQS åŒæ­¥é˜Ÿåˆ—ä¸­çº¿ç¨‹èŠ‚ç‚¹çš„çŠ¶æ€ã€‚\u003ccode\u003ewaitStatus\u003c/code\u003e æœ‰äº”ä¸ªçŠ¶æ€å€¼ï¼š\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eCANCELLED(1)\u003c/code\u003e - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹å¯èƒ½ç”±äºè¶…æ—¶æˆ–è¢«ä¸­æ–­è€Œ \u003cstrong\u003eå¤„äºè¢«å–æ¶ˆ(ä½œåºŸ)çŠ¶æ€\u003c/strong\u003eï¼Œä¸€æ—¦å¤„äºè¿™ä¸ªçŠ¶æ€ï¼Œè¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹åº”è¯¥ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eSIGNAL(-1)\u003c/code\u003e - æ­¤çŠ¶æ€è¡¨ç¤ºï¼š\u003cstrong\u003eåç»§èŠ‚ç‚¹ä¼šè¢«æŒ‚èµ·\u003c/strong\u003eï¼Œå› æ­¤åœ¨å½“å‰èŠ‚ç‚¹é‡Šæ”¾é”æˆ–è¢«å–æ¶ˆä¹‹åï¼Œå¿…é¡»å”¤é†’(\u003ccode\u003eunparking\u003c/code\u003e)å…¶åç»§ç»“ç‚¹ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eCONDITION(-2)\u003c/code\u003e - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹ \u003cstrong\u003eå¤„äºç­‰å¾…æ¡ä»¶çŠ¶æ€\u003c/strong\u003eï¼Œä¸ä¼šè¢«å½“ä½œæ˜¯åŒæ­¥é˜Ÿåˆ—ä¸Šçš„èŠ‚ç‚¹ï¼Œç›´åˆ°è¢«å”¤é†’(\u003ccode\u003esignal\u003c/code\u003e)ï¼Œè®¾ç½®å…¶å€¼ä¸º 0ï¼Œå†é‡æ–°è¿›å…¥é˜»å¡çŠ¶æ€ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePROPAGATE(-3)\u003c/code\u003e - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šä¸‹ä¸€ä¸ª \u003ccode\u003eacquireShared\u003c/code\u003e åº”æ— æ¡ä»¶ä¼ æ’­ã€‚\u003c/li\u003e\n\u003cli\u003e0 - éä»¥ä¸ŠçŠ¶æ€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾\"\u003e\u003ca href=\"#ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾\" class=\"headerlink\" title=\"ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾\"\u003e\u003c/a\u003eç‹¬å é”çš„è·å–å’Œé‡Šæ”¾\u003c/h4\u003e\u003ch5 id=\"è·å–ç‹¬å é”\"\u003e\u003ca href=\"#è·å–ç‹¬å é”\" class=\"headerlink\" title=\"è·å–ç‹¬å é”\"\u003e\u003c/a\u003eè·å–ç‹¬å é”\u003c/h5\u003e\u003cp\u003eAQS ä¸­ä½¿ç”¨ \u003ccode\u003eacquire(int arg)\u003c/code\u003e æ–¹æ³•è·å–ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eå…ˆå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼ŒAQS ä¼šä¸æ–­å°è¯•åˆ©ç”¨ CAS æ“ä½œå°†å½“å‰çº¿ç¨‹æ’å…¥ç­‰å¾…åŒæ­¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚\u003c/li\u003e\n\u003cli\u003eæ¥ç€ï¼Œä¸æ–­å°è¯•ä¸ºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹èŠ‚ç‚¹è·å–ç‹¬å é”ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javacore/concurrent/aqs_2.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javacore/concurrent/aqs_3.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003eè¯¦ç»†æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºï¼Œè¯·ç»“åˆæºç æ¥ç†è§£ï¼ˆä¸€å›¾èƒœåƒè¨€ï¼‰ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javacore/concurrent/aqs_4.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch5 id=\"é‡Šæ”¾ç‹¬å é”\"\u003e\u003ca href=\"#é‡Šæ”¾ç‹¬å é”\" class=\"headerlink\" title=\"é‡Šæ”¾ç‹¬å é”\"\u003e\u003c/a\u003eé‡Šæ”¾ç‹¬å é”\u003c/h5\u003e\u003cp\u003eAQS ä¸­ä½¿ç”¨ \u003ccode\u003erelease(int arg)\u003c/code\u003e æ–¹æ³•é‡Šæ”¾ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eå…ˆå°è¯•è·å–è§£é”çº¿ç¨‹çš„åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼ŒAQS ä¼šå°è¯•å”¤é†’å½“å‰çº¿ç¨‹èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch5 id=\"è·å–å¯ä¸­æ–­çš„ç‹¬å é”\"\u003e\u003ca href=\"#è·å–å¯ä¸­æ–­çš„ç‹¬å é”\" class=\"headerlink\" title=\"è·å–å¯ä¸­æ–­çš„ç‹¬å é”\"\u003e\u003c/a\u003eè·å–å¯ä¸­æ–­çš„ç‹¬å é”\u003c/h5\u003e\u003cp\u003eAQS ä¸­ä½¿ç”¨ \u003ccode\u003eacquireInterruptibly(int arg)\u003c/code\u003e æ–¹æ³•è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eacquireInterruptibly(int arg)\u003c/code\u003e å®ç°æ–¹å¼\u003cstrong\u003eç›¸è¾ƒäºè·å–ç‹¬å é”æ–¹æ³•ï¼ˆ \u003ccode\u003eacquire\u003c/code\u003eï¼‰éå¸¸ç›¸ä¼¼\u003c/strong\u003eï¼ŒåŒºåˆ«ä»…åœ¨äºå®ƒä¼š\u003cstrong\u003eé€šè¿‡ \u003ccode\u003eThread.interrupted\u003c/code\u003e æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­\u003c/strong\u003eï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç«‹å³æŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼ˆ\u003ccode\u003eInterruptedException\u003c/code\u003eï¼‰ã€‚\u003c/p\u003e\n\u003ch5 id=\"è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”\"\u003e\u003ca href=\"#è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”\" class=\"headerlink\" title=\"è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”\"\u003e\u003c/a\u003eè·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”\u003c/h5\u003e\u003cp\u003eAQS ä¸­ä½¿ç”¨ \u003ccode\u003etryAcquireNanos(int arg)\u003c/code\u003e æ–¹æ³•è·å–è¶…æ—¶ç­‰å¾…çš„ç‹¬å é”ã€‚\u003c/p\u003e\n\u003cp\u003edoAcquireNanos çš„å®ç°æ–¹å¼ \u003cstrong\u003eç›¸è¾ƒäºè·å–ç‹¬å é”æ–¹æ³•ï¼ˆ \u003ccode\u003eacquire\u003c/code\u003eï¼‰éå¸¸ç›¸ä¼¼\u003c/strong\u003eï¼ŒåŒºåˆ«åœ¨äºå®ƒä¼šæ ¹æ®è¶…æ—¶æ—¶é—´å’Œå½“å‰æ—¶é—´è®¡ç®—å‡ºæˆªæ­¢æ—¶é—´ã€‚åœ¨è·å–é”çš„æµç¨‹ä¸­ï¼Œä¼šä¸æ–­åˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œç›´æ¥è¿”å› falseï¼›å¦‚æœæ²¡è¶…æ—¶ï¼Œåˆ™ç”¨ \u003ccode\u003eLockSupport.parkNanos\u003c/code\u003e æ¥é˜»å¡å½“å‰çº¿ç¨‹ã€‚\u003c/p\u003e\n\u003ch4 id=\"å…±äº«é”çš„è·å–å’Œé‡Šæ”¾\"\u003e\u003ca href=\"#å…±äº«é”çš„è·å–å’Œé‡Šæ”¾\" class=\"headerlink\" title=\"å…±äº«é”çš„è·å–å’Œé‡Šæ”¾\"\u003e\u003c/a\u003eå…±äº«é”çš„è·å–å’Œé‡Šæ”¾\u003c/h4\u003e\u003ch5 id=\"è·å–å…±äº«é”\"\u003e\u003ca href=\"#è·å–å…±äº«é”\" class=\"headerlink\" title=\"è·å–å…±äº«é”\"\u003e\u003c/a\u003eè·å–å…±äº«é”\u003c/h5\u003e\u003cp\u003eAQS ä¸­ä½¿ç”¨ \u003ccode\u003eacquireShared(int arg)\u003c/code\u003e æ–¹æ³•è·å–å…±äº«é”ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eacquireShared\u003c/code\u003e æ–¹æ³•å’Œ \u003ccode\u003eacquire\u003c/code\u003e æ–¹æ³•çš„é€»è¾‘å¾ˆç›¸ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºè‡ªæ—‹çš„æ¡ä»¶ä»¥åŠèŠ‚ç‚¹å‡ºé˜Ÿçš„æ“ä½œæœ‰æ‰€ä¸åŒã€‚\u003c/p\u003e\n\u003cp\u003eæˆåŠŸè·å¾—å…±äº«é”çš„æ¡ä»¶å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003etryAcquireShared(arg)\u003c/code\u003e è¿”å›å€¼å¤§äºç­‰äº 0 ï¼ˆè¿™æ„å‘³ç€å…±äº«é”çš„ permit è¿˜æ²¡æœ‰ç”¨å®Œï¼‰ã€‚\u003c/li\u003e\n\u003cli\u003eå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"é‡Šæ”¾å…±äº«é”\"\u003e\u003ca href=\"#é‡Šæ”¾å…±äº«é”\" class=\"headerlink\" title=\"é‡Šæ”¾å…±äº«é”\"\u003e\u003c/a\u003eé‡Šæ”¾å…±äº«é”\u003c/h5\u003e\u003cp\u003eAQS ä¸­ä½¿ç”¨ \u003ccode\u003ereleaseShared(int arg)\u003c/code\u003e æ–¹æ³•é‡Šæ”¾å…±äº«é”ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ereleaseShared\u003c/code\u003e é¦–å…ˆä¼šå°è¯•é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è§£é”ä¸€ä¸ªæˆ–å¤šä¸ªåç»§çº¿ç¨‹èŠ‚ç‚¹ã€‚é‡Šæ”¾å…±äº«é”å’Œé‡Šæ”¾ç‹¬äº«é”æµç¨‹å¤§ä½“ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š\u003c/p\u003e\n\u003cp\u003eå¯¹äºç‹¬äº«æ¨¡å¼ï¼Œå¦‚æœéœ€è¦ SIGNALï¼Œé‡Šæ”¾ä»…ç›¸å½“äºè°ƒç”¨å¤´èŠ‚ç‚¹çš„ \u003ccode\u003eunparkSuccessor\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch5 id=\"è·å–å¯ä¸­æ–­çš„å…±äº«é”\"\u003e\u003ca href=\"#è·å–å¯ä¸­æ–­çš„å…±äº«é”\" class=\"headerlink\" title=\"è·å–å¯ä¸­æ–­çš„å…±äº«é”\"\u003e\u003c/a\u003eè·å–å¯ä¸­æ–­çš„å…±äº«é”\u003c/h5\u003e\u003cp\u003eAQS ä¸­ä½¿ç”¨ \u003ccode\u003eacquireSharedInterruptibly(int arg)\u003c/code\u003e æ–¹æ³•è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eacquireSharedInterruptibly\u003c/code\u003e æ–¹æ³•ä¸ \u003ccode\u003eacquireInterruptibly\u003c/code\u003e å‡ ä¹ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚\u003c/p\u003e\n\u003ch5 id=\"è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”\"\u003e\u003ca href=\"#è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”\" class=\"headerlink\" title=\"è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”\"\u003e\u003c/a\u003eè·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”\u003c/h5\u003e\u003cp\u003eAQS ä¸­ä½¿ç”¨ \u003ccode\u003etryAcquireSharedNanos(int arg)\u003c/code\u003e æ–¹æ³•è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003etryAcquireSharedNanos\u003c/code\u003e æ–¹æ³•ä¸ \u003ccode\u003etryAcquireNanos\u003c/code\u003e å‡ ä¹ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ­»é”\"\u003e\u003ca href=\"#æ­»é”\" class=\"headerlink\" title=\"æ­»é”\"\u003e\u003c/a\u003eæ­»é”\u003c/h2\u003e\u003ch3 id=\"ä»€ä¹ˆæ˜¯æ­»é”\"\u003e\u003ca href=\"#ä»€ä¹ˆæ˜¯æ­»é”\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯æ­»é”\"\u003e\u003c/a\u003eä»€ä¹ˆæ˜¯æ­»é”\u003c/h3\u003e\u003cp\u003eæ­»é”æ˜¯ä¸€ç§ç‰¹å®šçš„ç¨‹åºçŠ¶æ€ï¼Œåœ¨å®ä½“ä¹‹é—´ï¼Œç”±äºå¾ªç¯ä¾èµ–å¯¼è‡´å½¼æ­¤ä¸€ç›´å¤„äºç­‰å¾…ä¹‹ä¸­ï¼Œæ²¡æœ‰ä»»ä½•ä¸ªä½“å¯ä»¥ç»§ç»­å‰è¿›ã€‚æ­»é”ä¸ä»…ä»…æ˜¯åœ¨çº¿ç¨‹ä¹‹é—´ä¼šå‘ç”Ÿï¼Œå­˜åœ¨èµ„æºç‹¬å çš„è¿›ç¨‹ä¹‹é—´åŒæ ·ä¹Ÿ\u003cbr/\u003eå¯èƒ½å‡ºç°æ­»é”ã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å¤§å¤šæ˜¯èšç„¦åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­çš„æ­»é”ï¼ŒæŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œç”±äºäº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œè€Œæ°¸ä¹…å¤„äºé˜»å¡çš„çŠ¶æ€ã€‚\u003c/p\u003e\n\u003ch3 id=\"å¦‚ä½•å®šä½æ­»é”\"\u003e\u003ca href=\"#å¦‚ä½•å®šä½æ­»é”\" class=\"headerlink\" title=\"å¦‚ä½•å®šä½æ­»é”\"\u003e\u003c/a\u003eå¦‚ä½•å®šä½æ­»é”\u003c/h3\u003e\u003cp\u003eå®šä½æ­»é”æœ€å¸¸è§çš„æ–¹å¼å°±æ˜¯åˆ©ç”¨ jstack ç­‰å·¥å…·è·å–çº¿ç¨‹æ ˆï¼Œç„¶åå®šä½äº’ç›¸ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¿›è€Œæ‰¾åˆ°æ­»é”ã€‚å¦‚æœæ˜¯æ¯”è¾ƒæ˜æ˜¾çš„æ­»é”ï¼Œå¾€å¾€ jstack ç­‰å°±èƒ½ç›´æ¥å®šä½ï¼Œç±»ä¼¼ JConsole ç”šè‡³å¯ä»¥åœ¨å›¾å½¢ç•Œé¢è¿›è¡Œæœ‰é™çš„æ­»é”æ£€æµ‹ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœæˆ‘ä»¬æ˜¯å¼€å‘è‡ªå·±çš„ç®¡ç†å·¥å…·ï¼Œéœ€è¦ç”¨æ›´åŠ ç¨‹åºåŒ–çš„æ–¹å¼æ‰«ææœåŠ¡è¿›ç¨‹ã€å®šä½æ­»é”ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Java æä¾›çš„æ ‡å‡†ç®¡ç† APIï¼Œ\u003ccode\u003eThreadMXBean\u003c/code\u003eï¼Œå…¶ç›´æ¥å°±æä¾›äº† \u003ccode\u003efindDeadlockedThreads()\u003c/code\u003e æ–¹æ³•ç”¨äºå®šä½ã€‚\u003c/p\u003e\n\u003ch3 id=\"å¦‚ä½•é¿å…æ­»é”\"\u003e\u003ca href=\"#å¦‚ä½•é¿å…æ­»é”\" class=\"headerlink\" title=\"å¦‚ä½•é¿å…æ­»é”\"\u003e\u003c/a\u003eå¦‚ä½•é¿å…æ­»é”\u003c/h3\u003e\u003cp\u003eåŸºæœ¬ä¸Šæ­»é”çš„å‘ç”Ÿæ˜¯å› ä¸ºï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eäº’æ–¥ï¼Œç±»ä¼¼ Java ä¸­ Monitor éƒ½æ˜¯ç‹¬å çš„ã€‚\u003c/li\u003e\n\u003cli\u003eé•¿æœŸä¿æŒäº’æ–¥ï¼Œåœ¨ä½¿ç”¨ç»“æŸä¹‹å‰ï¼Œä¸ä¼šé‡Šæ”¾ï¼Œä¹Ÿä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æŠ¢å ã€‚\u003c/li\u003e\n\u003cli\u003eå¾ªç¯ä¾èµ–ï¼Œå¤šä¸ªä¸ªä½“ä¹‹é—´å‡ºç°äº†é”çš„å¾ªç¯ä¾èµ–ï¼Œå½¼æ­¤ä¾èµ–ä¸Šä¸€ç¯é‡Šæ”¾é”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºé¿å…æ­»é”çš„æ€è·¯å’Œæ–¹æ³•ã€‚\u003c/p\u003e\n\u003cp\u003eï¼ˆ1ï¼‰é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶è·å–å¤šä¸ªé”ã€‚\u003c/p\u003e\n\u003cp\u003eé¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨é”å†…åŒæ—¶å ç”¨å¤šä¸ªèµ„æºï¼Œå°½é‡ä¿è¯æ¯ä¸ªé”åªå ç”¨ä¸€ä¸ªèµ„æºã€‚\u003c/p\u003e\n\u003cp\u003eå°è¯•ä½¿ç”¨å®šæ—¶é” \u003ccode\u003elock.tryLock(timeout)\u003c/code\u003eï¼Œé¿å…é”ä¸€ç›´ä¸èƒ½é‡Šæ”¾ã€‚\u003c/p\u003e\n\u003cp\u003eå¯¹äºæ•°æ®åº“é”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥ä¸­é‡Œï¼Œå¦åˆ™ä¼šå‡ºç°è§£é”å¤±è´¥çš„æƒ…å†µã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒèµ„æ–™\"\u003e\u003ca href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"\u003e\u003c/a\u003eå‚è€ƒèµ„æ–™\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://book.douban.com/subject/10484692/\"\u003eã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://book.douban.com/subject/26591326/\"\u003eã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.cnblogs.com/dolphin0520/p/3923167.html\"\u003eJava å¹¶å‘ç¼–ç¨‹ï¼šLock\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://zhuanlan.zhihu.com/p/27134110\"\u003eæ·±å…¥å­¦ä¹  java åŒæ­¥å™¨ AQS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://t.hao0.me/java/2016/04/01/aqs.html\"\u003eAbstractQueuedSynchronizer æ¡†æ¶\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.cnblogs.com/qifengshi/p/6831055.html\"\u003eJava ä¸­çš„é”åˆ†ç±»\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-12-26T15:11:52Z",
  "Author": "é’æ‚Ÿ â—¾ Dunwu"
}