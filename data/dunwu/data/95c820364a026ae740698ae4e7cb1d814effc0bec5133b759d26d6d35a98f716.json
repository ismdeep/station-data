{
  "Source": "dunwu",
  "Title": "时间服务器 - NTP",
  "Link": "https://dunwu.github.io/blog/pages/f50fdb/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"时间服务器-NTP\"\u003e\u003ca href=\"#时间服务器-NTP\" class=\"headerlink\" title=\"时间服务器 - NTP\"\u003e\u003c/a\u003e时间服务器 - NTP\u003c/h1\u003e\u003ch2 id=\"NTP-简介\"\u003e\u003ca href=\"#NTP-简介\" class=\"headerlink\" title=\"NTP 简介\"\u003e\u003c/a\u003eNTP 简介\u003c/h2\u003e\u003cp\u003e网络时间协议（英语：Network Time Protocol，缩写：NTP）是在数据网络潜伏时间可变的计算机系统之间通过分组交换进行时钟同步的一个网络协议，位于 OSI 模型的应用层。自 1985 年以来，NTP 是目前仍在使用的最古老的互联网协议之一。NTP 由特拉华大学的 David L. Mills（英语：David L. Mills）设计。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNTP 意图将所有参与计算机的协调世界时（UTC）时间同步到几毫秒的误差内\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003eNTP 要点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e地球共有 24 个时区，而以格林威治时间 (GMT) 为标准时间；\u003c/li\u003e\n\u003cli\u003e中国本地时间为 GMT +8 小时；\u003c/li\u003e\n\u003cli\u003e最准确的时间为使用原子钟 (Atomic clock) 所计算的，例如 UTC (Coordinated Universal Time) 就是一例；\u003c/li\u003e\n\u003cli\u003eLinux 系统本来就有两种时间，一种是 Linux 以 \u003ccode\u003e1970/01/01\u003c/code\u003e 开始计数的系统时间，一种则是 BIOS 记载的硬件时间；\u003c/li\u003e\n\u003cli\u003eLinux 可以透过网络校时，最常见的网络校时为使用 NTP 服务器，这个服务启动在 \u003ccode\u003eudp port 123\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003e时区档案主要放置于 \u003ccode\u003e/usr/share/zoneinfo/\u003c/code\u003e 目录下，而本地时区则参考 \u003ccode\u003e/etc/localtime\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003eNTP 服务器为一种阶层式的服务，所以 NTP 服务器本来就会与上层时间服务器作时间的同步化， 因此 \u003ccode\u003enptd\u003c/code\u003e 与 \u003ccode\u003entpdate\u003c/code\u003e 两个指令不可同时使用；\u003c/li\u003e\n\u003cli\u003eNTP 服务器的联机状态可以使用 \u003ccode\u003entpstat\u003c/code\u003e 及 \u003ccode\u003entpq -p\u003c/code\u003e 来查询；\u003c/li\u003e\n\u003cli\u003eNTP 提供的客户端软件为 \u003ccode\u003entpdate\u003c/code\u003e 这个指令；\u003c/li\u003e\n\u003cli\u003e在 Linux 下想要手动处理时间时，需以 \u003ccode\u003edate\u003c/code\u003e 设定时间后，以 \u003ccode\u003ehwclock -w\u003c/code\u003e 来写入 BIOS 所记录的时间。\u003c/li\u003e\n\u003cli\u003eNTP 服务器之间的时间误差不可超过 1000 秒，否则 NTP 服务会自动关闭。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e更多 NTP 详情可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://cn.linux.vbird.org/linux_server/0440ntp.php\"\u003e鸟哥的 Linux 私房菜– NTP 时间服务器\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"ntpd-服务\"\u003e\u003ca href=\"#ntpd-服务\" class=\"headerlink\" title=\"ntpd 服务\"\u003e\u003c/a\u003entpd 服务\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e环境：CentOS\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"yum-安装\"\u003e\u003ca href=\"#yum-安装\" class=\"headerlink\" title=\"yum 安装\"\u003e\u003c/a\u003eyum 安装\u003c/h3\u003e\u003cp\u003eCentOS 安装 NTP 很简单，执行以下命令即可：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eyum -y install ntp\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"ntpd-配置\"\u003e\u003ca href=\"#ntpd-配置\" class=\"headerlink\" title=\"ntpd 配置\"\u003e\u003c/a\u003entpd 配置\u003c/h3\u003e\u003cp\u003entp 的配置文件路径为： \u003ccode\u003e/etc/ntp.conf\u003c/code\u003e ，参考配置：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e1. 先处理权限方面的问题，包括放行上层服务器以及开放区网用户来源：\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003erestrict default kod nomodify notrap nopeer noquery     \u003cspan class=\"comment\"\u003e# 拒绝 IPv4 的用户\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003erestrict -6 default kod nomodify notrap nopeer noquery  \u003cspan class=\"comment\"\u003e# 拒绝 IPv6 的用户\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003erestrict default nomodify notrap nopeer noquery\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e#\u003c/span\u003e\u003cspan class=\"language-bash\"\u003erestrict 192.168.100.0 mask 255.255.255.0 nomodify \u003cspan class=\"comment\"\u003e# 放行同局域网来源（根据网关和子网掩码决定）\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003erestrict 127.0.0.1   # 默认值，放行本机 IPv4 来源\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003erestrict ::1         # 默认值，放行本机 IPv6 来源\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e2. 设定 NTP 主机来源\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e注释掉默认 NTP 来源\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eserver 0.centos.pool.ntp.org iburst\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eserver 1.centos.pool.ntp.org iburst\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eserver 2.centos.pool.ntp.org iburst\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eserver 3.centos.pool.ntp.org iburst\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e设置国内 NTP 来源\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eserver cn.pool.ntp.org prefer # 以这个主机为优先\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eserver ntp1.aliyun.com\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eserver ntp.sjtu.edu.cn\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e3. 预设时间差异分析档案与暂不用到的 keys 等，不需要更改它：\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edriftfile /var/lib/ntp/drift\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ekeys /etc/ntp/keys\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eincludefile /etc/ntp/crypto/pw\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e注意：如果更改配置，必须重启 NTP 服务（\u003ccode\u003esystemctl restart ntpd\u003c/code\u003e）才能生效。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"放开防火墙限制\"\u003e\u003ca href=\"#放开防火墙限制\" class=\"headerlink\" title=\"放开防火墙限制\"\u003e\u003c/a\u003e放开防火墙限制\u003c/h3\u003e\u003cp\u003eNTP 服务的端口是 \u003ccode\u003e123\u003c/code\u003e，使用的是 udp 协议，所以 NTP 服务器的防火墙必须对外开放 udp 123 这个端口。\u003c/p\u003e\n\u003cp\u003e如果防火墙使用 **\u003ccode\u003eiptables\u003c/code\u003e**，执行以下命令：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eiptables -A INPUT -p UDP -i eth0 -s 192.168.0.0/24 --dport 123 -j ACCEPT\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e如果防火墙使用 **\u003ccode\u003efirewalld\u003c/code\u003e**，执行以下命令：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003efirewall-cmd --zone=public --add-port=123/udp --permanent\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"ntpd-服务命令\"\u003e\u003ca href=\"#ntpd-服务命令\" class=\"headerlink\" title=\"ntpd 服务命令\"\u003e\u003c/a\u003entpd 服务命令\u003c/h3\u003e\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esystemctl enable ntpd.service  # 开启服务（开机自动启动服务）\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esystemctl disable ntpd.service # 关闭服务（开机不会自动启动服务）\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esystemctl start ntpd.service   # 启动服务\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esystemctl stop ntpd.service    # 停止服务\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esystemctl restart ntpd.service # 重启服务\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esystemctl reload ntpd.service  # 重新载入配置\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esystemctl status ntpd.service  # 查看服务状态\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"查看-ntp-服务状态\"\u003e\u003ca href=\"#查看-ntp-服务状态\" class=\"headerlink\" title=\"查看 ntp 服务状态\"\u003e\u003c/a\u003e查看 ntp 服务状态\u003c/h3\u003e\u003ch4 id=\"验证-NTP-服务正常工作\"\u003e\u003ca href=\"#验证-NTP-服务正常工作\" class=\"headerlink\" title=\"验证 NTP 服务正常工作\"\u003e\u003c/a\u003e验证 NTP 服务正常工作\u003c/h4\u003e\u003cp\u003e执行 \u003ccode\u003entpstat\u003c/code\u003e 可以查看 ntp 服务器有无和上层 ntp 连通，，如果成功，可以看到类似以下的内容：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003entpstat\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esynchronised to NTP server (5.79.108.34) at stratum 3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   time correct to within 1129 ms\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   polling server every 64 s\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"查看-ntp-服务器与上层-ntp-的状态\"\u003e\u003ca href=\"#查看-ntp-服务器与上层-ntp-的状态\" class=\"headerlink\" title=\"查看 ntp 服务器与上层 ntp 的状态\"\u003e\u003c/a\u003e查看 ntp 服务器与上层 ntp 的状态\u003c/h4\u003e\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003entpq -p\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     remote           refid      st t when poll reach   delay   offset  jitter\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e==============================================================================\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e*ntp1.ams1.nl.le 130.133.1.10     2 u   36   64  367  230.801    5.271   2.791\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e 120.25.115.20   10.137.53.7      2 u   33   64  377   25.930   15.908   3.168\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e time.cloudflare 10.21.8.251      3 u   31   64  367  251.109   16.976   3.264\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"ntpdate-命令\"\u003e\u003ca href=\"#ntpdate-命令\" class=\"headerlink\" title=\"ntpdate 命令\"\u003e\u003c/a\u003entpdate 命令\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e注意：NTP 服务器为一种阶层式的服务，所以 NTP 服务器本来就会与上层时间服务器作时间的同步化， 因此 \u003ccode\u003enptd\u003c/code\u003e 与 \u003ccode\u003entpdate\u003c/code\u003e 两个指令不可同时使用。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"手动执行时间同步\"\u003e\u003ca href=\"#手动执行时间同步\" class=\"headerlink\" title=\"手动执行时间同步\"\u003e\u003c/a\u003e手动执行时间同步\u003c/h3\u003e\u003cp\u003e\u003ccode\u003entpdate\u003c/code\u003e 命令是 NTP 的客户端软件，它可以用于请求时间同步。\u003c/p\u003e\n\u003cp\u003e语法：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e/usr/sbin/ntpdate \u0026lt;ntp_server\u0026gt;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003ccode\u003entp_server\u003c/code\u003e 可以从 [国内 NTP 服务器](#国内 NTP 服务器) 中选择。\u003c/p\u003e\n\u003cp\u003e示例：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e$ \u003c/span\u003e\u003cspan class=\"language-bash\"\u003entpdate cn.pool.ntp.org\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11 Feb 10:47:12 ntpdate[30423]: step time server 84.16.73.33 offset -49.894774 sec\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"自动定时同步时间\"\u003e\u003ca href=\"#自动定时同步时间\" class=\"headerlink\" title=\"自动定时同步时间\"\u003e\u003c/a\u003e自动定时同步时间\u003c/h3\u003e\u003cp\u003e如果需要自动定时同步时间，可以利用 \u003ca href=\"#crontab\"\u003eCrontab\u003c/a\u003e 工具。本质就是用 crontab 定时执行一次手动时间同步命令 ntp。\u003c/p\u003e\n\u003cp\u003e示例：执行如下命令，就可以在每天凌晨 3 点同步系统时间：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eecho \u0026#34;0 3 * * * /usr/sbin/ntpdate cn.pool.ntp.org\u0026#34; \u0026gt;\u0026gt; /etc/crontab # 修改 crond 服务配置\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esystemctl restart crond # 重启 crond 服务以生效\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"四、国内-NTP-服务器\"\u003e\u003ca href=\"#四、国内-NTP-服务器\" class=\"headerlink\" title=\"四、国内 NTP 服务器\"\u003e\u003c/a\u003e四、国内 NTP 服务器\u003c/h2\u003e\u003cp\u003e以下 NTP 服务器搜集自网络：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecn.pool.ntp.org  # 最常用的国内NTP服务器，参考：https://www.ntppool.org/zh/use.html\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecn.ntp.org.cn    # 中国\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eedu.ntp.org.cn   # 中国教育网\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003entp1.aliyun.com  # 阿里云\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003entp2.aliyun.com  # 阿里云\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003entp.sjtu.edu.cn  # 上海交通大学\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es1a.time.edu.cn  # 北京邮电大学\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es1b.time.edu.cn  # 清华大学\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es1c.time.edu.cn  # 北京大学\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es1d.time.edu.cn  # 东南大学\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es1e.time.edu.cn  # 清华大学\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2a.time.edu.cn  # 清华大学\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2b.time.edu.cn  # 清华大学\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2c.time.edu.cn  # 北京邮电大学\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2d.time.edu.cn  # 西南地区网络中心\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2e.time.edu.cn  # 西北地区网络中心\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2f.time.edu.cn  # 东北地区网络中心\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2g.time.edu.cn  # 华东南地区网络中心\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2h.time.edu.cn  # 四川大学网络管理中心\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2j.time.edu.cn  # 大连理工大学网络中心\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003es2k.time.edu.cn  # CERNET桂林主节点\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"参考资料\"\u003e\u003ca href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"\u003e\u003c/a\u003e参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://cn.linux.vbird.org/linux_server/0440ntp.php\"\u003e鸟哥的 Linux 私房菜– NTP 时间服务器\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.cnblogs.com/quchunhui/p/7658853.html\"\u003eLinux 配置 ntp 时间服务器\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-02-11T05:11:00Z",
  "Author": "钝悟 ◾ Dunwu"
}