{
  "Source": "dunwu",
  "Title": "Tomcat å¿«é€Ÿå…¥é—¨",
  "Link": "https://dunwu.github.io/blog/pages/4a4c02/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"Tomcat-å¿«é€Ÿå…¥é—¨\"\u003e\u003ca href=\"#Tomcat-å¿«é€Ÿå…¥é—¨\" class=\"headerlink\" title=\"Tomcat å¿«é€Ÿå…¥é—¨\"\u003e\u003c/a\u003eTomcat å¿«é€Ÿå…¥é—¨\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003eğŸ ç‰ˆæœ¬è¯´æ˜\u003c/p\u003e\n\u003cp\u003eå½“å‰æœ€æ–°ç‰ˆæœ¬ï¼šTomcat 8.5.24\u003c/p\u003e\n\u003cp\u003eç¯å¢ƒè¦æ±‚ï¼šJDK7+\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"1-Tomcat-ç®€ä»‹\"\u003e\u003ca href=\"#1-Tomcat-ç®€ä»‹\" class=\"headerlink\" title=\"1. Tomcat ç®€ä»‹\"\u003e\u003c/a\u003e1. Tomcat ç®€ä»‹\u003c/h2\u003e\u003ch3 id=\"1-1-Tomcat-æ˜¯ä»€ä¹ˆ\"\u003e\u003ca href=\"#1-1-Tomcat-æ˜¯ä»€ä¹ˆ\" class=\"headerlink\" title=\"1.1. Tomcat æ˜¯ä»€ä¹ˆ\"\u003e\u003c/a\u003e1.1. Tomcat æ˜¯ä»€ä¹ˆ\u003c/h3\u003e\u003cp\u003eTomcat æ˜¯ç”± Apache å¼€å‘çš„ä¸€ä¸ª Servlet å®¹å™¨ï¼Œå®ç°äº†å¯¹ Servlet å’Œ JSP çš„æ”¯æŒï¼Œå¹¶æä¾›äº†ä½œä¸º Web æœåŠ¡å™¨çš„ä¸€äº›ç‰¹æœ‰åŠŸèƒ½ï¼Œå¦‚ Tomcat ç®¡ç†å’Œæ§åˆ¶å¹³å°ã€å®‰å…¨åŸŸç®¡ç†å’Œ Tomcat é˜€ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eç”±äº Tomcat æœ¬èº«ä¹Ÿå†…å«äº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒä¹Ÿå¯ä»¥è¢«è§†ä½œä¸€ä¸ªå•ç‹¬çš„ Web æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œä¸èƒ½å°† Tomcat å’Œ Apache HTTP æœåŠ¡å™¨æ··æ·†ï¼ŒApache HTTP æœåŠ¡å™¨æ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€å®ç°çš„ HTTP Web æœåŠ¡å™¨ï¼›è¿™ä¸¤ä¸ª HTTP web server ä¸æ˜¯æ†ç»‘åœ¨ä¸€èµ·çš„ã€‚Tomcat åŒ…å«äº†ä¸€ä¸ªé…ç½®ç®¡ç†å·¥å…·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¾‘ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶æ¥è¿›è¡Œé…ç½®ã€‚\u003c/p\u003e\n\u003ch3 id=\"1-2-Tomcat-é‡è¦ç›®å½•\"\u003e\u003ca href=\"#1-2-Tomcat-é‡è¦ç›®å½•\" class=\"headerlink\" title=\"1.2. Tomcat é‡è¦ç›®å½•\"\u003e\u003c/a\u003e1.2. Tomcat é‡è¦ç›®å½•\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e/bin\u003c/strong\u003e - Tomcat è„šæœ¬å­˜æ”¾ç›®å½•ï¼ˆå¦‚å¯åŠ¨ã€å…³é—­è„šæœ¬ï¼‰ã€‚ \u003ccode\u003e*.sh\u003c/code\u003e æ–‡ä»¶ç”¨äº Unix ç³»ç»Ÿï¼› \u003ccode\u003e*.bat\u003c/code\u003e æ–‡ä»¶ç”¨äº Windows ç³»ç»Ÿã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/conf\u003c/strong\u003e - Tomcat é…ç½®æ–‡ä»¶ç›®å½•ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/logs\u003c/strong\u003e - Tomcat é»˜è®¤æ—¥å¿—ç›®å½•ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e/webapps\u003c/strong\u003e - webapp è¿è¡Œçš„ç›®å½•ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"1-3-web-å·¥ç¨‹å‘å¸ƒç›®å½•ç»“æ„\"\u003e\u003ca href=\"#1-3-web-å·¥ç¨‹å‘å¸ƒç›®å½•ç»“æ„\" class=\"headerlink\" title=\"1.3. web å·¥ç¨‹å‘å¸ƒç›®å½•ç»“æ„\"\u003e\u003c/a\u003e1.3. web å·¥ç¨‹å‘å¸ƒç›®å½•ç»“æ„\u003c/h3\u003e\u003cp\u003eä¸€èˆ¬ web é¡¹ç›®è·¯å¾„ç»“æ„\u003c/p\u003e\n\u003cfigure class=\"highlight gherkin\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e|\u003cspan class=\"string\"\u003e-- webapp                         # ç«™ç‚¹æ ¹ç›®å½•\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e-- META-INF                   # META-INF ç›®å½•\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e   `-- MANIFEST.MF            # é…ç½®æ¸…å•æ–‡ä»¶\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e-- WEB-INF                    # WEB-INF ç›®å½•\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e   \u003c/span\u003e|\u003cspan class=\"string\"\u003e-- classes                # classæ–‡ä»¶ç›®å½•\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e   \u003c/span\u003e|\u003cspan class=\"string\"\u003e   \u003c/span\u003e|\u003cspan class=\"string\"\u003e-- *.class            # ç¨‹åºéœ€è¦çš„ class æ–‡ä»¶\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e   \u003c/span\u003e|\u003cspan class=\"string\"\u003e   `-- *.xml              # ç¨‹åºéœ€è¦çš„ xml æ–‡ä»¶\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e   \u003c/span\u003e|\u003cspan class=\"string\"\u003e-- lib                    # åº“æ–‡ä»¶å¤¹\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e   \u003c/span\u003e|\u003cspan class=\"string\"\u003e   `-- *.jar              # ç¨‹åºéœ€è¦çš„ jar åŒ…\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e   `-- web.xml                # Webåº”ç”¨ç¨‹åºçš„éƒ¨ç½²æè¿°æ–‡ä»¶\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e-- \u0026lt;userdir\u0026gt;                  # è‡ªå®šä¹‰çš„ç›®å½•\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u003c/span\u003e|\u003cspan class=\"string\"\u003e-- \u0026lt;userfiles\u0026gt;                # è‡ªå®šä¹‰çš„èµ„æºæ–‡ä»¶\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003ewebapp\u003c/code\u003eï¼šå·¥ç¨‹å‘å¸ƒæ–‡ä»¶å¤¹ã€‚å…¶å®æ¯ä¸ª war åŒ…éƒ½å¯ä»¥è§†ä¸º webapp çš„å‹ç¼©åŒ…ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eMETA-INF\u003c/code\u003eï¼šMETA-INF ç›®å½•ç”¨äºå­˜æ”¾å·¥ç¨‹è‡ªèº«ç›¸å…³çš„ä¸€äº›ä¿¡æ¯ï¼Œå…ƒæ–‡ä»¶ä¿¡æ¯ï¼Œé€šå¸¸ç”±å¼€å‘å·¥å…·ï¼Œç¯å¢ƒè‡ªåŠ¨ç”Ÿæˆã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eWEB-INF\u003c/code\u003eï¼šJava web åº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚æ‰€è°“å®‰å…¨å°±æ˜¯å®¢æˆ·ç«¯æ— æ³•è®¿é—®ï¼Œåªæœ‰æœåŠ¡ç«¯å¯ä»¥è®¿é—®çš„ç›®å½•ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003e/WEB-INF/classes\u003c/code\u003eï¼šå­˜æ”¾ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰ Java class æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003e/WEB-INF/lib\u003c/code\u003eï¼šå­˜æ”¾ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰ jar æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003e/WEB-INF/web.xml\u003c/code\u003eï¼šweb åº”ç”¨çš„éƒ¨ç½²é…ç½®æ–‡ä»¶ã€‚å®ƒæ˜¯å·¥ç¨‹ä¸­æœ€é‡è¦çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒæè¿°äº† servlet å’Œç»„æˆåº”ç”¨çš„å…¶å®ƒç»„ä»¶ï¼Œä»¥åŠåº”ç”¨åˆå§‹åŒ–å‚æ•°ã€å®‰å…¨ç®¡ç†çº¦æŸç­‰ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"1-4-Tomcat-åŠŸèƒ½\"\u003e\u003ca href=\"#1-4-Tomcat-åŠŸèƒ½\" class=\"headerlink\" title=\"1.4. Tomcat åŠŸèƒ½\"\u003e\u003c/a\u003e1.4. Tomcat åŠŸèƒ½\u003c/h3\u003e\u003cp\u003eTomcat æ”¯æŒçš„ I/O æ¨¡å‹æœ‰ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNIOï¼šéé˜»å¡ I/Oï¼Œé‡‡ç”¨ Java NIO ç±»åº“å®ç°ã€‚\u003c/li\u003e\n\u003cli\u003eNIO2ï¼šå¼‚æ­¥ I/Oï¼Œé‡‡ç”¨ JDK 7 æœ€æ–°çš„ NIO2 ç±»åº“å®ç°ã€‚\u003c/li\u003e\n\u003cli\u003eAPRï¼šé‡‡ç”¨ Apache å¯ç§»æ¤è¿è¡Œåº“å®ç°ï¼Œæ˜¯ C/C++ ç¼–å†™çš„æœ¬åœ°åº“ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTomcat æ”¯æŒçš„åº”ç”¨å±‚åè®®æœ‰ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHTTP/1.1ï¼šè¿™æ˜¯å¤§éƒ¨åˆ† Web åº”ç”¨é‡‡ç”¨çš„è®¿é—®åè®®ã€‚\u003c/li\u003e\n\u003cli\u003eAJPï¼šç”¨äºå’Œ Web æœåŠ¡å™¨é›†æˆï¼ˆå¦‚ Apacheï¼‰ã€‚\u003c/li\u003e\n\u003cli\u003eHTTP/2ï¼šHTTP 2.0 å¤§å¹…åº¦çš„æå‡äº† Web æ€§èƒ½ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"2-Tomcat-å…¥é—¨\"\u003e\u003ca href=\"#2-Tomcat-å…¥é—¨\" class=\"headerlink\" title=\"2. Tomcat å…¥é—¨\"\u003e\u003c/a\u003e2. Tomcat å…¥é—¨\u003c/h2\u003e\u003ch3 id=\"2-1-å®‰è£…\"\u003e\u003ca href=\"#2-1-å®‰è£…\" class=\"headerlink\" title=\"2.1. å®‰è£…\"\u003e\u003c/a\u003e2.1. å®‰è£…\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eå‰ææ¡ä»¶\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eTomcat 8.5 è¦æ±‚ JDK ç‰ˆæœ¬ä¸º 1.7 ä»¥ä¸Šã€‚\u003c/p\u003e\n\u003cp\u003eè¿›å…¥ \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://tomcat.apache.org/download-80.cgi\"\u003eTomcat å®˜æ–¹ä¸‹è½½åœ°å€\u003c/a\u003e é€‰æ‹©åˆé€‚ç‰ˆæœ¬ä¸‹è½½ï¼Œå¹¶è§£å‹åˆ°æœ¬åœ°ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWindows\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eæ·»åŠ ç¯å¢ƒå˜é‡ \u003ccode\u003eCATALINA_HOME\u003c/code\u003e ï¼Œå€¼ä¸º Tomcat çš„å®‰è£…è·¯å¾„ã€‚\u003c/p\u003e\n\u003cp\u003eè¿›å…¥å®‰è£…ç›®å½•ä¸‹çš„ bin ç›®å½•ï¼Œè¿è¡Œ startup.bat æ–‡ä»¶ï¼Œå¯åŠ¨ Tomcat\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eLinux / Unix\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eä¸‹é¢çš„ç¤ºä¾‹ä»¥ 8.5.24 ç‰ˆæœ¬ä¸ºä¾‹ï¼ŒåŒ…å«äº†ä¸‹è½½ã€è§£å‹ã€å¯åŠ¨æ“ä½œã€‚\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# ä¸‹è½½è§£å‹åˆ°æœ¬åœ°\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewget http://mirrors.hust.edu.cn/apache/tomcat/tomcat-8/v8.5.24/bin/apache-tomcat-8.5.24.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003etar -zxf apache-tomcat-8.5.24.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# å¯åŠ¨ Tomcat\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e./apache-tomcat-8.5.24/bin/startup.sh\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eå¯åŠ¨åï¼Œè®¿é—® \u003ccode\u003ehttp://localhost:8080\u003c/code\u003e ï¼Œå¯ä»¥çœ‹åˆ° Tomcat å®‰è£…æˆåŠŸçš„æµ‹è¯•é¡µé¢ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/tomcat.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"2-2-é…ç½®\"\u003e\u003ca href=\"#2-2-é…ç½®\" class=\"headerlink\" title=\"2.2. é…ç½®\"\u003e\u003c/a\u003e2.2. é…ç½®\u003c/h3\u003e\u003cp\u003eæœ¬èŠ‚å°†åˆ—ä¸¾ä¸€äº›é‡è¦ã€å¸¸è§çš„é…ç½®é¡¹ã€‚è¯¦ç»†çš„ Tomcat8 é…ç½®å¯ä»¥å‚è€ƒ \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://tomcat.apache.org/tomcat-8.5-doc/config/index.html\"\u003eTomcat 8 é…ç½®å®˜æ–¹å‚è€ƒæ–‡æ¡£\u003c/a\u003e ã€‚\u003c/p\u003e\n\u003ch4 id=\"2-2-1-Server\"\u003e\u003ca href=\"#2-2-1-Server\" class=\"headerlink\" title=\"2.2.1. Server\"\u003e\u003c/a\u003e2.2.1. Server\u003c/h4\u003e\u003cblockquote\u003e\n\u003cp\u003eServer å…ƒç´ è¡¨ç¤ºæ•´ä¸ª Catalina servlet å®¹å™¨ã€‚\u003c/p\u003e\n\u003cp\u003eå› æ­¤ï¼Œå®ƒå¿…é¡»æ˜¯ \u003ccode\u003econf/server.xml\u003c/code\u003e é…ç½®æ–‡ä»¶ä¸­çš„æ ¹å…ƒç´ ã€‚å®ƒçš„å±æ€§ä»£è¡¨äº†æ•´ä¸ª servlet å®¹å™¨çš„ç‰¹æ€§ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eå±æ€§è¡¨\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eå±æ€§\u003c/th\u003e\n\u003cth\u003eæè¿°\u003c/th\u003e\n\u003cth\u003eå¤‡æ³¨\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eclassName\u003c/td\u003e\n\u003ctd\u003eè¿™ä¸ªç±»å¿…é¡»å®ç° org.apache.catalina.Server æ¥å£ã€‚\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ org.apache.catalina.core.StandardServer\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eaddress\u003c/td\u003e\n\u003ctd\u003eæœåŠ¡å™¨ç­‰å¾…å…³æœºå‘½ä»¤çš„ TCP / IP åœ°å€ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šåœ°å€ï¼Œåˆ™ä½¿ç”¨ localhostã€‚\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eport\u003c/td\u003e\n\u003ctd\u003eæœåŠ¡å™¨ç­‰å¾…å…³æœºå‘½ä»¤çš„ TCP / IP ç«¯å£å·ã€‚è®¾ç½®ä¸º-1 ä»¥ç¦ç”¨å…³é—­ç«¯å£ã€‚\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eshutdown\u003c/td\u003e\n\u003ctd\u003eå¿…é¡»é€šè¿‡ TCP / IP è¿æ¥æ¥æ”¶åˆ°æŒ‡å®šç«¯å£å·çš„å‘½ä»¤å­—ç¬¦ä¸²ï¼Œä»¥å…³é—­ Tomcatã€‚\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch4 id=\"2-2-2-Service\"\u003e\u003ca href=\"#2-2-2-Service\" class=\"headerlink\" title=\"2.2.2. Service\"\u003e\u003c/a\u003e2.2.2. Service\u003c/h4\u003e\u003cblockquote\u003e\n\u003cp\u003eService å…ƒç´ è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥å™¨ç»„ä»¶çš„ç»„åˆï¼Œè¿™äº›ç»„ä»¶å…±äº«ä¸€ä¸ªç”¨äºå¤„ç†ä¼ å…¥è¯·æ±‚çš„å¼•æ“ç»„ä»¶ã€‚Server ä¸­å¯ä»¥æœ‰å¤šä¸ª Serviceã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eå±æ€§è¡¨\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eå±æ€§\u003c/th\u003e\n\u003cth\u003eæè¿°\u003c/th\u003e\n\u003cth\u003eå¤‡æ³¨\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eclassName\u003c/td\u003e\n\u003ctd\u003eè¿™ä¸ªç±»å¿…é¡»å®ç°\u003ccode\u003eorg.apache.catalina.Service\u003c/code\u003eæ¥å£ã€‚\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ \u003ccode\u003eorg.apache.catalina.core.StandardService\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ename\u003c/td\u003e\n\u003ctd\u003eæ­¤æœåŠ¡çš„æ˜¾ç¤ºåç§°ï¼Œå¦‚æœæ‚¨ä½¿ç”¨æ ‡å‡† Catalina ç»„ä»¶ï¼Œå°†åŒ…å«åœ¨æ—¥å¿—æ¶ˆæ¯ä¸­ã€‚ä¸ç‰¹å®šæœåŠ¡å™¨å…³è”çš„æ¯ä¸ªæœåŠ¡çš„åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003eå®ä¾‹ - \u003ccode\u003econf/server.xml\u003c/code\u003e é…ç½®æ–‡ä»¶ç¤ºä¾‹\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e\u0026lt;?xml version=\u003cspan class=\"string\"\u003e\u0026#34;1.0\u0026#34;\u003c/span\u003e encoding=\u003cspan class=\"string\"\u003e\u0026#34;UTF-8\u0026#34;\u003c/span\u003e?\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eServer\u003c/span\u003e \u003cspan class=\"attr\"\u003eport\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;8080\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003eshutdown\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;SHUTDOWN\u0026#34;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eService\u003c/span\u003e \u003cspan class=\"attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;xxx\u0026#34;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  ...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eService\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eServer\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"2-2-3-Executor\"\u003e\u003ca href=\"#2-2-3-Executor\" class=\"headerlink\" title=\"2.2.3. Executor\"\u003e\u003c/a\u003e2.2.3. Executor\u003c/h4\u003e\u003cblockquote\u003e\n\u003cp\u003eExecutor è¡¨ç¤ºå¯ä»¥åœ¨ Tomcat ä¸­çš„ç»„ä»¶ä¹‹é—´å…±äº«çš„çº¿ç¨‹æ± ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eå±æ€§è¡¨\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eå±æ€§\u003c/th\u003e\n\u003cth\u003eæè¿°\u003c/th\u003e\n\u003cth\u003eå¤‡æ³¨\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eclassName\u003c/td\u003e\n\u003ctd\u003eè¿™ä¸ªç±»å¿…é¡»å®ç°\u003ccode\u003eorg.apache.catalina.Executor\u003c/code\u003eæ¥å£ã€‚\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ \u003ccode\u003eorg.apache.catalina.core.StandardThreadExecutor\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ename\u003c/td\u003e\n\u003ctd\u003eçº¿ç¨‹æ± åç§°ã€‚\u003c/td\u003e\n\u003ctd\u003eè¦æ±‚å”¯ä¸€, ä¾› Connector å…ƒç´ çš„ executor å±æ€§ä½¿ç”¨\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003enamePrefix\u003c/td\u003e\n\u003ctd\u003eçº¿ç¨‹åç§°å‰ç¼€ã€‚\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emaxThreads\u003c/td\u003e\n\u003ctd\u003eæœ€å¤§æ´»è·ƒçº¿ç¨‹æ•°ã€‚\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ 200\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eminSpareThreads\u003c/td\u003e\n\u003ctd\u003eæœ€å°æ´»è·ƒçº¿ç¨‹æ•°ã€‚\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ 25\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emaxIdleTime\u003c/td\u003e\n\u003ctd\u003eå½“å‰æ´»è·ƒçº¿ç¨‹å¤§äº minSpareThreads æ—¶,ç©ºé—²çº¿ç¨‹å…³é—­çš„ç­‰å¾…æœ€å¤§æ—¶é—´ã€‚\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ 60000ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emaxQueueSize\u003c/td\u003e\n\u003ctd\u003eçº¿ç¨‹æ± æ»¡æƒ…å†µä¸‹çš„è¯·æ±‚æ’é˜Ÿå¤§å°ã€‚\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ Integer.MAX_VALUE\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eService\u003c/span\u003e \u003cspan class=\"attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;xxx\u0026#34;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eExecutor\u003c/span\u003e \u003cspan class=\"attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;tomcatThreadPool\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003enamePrefix\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;catalina-exec-\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003emaxThreads\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;300\u0026#34;\u003c/span\u003e \u003cspan class=\"attr\"\u003eminSpareThreads\u003c/span\u003e=\u003cspan class=\"string\"\u003e\u0026#34;25\u0026#34;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eService\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"2-2-4-Connector\"\u003e\u003ca href=\"#2-2-4-Connector\" class=\"headerlink\" title=\"2.2.4. Connector\"\u003e\u003c/a\u003e2.2.4. Connector\u003c/h4\u003e\u003cblockquote\u003e\n\u003cp\u003eConnector ä»£è¡¨è¿æ¥ç»„ä»¶ã€‚Tomcat æ”¯æŒä¸‰ç§åè®®ï¼šHTTP/1.1ã€HTTP/2.0ã€AJPã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eå±æ€§è¡¨\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eå±æ€§\u003c/th\u003e\n\u003cth\u003eè¯´æ˜\u003c/th\u003e\n\u003cth\u003eå¤‡æ³¨\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003easyncTimeout\u003c/td\u003e\n\u003ctd\u003eServlet3.0 è§„èŒƒä¸­çš„å¼‚æ­¥è¯·æ±‚è¶…æ—¶\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ 30s\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eport\u003c/td\u003e\n\u003ctd\u003eè¯·æ±‚è¿æ¥çš„ TCP Port\u003c/td\u003e\n\u003ctd\u003eè®¾ç½®ä¸º 0,åˆ™ä¼šéšæœºé€‰å–ä¸€ä¸ªæœªå ç”¨çš„ç«¯å£å·\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eprotocol\u003c/td\u003e\n\u003ctd\u003eåè®®. ä¸€èˆ¬æƒ…å†µä¸‹è®¾ç½®ä¸º HTTP/1.1,è¿™ç§æƒ…å†µä¸‹è¿æ¥æ¨¡å‹ä¼šåœ¨ NIO å’Œ APR/native ä¸­è‡ªåŠ¨æ ¹æ®é…ç½®é€‰æ‹©\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eURIEncoding\u003c/td\u003e\n\u003ctd\u003eå¯¹ URI çš„ç¼–ç æ–¹å¼.\u003c/td\u003e\n\u003ctd\u003eå¦‚æœè®¾ç½®ç³»ç»Ÿå˜é‡ org.apache.catalina.STRICT_SERVLET_COMPLIANCE ä¸º true,ä½¿ç”¨ ISO-8859-1 ç¼–ç ;å¦‚æœæœªè®¾ç½®æ­¤ç³»ç»Ÿå˜é‡ä¸”æœªè®¾ç½®æ­¤å±æ€§, ä½¿ç”¨ UTF-8 ç¼–ç \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003euseBodyEncodingForURI\u003c/td\u003e\n\u003ctd\u003eæ˜¯å¦é‡‡ç”¨æŒ‡å®šçš„ contentType è€Œä¸æ˜¯ URIEncoding æ¥ç¼–ç  URI ä¸­çš„è¯·æ±‚å‚æ•°\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eä»¥ä¸‹å±æ€§åœ¨æ ‡å‡†çš„ Connector(NIO, NIO2 å’Œ APR/native)ä¸­æœ‰æ•ˆ:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eå±æ€§\u003c/th\u003e\n\u003cth\u003eè¯´æ˜\u003c/th\u003e\n\u003cth\u003eå¤‡æ³¨\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eacceptCount\u003c/td\u003e\n\u003ctd\u003eå½“æœ€å¤§è¯·æ±‚è¿æ¥ maxConnections æ»¡æ—¶çš„æœ€å¤§æ’é˜Ÿå¤§å°\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ 100,æ³¨æ„æ­¤å±æ€§å’Œ Executor ä¸­å±æ€§ maxQueueSize çš„åŒºåˆ«.è¿™ä¸ªæŒ‡çš„æ˜¯è¯·æ±‚è¿æ¥æ»¡æ—¶çš„å †æ ˆå¤§å°,Executor çš„ maxQueueSize æŒ‡çš„æ˜¯å¤„ç†çº¿ç¨‹æ»¡æ—¶çš„å †æ ˆå¤§å°\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003econnectionTimeout\u003c/td\u003e\n\u003ctd\u003eè¯·æ±‚è¿æ¥è¶…æ—¶\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ 60000ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eexecutor\u003c/td\u003e\n\u003ctd\u003eæŒ‡å®šé…ç½®çš„çº¿ç¨‹æ± åç§°\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ekeepAliveTimeout\u003c/td\u003e\n\u003ctd\u003ekeeAlive è¶…æ—¶æ—¶é—´\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤å€¼ä¸º connectionTimeout é…ç½®å€¼.-1 è¡¨ç¤ºä¸è¶…æ—¶\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emaxConnections\u003c/td\u003e\n\u003ctd\u003eæœ€å¤§è¿æ¥æ•°\u003c/td\u003e\n\u003ctd\u003eè¿æ¥æ»¡æ—¶åç»­è¿æ¥æ”¾å…¥æœ€å¤§ä¸º acceptCount çš„é˜Ÿåˆ—ä¸­. å¯¹ NIO å’Œ NIO2 è¿æ¥,é»˜è®¤å€¼ä¸º 10000;å¯¹ APR/native,é»˜è®¤å€¼ä¸º 8192\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emaxThreads\u003c/td\u003e\n\u003ctd\u003eå¦‚æœæŒ‡å®šäº† Executor, æ­¤å±æ€§å¿½ç•¥;å¦åˆ™ä¸º Connector åˆ›å»ºçš„å†…éƒ¨çº¿ç¨‹æ± æœ€å¤§å€¼\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ 200\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eminSpareThreads\u003c/td\u003e\n\u003ctd\u003eå¦‚æœæŒ‡å®šäº† Executor, æ­¤å±æ€§å¿½ç•¥;å¦åˆ™ä¸º Connector åˆ›å»ºçº¿ç¨‹æ± çš„æœ€å°æ´»è·ƒçº¿ç¨‹æ•°\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ 10\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eprocessorCache\u003c/td\u003e\n\u003ctd\u003eåè®®å¤„ç†å™¨ç¼“å­˜ Processor å¯¹è±¡çš„å¤§å°\u003c/td\u003e\n\u003ctd\u003e-1 è¡¨ç¤ºä¸é™åˆ¶.å½“ä¸ä½¿ç”¨ servlet3.0 çš„å¼‚æ­¥å¤„ç†æƒ…å†µä¸‹: å¦‚æœé…ç½® Executor,é…ç½®ä¸º Executor çš„ maxThreads;å¦åˆ™é…ç½®ä¸º Connnector çš„ maxThreads. å¦‚æœä½¿ç”¨ Serlvet3.0 å¼‚æ­¥å¤„ç†, å– maxThreads å’Œ maxConnections çš„æœ€å¤§å€¼\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch4 id=\"2-2-5-Context\"\u003e\u003ca href=\"#2-2-5-Context\" class=\"headerlink\" title=\"2.2.5. Context\"\u003e\u003c/a\u003e2.2.5. Context\u003c/h4\u003e\u003cblockquote\u003e\n\u003cp\u003eContext å…ƒç´ è¡¨ç¤ºä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œå®ƒåœ¨ç‰¹å®šçš„è™šæ‹Ÿä¸»æœºä¸­è¿è¡Œã€‚æ¯ä¸ª Web åº”ç”¨ç¨‹åºéƒ½åŸºäº Web åº”ç”¨ç¨‹åºå­˜æ¡£ï¼ˆWARï¼‰æ–‡ä»¶ï¼Œæˆ–è€…åŒ…å«ç›¸åº”çš„è§£åŒ…å†…å®¹çš„ç›¸åº”ç›®å½•ï¼Œå¦‚ Servlet è§„èŒƒä¸­æ‰€è¿°ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eå±æ€§è¡¨\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eå±æ€§\u003c/th\u003e\n\u003cth\u003eè¯´æ˜\u003c/th\u003e\n\u003cth\u003eå¤‡æ³¨\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003ealtDDName\u003c/td\u003e\n\u003ctd\u003eweb.xml éƒ¨ç½²æè¿°ç¬¦è·¯å¾„\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ /WEB-INF/web.xml\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edocBase\u003c/td\u003e\n\u003ctd\u003eContext çš„ Root è·¯å¾„\u003c/td\u003e\n\u003ctd\u003eå’Œ Host çš„ appBase ç›¸ç»“åˆ, å¯ç¡®å®š web åº”ç”¨çš„å®é™…ç›®å½•\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efailCtxIfServletStartFails\u003c/td\u003e\n\u003ctd\u003eåŒ Host ä¸­çš„ failCtxIfServletStartFails, åªå¯¹å½“å‰ Context æœ‰æ•ˆ\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ä¸º false\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elogEffectiveWebXml\u003c/td\u003e\n\u003ctd\u003eæ˜¯å¦æ—¥å¿—æ‰“å° web.xml å†…å®¹(web.xml ç”±é»˜è®¤çš„ web.xml å’Œåº”ç”¨ä¸­çš„ web.xml ç»„æˆ)\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ä¸º false\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003epath\u003c/td\u003e\n\u003ctd\u003eweb åº”ç”¨çš„ context path\u003c/td\u003e\n\u003ctd\u003eå¦‚æœä¸ºæ ¹è·¯å¾„,åˆ™é…ç½®ä¸ºç©ºå­—ç¬¦ä¸²(â€œâ€), ä¸èƒ½ä¸é…ç½®\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eprivileged\u003c/td\u003e\n\u003ctd\u003eæ˜¯å¦ä½¿ç”¨ Tomcat æä¾›çš„ manager servlet\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ereloadable\u003c/td\u003e\n\u003ctd\u003e/WEB-INF/classes/ å’Œ/WEB-INF/lib/ ç›®å½•ä¸­ class æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ˜¯å¦è‡ªåŠ¨é‡æ–°åŠ è½½\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ä¸º false\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eswallowOutput\u003c/td\u003e\n\u003ctd\u003etrue æƒ…å†µä¸‹, System.out å’Œ System.err è¾“å‡ºå°†è¢«å®šå‘åˆ° web åº”ç”¨æ—¥å¿—ä¸­\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ä¸º false\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch4 id=\"2-2-6-Engine\"\u003e\u003ca href=\"#2-2-6-Engine\" class=\"headerlink\" title=\"2.2.6. Engine\"\u003e\u003c/a\u003e2.2.6. Engine\u003c/h4\u003e\u003cblockquote\u003e\n\u003cp\u003eEngine å…ƒç´ è¡¨ç¤ºä¸ç‰¹å®šçš„ Catalina æœåŠ¡ç›¸å…³è”çš„æ•´ä¸ªè¯·æ±‚å¤„ç†æœºå™¨ã€‚å®ƒæ¥æ”¶å¹¶å¤„ç†æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥å™¨çš„æ‰€æœ‰è¯·æ±‚ï¼Œå¹¶å°†å®Œæˆçš„å“åº”è¿”å›ç»™è¿æ¥å™¨ï¼Œä»¥ä¾¿æœ€ç»ˆä¼ è¾“å›å®¢æˆ·ç«¯ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eå±æ€§è¡¨\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eå±æ€§\u003c/th\u003e\n\u003cth\u003eæè¿°\u003c/th\u003e\n\u003cth\u003eå¤‡æ³¨\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003edefaultHost\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ä¸»æœºåï¼Œç”¨äºæ ‡è¯†å°†å¤„ç†æŒ‡å‘æ­¤æœåŠ¡å™¨ä¸Šä¸»æœºåç§°ä½†æœªåœ¨æ­¤é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„è¯·æ±‚çš„ä¸»æœºã€‚\u003c/td\u003e\n\u003ctd\u003eè¿™ä¸ªåå­—å¿…é¡»åŒ¹é…å…¶ä¸­ä¸€ä¸ªåµŒå¥—çš„ä¸»æœºå…ƒç´ çš„åå­—å±æ€§ã€‚\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ename\u003c/td\u003e\n\u003ctd\u003eæ­¤å¼•æ“çš„é€»è¾‘åç§°ï¼Œç”¨äºæ—¥å¿—å’Œé”™è¯¯æ¶ˆæ¯ã€‚\u003c/td\u003e\n\u003ctd\u003eåœ¨åŒä¸€æœåŠ¡å™¨ä¸­ä½¿ç”¨å¤šä¸ªæœåŠ¡å…ƒç´ æ—¶ï¼Œæ¯ä¸ªå¼•æ“å¿…é¡»åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„åç§°ã€‚\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch4 id=\"2-2-7-Host\"\u003e\u003ca href=\"#2-2-7-Host\" class=\"headerlink\" title=\"2.2.7. Host\"\u003e\u003c/a\u003e2.2.7. Host\u003c/h4\u003e\u003cblockquote\u003e\n\u003cp\u003eHost å…ƒç´ è¡¨ç¤ºä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå®ƒæ˜¯ä¸€ä¸ªæœåŠ¡å™¨çš„ç½‘ç»œåç§°ï¼ˆå¦‚â€œ\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.mycompany.comâ€)ä¸è¿è¡Œ/\"\u003ewww.mycompany.comâ€ï¼‰ä¸è¿è¡Œ\u003c/a\u003e Tomcat çš„ç‰¹å®šæœåŠ¡å™¨çš„å…³è”ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eå±æ€§è¡¨\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eå±æ€§\u003c/th\u003e\n\u003cth\u003eè¯´æ˜\u003c/th\u003e\n\u003cth\u003eå¤‡æ³¨\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003ename\u003c/td\u003e\n\u003ctd\u003eåç§°\u003c/td\u003e\n\u003ctd\u003eç”¨äºæ—¥å¿—è¾“å‡º\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eappBase\u003c/td\u003e\n\u003ctd\u003eè™šæ‹Ÿä¸»æœºå¯¹åº”çš„åº”ç”¨åŸºç¡€è·¯å¾„\u003c/td\u003e\n\u003ctd\u003eå¯ä»¥æ˜¯ä¸ªç»å¯¹è·¯å¾„, æˆ–${CATALINA_BASE}ç›¸å¯¹è·¯å¾„\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003exmlBase\u003c/td\u003e\n\u003ctd\u003eè™šæ‹Ÿä¸»æœº XML åŸºç¡€è·¯å¾„,é‡Œé¢åº”è¯¥æœ‰ Context xml é…ç½®æ–‡ä»¶\u003c/td\u003e\n\u003ctd\u003eå¯ä»¥æ˜¯ä¸ªç»å¯¹è·¯å¾„, æˆ–${CATALINA_BASE}ç›¸å¯¹è·¯å¾„\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecreateDirs\u003c/td\u003e\n\u003ctd\u003eå½“ appBase å’Œ xmlBase ä¸å­˜åœ¨æ—¶,æ˜¯å¦åˆ›å»ºç›®å½•\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ä¸º true\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eautoDeploy\u003c/td\u003e\n\u003ctd\u003eæ˜¯å¦å‘¨æœŸæ€§çš„æ£€æŸ¥ appBase å’Œ xmlBase å¹¶ deploy web åº”ç”¨å’Œ context æè¿°ç¬¦\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ä¸º true\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edeployIgnore\u003c/td\u003e\n\u003ctd\u003eå¿½ç•¥ deploy çš„æ­£åˆ™\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edeployOnStartup\u003c/td\u003e\n\u003ctd\u003eTomcat å¯åŠ¨æ—¶æ˜¯å¦è‡ªåŠ¨ deploy\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ä¸º true\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efailCtxIfServletStartFails\u003c/td\u003e\n\u003ctd\u003eé…ç½®ä¸º true æƒ…å†µä¸‹,ä»»ä½• load-on-startup \u0026gt;=0 çš„ servlet å¯åŠ¨å¤±è´¥,åˆ™å…¶å¯¹åº”çš„ Contxt ä¹Ÿå¯åŠ¨å¤±è´¥\u003c/td\u003e\n\u003ctd\u003eé»˜è®¤ä¸º false\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch4 id=\"2-2-8-Cluster\"\u003e\u003ca href=\"#2-2-8-Cluster\" class=\"headerlink\" title=\"2.2.8. Cluster\"\u003e\u003c/a\u003e2.2.8. Cluster\u003c/h4\u003e\u003cp\u003eç”±äºåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»æœªç”¨è¿‡ Tomcat é›†ç¾¤é…ç½®ï¼Œæ‰€ä»¥æ²¡ç ”ç©¶ã€‚\u003c/p\u003e\n\u003ch3 id=\"2-3-å¯åŠ¨\"\u003e\u003ca href=\"#2-3-å¯åŠ¨\" class=\"headerlink\" title=\"2.3. å¯åŠ¨\"\u003e\u003c/a\u003e2.3. å¯åŠ¨\u003c/h3\u003e\u003ch4 id=\"2-3-1-éƒ¨ç½²æ–¹å¼\"\u003e\u003ca href=\"#2-3-1-éƒ¨ç½²æ–¹å¼\" class=\"headerlink\" title=\"2.3.1. éƒ¨ç½²æ–¹å¼\"\u003e\u003c/a\u003e2.3.1. éƒ¨ç½²æ–¹å¼\u003c/h4\u003e\u003cp\u003eè¿™ç§æ–¹å¼è¦æ±‚æœ¬åœ°å¿…é¡»å®‰è£… Tomcat ã€‚\u003c/p\u003e\n\u003cp\u003eå°†æ‰“åŒ…å¥½çš„ war åŒ…æ”¾åœ¨ Tomcat å®‰è£…ç›®å½•ä¸‹çš„ \u003ccode\u003ewebapps\u003c/code\u003e ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ bin ç›®å½•ä¸‹æ‰§è¡Œ \u003ccode\u003estartup.bat\u003c/code\u003e æˆ– \u003ccode\u003estartup.sh\u003c/code\u003e ï¼ŒTomcat ä¼šè‡ªåŠ¨è§£å‹ \u003ccode\u003ewebapps\u003c/code\u003e ç›®å½•ä¸‹çš„ war åŒ…ã€‚\u003c/p\u003e\n\u003cp\u003eæˆåŠŸåï¼Œå¯ä»¥è®¿é—® \u003ccode\u003ehttp://localhost:8080/xxx\u003c/code\u003e ï¼ˆxxx æ˜¯ war åŒ…æ–‡ä»¶åï¼‰ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eæ³¨æ„\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eä»¥ä¸Šæ­¥éª¤æ˜¯æœ€ç®€å•çš„ç¤ºä¾‹ã€‚æ­¥éª¤ä¸­çš„ war åŒ…è§£å‹è·¯å¾„ã€å¯åŠ¨ç«¯å£ä»¥åŠä¸€äº›æ›´å¤šçš„åŠŸèƒ½éƒ½å¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥å®šåˆ¶ ï¼ˆä¸»è¦æ˜¯ \u003ccode\u003eserver.xml\u003c/code\u003e æˆ– \u003ccode\u003econtext.xml\u003c/code\u003e æ–‡ä»¶ï¼‰ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"2-3-2-åµŒå…¥å¼\"\u003e\u003ca href=\"#2-3-2-åµŒå…¥å¼\" class=\"headerlink\" title=\"2.3.2. åµŒå…¥å¼\"\u003e\u003c/a\u003e2.3.2. åµŒå…¥å¼\u003c/h4\u003e\u003ch5 id=\"2-3-2-1-API-æ–¹å¼\"\u003e\u003ca href=\"#2-3-2-1-API-æ–¹å¼\" class=\"headerlink\" title=\"2.3.2.1. API æ–¹å¼\"\u003e\u003c/a\u003e2.3.2.1. API æ–¹å¼\u003c/h5\u003e\u003cp\u003eåœ¨ pom.xml ä¸­æ·»åŠ ä¾èµ–\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eorg.apache.tomcat.embed\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003etomcat-embed-core\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e8.5.24\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003edependency\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eæ·»åŠ  SimpleEmbedTomcatServer.java æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e java.util.Optional;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e org.apache.catalina.startup.Tomcat;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eSimpleTomcatServer\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eint\u003c/span\u003e \u003cspan class=\"variable\"\u003ePORT\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"number\"\u003e8080\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eString\u003c/span\u003e \u003cspan class=\"variable\"\u003eCONTEXT_PATH\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;/javatool-server\u0026#34;\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003emain\u003c/span\u003e\u003cspan class=\"params\"\u003e(String[] args)\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e Exception {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// è®¾å®š profile\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Optional\u0026lt;String\u0026gt; profile = Optional.ofNullable(System.getProperty(\u003cspan class=\"string\"\u003e\u0026#34;spring.profiles.active\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        System.setProperty(\u003cspan class=\"string\"\u003e\u0026#34;spring.profiles.active\u0026#34;\u003c/span\u003e, profile.orElse(\u003cspan class=\"string\"\u003e\u0026#34;develop\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eTomcat\u003c/span\u003e \u003cspan class=\"variable\"\u003etomcat\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eTomcat\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        tomcat.setPort(PORT);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        tomcat.getHost().setAppBase(\u003cspan class=\"string\"\u003e\u0026#34;.\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        tomcat.addWebapp(CONTEXT_PATH, getAbsolutePath() + \u003cspan class=\"string\"\u003e\u0026#34;src/main/webapp\u0026#34;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        tomcat.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        tomcat.getServer().await();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003estatic\u003c/span\u003e String \u003cspan class=\"title function_\"\u003egetAbsolutePath\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eString\u003c/span\u003e \u003cspan class=\"variable\"\u003epath\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"literal\"\u003enull\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"type\"\u003eString\u003c/span\u003e \u003cspan class=\"variable\"\u003efolderPath\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e SimpleEmbedTomcatServer.class.getProtectionDomain().getCodeSource().getLocation().getPath()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                .substring(\u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (folderPath.indexOf(\u003cspan class=\"string\"\u003e\u0026#34;target\u0026#34;\u003c/span\u003e) \u0026gt; \u003cspan class=\"number\"\u003e0\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            path = folderPath.substring(\u003cspan class=\"number\"\u003e0\u003c/span\u003e, folderPath.indexOf(\u003cspan class=\"string\"\u003e\u0026#34;target\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e path;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eæˆåŠŸåï¼Œå¯ä»¥è®¿é—® \u003ccode\u003ehttp://localhost:8080/javatool-server\u003c/code\u003e ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eè¯´æ˜\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eæœ¬ç¤ºä¾‹æ˜¯ä½¿ç”¨ \u003ccode\u003eorg.apache.tomcat.embed\u003c/code\u003e å¯åŠ¨åµŒå…¥å¼ Tomcat çš„æœ€ç®€ç¤ºä¾‹ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ˜¯ Tomcat é»˜è®¤çš„é…ç½®ï¼Œä½†é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Tomcat é…ç½®è¿›è¡Œä¸€äº›å®šåˆ¶å’Œè°ƒä¼˜ã€‚ä¸ºäº†åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨ç±»å°±è¦ç¨å¾®å†å¤æ‚ä¸€äº›ã€‚è¿™é‡Œä¸æƒ³å†è´´ä»£ç ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/dunwu/JavaStack/tree/master/codes/javatool/server\"\u003e\u003cstrong\u003eç¤ºä¾‹é¡¹ç›®\u003c/strong\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch5 id=\"2-3-2-2-ä½¿ç”¨-maven-æ’ä»¶å¯åŠ¨ï¼ˆä¸æ¨èï¼‰\"\u003e\u003ca href=\"#2-3-2-2-ä½¿ç”¨-maven-æ’ä»¶å¯åŠ¨ï¼ˆä¸æ¨èï¼‰\" class=\"headerlink\" title=\"2.3.2.2. ä½¿ç”¨ maven æ’ä»¶å¯åŠ¨ï¼ˆä¸æ¨èï¼‰\"\u003e\u003c/a\u003e2.3.2.2. ä½¿ç”¨ maven æ’ä»¶å¯åŠ¨ï¼ˆä¸æ¨èï¼‰\u003c/h5\u003e\u003cp\u003eä¸æ¨èç†ç”±ï¼šè¿™ç§æ–¹å¼å¯åŠ¨ maven è™½ç„¶æœ€ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜æ˜¯ï¼ŒçœŸçš„å¾ˆä¹…å¾ˆä¹…æ²¡å‘å¸ƒæ–°ç‰ˆæœ¬äº†ï¼ˆæœ€æ–°ç‰ˆæœ¬å‘å¸ƒæ—¶é—´ï¼š2013-11-11ï¼‰ã€‚ä¸”è²Œä¼¼åªèƒ½æ‰¾åˆ° Tomcat6 ã€Tomcat7 æ’ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eä½¿ç”¨æ–¹æ³•\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eåœ¨ pom.xml ä¸­å¼•å…¥æ’ä»¶\u003c/p\u003e\n\u003cfigure class=\"highlight xml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eplugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003eorg.apache.tomcat.maven\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003egroupId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003etomcat7-maven-plugin\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eartifactId\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e2.2\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eversion\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003eport\u003c/span\u003e\u0026gt;\u003c/span\u003e8080\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eport\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003epath\u003c/span\u003e\u0026gt;\u003c/span\u003e/${project.artifactId}\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003epath\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"tag\"\u003e\u0026lt;\u003cspan class=\"name\"\u003euriEncoding\u003c/span\u003e\u0026gt;\u003c/span\u003eUTF-8\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003euriEncoding\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003econfiguration\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"tag\"\u003e\u0026lt;/\u003cspan class=\"name\"\u003eplugin\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eè¿è¡Œ \u003ccode\u003emvn tomcat7:run\u003c/code\u003e å‘½ä»¤ï¼Œå¯åŠ¨ Tomcatã€‚\u003c/p\u003e\n\u003cp\u003eæˆåŠŸåï¼Œå¯ä»¥è®¿é—® \u003ccode\u003ehttp://localhost:8080/xxx\u003c/code\u003e ï¼ˆxxx æ˜¯ ${project.artifactId} æŒ‡å®šçš„é¡¹ç›®åï¼‰ã€‚\u003c/p\u003e\n\u003ch4 id=\"2-3-3-IDE-æ’ä»¶\"\u003e\u003ca href=\"#2-3-3-IDE-æ’ä»¶\" class=\"headerlink\" title=\"2.3.3. IDE æ’ä»¶\"\u003e\u003c/a\u003e2.3.3. IDE æ’ä»¶\u003c/h4\u003e\u003cp\u003eå¸¸è§ Java IDE ä¸€èˆ¬éƒ½æœ‰å¯¹ Tomcat çš„æ”¯æŒã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ Intellij IDEA ä¸ºä¾‹ï¼Œæä¾›äº† \u003cstrong\u003eTomcat and TomEE Integration\u003c/strong\u003e æ’ä»¶ï¼ˆä¸€èˆ¬é»˜è®¤ä¼šå®‰è£…ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eä½¿ç”¨æ­¥éª¤\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç‚¹å‡» Run/Debug Configurations \u0026gt; New Tomcat Server \u0026gt; local ï¼Œæ‰“å¼€ Tomcat é…ç½®é¡µé¢ã€‚\u003c/li\u003e\n\u003cli\u003eç‚¹å‡» Confiureâ€¦ æŒ‰é’®ï¼Œè®¾ç½® Tomcat å®‰è£…è·¯å¾„ã€‚\u003c/li\u003e\n\u003cli\u003eç‚¹å‡» Deployment æ ‡ç­¾é¡µï¼Œè®¾ç½®è¦å¯åŠ¨çš„åº”ç”¨ã€‚\u003c/li\u003e\n\u003cli\u003eè®¾ç½®å¯åŠ¨åº”ç”¨çš„ç«¯å£ã€JVM å‚æ•°ã€å¯åŠ¨æµè§ˆå™¨ç­‰ã€‚\u003c/li\u003e\n\u003cli\u003eæˆåŠŸåï¼Œå¯ä»¥è®¿é—® \u003ccode\u003ehttp://localhost:8080/\u003c/code\u003eï¼ˆå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ url ä¸­è®¾ç½®ä¸Šä¸‹æ–‡åç§°ï¼‰ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/tomcat-intellij-run-config.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eè¯´æ˜\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eä¸ªäººè®¤ä¸ºè¿™ä¸ªæ’ä»¶ä¸å¦‚ Eclipse çš„ Tomcat æ’ä»¶å¥½ç”¨ï¼ŒEclipse çš„ Tomcat æ’ä»¶æ”¯æŒå¯¹ Tomcat xml é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚è€Œè¿™é‡Œï¼Œä½ åªèƒ½è‡ªå·±å» Tomcat å®‰è£…è·¯å¾„ä¸‹ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eæ–‡ä¸­çš„åµŒå…¥å¼å¯åŠ¨ç¤ºä¾‹å¯ä»¥å‚è€ƒ\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/dunwu/JavaStack/tree/master/codes/javatool/server\"\u003e\u003cstrong\u003eæˆ‘çš„ç¤ºä¾‹é¡¹ç›®\u003c/strong\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"3-Tomcat-æ¶æ„\"\u003e\u003ca href=\"#3-Tomcat-æ¶æ„\" class=\"headerlink\" title=\"3. Tomcat æ¶æ„\"\u003e\u003c/a\u003e3. Tomcat æ¶æ„\u003c/h2\u003e\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20201113193431.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003eTomcat è¦å®ç° 2 ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå¤„ç† Socket è¿æ¥\u003c/strong\u003eï¼Œè´Ÿè´£ç½‘ç»œå­—èŠ‚æµä¸ Request å’Œ Response å¯¹è±¡çš„è½¬åŒ–ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eåŠ è½½å’Œç®¡ç† Servlet\u003c/strong\u003eï¼Œä»¥åŠ\u003cstrong\u003eå¤„ç†å…·ä½“çš„ Request è¯·æ±‚\u003c/strong\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¸ºæ­¤ï¼ŒTomcat è®¾è®¡äº†ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eè¿æ¥å™¨ï¼ˆConnectorï¼‰\u003c/strong\u003eï¼šè´Ÿè´£å’Œå¤–éƒ¨é€šä¿¡\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå®¹å™¨ï¼ˆContainerï¼‰\u003c/strong\u003eï¼šè´Ÿè´£å†…éƒ¨å¤„ç†\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"3-1-Service\"\u003e\u003ca href=\"#3-1-Service\" class=\"headerlink\" title=\"3.1. Service\"\u003e\u003c/a\u003e3.1. Service\u003c/h3\u003e\u003cp\u003eTomcat æ”¯æŒçš„ I/O æ¨¡å‹æœ‰ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNIOï¼šéé˜»å¡ I/Oï¼Œé‡‡ç”¨ Java NIO ç±»åº“å®ç°ã€‚\u003c/li\u003e\n\u003cli\u003eNIO2ï¼šå¼‚æ­¥ I/Oï¼Œé‡‡ç”¨ JDK 7 æœ€æ–°çš„ NIO2 ç±»åº“å®ç°ã€‚\u003c/li\u003e\n\u003cli\u003eAPRï¼šé‡‡ç”¨ Apache å¯ç§»æ¤è¿è¡Œåº“å®ç°ï¼Œæ˜¯ C/C++ ç¼–å†™çš„æœ¬åœ°åº“ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTomcat æ”¯æŒçš„åº”ç”¨å±‚åè®®æœ‰ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHTTP/1.1ï¼šè¿™æ˜¯å¤§éƒ¨åˆ† Web åº”ç”¨é‡‡ç”¨çš„è®¿é—®åè®®ã€‚\u003c/li\u003e\n\u003cli\u003eAJPï¼šç”¨äºå’Œ Web æœåŠ¡å™¨é›†æˆï¼ˆå¦‚ Apacheï¼‰ã€‚\u003c/li\u003e\n\u003cli\u003eHTTP/2ï¼šHTTP 2.0 å¤§å¹…åº¦çš„æå‡äº† Web æ€§èƒ½ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTomcat æ”¯æŒå¤šç§ I/O æ¨¡å‹å’Œåº”ç”¨å±‚åè®®ã€‚ä¸ºäº†å®ç°è¿™ç‚¹ï¼Œä¸€ä¸ªå®¹å™¨å¯èƒ½å¯¹æ¥å¤šä¸ªè¿æ¥å™¨ã€‚ä½†æ˜¯ï¼Œå•ç‹¬çš„è¿æ¥å™¨æˆ–å®¹å™¨éƒ½ä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œéœ€è¦æŠŠå®ƒä»¬ç»„è£…èµ·æ¥æ‰èƒ½å·¥ä½œï¼Œç»„è£…åè¿™ä¸ªæ•´ä½“å«ä½œ Service ç»„ä»¶ã€‚Tomcat å†…å¯èƒ½æœ‰å¤šä¸ª Serviceï¼Œé€šè¿‡åœ¨ Tomcat ä¸­é…ç½®å¤šä¸ª Serviceï¼Œå¯ä»¥å®ç°é€šè¿‡ä¸åŒçš„ç«¯å£å·æ¥è®¿é—®åŒä¸€å°æœºå™¨ä¸Šéƒ¨ç½²çš„ä¸åŒåº”ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20201111093124.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eä¸€ä¸ª Tomcat å®ä¾‹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª Serviceï¼›ä¸€ä¸ª Service æœ‰å¤šä¸ª Connector å’Œ Container\u003c/strong\u003eã€‚Connector å’Œ Container ä¹‹é—´é€šè¿‡æ ‡å‡†çš„ ServletRequest å’Œ ServletResponse é€šä¿¡ã€‚\u003c/p\u003e\n\u003ch3 id=\"3-2-è¿æ¥å™¨\"\u003e\u003ca href=\"#3-2-è¿æ¥å™¨\" class=\"headerlink\" title=\"3.2. è¿æ¥å™¨\"\u003e\u003c/a\u003e3.2. è¿æ¥å™¨\u003c/h3\u003e\u003cp\u003eè¿æ¥å™¨å¯¹ Servlet å®¹å™¨å±è”½äº†åè®®åŠ I/O æ¨¡å‹ç­‰çš„åŒºåˆ«ï¼Œæ— è®ºæ˜¯ HTTP è¿˜æ˜¯ AJPï¼Œåœ¨å®¹å™¨ä¸­è·å–åˆ°çš„éƒ½æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ ServletRequest å¯¹è±¡ã€‚\u003c/p\u003e\n\u003cp\u003eè¿æ¥å™¨çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç½‘ç»œé€šä¿¡\u003c/li\u003e\n\u003cli\u003eåº”ç”¨å±‚åè®®è§£æ\u003c/li\u003e\n\u003cli\u003eTomcat Request/Response ä¸ ServletRequest/ServletResponse çš„è½¬åŒ–\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTomcat è®¾è®¡äº† 3 ä¸ªç»„ä»¶æ¥å®ç°è¿™ 3 ä¸ªåŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯ \u003cstrong\u003e\u003ccode\u003eEndPoint\u003c/code\u003e\u003cstrong\u003eã€\u003c/strong\u003e\u003ccode\u003eProcessor\u003c/code\u003e\u003c/strong\u003e å’Œ **\u003ccode\u003eAdapter\u003c/code\u003e**ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20201111101440.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003eç»„ä»¶é—´é€šè¿‡æŠ½è±¡æ¥å£äº¤äº’ã€‚è¿™æ ·åšè¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯\u003cstrong\u003eå°è£…å˜åŒ–ã€‚\u003c/strong\u003eè¿™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„ç²¾é«“ï¼Œå°†ç³»ç»Ÿä¸­ç»å¸¸å˜åŒ–çš„éƒ¨åˆ†å’Œç¨³å®šçš„éƒ¨åˆ†éš”ç¦»ï¼Œæœ‰åŠ©äºå¢åŠ å¤ç”¨æ€§ï¼Œå¹¶é™ä½ç³»ç»Ÿè€¦åˆåº¦ã€‚ç½‘ç»œé€šä¿¡çš„ I/O æ¨¡å‹æ˜¯å˜åŒ–çš„ï¼Œå¯èƒ½æ˜¯éé˜»å¡ I/Oã€å¼‚æ­¥ I/O æˆ–è€… APRã€‚åº”ç”¨å±‚åè®®ä¹Ÿæ˜¯å˜åŒ–çš„ï¼Œå¯èƒ½æ˜¯ HTTPã€HTTPSã€AJPã€‚æµè§ˆå™¨ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯ä¹Ÿæ˜¯å˜åŒ–çš„ã€‚ä½†æ˜¯æ•´ä½“çš„å¤„ç†é€»è¾‘æ˜¯ä¸å˜çš„ï¼ŒEndPoint è´Ÿè´£æä¾›å­—èŠ‚æµç»™ Processorï¼ŒProcessor è´Ÿè´£æä¾› Tomcat Request å¯¹è±¡ç»™ Adapterï¼ŒAdapter è´Ÿè´£æä¾› ServletRequest å¯¹è±¡ç»™å®¹å™¨ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœè¦æ”¯æŒæ–°çš„ I/O æ–¹æ¡ˆã€æ–°çš„åº”ç”¨å±‚åè®®ï¼Œåªéœ€è¦å®ç°ç›¸å…³çš„å…·ä½“å­ç±»ï¼Œä¸Šå±‚é€šç”¨çš„å¤„ç†é€»è¾‘æ˜¯ä¸å˜çš„ã€‚ç”±äº I/O æ¨¡å‹å’Œåº”ç”¨å±‚åè®®å¯ä»¥è‡ªç”±ç»„åˆï¼Œæ¯”å¦‚ NIO + HTTP æˆ–è€… NIO2 + AJPã€‚Tomcat çš„è®¾è®¡è€…å°†ç½‘ç»œé€šä¿¡å’Œåº”ç”¨å±‚åè®®è§£ææ”¾åœ¨ä¸€èµ·è€ƒè™‘ï¼Œè®¾è®¡äº†ä¸€ä¸ªå« ProtocolHandler çš„æ¥å£æ¥å°è£…è¿™ä¸¤ç§å˜åŒ–ç‚¹ã€‚å„ç§åè®®å’Œé€šä¿¡æ¨¡å‹çš„ç»„åˆæœ‰ç›¸åº”çš„å…·ä½“å®ç°ç±»ã€‚æ¯”å¦‚ï¼šHttp11NioProtocol å’Œ AjpNioProtocolã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20201027091819.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch4 id=\"3-2-1-ProtocolHandler-ç»„ä»¶\"\u003e\u003ca href=\"#3-2-1-ProtocolHandler-ç»„ä»¶\" class=\"headerlink\" title=\"3.2.1. ProtocolHandler ç»„ä»¶\"\u003e\u003c/a\u003e3.2.1. ProtocolHandler ç»„ä»¶\u003c/h4\u003e\u003cp\u003e\u003cstrong\u003eè¿æ¥å™¨ç”¨ ProtocolHandler æ¥å£æ¥å°è£…é€šä¿¡åè®®å’Œ I/O æ¨¡å‹çš„å·®å¼‚\u003c/strong\u003eã€‚ProtocolHandler å†…éƒ¨åˆåˆ†ä¸º EndPoint å’Œ Processor æ¨¡å—ï¼ŒEndPoint è´Ÿè´£åº•å±‚ Socket é€šä¿¡ï¼ŒProccesor è´Ÿè´£åº”ç”¨å±‚åè®®è§£æã€‚\u003c/p\u003e\n\u003ch5 id=\"3-2-1-1-EndPoint\"\u003e\u003ca href=\"#3-2-1-1-EndPoint\" class=\"headerlink\" title=\"3.2.1.1. EndPoint\"\u003e\u003c/a\u003e3.2.1.1. EndPoint\u003c/h5\u003e\u003cp\u003eEndPoint æ˜¯é€šä¿¡ç«¯ç‚¹ï¼Œå³é€šä¿¡ç›‘å¬çš„æ¥å£ï¼Œæ˜¯å…·ä½“çš„ Socket æ¥æ”¶å’Œå‘é€å¤„ç†å™¨ï¼Œæ˜¯å¯¹ä¼ è¾“å±‚çš„æŠ½è±¡ï¼Œå› æ­¤ EndPoint æ˜¯ç”¨æ¥å®ç° TCP/IP åè®®çš„ã€‚\u003c/p\u003e\n\u003cp\u003eEndPoint æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¯¹åº”çš„æŠ½è±¡å®ç°ç±»æ˜¯ AbstractEndpointï¼Œè€Œ AbstractEndpoint çš„å…·ä½“å­ç±»ï¼Œæ¯”å¦‚åœ¨ NioEndpoint å’Œ Nio2Endpoint ä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„å­ç»„ä»¶ï¼šAcceptor å’Œ SocketProcessorã€‚\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­ Acceptor ç”¨äºç›‘å¬ Socket è¿æ¥è¯·æ±‚ã€‚SocketProcessor ç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„ Socket è¯·æ±‚ï¼Œå®ƒå®ç° Runnable æ¥å£ï¼Œåœ¨ Run æ–¹æ³•é‡Œè°ƒç”¨åè®®å¤„ç†ç»„ä»¶ Processor è¿›è¡Œå¤„ç†ã€‚ä¸ºäº†æé«˜å¤„ç†èƒ½åŠ›ï¼ŒSocketProcessor è¢«æäº¤åˆ°çº¿ç¨‹æ± æ¥æ‰§è¡Œã€‚è€Œè¿™ä¸ªçº¿ç¨‹æ± å«ä½œæ‰§è¡Œå™¨ï¼ˆExecutor)ã€‚\u003c/p\u003e\n\u003ch5 id=\"3-2-1-2-Processor\"\u003e\u003ca href=\"#3-2-1-2-Processor\" class=\"headerlink\" title=\"3.2.1.2. Processor\"\u003e\u003c/a\u003e3.2.1.2. Processor\u003c/h5\u003e\u003cp\u003eå¦‚æœè¯´ EndPoint æ˜¯ç”¨æ¥å®ç° TCP/IP åè®®çš„ï¼Œé‚£ä¹ˆ Processor ç”¨æ¥å®ç° HTTP åè®®ï¼ŒProcessor æ¥æ”¶æ¥è‡ª EndPoint çš„ Socketï¼Œè¯»å–å­—èŠ‚æµè§£ææˆ Tomcat Request å’Œ Response å¯¹è±¡ï¼Œå¹¶é€šè¿‡ Adapter å°†å…¶æäº¤åˆ°å®¹å™¨å¤„ç†ï¼ŒProcessor æ˜¯å¯¹åº”ç”¨å±‚åè®®çš„æŠ½è±¡ã€‚\u003c/p\u003e\n\u003cp\u003eProcessor æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†è¯·æ±‚çš„å¤„ç†ç­‰æ–¹æ³•ã€‚å®ƒçš„æŠ½è±¡å®ç°ç±» AbstractProcessor å¯¹ä¸€äº›åè®®å…±æœ‰çš„å±æ€§è¿›è¡Œå°è£…ï¼Œæ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡Œå®ç°ã€‚å…·ä½“çš„å®ç°æœ‰ AJPProcessorã€HTTP11Processor ç­‰ï¼Œè¿™äº›å…·ä½“å®ç°ç±»å®ç°äº†ç‰¹å®šåè®®çš„è§£ææ–¹æ³•å’Œè¯·æ±‚å¤„ç†æ–¹å¼ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20201113185929.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003eä»å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼ŒEndPoint æ¥æ”¶åˆ° Socket è¿æ¥åï¼Œç”Ÿæˆä¸€ä¸ª SocketProcessor ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± å»å¤„ç†ï¼ŒSocketProcessor çš„ Run æ–¹æ³•ä¼šè°ƒç”¨ Processor ç»„ä»¶å»è§£æåº”ç”¨å±‚åè®®ï¼ŒProcessor é€šè¿‡è§£æç”Ÿæˆ Request å¯¹è±¡åï¼Œä¼šè°ƒç”¨ Adapter çš„ Service æ–¹æ³•ã€‚\u003c/p\u003e\n\u003ch4 id=\"3-2-2-Adapter\"\u003e\u003ca href=\"#3-2-2-Adapter\" class=\"headerlink\" title=\"3.2.2. Adapter\"\u003e\u003c/a\u003e3.2.2. Adapter\u003c/h4\u003e\u003cp\u003e\u003cstrong\u003eè¿æ¥å™¨é€šè¿‡é€‚é…å™¨ Adapter è°ƒç”¨å®¹å™¨\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eç”±äºåè®®ä¸åŒï¼Œå®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚ä¿¡æ¯ä¹Ÿä¸å°½ç›¸åŒï¼ŒTomcat å®šä¹‰äº†è‡ªå·±çš„ Request ç±»æ¥é€‚é…è¿™äº›è¯·æ±‚ä¿¡æ¯ã€‚\u003c/p\u003e\n\u003cp\u003eProtocolHandler æ¥å£è´Ÿè´£è§£æè¯·æ±‚å¹¶ç”Ÿæˆ Tomcat Request ç±»ã€‚ä½†æ˜¯è¿™ä¸ª Request å¯¹è±¡ä¸æ˜¯æ ‡å‡†çš„ ServletRequestï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œä¸èƒ½ç”¨ Tomcat Request ä½œä¸ºå‚æ•°æ¥è°ƒç”¨å®¹å™¨ã€‚Tomcat çš„è§£å†³æ–¹æ¡ˆæ˜¯å¼•å…¥ CoyoteAdapterï¼Œè¿™æ˜¯é€‚é…å™¨æ¨¡å¼çš„ç»å…¸è¿ç”¨ï¼Œè¿æ¥å™¨è°ƒç”¨ CoyoteAdapter çš„ Sevice æ–¹æ³•ï¼Œä¼ å…¥çš„æ˜¯ Tomcat Request å¯¹è±¡ï¼ŒCoyoteAdapter è´Ÿè´£å°† Tomcat Request è½¬æˆ ServletRequestï¼Œå†è°ƒç”¨å®¹å™¨çš„ Service æ–¹æ³•ã€‚\u003c/p\u003e\n\u003ch3 id=\"3-3-å®¹å™¨\"\u003e\u003ca href=\"#3-3-å®¹å™¨\" class=\"headerlink\" title=\"3.3. å®¹å™¨\"\u003e\u003c/a\u003e3.3. å®¹å™¨\u003c/h3\u003e\u003cp\u003eTomcat è®¾è®¡äº† 4 ç§å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯ Engineã€Hostã€Context å’Œ Wrapperã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eEngine\u003c/strong\u003e - Servlet çš„é¡¶å±‚å®¹å™¨ï¼ŒåŒ…å«ä¸€ ä¸ªæˆ–å¤šä¸ª Host å­å®¹å™¨ï¼›\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eHost\u003c/strong\u003e - è™šæ‹Ÿä¸»æœºï¼Œè´Ÿè´£ web åº”ç”¨çš„éƒ¨ç½²å’Œ Context çš„åˆ›å»ºï¼›\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eContext\u003c/strong\u003e - Web åº”ç”¨ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«å¤šä¸ª Wrapperï¼Œè´Ÿè´£ web é…ç½®çš„è§£æã€ç®¡ç†æ‰€æœ‰çš„ Web èµ„æºï¼›\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eWrapper\u003c/strong\u003e - æœ€åº•å±‚çš„å®¹å™¨ï¼Œæ˜¯å¯¹ Servlet çš„å°è£…ï¼Œè´Ÿè´£ Servlet å®ä¾‹çš„åˆ› å»ºã€æ‰§è¡Œå’Œé”€æ¯ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"3-3-1-è¯·æ±‚åˆ†å‘-Servlet-è¿‡ç¨‹\"\u003e\u003ca href=\"#3-3-1-è¯·æ±‚åˆ†å‘-Servlet-è¿‡ç¨‹\" class=\"headerlink\" title=\"3.3.1. è¯·æ±‚åˆ†å‘ Servlet è¿‡ç¨‹\"\u003e\u003c/a\u003e3.3.1. è¯·æ±‚åˆ†å‘ Servlet è¿‡ç¨‹\u003c/h4\u003e\u003cp\u003eTomcat æ˜¯æ€ä¹ˆç¡®å®šè¯·æ±‚æ˜¯ç”±å“ªä¸ª Wrapper å®¹å™¨é‡Œçš„ Servlet æ¥å¤„ç†çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼ŒTomcat æ˜¯ç”¨ Mapper ç»„ä»¶æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡çš„ã€‚\u003c/p\u003e\n\u003cp\u003eä¸¾ä¾‹æ¥è¯´ï¼Œå‡å¦‚æœ‰ä¸€ä¸ªç½‘è´­ç³»ç»Ÿï¼Œæœ‰é¢å‘ç½‘ç«™ç®¡ç†äººå‘˜çš„åå°ç®¡ç†ç³»ç»Ÿï¼Œè¿˜æœ‰é¢å‘ç»ˆç«¯å®¢æˆ·çš„åœ¨çº¿è´­ç‰©ç³»ç»Ÿã€‚è¿™ä¸¤ä¸ªç³»ç»Ÿè·‘åœ¨åŒä¸€ä¸ª Tomcat ä¸Šï¼Œä¸ºäº†éš”ç¦»å®ƒä»¬çš„è®¿é—®åŸŸåï¼Œé…ç½®äº†ä¸¤ä¸ªè™šæ‹ŸåŸŸåï¼š\u003ccode\u003emanage.shopping.com\u003c/code\u003eå’Œ\u003ccode\u003euser.shopping.com\u003c/code\u003eï¼Œç½‘ç«™ç®¡ç†äººå‘˜é€šè¿‡\u003ccode\u003emanage.shopping.com\u003c/code\u003eåŸŸåè®¿é—® Tomcat å»ç®¡ç†ç”¨æˆ·å’Œå•†å“ï¼Œè€Œç”¨æˆ·ç®¡ç†å’Œå•†å“ç®¡ç†æ˜¯ä¸¤ä¸ªå•ç‹¬çš„ Web åº”ç”¨ã€‚ç»ˆç«¯å®¢æˆ·é€šè¿‡\u003ccode\u003euser.shopping.com\u003c/code\u003eåŸŸåå»æœç´¢å•†å“å’Œä¸‹è®¢å•ï¼Œæœç´¢åŠŸèƒ½å’Œè®¢å•ç®¡ç†ä¹Ÿæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ Web åº”ç”¨ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæ¼”ç¤ºäº† url åº”å£° Servlet çš„å¤„ç†æµç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20201113192022.jpg\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003eå‡å¦‚æœ‰ç”¨æˆ·è®¿é—®ä¸€ä¸ª URLï¼Œæ¯”å¦‚å›¾ä¸­çš„\u003ccode\u003ehttp://user.shopping.com:8080/order/buy\u003c/code\u003eï¼ŒTomcat å¦‚ä½•å°†è¿™ä¸ª URL å®šä½åˆ°ä¸€ä¸ª Servlet å‘¢ï¼Ÿ\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eé¦–å…ˆï¼Œæ ¹æ®åè®®å’Œç«¯å£å·é€‰å®š Service å’Œ Engineã€‚\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç„¶åï¼Œæ ¹æ®åŸŸåé€‰å®š Hostã€‚\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eä¹‹åï¼Œæ ¹æ® URL è·¯å¾„æ‰¾åˆ° Context ç»„ä»¶ã€‚\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæœ€åï¼Œæ ¹æ® URL è·¯å¾„æ‰¾åˆ° Wrapperï¼ˆServletï¼‰ã€‚\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eè¿™ä¸ªè·¯ç”±åˆ†å‘è¿‡ç¨‹å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨ Pipeline-Valve ç®¡é“ã€‚\u003c/p\u003e\n\u003ch4 id=\"3-3-2-Pipeline-Value\"\u003e\u003ca href=\"#3-3-2-Pipeline-Value\" class=\"headerlink\" title=\"3.3.2. Pipeline-Value\"\u003e\u003c/a\u003e3.3.2. Pipeline-Value\u003c/h4\u003e\u003cp\u003ePipeline å¯ä»¥ç†è§£ä¸ºç°å®ä¸­çš„ç®¡é“ï¼ŒValve ä¸ºç®¡é“ä¸­çš„é˜€é—¨ï¼ŒRequest å’Œ Response å¯¹è±¡åœ¨ç®¡é“ä¸­ç»è¿‡å„ä¸ªé˜€é—¨çš„å¤„ç†å’Œæ§åˆ¶ã€‚\u003c/p\u003e\n\u003cp\u003ePipeline-Valve æ˜¯è´£ä»»é“¾æ¨¡å¼ï¼Œè´£ä»»é“¾æ¨¡å¼æ˜¯æŒ‡åœ¨ä¸€ä¸ªè¯·æ±‚å¤„ç†çš„è¿‡ç¨‹ä¸­æœ‰å¾ˆå¤šå¤„ç†è€…ä¾æ¬¡å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæ¯ä¸ªå¤„ç†è€…è´Ÿè´£åšè‡ªå·±ç›¸åº”çš„å¤„ç†ï¼Œå¤„ç†å®Œä¹‹åå°†å†è°ƒç”¨ä¸‹ä¸€ä¸ªå¤„ç†è€…ç»§ç»­å¤„ç†ã€‚Valve è¡¨ç¤ºä¸€ä¸ªå¤„ç†ç‚¹ï¼Œæ¯”å¦‚æƒé™è®¤è¯å’Œè®°å½•æ—¥å¿—ã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆæ¥äº†è§£ä¸€ä¸‹ Valve å’Œ Pipeline æ¥å£çš„è®¾è®¡ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/Pipeline%E4%B8%8EValve.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ¯ä¸€ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ª Pipeline å¯¹è±¡ï¼Œåªè¦è§¦å‘è¿™ä¸ª Pipeline çš„ç¬¬ä¸€ä¸ª Valveï¼Œè¿™ä¸ªå®¹å™¨é‡Œ Pipeline ä¸­çš„ Valve å°±éƒ½ä¼šè¢«è°ƒç”¨åˆ°ã€‚ä½†æ˜¯ï¼Œä¸åŒå®¹å™¨çš„ Pipeline æ˜¯æ€ä¹ˆé“¾å¼è§¦å‘çš„å‘¢ï¼Œæ¯”å¦‚ Engine ä¸­ Pipeline éœ€è¦è°ƒç”¨ä¸‹å±‚å®¹å™¨ Host ä¸­çš„ Pipelineã€‚\u003c/li\u003e\n\u003cli\u003eè¿™æ˜¯å› ä¸º Pipeline ä¸­è¿˜æœ‰ä¸ª getBasic æ–¹æ³•ã€‚è¿™ä¸ª BasicValve å¤„äº Valve é“¾è¡¨çš„æœ«ç«¯ï¼Œå®ƒæ˜¯ Pipeline ä¸­å¿…ä¸å¯å°‘çš„ä¸€ä¸ª Valveï¼Œè´Ÿè´£è°ƒç”¨ä¸‹å±‚å®¹å™¨çš„ Pipeline é‡Œçš„ç¬¬ä¸€ä¸ª Valveã€‚\u003c/li\u003e\n\u003cli\u003ePipeline ä¸­æœ‰ addValve æ–¹æ³•ã€‚Pipeline ä¸­ç»´æŠ¤äº† Valve é“¾è¡¨ï¼ŒValve å¯ä»¥æ’å…¥åˆ° Pipeline ä¸­ï¼Œå¯¹è¯·æ±‚åšæŸäº›å¤„ç†ã€‚æˆ‘ä»¬è¿˜å‘ç° Pipeline ä¸­æ²¡æœ‰ invoke æ–¹æ³•ï¼Œå› ä¸ºæ•´ä¸ªè°ƒç”¨é“¾çš„è§¦å‘æ˜¯ Valve æ¥å®Œæˆçš„ï¼ŒValve å®Œæˆè‡ªå·±çš„å¤„ç†åï¼Œè°ƒç”¨ \u003ccode\u003egetNext.invoke()\u003c/code\u003e æ¥è§¦å‘ä¸‹ä¸€ä¸ª Valve è°ƒç”¨ã€‚\u003c/li\u003e\n\u003cli\u003eValve ä¸­ä¸»è¦çš„ä¸‰ä¸ªæ–¹æ³•ï¼š\u003ccode\u003esetNext\u003c/code\u003eã€\u003ccode\u003egetNext\u003c/code\u003eã€\u003ccode\u003einvoke\u003c/code\u003eã€‚Valve ä¹‹é—´çš„å…³ç³»æ˜¯å•å‘é“¾å¼ç»“æ„ï¼Œæœ¬èº« \u003ccode\u003einvoke\u003c/code\u003e æ–¹æ³•ä¸­ä¼šè°ƒç”¨ä¸‹ä¸€ä¸ª Valve çš„ \u003ccode\u003einvoke\u003c/code\u003e æ–¹æ³•ã€‚\u003c/li\u003e\n\u003cli\u003eå„å±‚å®¹å™¨å¯¹åº”çš„ basic valve åˆ†åˆ«æ˜¯ \u003ccode\u003eStandardEngineValve\u003c/code\u003eã€\u003ccode\u003eStandardHostValve\u003c/code\u003eã€ \u003ccode\u003eStandardContextValve\u003c/code\u003eã€\u003ccode\u003eStandardWrapperValve\u003c/code\u003eã€‚\u003c/li\u003e\n\u003cli\u003eç”±äº Valve æ˜¯ä¸€ä¸ªå¤„ç†ç‚¹ï¼Œå› æ­¤ invoke æ–¹æ³•å°±æ˜¯æ¥å¤„ç†è¯·æ±‚çš„ã€‚æ³¨æ„åˆ° Valve ä¸­æœ‰ getNext å’Œ setNext æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å¤§æ¦‚å¯ä»¥çŒœåˆ°æœ‰ä¸€ä¸ªé“¾è¡¨å°† Valve é“¾èµ·æ¥äº†ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003eæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ç”±è¿æ¥å™¨ä¸­çš„ Adapter è§¦å‘çš„ï¼Œå®ƒä¼šè°ƒç”¨ Engine çš„ç¬¬ä¸€ä¸ª Valveï¼š\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003econnector.getService().getContainer().getPipeline().getFirst().invoke(request, response);\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"4-Tomcat-ç”Ÿå‘½å‘¨æœŸ\"\u003e\u003ca href=\"#4-Tomcat-ç”Ÿå‘½å‘¨æœŸ\" class=\"headerlink\" title=\"4. Tomcat ç”Ÿå‘½å‘¨æœŸ\"\u003e\u003c/a\u003e4. Tomcat ç”Ÿå‘½å‘¨æœŸ\u003c/h2\u003e\u003ch3 id=\"4-1-Tomcat-çš„å¯åŠ¨è¿‡ç¨‹\"\u003e\u003ca href=\"#4-1-Tomcat-çš„å¯åŠ¨è¿‡ç¨‹\" class=\"headerlink\" title=\"4.1. Tomcat çš„å¯åŠ¨è¿‡ç¨‹\"\u003e\u003c/a\u003e4.1. Tomcat çš„å¯åŠ¨è¿‡ç¨‹\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20201118145455.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eTomcat æ˜¯ä¸€ä¸ª Java ç¨‹åºï¼Œå®ƒçš„è¿è¡Œä»æ‰§è¡Œ \u003ccode\u003estartup.sh\u003c/code\u003e è„šæœ¬å¼€å§‹ã€‚\u003ccode\u003estartup.sh\u003c/code\u003e ä¼šå¯åŠ¨ä¸€ä¸ª JVM æ¥è¿è¡Œ Tomcat çš„å¯åŠ¨ç±» \u003ccode\u003eBootstrap\u003c/code\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eBootstrap\u003c/code\u003e ä¼šåˆå§‹åŒ– Tomcat çš„ç±»åŠ è½½å™¨å¹¶å®ä¾‹åŒ– \u003ccode\u003eCatalina\u003c/code\u003eã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eCatalina\u003c/code\u003e ä¼šé€šè¿‡ Digester è§£æ \u003ccode\u003eserver.xml\u003c/code\u003eï¼Œæ ¹æ®å…¶ä¸­çš„é…ç½®ä¿¡æ¯æ¥åˆ›å»ºç›¸åº”ç»„ä»¶ï¼Œå¹¶è°ƒç”¨ \u003ccode\u003eServer\u003c/code\u003e çš„ \u003ccode\u003estart\u003c/code\u003e æ–¹æ³•ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eServer\u003c/code\u003e è´Ÿè´£ç®¡ç† \u003ccode\u003eService\u003c/code\u003e ç»„ä»¶ï¼Œå®ƒä¼šè°ƒç”¨ \u003ccode\u003eService\u003c/code\u003e çš„ \u003ccode\u003estart\u003c/code\u003e æ–¹æ³•ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eService\u003c/code\u003e è´Ÿè´£ç®¡ç† \u003ccode\u003eConnector\u003c/code\u003e å’Œé¡¶å±‚å®¹å™¨ \u003ccode\u003eEngine\u003c/code\u003eï¼Œå®ƒä¼šè°ƒç”¨ \u003ccode\u003eConnector\u003c/code\u003e å’Œ \u003ccode\u003eEngine\u003c/code\u003e çš„ \u003ccode\u003estart\u003c/code\u003e æ–¹æ³•ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4 id=\"4-1-1-Catalina-ç»„ä»¶\"\u003e\u003ca href=\"#4-1-1-Catalina-ç»„ä»¶\" class=\"headerlink\" title=\"4.1.1. Catalina ç»„ä»¶\"\u003e\u003c/a\u003e4.1.1. Catalina ç»„ä»¶\u003c/h4\u003e\u003cp\u003eCatalina çš„èŒè´£å°±æ˜¯è§£æ server.xml é…ç½®ï¼Œå¹¶æ®æ­¤å®ä¾‹åŒ– Serverã€‚æ¥ä¸‹æ¥ï¼Œè°ƒç”¨ Server ç»„ä»¶çš„ init æ–¹æ³•å’Œ start æ–¹æ³•ï¼Œå°† Tomcat å¯åŠ¨èµ·æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eCatalina è¿˜éœ€è¦å¤„ç†å„ç§â€œå¼‚å¸¸â€æƒ…å†µï¼Œæ¯”å¦‚å½“æˆ‘ä»¬é€šè¿‡â€œCtrl + Câ€å…³é—­ Tomcat æ—¶ï¼ŒTomcat å°†å¦‚ä½•ä¼˜é›…çš„åœæ­¢å¹¶ä¸”æ¸…ç†èµ„æºå‘¢ï¼Ÿå› æ­¤ Catalina åœ¨ JVM ä¸­æ³¨å†Œä¸€ä¸ªâ€œå…³é—­é’©å­â€ã€‚\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003estart\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e//1. å¦‚æœæŒæœ‰çš„ Server å®ä¾‹ä¸ºç©ºï¼Œå°±è§£æ server.xml åˆ›å»ºå‡ºæ¥\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (getServer() == \u003cspan class=\"literal\"\u003enull\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        load();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e//2. å¦‚æœåˆ›å»ºå¤±è´¥ï¼ŒæŠ¥é”™é€€å‡º\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (getServer() == \u003cspan class=\"literal\"\u003enull\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        log.fatal(sm.getString(\u003cspan class=\"string\"\u003e\u0026#34;catalina.noServer\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e//3. å¯åŠ¨ Server\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        getServer().start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    } \u003cspan class=\"keyword\"\u003ecatch\u003c/span\u003e (LifecycleException e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// åˆ›å»ºå¹¶æ³¨å†Œå…³é—­é’©å­\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (useShutdownHook) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (shutdownHook == \u003cspan class=\"literal\"\u003enull\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            shutdownHook = \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eCatalinaShutdownHook\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Runtime.getRuntime().addShutdownHook(shutdownHook);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// ç”¨ await æ–¹æ³•ç›‘å¬åœæ­¢è¯·æ±‚\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (await) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        await();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        stop();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eä¸ºä»€ä¹ˆéœ€è¦å…³é—­é’©å­ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ JVM å…³é—­æ—¶åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚å°†ç¼“å­˜æ•°æ®åˆ·åˆ°ç£ç›˜ä¸Šï¼Œæˆ–è€…æ¸…ç†ä¸€äº›ä¸´æ—¶æ–‡ä»¶ï¼Œå¯ä»¥å‘ JVM æ³¨å†Œä¸€ä¸ªâ€œå…³é—­é’©å­â€ã€‚â€œå…³é—­é’©å­â€å…¶å®å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼ŒJVM åœ¨åœæ­¢ä¹‹å‰ä¼šå°è¯•æ‰§è¡Œè¿™ä¸ªçº¿ç¨‹çš„ \u003ccode\u003erun\u003c/code\u003e æ–¹æ³•ã€‚\u003c/p\u003e\n\u003cp\u003eTomcat çš„â€œå…³é—­é’©å­â€â€”â€” \u003ccode\u003eCatalinaShutdownHook\u003c/code\u003e åšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eCatalinaShutdownHook\u003c/span\u003e \u003cspan class=\"keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"title class_\"\u003eThread\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"meta\"\u003e@Override\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003erun\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (getServer() != \u003cspan class=\"literal\"\u003enull\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                Catalina.\u003cspan class=\"built_in\"\u003ethis\u003c/span\u003e.stop();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        } \u003cspan class=\"keyword\"\u003ecatch\u003c/span\u003e (Throwable ex) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e           ...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eTomcat çš„â€œå…³é—­é’©å­â€å®é™…ä¸Šå°±æ‰§è¡Œäº† \u003ccode\u003eServer\u003c/code\u003e çš„ \u003ccode\u003estop\u003c/code\u003e æ–¹æ³•ï¼Œ\u003ccode\u003eServer\u003c/code\u003e çš„ \u003ccode\u003estop\u003c/code\u003e æ–¹æ³•ä¼šé‡Šæ”¾å’Œæ¸…ç†æ‰€æœ‰çš„èµ„æºã€‚\u003c/p\u003e\n\u003ch4 id=\"4-1-2-Server-ç»„ä»¶\"\u003e\u003ca href=\"#4-1-2-Server-ç»„ä»¶\" class=\"headerlink\" title=\"4.1.2. Server ç»„ä»¶\"\u003e\u003c/a\u003e4.1.2. Server ç»„ä»¶\u003c/h4\u003e\u003cp\u003eServer ç»„ä»¶çš„å…·ä½“å®ç°ç±»æ˜¯ StandardServerï¼ŒServer ç»§æ‰¿äº† LifeCycleBaseï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸè¢«ç»Ÿä¸€ç®¡ç†ï¼Œå¹¶ä¸”å®ƒçš„å­ç»„ä»¶æ˜¯ Serviceï¼Œå› æ­¤å®ƒè¿˜éœ€è¦ç®¡ç† Service çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å¯åŠ¨æ—¶è°ƒç”¨ Service ç»„ä»¶çš„å¯åŠ¨æ–¹æ³•ï¼Œåœ¨åœæ­¢æ—¶è°ƒç”¨å®ƒä»¬çš„åœæ­¢æ–¹æ³•ã€‚Server åœ¨å†…éƒ¨ç»´æŠ¤äº†è‹¥å¹² Service ç»„ä»¶ï¼Œå®ƒæ˜¯ä»¥æ•°ç»„æ¥ä¿å­˜çš„ã€‚\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e@Override\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003eaddService\u003c/span\u003e\u003cspan class=\"params\"\u003e(Service service)\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    service.setServer(\u003cspan class=\"built_in\"\u003ethis\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003esynchronized\u003c/span\u003e (servicesLock) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// åˆ›å»ºä¸€ä¸ªé•¿åº¦ +1 çš„æ–°æ•°ç»„\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Service results[] = \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eService\u003c/span\u003e[services.length + \u003cspan class=\"number\"\u003e1\u003c/span\u003e];\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// å°†è€çš„æ•°æ®å¤åˆ¶è¿‡å»\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        System.arraycopy(services, \u003cspan class=\"number\"\u003e0\u003c/span\u003e, results, \u003cspan class=\"number\"\u003e0\u003c/span\u003e, services.length);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        results[services.length] = service;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        services = results;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// å¯åŠ¨ Service ç»„ä»¶\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (getState().isAvailable()) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                service.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            } \u003cspan class=\"keyword\"\u003ecatch\u003c/span\u003e (LifecycleException e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e// Ignore\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// è§¦å‘ç›‘å¬äº‹ä»¶\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        support.firePropertyChange(\u003cspan class=\"string\"\u003e\u0026#34;service\u0026#34;\u003c/span\u003e, \u003cspan class=\"literal\"\u003enull\u003c/span\u003e, service);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eServer å¹¶æ²¡æœ‰ä¸€å¼€å§‹å°±åˆ†é…ä¸€ä¸ªå¾ˆé•¿çš„æ•°ç»„ï¼Œè€Œæ˜¯åœ¨æ·»åŠ çš„è¿‡ç¨‹ä¸­åŠ¨æ€åœ°æ‰©å±•æ•°ç»„é•¿åº¦ï¼Œå½“æ·»åŠ ä¸€ä¸ªæ–°çš„ Service å®ä¾‹æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„å¹¶æŠŠåŸæ¥æ•°ç»„å†…å®¹å¤åˆ¶åˆ°æ–°æ•°ç»„ï¼Œè¿™æ ·åšçš„ç›®çš„å…¶å®æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´ã€‚\u003c/p\u003e\n\u003cp\u003eé™¤æ­¤ä¹‹å¤–ï¼ŒServer ç»„ä»¶è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡æ˜¯å¯åŠ¨ä¸€ä¸ª Socket æ¥ç›‘å¬åœæ­¢ç«¯å£ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ èƒ½é€šè¿‡ shutdown å‘½ä»¤æ¥å…³é—­ Tomcatã€‚ä¸çŸ¥é“ä½ ç•™æ„åˆ°æ²¡æœ‰ï¼Œä¸Šé¢ Caralina çš„å¯åŠ¨æ–¹æ³•çš„æœ€åä¸€è¡Œä»£ç å°±æ˜¯è°ƒç”¨äº† Server çš„ await æ–¹æ³•ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ await æ–¹æ³•é‡Œä¼šåˆ›å»ºä¸€ä¸ª Socket ç›‘å¬ 8005 ç«¯å£ï¼Œå¹¶åœ¨ä¸€ä¸ªæ­»å¾ªç¯é‡Œæ¥æ”¶ Socket ä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œå¦‚æœæœ‰æ–°çš„è¿æ¥åˆ°æ¥å°±å»ºç«‹è¿æ¥ï¼Œç„¶åä» Socket ä¸­è¯»å–æ•°æ®ï¼›å¦‚æœè¯»åˆ°çš„æ•°æ®æ˜¯åœæ­¢å‘½ä»¤â€œSHUTDOWNâ€ï¼Œå°±é€€å‡ºå¾ªç¯ï¼Œè¿›å…¥ stop æµç¨‹ã€‚\u003c/p\u003e\n\u003ch4 id=\"4-1-3-Service-ç»„ä»¶\"\u003e\u003ca href=\"#4-1-3-Service-ç»„ä»¶\" class=\"headerlink\" title=\"4.1.3. Service ç»„ä»¶\"\u003e\u003c/a\u003e4.1.3. Service ç»„ä»¶\u003c/h4\u003e\u003cp\u003eService ç»„ä»¶çš„å…·ä½“å®ç°ç±»æ˜¯ StandardServiceã€‚\u003c/p\u003e\n\u003cp\u003eã€æºç ã€‘StandardService æºç å®šä¹‰\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eStandardService\u003c/span\u003e \u003cspan class=\"keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"title class_\"\u003eLifecycleBase\u003c/span\u003e \u003cspan class=\"keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"title class_\"\u003eService\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// åå­—\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"type\"\u003eString\u003c/span\u003e \u003cspan class=\"variable\"\u003ename\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"literal\"\u003enull\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e//Server å®ä¾‹\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"type\"\u003eServer\u003c/span\u003e \u003cspan class=\"variable\"\u003eserver\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"literal\"\u003enull\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// è¿æ¥å™¨æ•°ç»„\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprotected\u003c/span\u003e Connector connectors[] = \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eConnector\u003c/span\u003e[\u003cspan class=\"number\"\u003e0\u003c/span\u003e];\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eObject\u003c/span\u003e \u003cspan class=\"variable\"\u003econnectorsLock\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eObject\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// å¯¹åº”çš„ Engine å®¹å™¨\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"type\"\u003eEngine\u003c/span\u003e \u003cspan class=\"variable\"\u003eengine\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"literal\"\u003enull\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// æ˜ å°„å™¨åŠå…¶ç›‘å¬å™¨\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eMapper\u003c/span\u003e \u003cspan class=\"variable\"\u003emapper\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMapper\u003c/span\u003e();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"type\"\u003eMapperListener\u003c/span\u003e \u003cspan class=\"variable\"\u003emapperListener\u003c/span\u003e \u003cspan class=\"operator\"\u003e=\u003c/span\u003e \u003cspan class=\"keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"title class_\"\u003eMapperListener\u003c/span\u003e(\u003cspan class=\"built_in\"\u003ethis\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"comment\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eStandardService ç»§æ‰¿äº† LifecycleBase æŠ½è±¡ç±»ã€‚\u003c/p\u003e\n\u003cp\u003eStandardService ç»´æŠ¤äº†ä¸€ä¸ª MapperListener ç”¨äºæ”¯æŒ Tomcat çƒ­éƒ¨ç½²ã€‚å½“ Web åº”ç”¨çš„éƒ¨ç½²å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒMapper ä¸­çš„æ˜ å°„ä¿¡æ¯ä¹Ÿè¦è·Ÿç€å˜åŒ–ï¼ŒMapperListener å°±æ˜¯ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒç›‘å¬å®¹å™¨çš„å˜åŒ–ï¼Œå¹¶æŠŠä¿¡æ¯æ›´æ–°åˆ° Mapper ä¸­ï¼Œè¿™æ˜¯å…¸å‹çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚\u003c/p\u003e\n\u003cp\u003eä½œä¸ºâ€œç®¡ç†â€è§’è‰²çš„ç»„ä»¶ï¼Œæœ€é‡è¦çš„æ˜¯ç»´æŠ¤å…¶ä»–ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚æ­¤å¤–åœ¨å¯åŠ¨å„ç§ç»„ä»¶æ—¶ï¼Œè¦æ³¨æ„å®ƒä»¬çš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æ³¨æ„å¯åŠ¨çš„é¡ºåºã€‚\u003c/p\u003e\n\u003cfigure class=\"highlight java\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title function_\"\u003estartInternal\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e \u003cspan class=\"keyword\"\u003ethrows\u003c/span\u003e LifecycleException {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e//1. è§¦å‘å¯åŠ¨ç›‘å¬å™¨\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    setState(LifecycleState.STARTING);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e//2. å…ˆå¯åŠ¨ Engineï¼ŒEngine ä¼šå¯åŠ¨å®ƒå­å®¹å™¨\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (engine != \u003cspan class=\"literal\"\u003enull\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003esynchronized\u003c/span\u003e (engine) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            engine.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e//3. å†å¯åŠ¨ Mapper ç›‘å¬å™¨\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    mapperListener.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e//4. æœ€åå¯åŠ¨è¿æ¥å™¨ï¼Œè¿æ¥å™¨ä¼šå¯åŠ¨å®ƒå­ç»„ä»¶ï¼Œæ¯”å¦‚ Endpoint\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003esynchronized\u003c/span\u003e (connectorsLock) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e (Connector connector: connectors) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (connector.getState() != LifecycleState.FAILED) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                connector.start();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eä»å¯åŠ¨æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼ŒService å…ˆå¯åŠ¨äº† Engine ç»„ä»¶ï¼Œå†å¯åŠ¨ Mapper ç›‘å¬å™¨ï¼Œæœ€åæ‰æ˜¯å¯åŠ¨è¿æ¥å™¨ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºå†…å±‚ç»„ä»¶å¯åŠ¨å¥½äº†æ‰èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ‰èƒ½å¯åŠ¨å¤–å±‚çš„è¿æ¥å™¨ç»„ä»¶ã€‚è€Œ Mapper ä¹Ÿä¾èµ–å®¹å™¨ç»„ä»¶ï¼Œå®¹å™¨ç»„ä»¶å¯åŠ¨å¥½äº†æ‰èƒ½ç›‘å¬å®ƒä»¬çš„å˜åŒ–ï¼Œå› æ­¤ Mapper å’Œ MapperListener åœ¨å®¹å™¨ç»„ä»¶ä¹‹åå¯åŠ¨ã€‚ç»„ä»¶åœæ­¢çš„é¡ºåºè·Ÿå¯åŠ¨é¡ºåºæ­£å¥½ç›¸åçš„ï¼Œä¹Ÿæ˜¯åŸºäºå®ƒä»¬çš„ä¾èµ–å…³ç³»ã€‚\u003c/p\u003e\n\u003ch4 id=\"4-1-4-Engine-ç»„ä»¶\"\u003e\u003ca href=\"#4-1-4-Engine-ç»„ä»¶\" class=\"headerlink\" title=\"4.1.4. Engine ç»„ä»¶\"\u003e\u003c/a\u003e4.1.4. Engine ç»„ä»¶\u003c/h4\u003e\u003cp\u003eEngine æœ¬è´¨æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå› æ­¤å®ƒç»§æ‰¿äº† ContainerBase åŸºç±»ï¼Œå¹¶ä¸”å®ç°äº† Engine æ¥å£ã€‚\u003c/p\u003e\n\u003ch3 id=\"4-2-Web-åº”ç”¨çš„éƒ¨ç½²æ–¹å¼\"\u003e\u003ca href=\"#4-2-Web-åº”ç”¨çš„éƒ¨ç½²æ–¹å¼\" class=\"headerlink\" title=\"4.2. Web åº”ç”¨çš„éƒ¨ç½²æ–¹å¼\"\u003e\u003c/a\u003e4.2. Web åº”ç”¨çš„éƒ¨ç½²æ–¹å¼\u003c/h3\u003e\u003cp\u003eæ³¨ï¼šcatalina.homeï¼šå®‰è£…ç›®å½•;catalina.baseï¼šå·¥ä½œç›®å½•;é»˜è®¤å€¼ user.dir\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eServer.xml é…ç½® Host å…ƒç´ ï¼ŒæŒ‡å®š appBase å±æ€§ï¼Œé»˜è®¤$catalina.base/webapps/\u003c/li\u003e\n\u003cli\u003eServer.xml é…ç½® Context å…ƒç´ ï¼ŒæŒ‡å®š docBaseï¼Œå…ƒç´ ï¼ŒæŒ‡å®š web åº”ç”¨çš„è·¯å¾„\u003c/li\u003e\n\u003cli\u003eè‡ªå®šä¹‰é…ç½®ï¼šåœ¨$catalina.base/EngineName/HostName/XXX.xml é…ç½® Context å…ƒç´ \u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHostConfig ç›‘å¬äº† StandardHost å®¹å™¨çš„äº‹ä»¶ï¼Œåœ¨ start æ–¹æ³•ä¸­è§£æä¸Šè¿°é…ç½®æ–‡ä»¶ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ‰«æ appbase è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹å’Œ war åŒ…ï¼Œè§£æå„ä¸ªåº”ç”¨çš„ META-INF/context.xmlï¼Œå¹¶ åˆ›å»º StandardContextï¼Œå¹¶å°† Context åŠ å…¥åˆ° Host çš„å­å®¹å™¨ä¸­ã€‚\u003c/li\u003e\n\u003cli\u003eè§£æ$catalina.base/EngineName/HostName/ä¸‹çš„æ‰€æœ‰ Context é…ç½®ï¼Œæ‰¾åˆ°ç›¸åº” web åº” ç”¨çš„ä½ç½®ï¼Œè§£æå„ä¸ªåº”ç”¨çš„ META-INF/context.xmlï¼Œå¹¶åˆ›å»º StandardContextï¼Œå¹¶å°† Context åŠ å…¥åˆ° Host çš„å­å®¹å™¨ä¸­ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ³¨ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHostConfig å¹¶æ²¡æœ‰å®é™…è§£æ Context.xmlï¼Œè€Œæ˜¯åœ¨ ContextConfig ä¸­è¿›è¡Œçš„ã€‚\u003c/li\u003e\n\u003cli\u003eHostConfig ä¸­ä¼šå®šæœŸæ£€æŸ¥ watched èµ„æºæ–‡ä»¶(context.xml é…ç½®æ–‡ä»¶)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eContextConfig è§£æ context.xml é¡ºåºï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå…ˆè§£æå…¨å±€çš„é…ç½® config/context.xml\u003c/li\u003e\n\u003cli\u003eç„¶åè§£æ Host çš„é»˜è®¤é…ç½® EngineName/HostName/context.xml.default\u003c/li\u003e\n\u003cli\u003eæœ€åè§£æåº”ç”¨çš„ META-INF/context.xml\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eContextConfig è§£æ web.xml é¡ºåºï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå…ˆè§£æå…¨å±€çš„é…ç½® config/web.xml\u003c/li\u003e\n\u003cli\u003eç„¶åè§£æ Host çš„é»˜è®¤é…ç½® EngineName/HostName/web.xml.default æ¥ç€è§£æåº”ç”¨çš„ MEB-INF/web.xml\u003c/li\u003e\n\u003cli\u003eæ‰«æåº”ç”¨ WEB-INF/lib/ä¸‹çš„ jar æ–‡ä»¶ï¼Œè§£æå…¶ä¸­çš„ META-INF/web-fragment.xml æœ€ååˆå¹¶ xml å°è£…æˆ WebXmlï¼Œå¹¶è®¾ç½® Context\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ³¨ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ‰«æ web åº”ç”¨å’Œ jar ä¸­çš„æ³¨è§£(Filterã€Listenerã€Servlet)å°±æ˜¯ä¸Šè¿°æ­¥éª¤ä¸­è¿›è¡Œçš„ã€‚\u003c/li\u003e\n\u003cli\u003eå®¹å™¨çš„å®šæœŸæ‰§è¡Œï¼šbackgroundProcessï¼Œç”± ContainerBase æ¥å®ç°çš„ï¼Œå¹¶ä¸”åªæœ‰åœ¨é¡¶å±‚å®¹å™¨ ä¸­æ‰ä¼šå¼€å¯çº¿ç¨‹ã€‚(backgroundProcessorDelay=10 æ ‡å¿—ä½æ¥æ§åˆ¶)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"4-3-LifeCycle\"\u003e\u003ca href=\"#4-3-LifeCycle\" class=\"headerlink\" title=\"4.3. LifeCycle\"\u003e\u003c/a\u003e4.3. LifeCycle\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/snap/20201118105012.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch4 id=\"4-3-1-è¯·æ±‚å¤„ç†è¿‡ç¨‹\"\u003e\u003ca href=\"#4-3-1-è¯·æ±‚å¤„ç†è¿‡ç¨‹\" class=\"headerlink\" title=\"4.3.1. è¯·æ±‚å¤„ç†è¿‡ç¨‹\"\u003e\u003c/a\u003e4.3.1. è¯·æ±‚å¤„ç†è¿‡ç¨‹\u003c/h4\u003e\u003cdiv align=\"center\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/è¯·æ±‚å¤„ç†è¿‡ç¨‹.png\" width=\"600\"/\u003e\n\u003c/div\u003e\n\n\u003col\u003e\n\u003cli\u003eæ ¹æ® server.xml é…ç½®çš„æŒ‡å®šçš„ connector ä»¥åŠç«¯å£ç›‘å¬ httpã€æˆ–è€… ajp è¯·æ±‚\u003c/li\u003e\n\u003cli\u003eè¯·æ±‚åˆ°æ¥æ—¶å»ºç«‹è¿æ¥,è§£æè¯·æ±‚å‚æ•°,åˆ›å»º Request å’Œ Response å¯¹è±¡,è°ƒç”¨é¡¶å±‚å®¹å™¨ pipeline çš„ invoke æ–¹æ³•\u003c/li\u003e\n\u003cli\u003eå®¹å™¨ä¹‹é—´å±‚å±‚è°ƒç”¨,æœ€ç»ˆè°ƒç”¨ä¸šåŠ¡ servlet çš„ service æ–¹æ³•\u003c/li\u003e\n\u003cli\u003eConnector å°† response æµä¸­çš„æ•°æ®å†™åˆ° socket ä¸­\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"4-4-Connector-æµç¨‹\"\u003e\u003ca href=\"#4-4-Connector-æµç¨‹\" class=\"headerlink\" title=\"4.4. Connector æµç¨‹\"\u003e\u003c/a\u003e4.4. Connector æµç¨‹\u003c/h3\u003e\u003cdiv align=\"center\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/connector.png\" width=\"600\"/\u003e\n\u003c/div\u003e\n\n\u003ch4 id=\"4-4-1-é˜»å¡-IO\"\u003e\u003ca href=\"#4-4-1-é˜»å¡-IO\" class=\"headerlink\" title=\"4.4.1. é˜»å¡ IO\"\u003e\u003c/a\u003e4.4.1. é˜»å¡ IO\u003c/h4\u003e\u003cdiv align=\"center\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/é˜»å¡IO.png\" width=\"600\"/\u003e\n\u003c/div\u003e\n\n\u003ch4 id=\"4-4-2-éé˜»å¡-IO\"\u003e\u003ca href=\"#4-4-2-éé˜»å¡-IO\" class=\"headerlink\" title=\"4.4.2. éé˜»å¡ IO\"\u003e\u003c/a\u003e4.4.2. éé˜»å¡ IO\u003c/h4\u003e\u003cdiv align=\"center\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/éé˜»å¡IO.png\" width=\"600\"/\u003e\n\u003c/div\u003e\n\n\u003ch4 id=\"4-4-3-IO-å¤šè·¯å¤ç”¨\"\u003e\u003ca href=\"#4-4-3-IO-å¤šè·¯å¤ç”¨\" class=\"headerlink\" title=\"4.4.3. IO å¤šè·¯å¤ç”¨\"\u003e\u003c/a\u003e4.4.3. IO å¤šè·¯å¤ç”¨\u003c/h4\u003e\u003cdiv align=\"center\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/IOå¤šè·¯å¤ç”¨.png\" width=\"600\"/\u003e\n\u003c/div\u003e\n\n\u003cp\u003eé˜»å¡ä¸éé˜»å¡çš„åŒºåˆ«åœ¨äºè¿›è¡Œè¯»æ“ä½œå’Œå†™æ“ä½œçš„ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå¦‚æœæ­¤æ—¶å†…æ ¸æ€æ²¡æœ‰æ•°æ®å¯è¯»æˆ–è€…æ²¡æœ‰ç¼“å†²ç©ºé—´å¯å†™æ—¶ï¼Œæ˜¯å¦é˜»å¡ã€‚\u003c/p\u003e\n\u003cp\u003eIO å¤šè·¯å¤ç”¨çš„å¥½å¤„åœ¨äºå¯åŒæ—¶ç›‘å¬å¤šä¸ª socket çš„å¯è¯»å’Œå¯å†™äº‹ä»¶ï¼Œè¿™æ ·å°±èƒ½ä½¿å¾—åº”ç”¨å¯ä»¥åŒæ—¶ç›‘å¬å¤šä¸ª socketï¼Œé‡Šæ”¾äº†åº”ç”¨çº¿ç¨‹èµ„æºã€‚\u003c/p\u003e\n\u003ch4 id=\"4-4-4-Tomcat-å„ç±»-Connector-å¯¹æ¯”\"\u003e\u003ca href=\"#4-4-4-Tomcat-å„ç±»-Connector-å¯¹æ¯”\" class=\"headerlink\" title=\"4.4.4. Tomcat å„ç±» Connector å¯¹æ¯”\"\u003e\u003c/a\u003e4.4.4. Tomcat å„ç±» Connector å¯¹æ¯”\u003c/h4\u003e\u003cdiv align=\"center\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/Tomcatå„ç±»Connectorå¯¹æ¯”.jpg\" width=\"500\"/\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eJIOï¼šç”¨ java.io ç¼–å†™çš„ TCP æ¨¡å—ï¼Œé˜»å¡ IO\u003c/li\u003e\n\u003cli\u003eNIOï¼šç”¨ java.nio ç¼–å†™çš„ TCP æ¨¡å—ï¼Œéé˜»å¡ IOï¼Œï¼ˆIO å¤šè·¯å¤ç”¨ï¼‰\u003c/li\u003e\n\u003cli\u003eAPRï¼šå…¨ç§° Apache Portable Runtimeï¼Œä½¿ç”¨ JNI çš„æ–¹å¼æ¥è¿›è¡Œè¯»å–æ–‡ä»¶ä»¥åŠè¿›è¡Œç½‘ç»œä¼ è¾“\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eApache Portable Runtime æ˜¯ä¸€ä¸ªé«˜åº¦å¯ç§»æ¤çš„åº“ï¼Œå®ƒæ˜¯ Apache HTTP Server 2.x çš„æ ¸å¿ƒã€‚ APR å…·æœ‰è®¸å¤šç”¨é€”ï¼ŒåŒ…æ‹¬è®¿é—®é«˜çº§ IO åŠŸèƒ½ï¼ˆå¦‚ sendfileï¼Œepoll å’Œ OpenSSLï¼‰ï¼Œæ“ä½œç³»ç»Ÿçº§åŠŸèƒ½ï¼ˆéšæœºæ•°ç”Ÿæˆï¼Œç³»ç»ŸçŠ¶æ€ç­‰ï¼‰å’Œæœ¬åœ°è¿›ç¨‹å¤„ç†ï¼ˆå…±äº«å†…å­˜ï¼ŒNT ç®¡é“å’Œ Unix å¥—æ¥å­—ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003eè¡¨æ ¼ä¸­å­—æ®µå«ä¹‰è¯´æ˜ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSupport Polling - æ˜¯å¦æ”¯æŒåŸºäº IO å¤šè·¯å¤ç”¨çš„ socket äº‹ä»¶è½®è¯¢\u003c/li\u003e\n\u003cli\u003ePolling Size - è½®è¯¢çš„æœ€å¤§è¿æ¥æ•°\u003c/li\u003e\n\u003cli\u003eWait for next Request - åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå¤„ç†çº¿ç¨‹æ˜¯å¦é‡Šæ”¾ï¼ŒBIO æ˜¯æ²¡æœ‰é‡Šæ”¾çš„ï¼Œæ‰€ä»¥åœ¨ keep-alive=true çš„æƒ…å†µä¸‹å¤„ç†çš„å¹¶å‘è¿æ¥æ•°æœ‰é™\u003c/li\u003e\n\u003cli\u003eRead Request Headers - ç”±äº request header æ•°æ®è¾ƒå°‘ï¼Œå¯ä»¥ç”±å®¹å™¨æå‰è§£æå®Œæ¯•ï¼Œä¸éœ€è¦é˜»å¡\u003c/li\u003e\n\u003cli\u003eRead Request Body - è¯»å– request body çš„æ•°æ®æ˜¯åº”ç”¨ä¸šåŠ¡é€»è¾‘çš„äº‹æƒ…ï¼ŒåŒæ—¶ Servlet çš„é™åˆ¶ï¼Œæ˜¯éœ€è¦é˜»å¡è¯»å–çš„\u003c/li\u003e\n\u003cli\u003eWrite Response - è·Ÿè¯»å– request body çš„é€»è¾‘ç±»ä¼¼ï¼ŒåŒæ ·éœ€è¦é˜»å¡å†™\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eNIO å¤„ç†ç›¸å…³ç±»\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/NIOå¤„ç†ç›¸å…³ç±».jpg\" width=\"500\"/\u003e\n\u003c/div\u003e\n\n\u003cp\u003ePoller çº¿ç¨‹ä» EventQueue è·å– PollerEventï¼Œå¹¶æ‰§è¡Œ PollerEvent çš„ run æ–¹æ³•ï¼Œè°ƒç”¨ Selector çš„ select æ–¹æ³•ï¼Œå¦‚æœæœ‰å¯è¯»çš„ Socket åˆ™åˆ›å»º Http11NioProcessorï¼Œæ”¾å…¥åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼›\u003c/p\u003e\n\u003cp\u003eCoyoteAdapter æ˜¯ Connector åˆ° Container çš„é€‚é…å™¨ï¼ŒHttp11NioProcessor è°ƒç”¨å…¶æä¾›çš„ service æ–¹æ³•ï¼Œå†…éƒ¨åˆ›å»º Request å’Œ Response å¯¹è±¡ï¼Œå¹¶è°ƒç”¨æœ€é¡¶å±‚å®¹å™¨çš„ Pipeline ä¸­çš„ç¬¬ä¸€ä¸ª Valve çš„ invoke æ–¹æ³•\u003c/p\u003e\n\u003cp\u003eMapper ä¸»è¦å¤„ç† http url åˆ° servlet çš„æ˜ å°„è§„åˆ™çš„è§£æï¼Œå¯¹å¤–æä¾› map æ–¹æ³•\u003c/p\u003e\n\u003ch3 id=\"4-5-Comet\"\u003e\u003ca href=\"#4-5-Comet\" class=\"headerlink\" title=\"4.5. Comet\"\u003e\u003c/a\u003e4.5. Comet\u003c/h3\u003e\u003cp\u003eComet æ˜¯ä¸€ç§ç”¨äº web çš„æ¨é€æŠ€æœ¯ï¼Œèƒ½ä½¿æœåŠ¡å™¨å®æ—¶åœ°å°†æ›´æ–°çš„ä¿¡æ¯ä¼ é€åˆ°å®¢æˆ·ç«¯ï¼Œè€Œæ— é¡»å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚\u003cbr/\u003eåœ¨ WebSocket å‡ºæ¥ä¹‹å‰ï¼Œå¦‚æœä¸é€‚ç”¨ cometï¼Œåªèƒ½é€šè¿‡æµè§ˆå™¨ç«¯è½®è¯¢ Server æ¥æ¨¡æ‹Ÿå®ç°æœåŠ¡å™¨ç«¯æ¨é€ã€‚\u003cbr/\u003eComet æ”¯æŒ servlet å¼‚æ­¥å¤„ç† IOï¼Œå½“è¿æ¥ä¸Šæ•°æ®å¯è¯»æ—¶è§¦å‘äº‹ä»¶ï¼Œå¹¶å¼‚æ­¥å†™æ•°æ®(é˜»å¡)\u003c/p\u003e\n\u003cp\u003eTomcat è¦å®ç° Cometï¼Œåªéœ€ç»§æ‰¿ HttpServlet åŒæ—¶ï¼Œå®ç° CometProcessor æ¥å£\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBeginï¼šæ–°çš„è¯·æ±‚è¿æ¥æ¥å…¥è°ƒç”¨ï¼Œå¯è¿›è¡Œä¸ Request å’Œ Response ç›¸å…³çš„å¯¹è±¡åˆå§‹åŒ–æ“ä½œï¼Œå¹¶ä¿å­˜ response å¯¹è±¡ï¼Œç”¨äºåç»­å†™å…¥æ•°æ®\u003c/li\u003e\n\u003cli\u003eReadï¼šè¯·æ±‚è¿æ¥æœ‰æ•°æ®å¯è¯»æ—¶è°ƒç”¨\u003c/li\u003e\n\u003cli\u003eEndï¼šå½“æ•°æ®å¯ç”¨æ—¶ï¼Œå¦‚æœè¯»å–åˆ°æ–‡ä»¶ç»“æŸæˆ–è€… response è¢«å…³é—­æ—¶åˆ™è¢«è°ƒç”¨\u003c/li\u003e\n\u003cli\u003eErrorï¼šåœ¨è¿æ¥ä¸Šå‘ç”Ÿå¼‚å¸¸æ—¶è°ƒç”¨ï¼Œæ•°æ®è¯»å–å¼‚å¸¸ã€è¿æ¥æ–­å¼€ã€å¤„ç†å¼‚å¸¸ã€socket è¶…æ—¶\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNoteï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eReadï¼šåœ¨ post è¯·æ±‚æœ‰æ•°æ®ï¼Œä½†åœ¨ begin äº‹ä»¶ä¸­æ²¡æœ‰å¤„ç†ï¼Œåˆ™ä¼šè°ƒç”¨ readï¼Œå¦‚æœ read æ²¡æœ‰è¯»å–æ•°æ®ï¼Œåœ¨ä¼šè§¦å‘ Error å›è°ƒï¼Œå…³é—­ socket\u003c/li\u003e\n\u003cli\u003eEndï¼šå½“ socket è¶…æ—¶ï¼Œå¹¶ä¸” response è¢«å…³é—­æ—¶ä¹Ÿä¼šè°ƒç”¨ï¼›server è¢«å…³é—­æ—¶è°ƒç”¨\u003c/li\u003e\n\u003cli\u003eErrorï¼šé™¤äº† socket è¶…æ—¶ä¸ä¼šå…³é—­ socketï¼Œå…¶ä»–éƒ½ä¼šå…³é—­ socket\u003c/li\u003e\n\u003cli\u003eEnd å’Œ Error æ—¶é—´è§¦å‘æ—¶åº”å…³é—­å½“å‰ comet ä¼šè¯ï¼Œå³è°ƒç”¨ CometEvent çš„ close æ–¹æ³•\u003cbr/\u003eNoteï¼šåœ¨äº‹ä»¶è§¦å‘æ—¶è¦åšå¥½çº¿ç¨‹å®‰å…¨çš„æ“ä½œ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"4-6-å¼‚æ­¥-Servlet\"\u003e\u003ca href=\"#4-6-å¼‚æ­¥-Servlet\" class=\"headerlink\" title=\"4.6. å¼‚æ­¥ Servlet\"\u003e\u003c/a\u003e4.6. å¼‚æ­¥ Servlet\u003c/h3\u003e\u003cdiv align=\"center\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/ä¼ ç»ŸServletå¤„ç†æµç¨‹.png\"/\u003e\n\u003c/div\u003e\n\n\u003cp\u003eä¼ ç»Ÿæµç¨‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eé¦–å…ˆï¼ŒServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œrequest æ•°æ®è§£æï¼›\u003c/li\u003e\n\u003cli\u003eæ¥ç€ï¼Œè°ƒç”¨ä¸šåŠ¡æ¥å£çš„æŸäº›æ–¹æ³•ï¼Œä»¥å®Œæˆä¸šåŠ¡å¤„ç†ï¼›\u003c/li\u003e\n\u003cli\u003eæœ€åï¼Œæ ¹æ®å¤„ç†çš„ç»“æœæäº¤å“åº”ï¼ŒServlet çº¿ç¨‹ç»“æŸ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv align=\"center\"\u003e\n\u003cimg src=\"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javaweb/tools/tomcat/å¼‚æ­¥Servletå¤„ç†æµç¨‹.png\"/\u003e\n\u003c/div\u003e\n\n\u003cp\u003eå¼‚æ­¥å¤„ç†æµç¨‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚\u003c/li\u003e\n\u003cli\u003eServlet å®¹å™¨åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å®¹å™¨ä¸­çš„ä¸€ä¸ª servlet\u003c/li\u003e\n\u003cli\u003eservlet è°ƒç”¨ request.startAsync()ï¼Œä¿å­˜ AsyncContext, ç„¶åè¿”å›\u003c/li\u003e\n\u003cli\u003eä»»ä½•æ–¹å¼å­˜åœ¨çš„å®¹å™¨çº¿ç¨‹éƒ½å°†é€€å‡ºï¼Œä½†æ˜¯ response ä»ç„¶ä¿æŒå¼€æ”¾\u003c/li\u003e\n\u003cli\u003eä¸šåŠ¡çº¿ç¨‹ä½¿ç”¨ä¿å­˜çš„ AsyncContext æ¥å®Œæˆå“åº”ï¼ˆçº¿ç¨‹æ± ï¼‰\u003c/li\u003e\n\u003cli\u003eå®¢æˆ·ç«¯æ”¶åˆ°å“åº”\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eServlet çº¿ç¨‹å°†è¯·æ±‚è½¬äº¤ç»™ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹æ¥æ‰§è¡Œä¸šåŠ¡å¤„ç†ï¼Œçº¿ç¨‹æœ¬èº«è¿”å›è‡³å®¹å™¨ï¼Œæ­¤æ—¶ Servlet è¿˜æ²¡æœ‰ç”Ÿæˆå“åº”æ•°æ®ï¼Œå¼‚æ­¥çº¿ç¨‹å¤„ç†å®Œä¸šåŠ¡ä»¥åï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆå“åº”æ•°æ®ï¼ˆå¼‚æ­¥çº¿ç¨‹æ‹¥æœ‰ ServletRequest å’Œ ServletResponse å¯¹è±¡çš„å¼•ç”¨ï¼‰\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eä¸ºä»€ä¹ˆ web åº”ç”¨ä¸­æ”¯æŒå¼‚æ­¥ï¼Ÿ\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eæ¨å‡ºå¼‚æ­¥ï¼Œä¸»è¦æ˜¯é’ˆå¯¹é‚£äº›æ¯”è¾ƒè€—æ—¶çš„è¯·æ±‚ï¼šæ¯”å¦‚ä¸€æ¬¡ç¼“æ…¢çš„æ•°æ®åº“æŸ¥è¯¢ï¼Œä¸€æ¬¡å¤–éƒ¨ REST API è°ƒç”¨, æˆ–è€…æ˜¯å…¶ä»–ä¸€äº› I/O å¯†é›†å‹æ“ä½œã€‚è¿™ç§è€—æ—¶çš„è¯·æ±‚ä¼šå¾ˆå¿«çš„è€—å…‰ Servlet å®¹å™¨çš„çº¿ç¨‹æ± ï¼Œç»§è€Œå½±å“å¯æ‰©å±•æ€§ã€‚\u003c/p\u003e\n\u003cp\u003eNoteï¼šä»å®¢æˆ·ç«¯çš„è§’åº¦æ¥çœ‹ï¼Œrequest ä»ç„¶åƒä»»ä½•å…¶ä»–çš„ HTTP çš„ request-response äº¤äº’ä¸€æ ·ï¼Œåªæ˜¯è€—è´¹äº†æ›´é•¿çš„æ—¶é—´è€Œå·²\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå¼‚æ­¥äº‹ä»¶ç›‘å¬\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eonStartAsyncï¼šRequest è°ƒç”¨ startAsync æ–¹æ³•æ—¶è§¦å‘\u003c/li\u003e\n\u003cli\u003eonCompleteï¼šsyncContext è°ƒç”¨ complete æ–¹æ³•æ—¶è§¦å‘\u003c/li\u003e\n\u003cli\u003eonErrorï¼šå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹å‡ºç°å¼‚å¸¸æ—¶è§¦å‘\u003c/li\u003e\n\u003cli\u003eonTimeoutï¼šsocket è¶…æ—¶è§¦å‘\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNote :\u003cbr/\u003eonError/ onTimeout è§¦å‘åï¼Œä¼šç´§æ¥ç€å›è°ƒ onComplete\u003cbr/\u003eonComplete æ‰§è¡Œåï¼Œå°±ä¸å¯å†æ“ä½œ request å’Œ response\u003c/p\u003e\n\u003ch2 id=\"5-å‚è€ƒèµ„æ–™\"\u003e\u003ca href=\"#5-å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"5. å‚è€ƒèµ„æ–™\"\u003e\u003c/a\u003e5. å‚è€ƒèµ„æ–™\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eå®˜æ–¹\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://tomcat.apache.org/\"\u003eTomcat å®˜æ–¹ç½‘ç«™\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://wiki.apache.org/tomcat/FrontPage\"\u003eTomcat Wiki\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://tomee.apache.org/\"\u003eTomee å®˜æ–¹ç½‘ç«™\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eæ–‡ç« \u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/basic_app_embedded_tomcat/basic_app-tomcat-embedded.html\"\u003eCreating a Web App with Bootstrap and Tomcat Embedded\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://juejin.im/post/58eb5fdda0bb9f00692a78fc\"\u003eTomcat ç»„æˆä¸å·¥ä½œåŸç†\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.ibm.com/developerworks/cn/java/j-lo-tomcat1/index.html\"\u003eTomcat å·¥ä½œåŸç†\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.ibm.com/developerworks/cn/java/j-lo-tomcat2/index.html?ca=drs-\"\u003eTomcat è®¾è®¡æ¨¡å¼åˆ†æ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2022-02-17T14:34:30Z",
  "Author": "é’æ‚Ÿ â—¾ Dunwu"
}