{
  "Source": "dunwu",
  "Title": "Filebeat 运维",
  "Link": "https://dunwu.github.io/blog/pages/7c067f/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"Filebeat-运维\"\u003e\u003ca href=\"#Filebeat-运维\" class=\"headerlink\" title=\"Filebeat 运维\"\u003e\u003c/a\u003eFilebeat 运维\u003c/h1\u003e\u003cblockquote\u003e\n\u003cp\u003eBeats 平台集合了多种单一用途数据采集器。它们从成百上千或成千上万台机器和系统向 Logstash 或 Elasticsearch 发送数据。\u003c/p\u003e\n\u003cp\u003e因为我只接触过 Filebeat，所有本文仅介绍 Filebeat 的日常运维。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"1-Filebeat-安装\"\u003e\u003ca href=\"#1-Filebeat-安装\" class=\"headerlink\" title=\"1. Filebeat 安装\"\u003e\u003c/a\u003e1. Filebeat 安装\u003c/h2\u003e\u003ch3 id=\"1-1-环境要求\"\u003e\u003ca href=\"#1-1-环境要求\" class=\"headerlink\" title=\"1.1. 环境要求\"\u003e\u003c/a\u003e1.1. 环境要求\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e版本：Elastic Stack 7.4\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"1-2-安装步骤\"\u003e\u003ca href=\"#1-2-安装步骤\" class=\"headerlink\" title=\"1.2. 安装步骤\"\u003e\u003c/a\u003e1.2. 安装步骤\u003c/h3\u003e\u003cp\u003eUnix / Linux 系统建议使用下面方式安装，因为比较通用。\u003c/p\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ewget\u003c/span\u003e https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-\u003cspan class=\"number\"\u003e6\u003c/span\u003e.\u003cspan class=\"number\"\u003e1\u003c/span\u003e.\u003cspan class=\"number\"\u003e1\u003c/span\u003e-linux-x86_64.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003etar\u003c/span\u003e -zxf filebeat-\u003cspan class=\"number\"\u003e6\u003c/span\u003e.\u003cspan class=\"number\"\u003e1\u003c/span\u003e.\u003cspan class=\"number\"\u003e1\u003c/span\u003e-linux-x86_64.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e更多内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation.html\"\u003efilebeat-installation\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"2-Filebeat-配置\"\u003e\u003ca href=\"#2-Filebeat-配置\" class=\"headerlink\" title=\"2. Filebeat 配置\"\u003e\u003c/a\u003e2. Filebeat 配置\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e首先，必须要知道的是：\u003ccode\u003efilebeat.yml\u003c/code\u003e 是 filebeat 的配置文件。其路径会因为你安装方式而有所不同。\u003c/p\u003e\n\u003cp\u003eBeat 所有系列产品的配置文件都基于 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.yaml.org/\"\u003eYAML\u003c/a\u003e 格式，FileBeat 当然也不例外。\u003c/p\u003e\n\u003cp\u003e更多 filebeat 配置内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html\"\u003e配置 filebeat\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e更多 filebeat.yml 文件格式内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html\"\u003efilebeat.yml 文件格式\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003efilebeat.yml 部分配置示例：\u003c/p\u003e\n\u003cfigure class=\"highlight yml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003efilebeat:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003eprospectors:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"attr\"\u003etype:\u003c/span\u003e \u003cspan class=\"string\"\u003elog\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003epaths:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/log/*.log\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003emultiline:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"attr\"\u003epattern:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;^[\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"attr\"\u003ematch:\u003c/span\u003e \u003cspan class=\"string\"\u003eafter\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"2-1-重要配置项\"\u003e\u003ca href=\"#2-1-重要配置项\" class=\"headerlink\" title=\"2.1. 重要配置项\"\u003e\u003c/a\u003e2.1. 重要配置项\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e下面我将列举 Filebeat 的较为重要的配置项。\u003c/p\u003e\n\u003cp\u003e如果想了解更多配置信息，可以参考：\u003c/p\u003e\n\u003cp\u003e更多 filebeat 配置内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html\"\u003e配置 filebeat\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e更多 filebeat.yml 文件格式内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html\"\u003efilebeat.yml 文件格式\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"2-1-1-filebeat-prospectors\"\u003e\u003ca href=\"#2-1-1-filebeat-prospectors\" class=\"headerlink\" title=\"2.1.1. filebeat.prospectors\"\u003e\u003c/a\u003e2.1.1. filebeat.prospectors\u003c/h4\u003e\u003cp\u003e（文件监视器）用于指定需要关注的文件。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003efilebeat.prospectors:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"attr\"\u003etype:\u003c/span\u003e \u003cspan class=\"string\"\u003elog\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eenabled:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003epaths:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/log/*.log\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"2-1-2-output-elasticsearch\"\u003e\u003ca href=\"#2-1-2-output-elasticsearch\" class=\"headerlink\" title=\"2.1.2. output.elasticsearch\"\u003e\u003c/a\u003e2.1.2. output.elasticsearch\u003c/h4\u003e\u003cp\u003e如果你希望使用 filebeat 直接向 elasticsearch 输出数据，需要配置 output.elasticsearch 。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eoutput.elasticsearch:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ehosts:\u003c/span\u003e [\u003cspan class=\"string\"\u003e\u0026#39;192.168.1.42:9200\u0026#39;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"2-1-3-output-logstash\"\u003e\u003ca href=\"#2-1-3-output-logstash\" class=\"headerlink\" title=\"2.1.3. output.logstash\"\u003e\u003c/a\u003e2.1.3. output.logstash\u003c/h4\u003e\u003cp\u003e如果你希望使用 filebeat 向 logstash 输出数据，然后由 logstash 再向 elasticsearch 输出数据，需要配置 output.logstash。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e相比于向 elasticsearch 输出数据，个人更推荐向 logstash 输出数据。\u003c/p\u003e\n\u003cp\u003e因为 logstash 和 filebeat 一起工作时，如果 logstash 忙于处理数据，会通知 FileBeat 放慢读取速度。一旦拥塞得到解决，FileBeat 将恢复到原来的速度并继续传播。这样，可以减少管道超负荷的情况。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eoutput.logstash:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ehosts:\u003c/span\u003e [\u003cspan class=\"string\"\u003e\u0026#39;127.0.0.1:5044\u0026#39;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e此外，还需要在 logstash 的配置文件（如 logstash.conf）中指定 beats input 插件：\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003einput\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"string\"\u003ebeats\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003eport\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"number\"\u003e5044\u003c/span\u003e \u003cspan class=\"comment\"\u003e# 此端口需要与 filebeat.yml 中的端口相同\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# The filter part of this file is commented out to indicate that it is\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# optional.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# filter {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# }\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003eoutput\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"string\"\u003eelasticsearch\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003ehosts\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;localhost:9200\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003emanage_template\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003eindex\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"template-variable\"\u003e%{[@metadata][beat]}\u003c/span\u003e-\u003cspan class=\"template-variable\"\u003e%{[@metadata][version]}\u003c/span\u003e-\u003cspan class=\"template-variable\"\u003e%{+YYYY.MM.dd}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003edocument_type\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"template-variable\"\u003e%{[@metadata][type]}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"2-1-4-setup-kibana\"\u003e\u003ca href=\"#2-1-4-setup-kibana\" class=\"headerlink\" title=\"2.1.4. setup.kibana\"\u003e\u003c/a\u003e2.1.4. setup.kibana\u003c/h4\u003e\u003cp\u003e如果打算使用 Filebeat 提供的 Kibana 仪表板，需要配置 setup.kibana 。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003esetup.kibana:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ehost:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;localhost:5601\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"2-1-5-setup-template-settings\"\u003e\u003ca href=\"#2-1-5-setup-template-settings\" class=\"headerlink\" title=\"2.1.5. setup.template.settings\"\u003e\u003c/a\u003e2.1.5. setup.template.settings\u003c/h4\u003e\u003cp\u003e在 Elasticsearch 中，\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-templates.html\"\u003e索引模板\u003c/a\u003e用于定义设置和映射，以确定如何分析字段。\u003c/p\u003e\n\u003cp\u003e在 Filebeat 中，setup.template.settings 用于配置索引模板。\u003c/p\u003e\n\u003cp\u003eFilebeat 推荐的索引模板文件由 Filebeat 软件包安装。如果您接受 filebeat.yml 配置文件中的默认配置，Filebeat 在成功连接到 Elasticsearch 后自动加载模板。\u003c/p\u003e\n\u003cp\u003e您可以通过在 Filebeat 配置文件中配置模板加载选项来禁用自动模板加载，或加载自己的模板。您还可以设置选项来更改索引和索引模板的名称。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-template.html\"\u003efilebeat-template\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e说明\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e如无必要，使用 Filebeat 配置文件中的默认索引模板即可。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"2-1-6-setup-dashboards\"\u003e\u003ca href=\"#2-1-6-setup-dashboards\" class=\"headerlink\" title=\"2.1.6. setup.dashboards\"\u003e\u003c/a\u003e2.1.6. setup.dashboards\u003c/h4\u003e\u003cp\u003eFilebeat 附带了示例 Kibana 仪表板。在使用仪表板之前，您需要创建索引模式 \u003ccode\u003efilebeat- *\u003c/code\u003e，并将仪表板加载到 Kibana 中。为此，您可以运行 \u003ccode\u003esetup\u003c/code\u003e 命令或在 \u003ccode\u003efilebeat.yml\u003c/code\u003e 配置文件中配置仪表板加载。\u003c/p\u003e\n\u003cp\u003e为了在 Kibana 中加载 Filebeat 的仪表盘，需要在 \u003ccode\u003efilebeat.yml\u003c/code\u003e 配置中启动开关：\u003c/p\u003e\n\u003cfigure class=\"highlight arduino\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esetup.dashboards.enabled: \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/configuration-dashboards.html\"\u003econfiguration-dashboards\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"3-Filebeat-命令\"\u003e\u003ca href=\"#3-Filebeat-命令\" class=\"headerlink\" title=\"3. Filebeat 命令\"\u003e\u003c/a\u003e3. Filebeat 命令\u003c/h2\u003e\u003cp\u003efilebeat 提供了一系列命令来完成各种功能。\u003c/p\u003e\n\u003cp\u003e执行命令方式：\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e./filebeat COMMAND\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html\"\u003ecommand-line-options\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e说明\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e个人认为命令行没有必要一一掌握，因为绝大部分功能都可以通过配置来完成。且通过命令行指定功能这种方式要求每次输入同样参数，不利于固化启动方式。\u003c/p\u003e\n\u003cp\u003e最重要的当然是启动命令 run 了。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e 指定配置文件启动\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e./filebeat run -e -c filebeat.yml -d \u003cspan class=\"string\"\u003e\u0026#34;publish\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e./filebeat -e -c filebeat.yml -d \u003cspan class=\"string\"\u003e\u0026#34;publish\u0026#34;\u003c/span\u003e \u003cspan class=\"comment\"\u003e# run 可以省略\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"4-Filebeat-模块\"\u003e\u003ca href=\"#4-Filebeat-模块\" class=\"headerlink\" title=\"4. Filebeat 模块\"\u003e\u003c/a\u003e4. Filebeat 模块\u003c/h2\u003e\u003cblockquote\u003e\n\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/cn/products/beats/filebeat\"\u003eFilebeat\u003c/a\u003e 和 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/cn/products/beats/metricbeat\"\u003eMetricbeat\u003c/a\u003e 内部集成了一系列模块，用以简化常见日志格式（例如 NGINX、Apache 或诸如 Redis 或 Docker 等系统指标）的收集、解析和可视化过程。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e配置 elasticsearch 和 kibana\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight dts\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eoutput.elasticsearch:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  hosts:\u003c/span\u003e [\u003cspan class=\"string\"\u003e\u0026#34;myEShost:9200\u0026#34;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  username:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;elastic\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  password:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;elastic\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esetup.kibana:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  host:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;mykibanahost:5601\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  username:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;elastic\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  password:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;elastic\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eusername 和 password 是可选的，如果不需要认证则不填。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e初始化环境\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e执行下面命令，filebeat 会加载推荐索引模板。\u003c/p\u003e\n\u003cfigure class=\"highlight arduino\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e./filebeat setup -e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e指定模块\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e执行下面命令，指定希望加载的模块。\u003c/p\u003e\n\u003cfigure class=\"highlight jboss-cli\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e./filebeat\u003c/span\u003e -e \u003cspan class=\"params\"\u003e--modules\u003c/span\u003e system,nginx,mysql\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e更多内容可以参考：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-modules.html\"\u003e配置 filebeat 模块\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html\"\u003efilebeat 支持模块\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"5-参考资料\"\u003e\u003ca href=\"#5-参考资料\" class=\"headerlink\" title=\"5. 参考资料\"\u003e\u003c/a\u003e5. 参考资料\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/cn/products/beats\"\u003eBeats 官网\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/elastic/beats\"\u003eBeats Github\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/libbeat/current/index.html\"\u003eBeats 官方文档\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-06-15T23:10:44Z",
  "Author": "钝悟 ◾ Dunwu"
}