{
  "Source": "dunwu",
  "Title": "Elastic 技术栈之 Filebeat",
  "Link": "https://dunwu.github.io/blog/pages/b7f079/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\u003ch1 id=\"Elastic-技术栈之-Filebeat\"\u003e\u003ca href=\"#Elastic-技术栈之-Filebeat\" class=\"headerlink\" title=\"Elastic 技术栈之 Filebeat\"\u003e\u003c/a\u003eElastic 技术栈之 Filebeat\u003c/h1\u003e\u003ch2 id=\"简介\"\u003e\u003ca href=\"#简介\" class=\"headerlink\" title=\"简介\"\u003e\u003c/a\u003e简介\u003c/h2\u003e\u003cp\u003eBeats 是安装在服务器上的数据中转代理。\u003c/p\u003e\n\u003cp\u003eBeats 可以将数据直接传输到 Elasticsearch 或传输到 Logstash 。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://www.elastic.co/guide/en/beats/libbeat/current/images/beats-platform.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003cp\u003eBeats 有多种类型，可以根据实际应用需要选择合适的类型。\u003c/p\u003e\n\u003cp\u003e常用的类型有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003ePacketbeat：\u003c/strong\u003e网络数据包分析器，提供有关您的应用程序服务器之间交换的事务的信息。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eFilebeat：\u003c/strong\u003e从您的服务器发送日志文件。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eMetricbeat：\u003c/strong\u003e是一个服务器监视代理程序，它定期从服务器上运行的操作系统和服务收集指标。\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eWinlogbeat：\u003c/strong\u003e提供 Windows 事件日志。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多 Beats 类型可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/libbeat/current/community-beats.html\"\u003ecommunity-beats\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e说明\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e由于本人工作中只应用了 FileBeat，所以后面内容仅介绍 FileBeat 。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"FileBeat-的作用\"\u003e\u003ca href=\"#FileBeat-的作用\" class=\"headerlink\" title=\"FileBeat 的作用\"\u003e\u003c/a\u003eFileBeat 的作用\u003c/h3\u003e\u003cp\u003e相比 Logstash，FileBeat 更加轻量化。\u003c/p\u003e\n\u003cp\u003e在任何环境下，应用程序都有停机的可能性。 Filebeat 读取并转发日志行，如果中断，则会记住所有事件恢复联机状态时所在位置。\u003c/p\u003e\n\u003cp\u003eFilebeat 带有内部模块（auditd，Apache，Nginx，System 和 MySQL），可通过一个指定命令来简化通用日志格式的收集，解析和可视化。\u003c/p\u003e\n\u003cp\u003eFileBeat 不会让你的管道超负荷。FileBeat 如果是向 Logstash 传输数据，当 Logstash 忙于处理数据，会通知 FileBeat 放慢读取速度。一旦拥塞得到解决，FileBeat 将恢复到原来的速度并继续传播。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://www.elastic.co/guide/en/beats/filebeat/current/images/filebeat.png\" alt=\"img\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"安装\"\u003e\u003ca href=\"#安装\" class=\"headerlink\" title=\"安装\"\u003e\u003c/a\u003e安装\u003c/h2\u003e\u003cp\u003eUnix / Linux 系统建议使用下面方式安装，因为比较通用。\u003c/p\u003e\n\u003cfigure class=\"highlight apache\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003ewget\u003c/span\u003e https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-\u003cspan class=\"number\"\u003e6\u003c/span\u003e.\u003cspan class=\"number\"\u003e1\u003c/span\u003e.\u003cspan class=\"number\"\u003e1\u003c/span\u003e-linux-x86_64.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attribute\"\u003etar\u003c/span\u003e -zxf filebeat-\u003cspan class=\"number\"\u003e6\u003c/span\u003e.\u003cspan class=\"number\"\u003e1\u003c/span\u003e.\u003cspan class=\"number\"\u003e1\u003c/span\u003e-linux-x86_64.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation.html\"\u003efilebeat-installation\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"配置\"\u003e\u003ca href=\"#配置\" class=\"headerlink\" title=\"配置\"\u003e\u003c/a\u003e配置\u003c/h2\u003e\u003ch3 id=\"配置文件\"\u003e\u003ca href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"\u003e\u003c/a\u003e配置文件\u003c/h3\u003e\u003cp\u003e首先，需要知道的是：\u003ccode\u003efilebeat.yml\u003c/code\u003e 是 filebeat 的配置文件。配置文件的路径会因为你安装方式的不同而变化。\u003c/p\u003e\n\u003cp\u003eBeat 所有系列产品的配置文件都基于 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.yaml.org/\"\u003eYAML\u003c/a\u003e 格式，FileBeat 当然也不例外。\u003c/p\u003e\n\u003cp\u003efilebeat.yml 部分配置示例：\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003efilebeat:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003eprospectors:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"attr\"\u003etype:\u003c/span\u003e \u003cspan class=\"string\"\u003elog\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003epaths:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/log/*.log\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003emultiline:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"attr\"\u003epattern:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;^[\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"attr\"\u003ematch:\u003c/span\u003e \u003cspan class=\"string\"\u003eafter\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多 filebeat 配置内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html\"\u003e配置 filebeat\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e更多 filebeat.yml 文件格式内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html\"\u003efilebeat.yml 文件格式\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"重要配置项\"\u003e\u003ca href=\"#重要配置项\" class=\"headerlink\" title=\"重要配置项\"\u003e\u003c/a\u003e重要配置项\u003c/h3\u003e\u003ch4 id=\"filebeat-prospectors\"\u003e\u003ca href=\"#filebeat-prospectors\" class=\"headerlink\" title=\"filebeat.prospectors\"\u003e\u003c/a\u003efilebeat.prospectors\u003c/h4\u003e\u003cp\u003e（文件监视器）用于指定需要关注的文件。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003efilebeat.prospectors:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"attr\"\u003etype:\u003c/span\u003e \u003cspan class=\"string\"\u003elog\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eenabled:\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003epaths:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/log/*.log\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"output-elasticsearch\"\u003e\u003ca href=\"#output-elasticsearch\" class=\"headerlink\" title=\"output.elasticsearch\"\u003e\u003c/a\u003eoutput.elasticsearch\u003c/h4\u003e\u003cp\u003e如果你希望使用 filebeat 直接向 elasticsearch 输出数据，需要配置 output.elasticsearch 。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eoutput.elasticsearch:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ehosts:\u003c/span\u003e [\u003cspan class=\"string\"\u003e\u0026#39;192.168.1.42:9200\u0026#39;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"output-logstash\"\u003e\u003ca href=\"#output-logstash\" class=\"headerlink\" title=\"output.logstash\"\u003e\u003c/a\u003eoutput.logstash\u003c/h4\u003e\u003cp\u003e如果你希望使用 filebeat 向 logstash 输出数据，然后由 logstash 再向 elasticsearch 输出数据，需要配置 output.logstash。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e相比于向 elasticsearch 输出数据，个人更推荐向 logstash 输出数据。\u003c/p\u003e\n\u003cp\u003e因为 logstash 和 filebeat 一起工作时，如果 logstash 忙于处理数据，会通知 FileBeat 放慢读取速度。一旦拥塞得到解决，FileBeat 将恢复到原来的速度并继续传播。这样，可以减少管道超负荷的情况。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eoutput.logstash:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ehosts:\u003c/span\u003e [\u003cspan class=\"string\"\u003e\u0026#39;127.0.0.1:5044\u0026#39;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e此外，还需要在 logstash 的配置文件（如 logstash.conf）中指定 beats input 插件：\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003einput\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"string\"\u003ebeats\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003eport\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"number\"\u003e5044\u003c/span\u003e \u003cspan class=\"comment\"\u003e# 此端口需要与 filebeat.yml 中的端口相同\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# The filter part of this file is commented out to indicate that it is\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# optional.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# filter {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# }\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003eoutput\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"string\"\u003eelasticsearch\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003ehosts\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;localhost:9200\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003emanage_template\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003eindex\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"template-variable\"\u003e%{[@metadata][beat]}\u003c/span\u003e-\u003cspan class=\"template-variable\"\u003e%{[@metadata][version]}\u003c/span\u003e-\u003cspan class=\"template-variable\"\u003e%{+YYYY.MM.dd}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003edocument_type\u003c/span\u003e \u003cspan class=\"string\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"template-variable\"\u003e%{[@metadata][type]}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"setup-kibana\"\u003e\u003ca href=\"#setup-kibana\" class=\"headerlink\" title=\"setup.kibana\"\u003e\u003c/a\u003esetup.kibana\u003c/h4\u003e\u003cp\u003e如果打算使用 Filebeat 提供的 Kibana 仪表板，需要配置 setup.kibana 。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003esetup.kibana:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ehost:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;localhost:5601\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"setup-template-settings\"\u003e\u003ca href=\"#setup-template-settings\" class=\"headerlink\" title=\"setup.template.settings\"\u003e\u003c/a\u003esetup.template.settings\u003c/h4\u003e\u003cp\u003e在 Elasticsearch 中，\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-templates.html\"\u003e索引模板\u003c/a\u003e用于定义设置和映射，以确定如何分析字段。\u003c/p\u003e\n\u003cp\u003e在 Filebeat 中，setup.template.settings 用于配置索引模板。\u003c/p\u003e\n\u003cp\u003eFilebeat 推荐的索引模板文件由 Filebeat 软件包安装。如果您接受 filebeat.yml 配置文件中的默认配置，Filebeat 在成功连接到 Elasticsearch 后自动加载模板。\u003c/p\u003e\n\u003cp\u003e您可以通过在 Filebeat 配置文件中配置模板加载选项来禁用自动模板加载，或加载自己的模板。您还可以设置选项来更改索引和索引模板的名称。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-template.html\"\u003efilebeat-template\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e说明\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e如无必要，使用 Filebeat 配置文件中的默认索引模板即可。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"setup-dashboards\"\u003e\u003ca href=\"#setup-dashboards\" class=\"headerlink\" title=\"setup.dashboards\"\u003e\u003c/a\u003esetup.dashboards\u003c/h4\u003e\u003cp\u003eFilebeat 附带了示例 Kibana 仪表板。在使用仪表板之前，您需要创建索引模式 \u003ccode\u003efilebeat- *\u003c/code\u003e，并将仪表板加载到 Kibana 中。为此，您可以运行 \u003ccode\u003esetup\u003c/code\u003e 命令或在 \u003ccode\u003efilebeat.yml\u003c/code\u003e 配置文件中配置仪表板加载。\u003c/p\u003e\n\u003cp\u003e为了在 Kibana 中加载 Filebeat 的仪表盘，需要在 \u003ccode\u003efilebeat.yml\u003c/code\u003e 配置中启动开关：\u003c/p\u003e\n\u003cfigure class=\"highlight arduino\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esetup.dashboards.enabled: \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/configuration-dashboards.html\"\u003econfiguration-dashboards\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"命令\"\u003e\u003ca href=\"#命令\" class=\"headerlink\" title=\"命令\"\u003e\u003c/a\u003e命令\u003c/h2\u003e\u003cp\u003efilebeat 提供了一系列命令来完成各种功能。\u003c/p\u003e\n\u003cp\u003e执行命令方式：\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e./filebeat COMMAND\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多内容可以参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html\"\u003ecommand-line-options\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e说明\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e个人认为命令行没有必要一一掌握，因为绝大部分功能都可以通过配置来完成。且通过命令行指定功能这种方式要求每次输入同样参数，不利于固化启动方式。\u003c/p\u003e\n\u003cp\u003e最重要的当然是启动命令 run 了。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e示例\u003c/strong\u003e 指定配置文件启动\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e./filebeat run -e -c filebeat.yml -d \u003cspan class=\"string\"\u003e\u0026#34;publish\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e./filebeat -e -c filebeat.yml -d \u003cspan class=\"string\"\u003e\u0026#34;publish\u0026#34;\u003c/span\u003e \u003cspan class=\"comment\"\u003e# run 可以省略\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"模块\"\u003e\u003ca href=\"#模块\" class=\"headerlink\" title=\"模块\"\u003e\u003c/a\u003e模块\u003c/h2\u003e\u003cp\u003eFilebeat 提供了一套预构建的模块，让您可以快速实施和部署日志监视解决方案，并附带示例仪表板和数据可视化。这些模块支持常见的日志格式，例如 Nginx，Apache2 和 MySQL 等。\u003c/p\u003e\n\u003ch3 id=\"运行模块的步骤\"\u003e\u003ca href=\"#运行模块的步骤\" class=\"headerlink\" title=\"运行模块的步骤\"\u003e\u003c/a\u003e运行模块的步骤\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e配置 elasticsearch 和 kibana\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight dts\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eoutput.elasticsearch:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  hosts:\u003c/span\u003e [\u003cspan class=\"string\"\u003e\u0026#34;myEShost:9200\u0026#34;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  username:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;elastic\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  password:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;elastic\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esetup.kibana:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  host:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;mykibanahost:5601\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  username:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;elastic\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"symbol\"\u003e  password:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;elastic\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eusername 和 password 是可选的，如果不需要认证则不填。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e初始化环境\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e执行下面命令，filebeat 会加载推荐索引模板。\u003c/p\u003e\n\u003cfigure class=\"highlight arduino\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e./filebeat setup -e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cul\u003e\n\u003cli\u003e指定模块\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e执行下面命令，指定希望加载的模块。\u003c/p\u003e\n\u003cfigure class=\"highlight jboss-cli\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e./filebeat\u003c/span\u003e -e \u003cspan class=\"params\"\u003e--modules\u003c/span\u003e system,nginx,mysql\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e参考\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e更多内容可以参考： \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-modules.html\"\u003e配置 filebeat 模块\u003c/a\u003e | \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html\"\u003efilebeat 支持模块\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"原理\"\u003e\u003ca href=\"#原理\" class=\"headerlink\" title=\"原理\"\u003e\u003c/a\u003e原理\u003c/h2\u003e\u003cp\u003eFilebeat 有两个主要组件：\u003c/p\u003e\n\u003cp\u003eharvester：负责读取一个文件的内容。它会逐行读取文件内容，并将内容发送到输出目的地。\u003c/p\u003e\n\u003cp\u003eprospector：负责管理 harvester 并找到所有需要读取的文件源。比如类型是日志，prospector 就会遍历制定路径下的所有匹配要求的文件。\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003efilebeat.prospectors:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"attr\"\u003etype:\u003c/span\u003e \u003cspan class=\"string\"\u003elog\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003epaths:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/log/*.log\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/path2/*.log\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eFilebeat 保持每个文件的状态，并经常刷新注册表文件中的磁盘状态。状态用于记住 harvester 正在读取的最后偏移量，并确保发送所有日志行。\u003c/p\u003e\n\u003cp\u003eFilebeat 将每个事件的传递状态存储在注册表文件中。所以它能保证事件至少传递一次到配置的输出，没有数据丢失。\u003c/p\u003e\n\u003ch2 id=\"资料\"\u003e\u003ca href=\"#资料\" class=\"headerlink\" title=\"资料\"\u003e\u003c/a\u003e资料\u003c/h2\u003e\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.elastic.co/guide/en/beats/libbeat/current/index.html\"\u003eBeats 官方文档\u003c/a\u003e\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-06-15T23:10:44Z",
  "Author": "钝悟 ◾ Dunwu"
}