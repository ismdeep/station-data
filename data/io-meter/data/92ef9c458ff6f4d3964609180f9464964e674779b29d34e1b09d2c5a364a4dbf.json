{
  "Source": "io-meter",
  "Title": "When WebGL Meets Device Motion",
  "Link": "https://io-meter.com/2014/10/03/when-webgl-meets-device-motion/",
  "Content": "\u003cdiv class=\"entry\"\u003e\n      \u003cp\u003e众所周知，iOS 8 中的一大亮点功能就是为 Safari 添加了 WebGL 的支持并默认开启，\n这可以说是 WebGL 的发展历程中的一个重要的里程碑。而我们也终于可以在 iOS 上使用加速度感应器来控制\nWeb 页面上的 3D 元素的交互。 作为一个小实验，我为之前写的一个 WebGL 小页面添加了重力感应的控制的交互。\u003c/p\u003e\n\u003ca id=\"more\"\u003e\u003c/a\u003e\n\u003cp\u003e升级了 iOS 8 的 iOS 设备可以访问 \u003ca href=\"http://sjtug.org\" target=\"_blank\" rel=\"noopener\"\u003esjtug.org\u003c/a\u003e 浏览完成后的页面效果。\n关于这个页面 WebGL 方面的实现，之前已经在 \u003ca href=\"https://io-meter.com/2014/04/05/let-rocket-fly/\"\u003eLet Rocket Fly\u003c/a\u003e\n里详细介绍了，这里就不再赘述。本文就主要来讨论一下 Device Motion 相关的内容\u003c/p\u003e\n\u003ch1 id=\"u914D_u7F6E_Mobile_Debug__u73AF_u5883\"\u003e\u003ca href=\"#u914D_u7F6E_Mobile_Debug__u73AF_u5883\" class=\"headerlink\" title=\"配置 Mobile Debug 环境\"\u003e\u003c/a\u003e配置 Mobile Debug 环境\u003c/h1\u003e\u003cp\u003e首先，我们要想办法方便地调试页面。因为需要利用加速度感应器，因此最好还是使用真实设备进行调试，\n需要先想办法将 iOS 设备上的 Safari 和 OSX 上 Safari 的调试器连接起来。这一功能在 iOS6、\n和 OSX 10.8 的时候就已经得到了支持。\u003c/p\u003e\n\u003cp\u003e首先，在 iOS 8 的 Safari 偏好设置中 Advanced 子菜单里将 Web Inspector 子选项设为开启状态，如下图所示。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/posts/enable-web-inspector.png\" alt=\"Enable Web Inspector\"/\u003e\u003c/p\u003e\n\u003cp\u003e此后，将你的 iOS 设备使用 USB 连接到 Mac 上，再开启桌面版 Safari，就可以在 Developer 菜单下找到对应的设备了。\n有时需要重启 Safari 才能看到菜单项。如果找不到 Safari 的 Developer 菜单，你需要首先在偏好设置里激活它。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/posts/devices-menu.png\" alt=\"Devices Menu\"/\u003e\u003c/p\u003e\n\u003cp\u003eOK，现在我们就可以在桌面版的 Safari 上使用调试器调试 iOS 设备上打开的网页了。不光可以捕捉到网页中 Console 输出的\nlog，甚至还可以完成查看元素、控制页面刷新等等任务，使用上和调试桌面网页没有什么区别。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/posts/debug-panel.png\" alt=\"Debug Panel\"/\u003e\u003c/p\u003e\n\u003ch1 id=\"u6DFB_u52A0_Device_Motion__u652F_u6301\"\u003e\u003ca href=\"#u6DFB_u52A0_Device_Motion__u652F_u6301\" class=\"headerlink\" title=\"添加 Device Motion 支持\"\u003e\u003c/a\u003e添加 Device Motion 支持\u003c/h1\u003e\u003cp\u003e为了给页面中的小火箭添加 Device Motion 交互支持，我们首先需要判断浏览器是否支持这一特性，\n最简单的方法就是使用下面的代码检测\u003ccode\u003eDeviceMotionEvent\u003c/code\u003e是否存在。\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"built_in\"\u003ewindow\u003c/span\u003e.DeviceMotionEvent) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e// the browser support device motion\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003e可以设定\u003ccode\u003ewindow.ondevicemotion\u003c/code\u003e或使用\u003ccode\u003eaddEventListener\u003c/code\u003e的方法侦听加速度的变化。\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003ewindow\u003c/span\u003e.addEventListener(\u003cspan class=\"string\"\u003e\u0026#39;devicemotion\u0026#39;\u003c/span\u003e, \u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"params\"\u003ee\u003c/span\u003e) \u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e// do someting\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e});\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003e这里得到的\u003ccode\u003eEvent\u003c/code\u003e对象是\u003ccode\u003eDeviceMotionEvent\u003c/code\u003e对象，可以获取的主要参数为：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003eacceleration\u003c/code\u003e: 过滤掉重力之后的加速度，有\u003ccode\u003ex\u003c/code\u003e、\u003ccode\u003ey\u003c/code\u003e、\u003ccode\u003ez\u003c/code\u003e三个分量\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eaccelerationIncludingGravity\u003c/code\u003e: 带有重力的加速度，有\u003ccode\u003ex\u003c/code\u003e、\u003ccode\u003ey\u003c/code\u003e、\u003ccode\u003ez\u003c/code\u003e三个分量\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003erotationRate\u003c/code\u003e: 设备在三个方向旋转的角速度，有\u003ccode\u003ealpha\u003c/code\u003e、\u003ccode\u003ebeta\u003c/code\u003e、\u003ccode\u003egamma\u003c/code\u003e三个分量\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e有了这三个属性，我们就可以方便的设计基于设备运动的页面交互了。在本文中，只使用了\u003ccode\u003eaccelerationIncludingGravity\u003c/code\u003e这个属性。\n需要注意的是，\u003ccode\u003eDeviceMotionEvent\u003c/code\u003e所提供的运动参量的坐标系不会随着屏幕窗口方向的改变而改变，也就是说，上述\u003ccode\u003ex\u003c/code\u003e、\u003ccode\u003ey\u003c/code\u003e、\u003ccode\u003ez\u003c/code\u003e\n等分量，总是相对于设备本身而言的。具体来说，\u003ccode\u003ex\u003c/code\u003e方向为垂直于设备的竖直方向，\u003ccode\u003ey\u003c/code\u003e为平行于设备的竖直方向，\u003ccode\u003ez\u003c/code\u003e垂直于屏幕向外。\u003c/p\u003e\n\u003cp\u003e由于这个特性，我们还需要通过检测屏幕的不同 Orientation 方向，来保证我们交互效果的一致性，\n不能因横屏或竖屏浏览网页而产生不一样的交互。获取屏幕的 Orientation 可以使用\n\u003ccode\u003ewindow.orientation\u003c/code\u003e属性。\u003c/p\u003e\n\u003cp\u003e在 Safari 中，\u003ccode\u003ewindow.orientation\u003c/code\u003e是使用数字表示方向的。值和屏幕方向的对应关系为\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e值为0，屏幕竖直向上\u003c/li\u003e\n\u003cli\u003e值为-90，屏幕顺时针旋转90度\u003c/li\u003e\n\u003cli\u003e值为90，屏幕逆时针旋转90度\u003c/li\u003e\n\u003cli\u003e值为180，屏幕旋转180度\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e了解了上述基础知识后，为我们的小火箭添加运动控制就非常简单了。代码如下:\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003cfigcaption\u003e\u003cspan\u003emain.js\u003c/span\u003e\u003ca href=\"https://github.com/sjtug/sjtug.github.io/blob/master/js/main.js#L57\" target=\"_blank\" rel=\"noopener\"\u003eview on Github\u003c/a\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"built_in\"\u003ewindow\u003c/span\u003e.DeviceMotionEvent) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"built_in\"\u003ewindow\u003c/span\u003e.ondevicemotion = \u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"params\"\u003ee\u003c/span\u003e) \u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evar\u003c/span\u003e ax = event.accelerationIncludingGravity.x;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evar\u003c/span\u003e ay = event.accelerationIncludingGravity.y;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003evar\u003c/span\u003e orient = \u003cspan class=\"built_in\"\u003ewindow\u003c/span\u003e.orientation;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (orient==\u003cspan class=\"number\"\u003e0\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      mx = -ax * \u003cspan class=\"number\"\u003e80\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      my = -ay * \u003cspan class=\"number\"\u003e80\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (orient==\u003cspan class=\"number\"\u003e90\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      mx = ay * \u003cspan class=\"number\"\u003e80\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      my = -ax * \u003cspan class=\"number\"\u003e80\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (orient==\u003cspan class=\"number\"\u003e-90\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      mx = -ay * \u003cspan class=\"number\"\u003e80\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      my = -ax * \u003cspan class=\"number\"\u003e80\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (orient==\u003cspan class=\"number\"\u003e180\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      mx = -ax * \u003cspan class=\"number\"\u003e80\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      my = ay * \u003cspan class=\"number\"\u003e80\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003ch1 id=\"The_End\"\u003e\u003ca href=\"#The_End\" class=\"headerlink\" title=\"The End\"\u003e\u003c/a\u003eThe End\u003c/h1\u003e\u003cp\u003eiOS 8 支持 WebGL 是一件令人振奋的事情。自此，我们不但可以在 iOS 这一主流移动平台上使用 WebGL 进行开发，\n也可以利用移动设备特有的一些 API 实现更为有趣的交互。这也许意味着 WebGL 将迎来一次大普及。\u003c/p\u003e\n\u003cp\u003e尽管在移动设备上运行复杂的 WebGL 页面并不现实，但是像本文这样通过添加简单的 3D 图形，\n使原来朴素的页面变得有趣起来，也不啻为一种很好的应用。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2014-10-03T06:33:38Z",
  "Author": "Chase Zhang"
}