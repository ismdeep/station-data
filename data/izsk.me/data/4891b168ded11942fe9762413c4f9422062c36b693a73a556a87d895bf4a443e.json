{
  "Source": "izsk.me",
  "Title": "kubernetes学习(Kubernetes集群运行Spark-Job提示Invalid-DER:-object-is-not-integer错误的解决办法)",
  "Link": "https://izsk.me/2020/02/20/Kubernetes-Spark-Job-InvalidDER/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e最近有个同事说他在测试kubernetes中跑spark，在运行spark-job时提示\u003ccode\u003eInvalid DER: object is not integer\u003c/code\u003e，但是如果在线上环境跑同样的任务就没问题, 束手无措，想让我帮看一下什么问题\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\n\n\u003ch3 id=\"问题\"\u003e\u003ca href=\"#问题\" class=\"headerlink\" title=\"问题\"\u003e\u003c/a\u003e问题\u003c/h3\u003e\u003cp\u003e在测试Kubernetes执行spark-job时提示的错误完整的如下:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200309123610.png\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"排查\"\u003e\u003ca href=\"#排查\" class=\"headerlink\" title=\"排查\"\u003e\u003c/a\u003e排查\u003c/h3\u003e\u003cp\u003e从上面的报错来看, 很明显涉及kubernetes.client的问题, spark用的当然是java的client\u003c/p\u003e\n\u003cp\u003e首先, 可以排除是spark, 同事可以确认spark版本及spark-job完全一样.\u003c/p\u003e\n\u003cp\u003e那么很容易就联想到两个环境下的Kubernetes是有区别的, 开先, 我的同事怀疑是用户认证的问题, 这个基本可以排除, 我觉得是kubernetes集群上的区别关系很大, 那么很自然, 从差别着手\u003c/p\u003e\n\u003cp\u003e首先，发现集群的版本不一致, 测试环境下的kubernetes的版本较低, 那版本的差异很有问题. \u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e上kubernetes的github查找issue\u003c/strong\u003e, 发现一个相近的问题.\u003c/p\u003e\n\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/fabric8io/kubernetes-client/issues/1314\"\u003ehttps://github.com/fabric8io/kubernetes-client/issues/1314\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ekubernetes的java client 在github这个项目\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/fabric8io/kubernetes-client\"\u003ehttps://github.com/fabric8io/kubernetes-client\u003c/a\u003e上的\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/fabric8io/kubernetes-client/issues/1314\"\u003eissue\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e再根据提交的代码记录发现问题:\u003c/p\u003e\n\u003cp\u003e在kubernetes的java client早版本的代码里\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200309141145.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e在ClientCertificateAuthentication.java这个文件中, 是写死了证书的加密类型只能是RSA, 而测试的kubernetes使用的是minikube搭建的, 默认情况下使用的证书加密类型为EC(Eliptical Curve), 而测试的kubernetes并不支持, 如何查看证书的类型呢, 很简单, cat ca-key.pem, 第一行都标注了证书加密类型. \u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200310103152.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e线上环境没问题是因为kubernetes使用的版本已经支持了EC这种加密类型\u003c/p\u003e\n\u003ch3 id=\"解决\"\u003e\u003ca href=\"#解决\" class=\"headerlink\" title=\"解决\"\u003e\u003c/a\u003e解决\u003c/h3\u003e\u003cp\u003e所以，问题就很清晰了,有两个解决方案, **要么升级java client, 要么使用RSA的证书类型.**由于spark已经是最新版本的了, 因此只能切换到RSA证书，这其实还是比较麻烦的, 我建议直接使用新版本的kubernetes重新搭建, 也比换证书要快, 比较minikube、kubeadm一键式还是很爽的.\u003c/p\u003e\n\u003cp\u003e所以, \u003cstrong\u003e多多查找对应project的issue, 你遇到的问题, 大概率别人都遇到过.\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e\u003cstrong\u003e参考文章:\u003c/strong\u003e\u003c/h3\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/fabric8io/kubernetes-client/issues/1314\"\u003ehttps://github.com/fabric8io/kubernetes-client/issues/1314\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/fabric8io/kubernetes-client\"\u003ehttps://github.com/fabric8io/kubernetes-client\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/fabric8io/kubernetes-client/issues/1314\"\u003ehttps://github.com/fabric8io/kubernetes-client/issues/1314\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\n      \n    \u003c/div\u003e",
  "Date": "2020-02-20T13:30:53+08:00",
  "Author": "Z.S.K."
}