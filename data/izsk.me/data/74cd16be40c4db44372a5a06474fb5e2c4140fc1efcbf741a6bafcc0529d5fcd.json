{
  "Source": "izsk.me",
  "Title": "Gitlab学习(实现多kubernets环境CI/CD)",
  "Link": "https://izsk.me/2020/05/15/gitlab-kubernetes-multi-environment-deploy/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e随着环境的多样性, 频繁的集成、测试占用了大量的时间, 大公司都有专门的团队做效率工程, 而我司这种小公司则就只能自养自足. 好在所有的环境都切换到了kubernetes环境, k8s天然的属性结合gitlab end-to-end的能力，实现CI/CD也能节省大量的时间.\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\n\n\u003cp\u003e目前存在有3个环境\u003ccode\u003edev, gray, prod\u003c/code\u003e,都是基于k8s架构, 使用的开发语言大部分都是golang.\u003c/p\u003e\n\u003cp\u003e \u003ccode\u003edev用于线下环境测试 --\u0026gt;  gray用于灰度环境的联调 --\u0026gt;  prod则是生产环境\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e由于不同环境只是配置文件的不同, CI/CD主要存在以下场景:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eMerge request请求，对于这类请求全都需要执行源码编译, 可由maintainer选择是否同时需要后续流程\u003c/li\u003e\n\u003cli\u003edev环境发布, 开发同学自测环境\u003c/li\u003e\n\u003cli\u003egray环境发布，所有开发同学都能够发布\u003c/li\u003e\n\u003cli\u003eprod环境发布， 只有部分同学有权限发布\u003c/li\u003e\n\u003cli\u003e配置文件的变更，变更权限跟环境走\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"CI-x2F-CD流程\"\u003e\u003ca href=\"#CI-x2F-CD流程\" class=\"headerlink\" title=\"CI/CD流程\"\u003e\u003c/a\u003eCI/CD流程\u003c/h3\u003e\u003cp\u003e\u003ccode\u003edev --\u0026gt; makesource --\u0026gt; imagespush --\u0026gt; --\u0026gt; CD gray --\u0026gt; [自动化测试] --\u0026gt; CD prod --\u0026gt; [Blackbox Monitor]\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e由于dev环境其实是开发自己使用的环境,虽然接入了CI/CD，但基于不怎么维护, 因此把dev放在最前面，用于说明开发者自测完成.\u003c/p\u003e\n\u003cp\u003e目前自动化测试跟功能黑盒测试还在完善.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/gitlab_workflow_example.png\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"merge-request\"\u003e\u003ca href=\"#merge-request\" class=\"headerlink\" title=\"merge request\"\u003e\u003c/a\u003emerge request\u003c/h3\u003e\u003cp\u003e由于出于对源码的保护, 对于merge request的请求都需要通过maintainer进行codeview,因此\u003ccode\u003emerge request\u003c/code\u003e 进行源码编译(代码测试), 编译通过后才能合并到目的分支是，同时gitlab还支持选择当pipeline成功时可自动合并\u003c/p\u003e\n\u003cp\u003emaintainer也可以选择是否需要配置合并后自动发布流程.\u003c/p\u003e\n\u003cp\u003e关于gitlab开启自动合并功能, 详见\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.gitlab.com/ee/ci/merge_request_pipelines/\"\u003emerge_request_pipelines\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"kubernetes认证\"\u003e\u003ca href=\"#kubernetes认证\" class=\"headerlink\" title=\"kubernetes认证\"\u003e\u003c/a\u003ekubernetes认证\u003c/h3\u003e\u003cp\u003e多个kubernetes的认证也是根据环境来做的, 最简单的办法就是通过将各种环境下的kubeconfig文件作为变量,最好做为gitlab的组环境变量，这样所有的repo都能够使用了.\u003c/p\u003e\n\u003cp\u003e在gitlab-ci.yml中通过不同的环境来选用不同的kubeconfig, 这样就能实现对集群的操作,\u003c/p\u003e\n\u003cp\u003e比如修改gray环境下的某个应用的配置文件， 主要代码如下:\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e.exportenvgray:\u003c/span\u003e \u003cspan class=\"meta\"\u003e\u0026amp;exportenvgray\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003eexport\u003c/span\u003e \u003cspan class=\"string\"\u003eMODE=gray\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003eKUBE_CONFIG=${KUBE_CONFIG_GRAY}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e.kubeconfig:\u003c/span\u003e \u003cspan class=\"meta\"\u003e\u0026amp;kubeconfig\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003emkdir\u003c/span\u003e \u003cspan class=\"string\"\u003e$HOME/.kube\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"string\"\u003ecat\u003c/span\u003e \u003cspan class=\"string\"\u003e$KUBE_CONFIG\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"string\"\u003e$HOME/.kube/config\u003c/span\u003e \u003cspan class=\"comment\"\u003e#需要在gilab中指定为文件类型的变量\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e.k8supdateconfig:\u003c/span\u003e \u003cspan class=\"meta\"\u003e\u0026amp;k8supdateconfig\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003ekubectl\u003c/span\u003e \u003cspan class=\"string\"\u003ecreate\u003c/span\u003e \u003cspan class=\"string\"\u003econfigmap\u003c/span\u003e \u003cspan class=\"string\"\u003e${APP}-${KUBERNETES_NS}-cm\u003c/span\u003e \u003cspan class=\"string\"\u003e--from-file=/tmp/config.yml\u003c/span\u003e \u003cspan class=\"string\"\u003e-n\u003c/span\u003e \u003cspan class=\"string\"\u003e${KUBERNETES_NS}\u003c/span\u003e \u003cspan class=\"string\"\u003e-o\u003c/span\u003e \u003cspan class=\"string\"\u003eyaml\u003c/span\u003e \u003cspan class=\"string\"\u003e--dry-run\u003c/span\u003e \u003cspan class=\"string\"\u003e|\u003c/span\u003e \u003cspan class=\"string\"\u003ekubectl\u003c/span\u003e \u003cspan class=\"string\"\u003eapply\u003c/span\u003e \u003cspan class=\"string\"\u003e-f\u003c/span\u003e \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e.updateconfig:\u003c/span\u003e \u003cspan class=\"meta\"\u003e\u0026amp;updateconfig\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"string\"\u003ekubectl_yaml:v1.15.4\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003edependencies:\u003c/span\u003e []\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003escript:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e*kubeconfig\u003c/span\u003e \u003cspan class=\"comment\"\u003e# 获取认证文件\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e*k8supdateconfig\u003c/span\u003e \u003cspan class=\"comment\"\u003e# 到这里就有权限能够更新configmap了\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eupdateconfig:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"string\"\u003e\u0026lt;\u0026lt;:\u003c/span\u003e \u003cspan class=\"meta\"\u003e*updateconfig\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003estage:\u003c/span\u003e \u003cspan class=\"string\"\u003eupdateconfig1box\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ebefore_script:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e*exportenv1gray\u003c/span\u003e \u003cspan class=\"comment\"\u003e# 指定环境变量，通过不同的环境获取不同的kubeconfig变量.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003erules:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"attr\"\u003eif:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;$CI_COMMIT_MESSAGE =~ /\\[gray[ _-]uc\\]/i \u0026amp;\u0026amp; $CONFIGPATH != \u0026#34;\u0026#34;\u0026#39;\u003c/span\u003e \u003cspan class=\"comment\"\u003e# 指定执行条件\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"多环境发布流程\"\u003e\u003ca href=\"#多环境发布流程\" class=\"headerlink\" title=\"多环境发布流程\"\u003e\u003c/a\u003e多环境发布流程\u003c/h3\u003e\u003cp\u003e对于多个环境, 其实除了配置不一样之外，其它的操作都是一样的，因此可借用yaml文件的锚定及gitlab的external功能大于减少gitlab-ci.yml配置文件的行数\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e因为需要将gitlab-ci.yml做成标准化的流程，对于我来说, 我不需要区分是谁触发的pipeline，只需要知道你想触发哪个pipeline, 至于权限问题,则直接丢给了gitlab做管理\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e有些开发者可能一天commit 100次, 但是他知道前面的90次都是做代码集成, 并不能编译通过, 所以没必要每次的push都执行pipeline， 所以把什么时候需要才真正执行pipeline的选择丢给了开发者,因为开发者才是真正知道代码进度的问题, 当然他想每次都执行也是没问题的.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e因此这里大量使用了\u003ccode\u003ecommit message\u003c/code\u003e关键字来区分environment\u003c/p\u003e\n\u003cp\u003e根据commit message的内容来选择执行对应的pipeline(以下关键字不区分大小写),比如: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e包含有**[mb]** 时: 会执行源码编译(makebinary),主要用于开发编译集成\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e包含有**[gray-cd] or [gray_cd] or [gray cd]**时: 发布到1box环境(测试环境)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e包含有 **[gray-uc] or [gray_uc] or [gray uc]**时: 说明只需要更新配置文件，但代码并未更新，适用于数据库密码修改等操作\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e当\u003ccode\u003egray\u003c/code\u003e环境回归测试通过后, 将分支合并到主分支，打tag后可使用**[prod-cd]**发布到生产再进行回归\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e包含有**[skip ci] or [ci skip]**时: 不执行任何pipeline, 适用于比如提交文档修改之类的操作\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e对于只需更新配置文件的前提\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e由于缺少专门的配置平台, 目前使用的配置文件都使用configmap中， 很多的开发者又喜欢直接在平台(rancher)上修改，这样就没办法保证源代码中的配置会得到及时的更新， 为保证配置文件端到端的修改, 尽量禁止了在rancher上直接修改配置文件\u003c/li\u003e\n\u003cli\u003e配置文件的存放路径需要位于项目跟目录下的config/config.yml，yaml格式, demo见下.\u003c/li\u003e\n\u003cli\u003e开发人员在发布\u003ccode\u003egray\u003c/code\u003e环境时, 不应该保存有生产上的配置文件, 生产上则可以保存1box环境的配置,\u003cstrong\u003eCI流程会根据发布的环境来选择对应的配置文件\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e应用启动时可通过命令行参数指定配置文件的路径, 固定位于目录/etc/${APP}/config.yml下\u003c/li\u003e\n\u003cli\u003e如果应用不存在配置文件(如nodejs等应用)则可在gitlab-ci.yml文件中把\u003ccode\u003eCONFIGPATH\u003c/code\u003e变量置为空\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"配置文件处理\"\u003e\u003ca href=\"#配置文件处理\" class=\"headerlink\" title=\"配置文件处理\"\u003e\u003c/a\u003e配置文件处理\u003c/h3\u003e\u003cp\u003e这是一个标准化的流程，由于代码中可能保存有所有环境的配置文件, 为了数据安全, 需要对配置文件进行解析, 即: 根据要发布的环境来选择配置文件段，然后发布成kubernetes configmap的形式,最后挂载到应用中.\u003c/p\u003e\n\u003cp\u003e这里参考一个开源库\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/olebedev/config\"\u003econfig\u003c/a\u003e,随便改了些代码就实现功能了，即: 通过指定一个环境变量来获取配置文件段.\u003c/p\u003e\n\u003cp\u003e###\u003ccode\u003econfig/config.yml\u003c/code\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003edebug:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003emode:\u003c/span\u003e \u003cspan class=\"string\"\u003edebug\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003etable:\u003c/span\u003e \u003cspan class=\"string\"\u003efilter\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eenabled:\u003c/span\u003e [\u003cspan class=\"string\"\u003emon\u003c/span\u003e,\u003cspan class=\"string\"\u003eosd\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003edisabled:\u003c/span\u003e []\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eipv4:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003emon:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003epriority:\u003c/span\u003e \u003cspan class=\"number\"\u003e100\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003etcp:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;-p tcp -m multiport --dport 6789,3300 -m state --state NEW -j ACCEPT\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;-p tcp -m multiport --dport 6789,3300 -m state --state ESTABLISHED -j ACCEPT\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eosd:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003epriority:\u003c/span\u003e \u003cspan class=\"number\"\u003e200\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003e1box:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003ezsk:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;我是ZSK\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003emode:\u003c/span\u003e \u003cspan class=\"string\"\u003e1box\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003etable:\u003c/span\u003e \u003cspan class=\"string\"\u003efilter\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eenabled:\u003c/span\u003e [\u003cspan class=\"string\"\u003emon\u003c/span\u003e,\u003cspan class=\"string\"\u003eosd\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003edisabled:\u003c/span\u003e []\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eipv4:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003emon:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003epriority:\u003c/span\u003e \u003cspan class=\"number\"\u003e100\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"attr\"\u003etcp:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;-p tcp -m multiport --dport 6789,3300 -m state --state NEW -j ACCEPT\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;-p tcp -m multiport --dport 6789,3300 -m state --state ESTABLISHED -j ACCEPT\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eprod:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"string\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e经过几天的研究测试，发现gitlab的CI/CD还是很强大的, 除了能够支持很多的语言来写gitlab-ci.yaml外,官方文档也是非常的详细, 我几乎没有再看其它的文档 .\u003c/p\u003e\n\u003cp\u003eCI/CD是个很有技巧的活, 除了标准化之外，跟其它工种的同学怎么协调接入, 比如自动化测、 分级发布、联动发布、黑盒监控等，都需要投入大量的时间来做.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e技术从来都不是重点, 推动起来被人认可才是\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e\u003cstrong\u003e参考文章:\u003c/strong\u003e\u003c/h3\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.gitlab.com/ee/ci/merge_request_pipelines/\"\u003ehttps://docs.gitlab.com/ee/ci/merge_request_pipelines/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/olebedev/config\"\u003ehttps://github.com/olebedev/config\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://gitlab.bj.sensetime.com/help/ci/variables/README#variables\"\u003ehttp://gitlab.bj.sensetime.com/help/ci/variables/README#variables\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\n      \n    \u003c/div\u003e",
  "Date": "2020-05-15T13:30:53+08:00",
  "Author": "Z.S.K."
}