{
  "Source": "izsk.me",
  "Title": "使用crash查看Linux系统异常重启原因",
  "Link": "https://izsk.me/2020/09/27/System-kernel-panic-debug/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e最近有一台物理机间歇性的发生重启, 本以为是偶发事件就没多在意，今天又给重启了, 因此决定探探究竟\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e首先看一下kdump服务是否开启, kdump主要用于内核发生crash时记录相关上下文的. 用来转储运行内存的一个工具\u003c/p\u003e\n\u003cp\u003e简言之: 系统一旦崩溃，内核就没法正常工作了，这个时候将由kdump提供一个用于捕获当前运行信息的内核，\u003c/p\u003e\n\u003cp\u003e该内核会将此时内存中的所有运行状态和数据信息收集到一个dump core文件中以便之后分析崩溃原因\u003c/p\u003e\n\u003cp\u003e之后系统便会重启.\u003c/p\u003e\n\u003cp\u003e关于kdump在内核已经崩溃的前提下还能够捕获到异常信息, 原理可\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://blog.csdn.net/zhangskd/article/details/38084337\"\u003e参考\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200927180148.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e这里引用\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://blog.csdn.net/zhangskd/article/details/38084337\"\u003e一张图\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200927185450.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e要分析core文件，可以使用crash工具，首先是安装:\u003c/p\u003e\n\u003cp\u003e注意, 要安装与当前内核对应的版本, 要不然crash无法使用.\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ewget http://debuginfo.centos.org/7/x86_64/kernel-debuginfo-common-x86_64-3.10.0-693.el7.x86_64.rpm\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewget http://debuginfo.centos.org/7/x86_64/kernel-debuginfo-3.10.0-693.el7.x86_64.rpm\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003erpm -ivh kernel-debuginfo-common-x86_64-3.10.0-693.el7.x86_64.rpm\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003erpm -ivh kernel-debuginfo-3.10.0-693.el7.x86_64.rpm\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eyum install crash\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e通常, 内核crash后保存的core文件保存在\u003ccode\u003e/var/crash\u003c/code\u003e目录下，在该目录下找到最近一次crash的时间，使用以下命令启动crash分析dump.\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecrash vmcore /usr/lib/debug/lib/modules/3.10.0-693.el7.x86_64/vmlinux\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e启动之后就进入到了crash命令行，很明显地显示出crash的原因,如下图红框所示:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200927175237.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e这里简要地反应出内核crash时的一些内存信息快照，包含一些物理信息, tasks数量，最重要的就是导致crash的command与panic的原因\u003c/p\u003e\n\u003cp\u003e这里可直接使用ps查看进程的相关信息,跟linux 命令行下的ps功能相似\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200927175207.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e还可以使用bt命令来查看trace信息, 当然都是一些汇编层的内容，需要有一定的专业知识，理解起来比较困难.\u003c/p\u003e\n\u003cp\u003e从上面已经知道了panic的原因后就可对症下药.\u003c/p\u003e\n\u003cp\u003e另外crash支持很多的子命令,大家可使用man crash查看，比较常用的为\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecrash ps \u003cspan class=\"comment\"\u003e# 查看进程\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecrash sys \u003cspan class=\"comment\"\u003e# 查看系统信息\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecrash bt \u003cspan class=\"comment\"\u003e# 查看堆栈信息\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecrash files \u003cspan class=\"comment\"\u003e# 查看异常时进程打开的文件\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecrash task \u003cspan class=\"comment\"\u003e# 查看指定task的信息\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e\u003cstrong\u003e参考文章:\u003c/strong\u003e\u003c/h3\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.linuxtechi.com/how-to-enable-kdump-on-rhel-7-and-centos-7/\"\u003ehttps://www.linuxtechi.com/how-to-enable-kdump-on-rhel-7-and-centos-7/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.cnblogs.com/doctormo/p/12619485.html\"\u003ehttps://www.cnblogs.com/doctormo/p/12619485.html\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://blog.csdn.net/zhangskd/article/details/38084337\"\u003ehttps://blog.csdn.net/zhangskd/article/details/38084337\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\n      \n    \u003c/div\u003e",
  "Date": "2020-09-27T21:10:53+08:00",
  "Author": "Z.S.K."
}