{
  "Source": "izsk.me",
  "Title": "CockRoachDB学习(无证书集群搭建)",
  "Link": "https://izsk.me/2019/05/20/CockroachDB-Cluster-Build-No-CA/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e3节点的无证书CockroachDB 集群搭建, 由于CRDB只有一个单二进制文件, 所以部署也非常简单.\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch3 id=\"物理机部署\"\u003e\u003ca href=\"#物理机部署\" class=\"headerlink\" title=\"物理机部署\"\u003e\u003c/a\u003e物理机部署\u003c/h3\u003e\u003cp\u003e将cockroach二进制包上传至服务器的目录/opt， 解压\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003etar zxf cockroach-v19.1.1.linux-amd64.tar.gz -C /opt\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecd /opt\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003emv  cockroach-v19.1.1.linux-amd64 cockroach\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecd cockroach\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e启动cockroach第一个节点\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enohup /opt/cockroach/cockroach start --insecure --store=node --host=172.16.104.19 --port=26257 --http-port=18080 \u0026amp;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e查看状态\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e./cockroach node status --insecure --host=172.16.104.19\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e重复以上命令依次重启第二个,第三个节点，启动时使用–join加入第一个节点\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enohup /opt/cockroach/cockroach start --insecure --store=node --host=172.16.104.20 --port=26257 --http-port=18080 --join 172.16.104.19 \u0026amp;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enohup /opt/cockroach/cockroach start --insecure --store=node --host=172.16.104.21 --port=26257 --http-port=18080 --join 172.16.104.19 \u0026amp;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e查看集群信息, 3个节点已经组成了一个集群\u003c/p\u003e\n\u003cp\u003e测试集群\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e./cockroach node status --insecure --host=172.16.104.19\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"Docker部署\"\u003e\u003ca href=\"#Docker部署\" class=\"headerlink\" title=\"Docker部署\"\u003e\u003c/a\u003eDocker部署\u003c/h3\u003e\u003cp\u003e第一个节点\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003edocker run -d --name=roach1 --hostname=roach1 -p 26257:26257 -p 8080:8080  -v \u0026#34;${PWD}/cockroach-data/roach1:/cockroach/cockroach-data\u0026#34;  cockroachdb/cockroach:v2.0.5 start --insecure\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e上述命令创建了一个容器，并在其中启动了第一个CockroachDB集群节点。 涉及指令和参数的介绍：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003edocker run\u003c/code\u003e：用Docker命令启动一个容器\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-d\u003c/code\u003e： 指定容器运行在后台\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e--name\u003c/code\u003e：指定容器的名字\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e--hostname\u003c/code\u003e：指定容器的主机名，和\u003ccode\u003ename\u003c/code\u003e不同，这个是其他容器加入其所在集群的标签。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-p  26257:26257 -p 8080:8080\u003c/code\u003e：指定内部节点和客户端节点的通信端口（26257）映射以及Admin界面从容器到主机的HTTP访问端口映射。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-v \u0026#34;${PWD}/cockroach-data/roach1:/cockroach/cockroach-data\u0026#34;\u003c/code\u003e： 挂载一个主机目录作为容器的磁盘，意味着数据和日志将会存在\u003ccode\u003e${PWD}/cockroach-data/roach1\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecockroachdb/cockroach:v2.0.5 start --insecure\u003c/code\u003e ：启动CockroachDB节点命令\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e添加节点二\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003edocker run -d --name=roach2 --hostname=roach2 -v \u0026#34;${PWD}/cockroach-data/roach2:/cockroach/cockroach-data\u0026#34; cockroachdb/cockroach:v2.0.5 start --insecure --join=roach1\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e添加节点三\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003edocker run -d --name=roach3 --hostname=roach3 -v \u0026#34;${PWD}/cockroach-data/roach3:/cockroach/cockroach-data\u0026#34; cockroachdb/cockroach:v2.0.5 start --insecure --join=roach1\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e测试集群\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003edocker exec -it roach1 ./cockroach sql --insecure\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"常用操作\"\u003e\u003ca href=\"#常用操作\" class=\"headerlink\" title=\"常用操作\"\u003e\u003c/a\u003e常用操作\u003c/h3\u003e\u003cp\u003e登录cockroach, 查看当前存在的数据库\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e./cockroach sql --insecure --host=172.16.104.19 --port=26257\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e新建数据库\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCREATE database unicorn;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e导入数据库表结构\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e./cockroach sql --insecure --host=172.16.104.19 --port=26257 --database=unicron \u0026lt;unicron.sql\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e查看用户信息\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e./cockroach --insecure --host=172.16.104.19 --port=26257 user get root\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e停止一个节点\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e./cockroach quit --insecure --host=172.16.104.19\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e\u003cstrong\u003e参考文章:\u003c/strong\u003e\u003c/h3\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://doc.cockroachchina.baidu.com/#maintain/remove-nodes/\"\u003ehttp://doc.cockroachchina.baidu.com/#maintain/remove-nodes/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\n      \n    \u003c/div\u003e",
  "Date": "2019-05-20T20:10:53+08:00",
  "Author": "Z.S.K."
}