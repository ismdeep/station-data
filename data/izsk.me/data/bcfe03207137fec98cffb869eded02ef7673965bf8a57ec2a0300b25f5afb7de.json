{
  "Source": "izsk.me",
  "Title": "定时备份Kubernetes集群常用对象到Yaml文件",
  "Link": "https://izsk.me/2020/02/02/Backup-Kubernetes-Object-ToYaml/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e有时候我们经常需要用到kubernetes中常用对象的yaml文件, 搞了个简单的脚本来定时备份集群中常用的资源对象保存到yaml文件，以防万一, 毕竟机器的运维权限在别人手上, 指不定什么时候就出问题.\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e脚本保存的常用对象如下, 需求比较明确, 脚本比较简单，也没啥好说的, 有些为了去掉yaml中不必要的字段使用了正则匹配, 又臭又长.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSecrets\u003c/li\u003e\n\u003cli\u003eConfig Maps\u003c/li\u003e\n\u003cli\u003eDeployments\u003c/li\u003e\n\u003cli\u003eServices\u003c/li\u003e\n\u003cli\u003eIngress\u003c/li\u003e\n\u003cli\u003ePersistent Volumes\u003c/li\u003e\n\u003cli\u003eCronjobs\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eshell脚本如下: \u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e56\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e57\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e59\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e60\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e61\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e62\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e63\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e65\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e66\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e67\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e68\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e69\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e70\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e71\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e72\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e73\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e74\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e75\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e76\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e77\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e78\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e79\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e80\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e81\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e82\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e83\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e84\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e85\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e86\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e87\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e88\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e89\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e90\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e91\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e92\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e93\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e94\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e95\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e96\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e97\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e98\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e99\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e100\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e101\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e102\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e103\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e104\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e105\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e106\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e107\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e108\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e109\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e110\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e111\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e112\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e113\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e114\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e115\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003ecat\u003c/span\u003e kubernetes-object-toyaml.backup\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e###########\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# Global Configurations\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#======================\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eBACKUP_DIR=/usr/local/src/kubernetes-objectyaml-backup\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eBACKUP_ENCS=\u003cspan class=\"variable\"\u003e$BACKUP_DIR\u003c/span\u003e/backup_encs\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eAWS_CMD=/usr/bin/aws\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eS3_BUCKET=your-s3-bucket\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eAWS_ACCESS_KEY_ID=your-aws-access-key\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eAWS_SECRET_ACCESS_KEY=your-aws-secret-key \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eTIME_STAMP=$(\u003cspan class=\"built_in\"\u003edate\u003c/span\u003e +%Y-%m-%d_%H-%M)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCLUSTER_NAME=your-cluster\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#tar secret\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eKUBE_ARCHIVE_PW=your-tar-password\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e######################\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e get_secret {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  kubectl get secret -n \u003cspan class=\"variable\"\u003e${1}\u003c/span\u003e -o=yaml --\u003cspan class=\"built_in\"\u003eexport\u003c/span\u003e --field-selector \u003cspan class=\"built_in\"\u003etype\u003c/span\u003e!=kubernetes.io/service-account-token | sed -e \u003cspan class=\"string\"\u003e\u0026#39;/resourceVersion: \u0026#34;[0-9]\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/uid: [a-z0-9-]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/selfLink: [a-z0-9A-Z/]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/creationTimestamp: \u0026#34;[0-9]\\+-[0-9]\\+-[0-9]\\+T.\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/kubectl.kubernetes.io\\/last-applied-configuration/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/{\u0026#34;apiVersion\u0026#34;:\u0026#34;.*}/d\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e get_configmap {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  kubectl get configmap -n \u003cspan class=\"variable\"\u003e${1}\u003c/span\u003e -o=yaml --\u003cspan class=\"built_in\"\u003eexport\u003c/span\u003e | sed -e \u003cspan class=\"string\"\u003e\u0026#39;/resourceVersion: \u0026#34;[0-9]\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/uid: [a-z0-9-]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/selfLink: [a-z0-9A-Z/]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/creationTimestamp: \u0026#34;[0-9]\\+-[0-9]\\+-[0-9]\\+T.\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/kubectl.kubernetes.io\\/last-applied-configuration/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/{\u0026#34;apiVersion\u0026#34;:\u0026#34;.*}/d\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e get_ingress {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  kubectl get ing -n \u003cspan class=\"variable\"\u003e${1}\u003c/span\u003e -o=yaml --\u003cspan class=\"built_in\"\u003eexport\u003c/span\u003e | sed -e \u003cspan class=\"string\"\u003e\u0026#39;/status:/,+2d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/\\- ip: \\([0-9]\\{1,3\\}\\.\\)\\{3\\}[0-9]\\{1,3\\}/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/resourceVersion: \u0026#34;[0-9]\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/uid: [a-z0-9-]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/selfLink: [a-z0-9A-Z/]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/creationTimestamp: \u0026#34;[0-9]\\+-[0-9]\\+-[0-9]\\+T.\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/kubectl.kubernetes.io\\/last-applied-configuration/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/{\u0026#34;apiVersion\u0026#34;:\u0026#34;.*}/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/generation: [0-9]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/field.cattle.io\\/publicEndpoints/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/field.cattle.io\\/ingressState/d\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e get_service {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  kubectl get service -n \u003cspan class=\"variable\"\u003e${1}\u003c/span\u003e -o=yaml --\u003cspan class=\"built_in\"\u003eexport\u003c/span\u003e | sed -e \u003cspan class=\"string\"\u003e\u0026#39;/ownerReferences:/,+5d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/resourceVersion: \u0026#34;[0-9]\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/uid: [a-z0-9-]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/selfLink: [a-z0-9A-Z/]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/clusterIP: \\([0-9]\\{1,3\\}\\.\\)\\{3\\}[0-9]\\{1,3\\}/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/creationTimestamp: \u0026#34;[0-9]\\+-[0-9]\\+-[0-9]\\+T.\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/kubectl.kubernetes.io\\/last-applied-configuration/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/{\u0026#34;apiVersion\u0026#34;:\u0026#34;.*}/d\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e get_deployment {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  kubectl get deployment -n \u003cspan class=\"variable\"\u003e${1}\u003c/span\u003e -o=yaml --\u003cspan class=\"built_in\"\u003eexport\u003c/span\u003e | sed -e \u003cspan class=\"string\"\u003e\u0026#39;/deployment\\.kubernetes\\.io\\/revision: \u0026#34;[0-9]\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/resourceVersion: \u0026#34;[0-9]\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/uid: [a-z0-9-]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/selfLink: [a-z0-9A-Z/]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/status:/,+18d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/creationTimestamp: \u0026#34;[0-9]\\+-[0-9]\\+-[0-9]\\+T.\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/kubectl.kubernetes.io\\/last-applied-configuration/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/{\u0026#34;apiVersion\u0026#34;:\u0026#34;.*}/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/generation: [0-9]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/field.cattle.io\\/publicEndpoints/d\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e get_cronjob {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  kubectl get cronjob -n \u003cspan class=\"variable\"\u003e${1}\u003c/span\u003e -o=yaml --\u003cspan class=\"built_in\"\u003eexport\u003c/span\u003e | sed -e \u003cspan class=\"string\"\u003e\u0026#39;/status:/,+1d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/resourceVersion: \u0026#34;[0-9]\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/uid: [a-z0-9-]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/selfLink: [a-z0-9A-Z/]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/creationTimestamp: \u0026#34;[0-9]\\+-[0-9]\\+-[0-9]\\+T.\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/kubectl.kubernetes.io\\/last-applied-configuration/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/{\u0026#34;apiVersion\u0026#34;:\u0026#34;.*}/d\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e get_pvc {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  kubectl get pvc -n \u003cspan class=\"variable\"\u003e${1}\u003c/span\u003e -o=yaml --\u003cspan class=\"built_in\"\u003eexport\u003c/span\u003e | sed -e \u003cspan class=\"string\"\u003e\u0026#39;/control\\-plane\\.alpha\\.kubernetes\\.io\\/leader\\:/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/resourceVersion: \u0026#34;[0-9]\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/uid: [a-z0-9-]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/selfLink: [a-z0-9A-Z/]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/creationTimestamp: \u0026#34;[0-9]\\+-[0-9]\\+-[0-9]\\+T.\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/kubectl.kubernetes.io\\/last-applied-configuration/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/{\u0026#34;apiVersion\u0026#34;:\u0026#34;.*}/d\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e get_pv {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e pvolume \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e `kubectl get pvc -n \u003cspan class=\"variable\"\u003e${1}\u003c/span\u003e -o=custom-columns=:.spec.volumeName` \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     kubectl get pv -o=yaml --\u003cspan class=\"built_in\"\u003eexport\u003c/span\u003e --field-selector metadata.name=\u003cspan class=\"variable\"\u003e${pvolume}\u003c/span\u003e | sed -e \u003cspan class=\"string\"\u003e\u0026#39;/resourceVersion: \u0026#34;[0-9]\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/uid: [a-z0-9-]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/selfLink: [a-z0-9A-Z/]\\+/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/creationTimestamp: \u0026#34;[0-9]\\+-[0-9]\\+-[0-9]\\+T.\\+\u0026#34;/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/kubectl.kubernetes.io\\/last-applied-configuration/d\u0026#39;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#39;/{\u0026#34;apiVersion\u0026#34;:\u0026#34;.*}/d\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e export_ns {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"built_in\"\u003emkdir\u003c/span\u003e -p \u003cspan class=\"variable\"\u003e${BACKUP_DIR}\u003c/span\u003e/\u003cspan class=\"variable\"\u003e${CLUSTER_NAME}\u003c/span\u003e/\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e \u003cspan class=\"variable\"\u003e${BACKUP_DIR}\u003c/span\u003e/\u003cspan class=\"variable\"\u003e${CLUSTER_NAME}\u003c/span\u003e/\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e namespace \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e `kubectl get namespaces --no-headers=\u003cspan class=\"literal\"\u003etrue\u003c/span\u003e | awk \u003cspan class=\"string\"\u003e\u0026#39;{ print $1 }\u0026#39;\u003c/span\u003e | grep -v -e \u003cspan class=\"string\"\u003e\u0026#34;cattle-prometheus\u0026#34;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#34;cattle-system\u0026#34;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#34;kube-system\u0026#34;\u003c/span\u003e -e \u003cspan class=\"string\"\u003e\u0026#34;kube-public\u0026#34;\u003c/span\u003e`\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Namespace: \u003cspan class=\"variable\"\u003e$namespace\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;+++++++++++++++++++++++++\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     \u003cspan class=\"built_in\"\u003emkdir\u003c/span\u003e -p \u003cspan class=\"variable\"\u003e$namespace\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e object_kind \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e configmap ingress service secret deployment cronjob pvc\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e kubectl get \u003cspan class=\"variable\"\u003e${object_kind}\u003c/span\u003e -n \u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e 2\u0026gt;\u0026amp;1 | grep \u003cspan class=\"string\"\u003e\u0026#34;No resources\u0026#34;\u003c/span\u003e \u0026gt; /dev/null; \u003cspan class=\"keyword\"\u003ethen\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;No resources found for \u003cspan class=\"variable\"\u003e${object_kind}\u003c/span\u003e in \u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         get_\u003cspan class=\"variable\"\u003e${object_kind}\u003c/span\u003e \u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e \u0026gt; \u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e/\u003cspan class=\"variable\"\u003e${object_kind}\u003c/span\u003e.\u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e.yaml \u0026amp;\u0026amp;  \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${object_kind}\u003c/span\u003e.\u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e\u0026#34;\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e [ \u003cspan class=\"variable\"\u003e${object_kind}\u003c/span\u003e = \u003cspan class=\"string\"\u003e\u0026#34;pvc\u0026#34;\u003c/span\u003e ]; \u003cspan class=\"keyword\"\u003ethen\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e           get_pv \u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e \u0026gt; \u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e/pv.\u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e.yaml \u0026amp;\u0026amp;  \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;pv.\u003cspan class=\"variable\"\u003e${namespace}\u003c/span\u003e\u0026#34;\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         \u003cspan class=\"keyword\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       \u003cspan class=\"keyword\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     \u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;+++++++++++++++++++++++++\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e###########################################################\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e## Archiving k8s data with password to upload it to AWS S3.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e## This password is available on our password manager.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e############################################################\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e archive_ns {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e \u003cspan class=\"variable\"\u003e${BACKUP_DIR}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"built_in\"\u003emkdir\u003c/span\u003e -p \u003cspan class=\"variable\"\u003e${BACKUP_ENCS}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e# tar with openssl\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  tar cz \u003cspan class=\"variable\"\u003e${CLUSTER_NAME}\u003c/span\u003e | openssl enc -aes-256-cbc -e -k \u003cspan class=\"variable\"\u003e${KUBE_ARCHIVE_PW}\u003c/span\u003e \u0026gt; \u003cspan class=\"variable\"\u003e${BACKUP_ENCS}\u003c/span\u003e/\u003cspan class=\"variable\"\u003e${CLUSTER_NAME}\u003c/span\u003e-\u003cspan class=\"variable\"\u003e${TIME_STAMP}\u003c/span\u003e.tar.gz.enc\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e# untar with openssl\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e# https://www.howtoing.com/encrypt-decrypt-files-tar-openssl-linux/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e# openssl enc -d -aes256-cbc -k ${KUBE_ARCHIVE_PW} -in xxx.ooo.tar.gz.enc | tar xz -C test\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# Upload Backups\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#===============\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e upload_backup_to_s3 {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"variable\"\u003e${AWS_CMD}\u003c/span\u003e s3 \u003cspan class=\"built_in\"\u003ecp\u003c/span\u003e \u003cspan class=\"variable\"\u003e${BACKUP_DIR}\u003c/span\u003e/\u003cspan class=\"variable\"\u003e${CLUSTER_NAME}\u003c/span\u003e-\u003cspan class=\"variable\"\u003e${TIME_STAMP}\u003c/span\u003e.tar.gz.enc s3://\u003cspan class=\"variable\"\u003e${S3_BUCKET}\u003c/span\u003e/\u003cspan class=\"variable\"\u003e${CLUSTER_NAME}\u003c/span\u003e/\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e [ $? -eq 0 ]; \u003cspan class=\"keyword\"\u003ethen\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${CLUSTER_NAME}\u003c/span\u003e-\u003cspan class=\"variable\"\u003e${TIME_STAMP}\u003c/span\u003e.tar.gz.enc is successfully uploaded\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003erm\u003c/span\u003e -rf \u003cspan class=\"variable\"\u003e${BACKUP_DIR}\u003c/span\u003e/\u003cspan class=\"variable\"\u003e${CLUSTER_NAME}\u003c/span\u003e \u003cspan class=\"variable\"\u003e${BACKUP_DIR}\u003c/span\u003e/k8s-data-\u003cspan class=\"variable\"\u003e${TIME_STAMP}\u003c/span\u003e.tar.gz.enc\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${CLUSTER_NAME}\u003c/span\u003e-\u003cspan class=\"variable\"\u003e${TIME_STAMP}\u003c/span\u003e.tar.gz.enc failed to be uploaded\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eexit\u003c/span\u003e 1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# Clean 7 days ago\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e clean_7days_ago {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  find \u003cspan class=\"variable\"\u003e${BACKUP_ENCS}\u003c/span\u003e -mtime +7 -name \u003cspan class=\"string\"\u003e\u0026#34;*.tar.gz.enc\u0026#34;\u003c/span\u003e -\u003cspan class=\"built_in\"\u003eexec\u003c/span\u003e /bin/rm -rf {} \\;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e###########\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eexport_ns\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003earchive_ns\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eupload_backup_to_s3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eclean_7days_ago\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e在另一master节点下执行:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ebash kubernetes-object-toyaml.backup\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e最后加入系统crontab即可\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e11 22 * * * bash /your/dir/kubernetes-object-toyaml.backup\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e再或者加个rsync同步到其它节点上，双保险.\u003c/p\u003e\n\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e\u003cstrong\u003e参考文章:\u003c/strong\u003e\u003c/h3\u003e\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\n      \n    \u003c/div\u003e",
  "Date": "2020-02-02T20:10:53+08:00",
  "Author": "Z.S.K."
}