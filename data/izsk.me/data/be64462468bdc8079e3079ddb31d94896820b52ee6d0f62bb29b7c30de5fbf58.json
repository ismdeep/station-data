{
  "Source": "izsk.me",
  "Title": "Kubernetes学习(在云架构外运行flannel)",
  "Link": "https://izsk.me/2020/01/07/Kubernetes-running-flannel-out-of-cloud/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e该文章为翻译文档, 这里是\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-flannel-c01283308f0e\"\u003e原文地址\u003c/a\u003e, 比较清晰地说明了flannel在VxLAN下的实现原理\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\n\n\u003cp\u003e在本文中，我们将详细介绍flannel及其在Kubernetes网络中的作用。我强烈建议您点击参考链接，以更好地了解flannel工作原理。\u003c/p\u003e\n\u003cp\u003e在\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-etcd-b332d1be474c\"\u003e上一篇文章中\u003c/a\u003e，我们介绍了\u003cstrong\u003eetcd\u003c/strong\u003e并对其进行了简要概述。\u003c/p\u003e\n\u003cp\u003e这些文章是我们的\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://medium.com/@mtvallim/kubernetes-journey-up-and-running-out-of-the-cloud-introduction-f04a811c92a5\"\u003eKubernetes旅程的\u003c/a\u003e一部分。我希望您很高兴深入了解如何从云中安装和配置Kubernetes！\u003c/p\u003e\n\u003ch3 id=\"集群网络\"\u003e\u003ca href=\"#集群网络\" class=\"headerlink\" title=\"集群网络\"\u003e\u003c/a\u003e集群网络\u003c/h3\u003e\u003cblockquote\u003e\n\u003cp\u003e\u003cem\u003e“网络是Kubernetes的核心部分，但要确切地了解其预期工作方式可能会有些困难。”\u003c/em\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://kubernetes.io/docs/concepts/cluster-administration/networking/\"\u003ehttps://kubernetes.io/docs/concepts/cluster-administration/networking/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在讨论\u003cstrong\u003eflannel\u003c/strong\u003e之前，了解群集的网络特性很重要。\u003c/p\u003e\n\u003cp\u003e在本节中，我们将主要集中于了解\u003cstrong\u003ePod到Pod的\u003c/strong\u003e通信方式。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eKubernetes网络模型\u003c/strong\u003e遵循一些基本假设。在\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://kubernetes.io/docs/concepts/cluster-administration/networking/#the-kubernetes-network-model\"\u003e官方文件\u003c/a\u003e说，\u003cstrong\u003eKubernetes网络模型的\u003c/strong\u003e要求：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cem\u003ePod都可以彼此通信，而无需使用网络地址转换（NAT）。\u003c/em\u003e\u003c/li\u003e\n\u003cli\u003e\u003cem\u003e节点-运行Kubernetes集群的机器。这些可以是虚拟机或物理机，或者实际上可以运行Kubernetes的任何其他机器-也可以与所有Pod通信，而无需NAT。\u003c/em\u003e\u003c/li\u003e\n\u003cli\u003e\u003cem\u003e每个Pod会看到与其他Pod一样的IP\u003c/em\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"Kubernetes网络模型\"\u003e\u003ca href=\"#Kubernetes网络模型\" class=\"headerlink\" title=\"Kubernetes网络模型\"\u003e\u003c/a\u003eKubernetes网络模型\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200422150307.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e每个Kubernetes节点（主节点或工作节点）都是Linux机器（VM或Bare Metal），其具有网络命名空间**-netns-\u003cstrong\u003e以网络接口作为其主要接口。上图中的\u003c/strong\u003eeth0**对此进行了说明。\u003c/p\u003e\n\u003cp\u003e仔细观察，我们可以看到每个Pod都有自己的\u003cstrong\u003eeth\u003c/strong\u003e接口，这意味着每个Pod都有自己的网络配置（IP，路由等）。这也意味着每个Pod都有自己的\u003cstrong\u003e网络\u003c/strong\u003e，因此我们有一个按网络接口分隔的网络命名空间。\u003c/p\u003e\n\u003cp\u003e为了说明这一点，假设您与同事一起参加在拉斯维加斯举行的会议。贵公司将赞助您参加此次会议，因此您将全部留在同一家酒店（Kubernetes节点）。这家酒店的每个房间（一个Pod）都配备了客房电话（网络接口）。\u003c/p\u003e\n\u003cp\u003e您可以使用客房电话与不在酒店的家人进行通讯。没有免费的午餐，因此酒店显然会向您收取使用客房电话拨打的任何外部电话的费用。为此，所有外部呼叫都要经过一个中心（\u003cstrong\u003eeth0\u003c/strong\u003e），该中心将对其进行注册，然后将这些呼叫重定向到外部世界。客房电话和此中央设备之间的链接类似于虚拟接口（\u003cstrong\u003eveth\u003c/strong\u003e）在网络中扮演的角色\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e“第五个设备是虚拟以太网设备。它们可以充当网络名称空间之间的隧道，以创建到另一个名称空间中的物理网络设备的桥，但也可以用作独立的网络设备。\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eveth设备总是以互连对的形式创建。”\u003c/em\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://man7.org/linux/man-pages/man4/veth.4.html\"\u003ehttps://man7.org/linux/man-pages/man4/veth.4.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e现在，您和您的同事希望例如在您离开会议或吃晚饭时让对方知道。您想节省一些钱，因此决定使用客房电话互相通话，而不是使用手机。当您在酒店办理入住手续时，礼宾部解释说，您可以通过输入\u003cstrong\u003e＃\u0026lt;房间号\u0026gt;在\u003c/strong\u003e各个房间之间互相呼叫。有一个内部中心，可以进行这种通信。这类似于\u003cstrong\u003ecni0\u003c/strong\u003e（如上图所示）扮演的角色，充当允许Pod到Pod通信的桥梁。\u003c/p\u003e\n\u003cp\u003e这家酒店可能有多栋建筑，而您的一些同事则位于第二栋建筑中。不过，礼宾部解释说根本没有问题。要与他们进行通信，您只需要在房间号之前添加建筑物号：\u003cstrong\u003e＃ \u0026lt;房间号\u0026gt;\u003cstrong\u003e。内部中央（\u003c/strong\u003ecni\u003c/strong\u003e）将注意到此地址不是其自己建筑物的内部地址，会将呼叫重定向到中央（\u003cstrong\u003eeth0\u003c/strong\u003e），这将使它们再次将呼叫重定向到另一个建筑物（另一个Kubernetes节点）中央（类似于\u003cstrong\u003eeth0\u003c/strong\u003e），依次将呼叫传递到它自己的内部中心，使呼叫最终在目标房间完成。有关此方案的更多技术说明，请检查\u003cstrong\u003e在\u003c/strong\u003e下面的“\u003cstrong\u003e跨不同主机路由流量”\u003c/strong\u003e部分。\u003c/p\u003e\n\u003cp\u003e在Kubernetes上，所有这些配置和管理都是通过\u003cstrong\u003eCNI\u003c/strong\u003e（容器网络接口）插件进行的\u003c/p\u003e\n\u003ch3 id=\"什么是CNI\"\u003e\u003ca href=\"#什么是CNI\" class=\"headerlink\" title=\"什么是CNI\"\u003e\u003c/a\u003e什么是CNI\u003c/h3\u003e\u003cp\u003e\u003cstrong\u003eCNI\u003c/strong\u003e是\u003cstrong\u003eContainer Networking Interface\u003c/strong\u003e（\u003cstrong\u003e容器网络接口\u003c/strong\u003e）的缩写，它基本上是一个外部软件（模块），它实现了\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/containernetworking/cni/blob/master/SPEC.md#container-network-interface-specification\"\u003e规范明确定义\u003c/a\u003e的\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/containernetworking/cni/blob/master/SPEC.md#container-network-interface-specification\"\u003e接口\u003c/a\u003e，该\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/containernetworking/cni/blob/master/SPEC.md#container-network-interface-specification\"\u003e接口\u003c/a\u003e允许\u003cstrong\u003eKubernetes\u003c/strong\u003e执行操作以提供网络功能。\u003c/p\u003e\n\u003cp\u003e“\u003cstrong\u003e每个CNI插件必须实现为由容器管理系统（例如rkt或Kubernetes）调用的可执行文件。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eCNI插件是负责将网络接口到所述容器网络命名空间（例如一个的一端VETH在主机上对），使任何必要的变更（例如，另一端附接VETH成桥）。然后，它应该通过调用适当的IPAM插件，将IP分配给该接口并设置与IP地址管理部分一致的路由。”\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/containernetworking/cni/blob/master/SPEC.md#cni-plugin\"\u003ehttps://github.com/containernetworking/cni/blob/master/SPEC.md#cni-plugin\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"Kubernetes请求路由\"\u003e\u003ca href=\"#Kubernetes请求路由\" class=\"headerlink\" title=\"Kubernetes请求路由\"\u003e\u003c/a\u003eKubernetes请求路由\u003c/h3\u003e\u003cp\u003e我们将在两种情况下更详细地说明如何在Pod之间路由流量\u003c/p\u003e\n\u003ch4 id=\"在同一主机上路由流量\"\u003e\u003ca href=\"#在同一主机上路由流量\" class=\"headerlink\" title=\"在同一主机上路由流量\"\u003e\u003c/a\u003e在同一主机上路由流量\u003c/h4\u003e\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200422150719.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e从\u003cstrong\u003ePod 4\u003c/strong\u003e到\u003cstrong\u003ePod 6\u003c/strong\u003e的逐步通信：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e程序包通过eth4接口离开Pod 4网络，并通过虚拟接口veth4到达根网络\u003c/li\u003e\n\u003cli\u003e请求到达cni0，寻找Pod 6的地址\u003c/li\u003e\n\u003cli\u003e请求离开cni0并重定向到veth6\u003c/li\u003e\n\u003cli\u003e请求通过veth6离开根网络，并通过eth6接口到达pod6网络\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4 id=\"跨不同主机路由流量\"\u003e\u003ca href=\"#跨不同主机路由流量\" class=\"headerlink\" title=\"跨不同主机路由流量\"\u003e\u003c/a\u003e跨不同主机路由流量\u003c/h4\u003e\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200422151055.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e从\u003cstrong\u003ePod 1\u003c/strong\u003e到\u003cstrong\u003ePod 6\u003c/strong\u003e的逐步通信：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e程序包通过eth1接口离开Pod 1网络并通过虚拟接口veth1到达根网络\u003c/li\u003e\n\u003cli\u003e请求离开veth1并到达cni0，寻找Pod6地址\u003c/li\u003e\n\u003cli\u003e请求离开cni0并重定向到eth0\u003c/li\u003e\n\u003cli\u003e请求从主机1离开eth0到达网关\u003c/li\u003e\n\u003cli\u003e请求离开网关，并通过Worker1上的eth0接口到达根网\u003c/li\u003e\n\u003cli\u003e请求离开eth0并到达cni0，以查找Pod6的地址；\u003c/li\u003e\n\u003cli\u003e请求离开cni0并重定向到veth6虚拟接口\u003c/li\u003e\n\u003cli\u003e请求从根netns通过veth6并到达Pod6 netns的eth6接口;\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"flannel\"\u003e\u003ca href=\"#flannel\" class=\"headerlink\" title=\"flannel\"\u003e\u003c/a\u003eflannel\u003c/h3\u003e\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200422151535.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e“ Flannel是配置专为Kubernetes设计的第3层网络结构的简单方法\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eFlannel\u003c/em\u003e 在每个主机上运行一个小的单一二进制代理程序，称为flanneld，并负责从更大的预配置地址空间中为每个主机分配子网租约。Flannel *直接\u003cstrong\u003e使用Kubernetes API或etcd\u003c/strong\u003e来存储网络配置，分配的子网以及任何辅助数据（例如主机的公共IP）。数据包使用包括VXLAN和各种云集成在内的几种后端机制之一转发。”\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/coreos/flannel\"\u003ehttps://github.com/coreos/flannel\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"backend\"\u003e\u003ca href=\"#backend\" class=\"headerlink\" title=\"backend\"\u003e\u003c/a\u003ebackend\u003c/h4\u003e\u003cblockquote\u003e\n\u003cp\u003e\u003cem\u003e“\u003c/em\u003e flannel可以与几个不同的后端进行配对。设置后，不应在运行时更改后端。\u003c/p\u003e\n\u003cp\u003e推荐使用\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/coreos/flannel/blob/master/Documentation/backends.md#vxlan\"\u003eVXLAN\u003c/a\u003e\u003cem\u003e。建议有经验的用户使用\u003c/em\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/coreos/flannel/blob/master/Documentation/backends.md#host-gw\"\u003e host-gw\u003c/a\u003e*来提高性能并获得基础架构的支持（通常不能在云环境中使用）。建议将\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/coreos/flannel/blob/master/Documentation/backends.md#udp\"\u003eUDP\u003c/a\u003e*仅用于调试或不支持VXLAN的非常老的内核。”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考 \u003ca href=\"%5Bgithub.com/coreos/flannel/blob/master/Documentation/backends.md\"\u003ehttps://github.com/coreos/flannel/blob/master/Documentation/backends\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在本文中，我们将讨论在解决方案中将使用的\u003cstrong\u003eVXLAN\u003c/strong\u003e模式的内部\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/zhoushuke/BlogPhoto/master/githuboss/20200422151813.png\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"flannel-namespace\"\u003e\u003ca href=\"#flannel-namespace\" class=\"headerlink\" title=\"flannel namespace\"\u003e\u003c/a\u003eflannel namespace\u003c/h3\u003e\u003cp\u003e默认情况下，flannel使用CIDR \u003cstrong\u003e10.244.0.0/16\u003c/strong\u003e为每个节点分配具有\u003cstrong\u003e10.244.X.0 / 24\u003c/strong\u003e掩码的较小子网，而\u003cstrong\u003ePod\u003c/strong\u003e将使用这些子网之一分配给给定节点的IP地址。\u003c/p\u003e\n\u003cp\u003e简而言之，这意味着每个节点最多可以有254个活动Pod，其中每个Pod将具有与此分配的子网不同的IP。\u003c/p\u003e\n\u003cp\u003e你可以看到在本说明书\u003cstrong\u003eKUBE-flannel.yml\u003c/strong\u003e清单，在定义\u003cstrong\u003e网conf.json\u003c/strong\u003e。（官方flannel repository位于下面的链接中）\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003ekind:\u003c/span\u003e \u003cspan class=\"string\"\u003eConfigMap\u003c/span\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eapiVersion:\u003c/span\u003e \u003cspan class=\"string\"\u003ev1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003emetadata:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"string\"\u003ekube-flannel-cfg\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003enamespace:\u003c/span\u003e \u003cspan class=\"string\"\u003ekube-system\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003elabels:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003etier:\u003c/span\u003e \u003cspan class=\"string\"\u003enode\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eapp:\u003c/span\u003e \u003cspan class=\"string\"\u003eflannel\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003edata:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ecni-conf.json:\u003c/span\u003e \u003cspan class=\"string\"\u003e|\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      \u0026#34;name\u0026#34;: \u0026#34;cbr0\u0026#34;,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      \u0026#34;plugins\u0026#34;: [\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e          \u0026#34;type\u0026#34;: \u0026#34;flannel\u0026#34;,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e          \u0026#34;delegate\u0026#34;: {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e            \u0026#34;hairpinMode\u0026#34;: true,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e            \u0026#34;isDefaultGateway\u0026#34;: true\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e          }\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        },\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e          \u0026#34;type\u0026#34;: \u0026#34;portmap\u0026#34;,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e          \u0026#34;capabilities\u0026#34;: {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e            \u0026#34;portMappings\u0026#34;: true\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e          }\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      ]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e\u003c/span\u003e  \u003cspan class=\"attr\"\u003enet-conf.json:\u003c/span\u003e \u003cspan class=\"string\"\u003e|\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      \u0026#34;Network\u0026#34;: \u0026#34;10.244.0.0/16\u0026#34;,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      \u0026#34;Backend\u0026#34;: {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        \u0026#34;Type\u0026#34;: \u0026#34;vxlan\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      }\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch4 id=\"Virtual-Ethernet-Devices-—-veth\"\u003e\u003ca href=\"#Virtual-Ethernet-Devices-—-veth\" class=\"headerlink\" title=\"Virtual Ethernet Devices — veth\"\u003e\u003c/a\u003eVirtual Ethernet Devices — veth\u003c/h4\u003e\u003cblockquote\u003e\n\u003cp\u003e“veth设备是虚拟以太网设备。它们可以充当网络名称空间之间的隧道，以创建到另一个名称空间中的物理网络设备的桥梁，但也可以用作独立的网络设备。”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://man7.org/linux/man-pages/man4/veth.4.html\"\u003ehttps://man7.org/linux/man-pages/man4/veth.4.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"Bridge-—-cni0\"\u003e\u003ca href=\"#Bridge-—-cni0\" class=\"headerlink\" title=\"Bridge — cni0\"\u003e\u003c/a\u003eBridge — cni0\u003c/h4\u003e\u003cp\u003e\u003cstrong\u003ecni0\u003c/strong\u003e是Linux网络桥接设备，所有\u003cstrong\u003eveth\u003c/strong\u003e设备都将连接到该桥接器，因此同一节点上的所有\u003cstrong\u003ePod\u003c/strong\u003e都可以相互通信，如\u003cstrong\u003eKubernetes网络模型\u003c/strong\u003e和上述酒店类比中所述\t\u003c/p\u003e\n\u003ch4 id=\"vxlan-flannel\"\u003e\u003ca href=\"#vxlan-flannel\" class=\"headerlink\" title=\"vxlan-flannel\"\u003e\u003c/a\u003evxlan-flannel\u003c/h4\u003e\u003cp\u003e\u003cem\u003e“\u003c/em\u003e 虚拟可扩展局域网（VXLAN）是一种\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Network_virtualization\"\u003e网络虚拟化\u003c/a\u003e技术，旨在解决与大型\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Cloud_computing\"\u003e云计算\u003c/a\u003e部署相关的\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Scalability\"\u003e可扩展性\u003c/a\u003e问题。它使用类似\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/VLAN\"\u003eVLAN\u003c/a\u003e的封装技术将\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/OSI_model\"\u003eOSI\u003c/a\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Layer_2\"\u003e第2层\u003c/a\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Ethernet_frame\"\u003e以太网帧\u003c/a\u003e封装在\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Layer_4\"\u003e第4层\u003c/a\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/User_Datagram_Protocol\"\u003eUDP\u003c/a\u003e数据报中，并使用4789作为默认\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Internet_Assigned_Numbers_Authority\"\u003eIANA\u003c/a\u003e分配的目标UDP端口号。终止VXLAN隧道的VXLAN终结点，可以是虚拟或物理\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Switch_port\"\u003e交换机端口\u003c/a\u003e，称为VXLAN隧道终结点（VTEP ).”\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Virtual_Extensible_LAN\"\u003ehttps://en.wikipedia.org/wiki/Virtual_Extensible_LAN\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e该接口（在我们的图中，flannel.1）的主要功能是通过覆盖来确保Pod及其网络之间的通信前提之一（记住每个节点都有一个子网，每个Pod都有该子网的IP)。\u003c/p\u003e\n\u003cp\u003e使用VXLAN，可以通过使两个或多个网络像在同一个网络中一样进行操作来连接两个或多个网络，也就是说，每个网络都是其自身网络的一部分，但在同一域内。\u003c/p\u003e\n\u003cp\u003e在以前使用的类比中，VXLAN是将一栋建筑物连接到另一栋建筑物的（物理）电话线，从而允许您所在建筑物（Node1）中一个（Pod1)与位于您的同事所在的另一座建筑物（Node2）中的Pod4通信。 \u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eflanneld\u003c/strong\u003e是一个守护程序，负责使节点（及其所包含的Pod）之间的路由保持最新。\u003c/p\u003e\n\u003ch3 id=\"原文地址\"\u003e\u003ca href=\"#原文地址\" class=\"headerlink\" title=\"原文地址\"\u003e\u003c/a\u003e原文地址\u003c/h3\u003e\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-flannel-c01283308f0e\"\u003ehttps://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-flannel-c01283308f0e\u003c/a\u003e\u003c/p\u003e\n\n      \n    \u003c/div\u003e",
  "Date": "2020-01-07T10:30:53+08:00",
  "Author": "Z.S.K."
}