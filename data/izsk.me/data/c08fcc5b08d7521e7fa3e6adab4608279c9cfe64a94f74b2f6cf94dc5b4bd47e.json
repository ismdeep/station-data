{
  "Source": "izsk.me",
  "Title": "使用Influxdb-relay实现Influxdb高可用",
  "Link": "https://izsk.me/2020/08/04/influx-single-transfer-to-relay/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e目前平台有些遗留应用还是使用的influxdb保存监控数据, influxdb为单实例, 随时可能出现单机故障, 考虑到influxdb还将运行很长一段时间, 因此需要扩展成HA机制, 这里选择influxdb-relay方案\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e这里需要说明的是, relay不会同步两个influxdb实例之间的数据，\u003cstrong\u003e它只提供双写的能力\u003c/strong\u003e，即在某个实例出现问题后还能将数据正常写入另一个正常的实例, 保证数据不丢失.如果想在问题实例上同步这部分数据话需要人工介入.\u003c/p\u003e\n\u003ch3 id=\"架构\"\u003e\u003ca href=\"#架构\" class=\"headerlink\" title=\"架构\"\u003e\u003c/a\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/influxdata/influxdb-relay\"\u003e架构\u003c/a\u003e\u003c/h3\u003e\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\t\t\t\t┌─────────────────┐                 \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        │writes \u0026amp; queries │                 \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        └─────────────────┘                 \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                 │                          \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                 ▼                          \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         ┌───────────────┐                  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         │               │                  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e┌────────│ Load Balancer │─────────┐        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│        │               │         │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│        └──────┬─┬──────┘         │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│               │ │                │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│               │ │                │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│        ┌──────┘ └────────┐       │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│        │ ┌─────────────┐ │       │┌──────┐\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│        │ │/write or UDP│ │       ││/query│\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│        ▼ └─────────────┘ ▼       │└──────┘\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│  ┌──────────┐      ┌──────────┐  │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│  │ InfluxDB │      │ InfluxDB │  │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│  │ Relay    │      │ Relay    │  │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│  └──┬────┬──┘      └────┬──┬──┘  │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│     │    |              |  │     │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│     |  ┌─┼──────────────┘  |     │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│     │  │ └──────────────┐  │     │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│     ▼  ▼                ▼  ▼     │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│  ┌──────────┐      ┌──────────┐  │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e│  │          │      │          │  │        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e└─▶│ InfluxDB │      │ InfluxDB │◀─┘        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   │          │      │          │           \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   └──────────┘      └──────────┘ \u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e共涉及到3个应用\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eInfluxdb: influxdb实例\u003c/li\u003e\n\u003cli\u003eInfluxdb-relay: 代理influxdb的写流量, 通过双写机制保证数据写入到2个influxdb数据库中,读流量还是从lb直接转到influxdb实例，不会经过relay\u003c/li\u003e\n\u003cli\u003eloadBalancer: 对influxdb的读写流量都通过该服务进行代理到influxdb relay, 选择nginx即可,其它需要访问influxdb服务的配置参数都需要指定该应用的地址\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"新增实例\"\u003e\u003ca href=\"#新增实例\" class=\"headerlink\" title=\"新增实例\"\u003e\u003c/a\u003e新增实例\u003c/h3\u003e\u003cp\u003e线上influxdb的版本为:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eInfluxDB v1.7.4 (git: 1.7 ef77e72f435b71b1ad6da7d6a6a4c4a262439379)\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e部署机器: \u003ccode\u003e192.168.1.5\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e需要在一台机器上部署一个influxdb新实例: \u003ccode\u003e192.168.1.6\u003c/code\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ewget https://dl.influxdata.com/influxdb/releases/influxdb_1.7.4_amd64.deb\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edpkg -i influxdb_1.7.4_amd64.deb\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e两个实例使用的配置文件如下, 具体的参数配置可以根据情况定:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecat /etc/influxdb/influxdb.conf\u003c/code\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e56\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e57\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e59\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e60\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e61\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e62\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e63\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e65\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e66\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e67\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e68\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e69\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e70\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e71\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e72\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e73\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e74\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e75\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e76\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e77\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e78\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e79\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e80\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ereporting-disabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ebind-address = \u003cspan class=\"string\"\u003e\u0026#34;:8088\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[meta]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"built_in\"\u003edir\u003c/span\u003e = \u003cspan class=\"string\"\u003e\u0026#34;/data/influxdb/meta\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  retention-autocreate = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[data]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"built_in\"\u003edir\u003c/span\u003e = \u003cspan class=\"string\"\u003e\u0026#34;/data/influxdb/data\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  wal-dir = \u003cspan class=\"string\"\u003e\u0026#34;/data/influxdb/wal\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  wal-fsync-delay = \u003cspan class=\"string\"\u003e\u0026#34;50ms\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  index-version = \u003cspan class=\"string\"\u003e\u0026#34;inmem\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  trace-logging-enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  query-log-enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  validate-keys = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  cache-max-memory-size = \u003cspan class=\"string\"\u003e\u0026#34;4g\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  compact-full-write-cold-duration = \u003cspan class=\"string\"\u003e\u0026#34;6h\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-concurrent-compactions = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  compact-throughput = \u003cspan class=\"string\"\u003e\u0026#34;64m\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  compact-throughput-burst = \u003cspan class=\"string\"\u003e\u0026#34;128m\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  tsm-use-madv-willneed = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-series-per-database = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-values-per-tag = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[coordinator]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  write-timeout = \u003cspan class=\"string\"\u003e\u0026#34;600s\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-concurrent-queries = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  query-timeout = \u003cspan class=\"string\"\u003e\u0026#34;0s\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  log-queries-after = \u003cspan class=\"string\"\u003e\u0026#34;60s\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-select-point = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-select-series = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-select-buckets = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[retention]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  enabled = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  check-interval = \u003cspan class=\"string\"\u003e\u0026#34;1h\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[shard-precreation]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  enabled = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  check-interval = \u003cspan class=\"string\"\u003e\u0026#34;30m\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  advance-period = \u003cspan class=\"string\"\u003e\u0026#34;30m\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[monitor]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  store-enabled = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  store-database = \u003cspan class=\"string\"\u003e\u0026#34;_internal\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  store-interval = \u003cspan class=\"string\"\u003e\u0026#34;60s\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[http]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  enabled = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  flux-enabled = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  bind-address = \u003cspan class=\"string\"\u003e\u0026#34;:8086\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  log-enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  write-tracing = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  pprof-enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  debug-pprof-enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  https-enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-row-limit = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-connection-limit = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  unix-socket-enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-body-size = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-concurrent-write-limit = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  max-enqueued-write-limit = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  enqueued-write-timeout = 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[logging]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  format = \u003cspan class=\"string\"\u003e\u0026#34;json\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  level = \u003cspan class=\"string\"\u003e\u0026#34;info\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  suppress-logo = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[subscriber]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[[graphite]]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e enabled = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e database = \u003cspan class=\"string\"\u003e\u0026#34;graphite\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e retention-policy = \u003cspan class=\"string\"\u003e\u0026#34;day_hour\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e bind-address = \u003cspan class=\"string\"\u003e\u0026#34;:2003\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e protocol = \u003cspan class=\"string\"\u003e\u0026#34;tcp\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e consistency-level = \u003cspan class=\"string\"\u003e\u0026#34;one\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e batch-size = 1000\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e batch-pending = 50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e batch-timeout = \u003cspan class=\"string\"\u003e\u0026#34;1s\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[[udp]]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[continuous_queries]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  enabled = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  log-enabled = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  query-stats-enabled = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  run-interval = \u003cspan class=\"string\"\u003e\u0026#34;10s\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[tls]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e实例启停方式:\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esystemctl start influxd.service\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esystemctl stop influxd.service\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cstrong\u003e启动新的influxdb实例后，需要将线上数据导入到该实例.\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"relay\"\u003e\u003ca href=\"#relay\" class=\"headerlink\" title=\"relay\"\u003e\u003c/a\u003erelay\u003c/h3\u003e\u003cp\u003erelay服务会对统一接入的流程进行转发， 可直接docker部署，目前只有一个实例, 可扩容成2个,配置相同.\u003c/p\u003e\n\u003cp\u003e配置文件做为configmap的形式挂载到容器中, 内容如下: \u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e[[http]]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ename = \u003cspan class=\"string\"\u003e\u0026#34;relay-http\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ebind-addr = \u003cspan class=\"string\"\u003e\u0026#34;:9096\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eoutput = [\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    { name=\u003cspan class=\"string\"\u003e\u0026#34;db1\u0026#34;\u003c/span\u003e, location = \u003cspan class=\"string\"\u003e\u0026#34;http://192.168.1.5:8086/write\u0026#34;\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    { name=\u003cspan class=\"string\"\u003e\u0026#34;db2\u0026#34;\u003c/span\u003e, location = \u003cspan class=\"string\"\u003e\u0026#34;http://192.168.1.6:8086/write\u0026#34;\u003c/span\u003e },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e同时，生成一个relay的svc，名为influxdb-relay-headless.sensego，端口号9096\u003c/p\u003e\n\u003ch3 id=\"nginx\"\u003e\u003ca href=\"#nginx\" class=\"headerlink\" title=\"nginx\"\u003e\u003c/a\u003enginx\u003c/h3\u003e\u003cp\u003e从架构图中可以看出, 需要部署一个proxy层来代理influxdb的读写流量, 这里选择nginx\u003c/p\u003e\n\u003cp\u003enginx做为容器部署, 一个实例即可\u003c/p\u003e\n\u003cp\u003e配置文件如下:\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eworker_processes 8;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eevents {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    worker_connections 10240;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ehttp {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    client_max_body_size 0;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eupstream relay {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"comment\"\u003e# relay实例svc\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    server influxdb-relay-headless.sensego:9096;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eupstream db {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"comment\"\u003e# 后端influx实例地址，这里最好使用健康检查，当influxdb有一个节点宕机时,会被nginx踢除\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tip_hash;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    server 192.168.1.5:8086 max_fails=1 fail_timeout=10s;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    server 192.168.1.6:8086 max_fails=1 fail_timeout=10s;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eserver {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    listen 9096;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    location /ping {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        proxy_pass http://db;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    location /write {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        limit_except POST {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            deny all;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        proxy_pass http://relay;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    location /query {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        proxy_pass http://db;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"数据迁移\"\u003e\u003ca href=\"#数据迁移\" class=\"headerlink\" title=\"数据迁移\"\u003e\u003c/a\u003e数据迁移\u003c/h3\u003e\u003cp\u003e由于influxdb只是保存metrics数据, \u003ccode\u003e数据量大概在300G左右\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e不是特别敏感, 因此可以不停机进行备份, \u003c/p\u003e\n\u003cp\u003e这里采用的是在某个时间点进行全量备份，之后再通过增量备份来导入在操作期间写入的数据\u003c/p\u003e\n\u003cp\u003e虽然influxdb支持远程备份，建议在192.168.1.5本地进行备份,然后复制到新节点上\u003c/p\u003e\n\u003ch4 id=\"备份\"\u003e\u003ca href=\"#备份\" class=\"headerlink\" title=\"备份\"\u003e\u003c/a\u003e备份\u003c/h4\u003e\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 先全量备份\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003einfluxd backup -host 192.168.1.5:8088 -portable /tmp/backup-all/influxdb\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 全库备份必须为一个全新的influxdb实例\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 全库备份包含retention policy.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 增量备份\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003einfluxd backup  -portable -database mytsd -start 2017-04-28T06:49:00Z -end 2017-04-28T06:50:00Z /tmp/backup-ins/influxdb\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch4 id=\"恢复\"\u003e\u003ca href=\"#恢复\" class=\"headerlink\" title=\"恢复\"\u003e\u003c/a\u003e恢复\u003c/h4\u003e\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 在172.16.104.203上做本地恢复\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003einfluxd restore -portable /tmp/backup-all/influxdb\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 再导入增量备份数据\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003einfluxd restore -portable /tmp/backup-ins/influxdb\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003cp\u003e到此，influxdb由单机点扩容到双节点, 避免了单机故障\u003c/p\u003e\n\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e\u003cstrong\u003e参考文章:\u003c/strong\u003e\u003c/h3\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/influxdata/influxdb-relay\"\u003ehttps://github.com/influxdata/influxdb-relay\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\n      \n    \u003c/div\u003e",
  "Date": "2020-08-04T16:30:53+08:00",
  "Author": "Z.S.K."
}