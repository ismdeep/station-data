{
  "Source": "izsk.me",
  "Title": "Prometheus学习(编写业务Exporter)",
  "Link": "https://izsk.me/2020/01/19/Prometheus-Write-Exporter/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003ePrometheus官网维护了大量的Exporter, 很多都是开箱即用，非常方便，但有时业务要接入Prometheus时, 还需要业务端开发Exporter,好在Prometheus定制了一套流程的Client开发流程，非常容易接入.\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch3 id=\"实现方式\"\u003e\u003ca href=\"#实现方式\" class=\"headerlink\" title=\"实现方式\"\u003e\u003c/a\u003e\u003cstrong\u003e实现方式\u003c/strong\u003e\u003c/h3\u003e\u003cp\u003e编写 Exporter 的两种方式，分别是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自己的代码定时刷新值\u003c/li\u003e\n\u003cli\u003e在 Prometheus 抓取的时候实时获取值\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这两种方式本质上没有差别，但是在采集时有一些差别：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e方式一可以以几乎忽略的延迟返回监控数据, 但无法保证数据是最新值.\u003c/li\u003e\n\u003cli\u003e方式二可能会因为一些难以获取的值而超时或者很久才会返回值\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e一般情况下都是使用第二种方式,只需要我们在业务代码中实现\u003cstrong\u003eCollect接口\u003c/strong\u003e即可\u003c/p\u003e\n\u003cp\u003ePrometheus的官网写明了实现自己的exporter需要的流程, 看\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://prometheus.io/docs/instrumenting/writing_exporters/\"\u003ewriting_exporters\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"Example\"\u003e\u003ca href=\"#Example\" class=\"headerlink\" title=\"Example\"\u003e\u003c/a\u003e\u003cstrong\u003eExample\u003c/strong\u003e\u003c/h3\u003e\u003cfigure class=\"highlight go\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e56\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e57\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e59\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e60\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e61\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e62\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e63\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e65\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e66\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e67\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e68\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e69\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e70\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e71\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e72\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e73\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e74\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e75\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e76\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e77\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e78\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e79\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e80\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e81\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e82\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e83\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e84\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e85\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e86\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e87\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003epackage\u003c/span\u003e main\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e (\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;fmt\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;time\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;github.com/prometheus/client_golang/prometheus\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;net/http\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;math/rand\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003evar\u003c/span\u003e (\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e//版本信息\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    version = prometheus.NewGauge(prometheus.GaugeOpts{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Name: \u003cspan class=\"string\"\u003e\u0026#34;fake_version\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Help: \u003cspan class=\"string\"\u003e\u0026#34;Version information about this binary\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        ConstLabels: \u003cspan class=\"keyword\"\u003emap\u003c/span\u003e[\u003cspan class=\"type\"\u003estring\u003c/span\u003e]\u003cspan class=\"type\"\u003estring\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"string\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;v1.0\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        },\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    })\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003etype\u003c/span\u003e Exporter \u003cspan class=\"keyword\"\u003estruct\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    gauge          prometheus.Gauge\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    gaugeVec       prometheus.GaugeVec\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"title\"\u003eNewExporter\u003c/span\u003e\u003cspan class=\"params\"\u003e(metricsPrefix \u003cspan class=\"type\"\u003estring\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e *Exporter {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    gauge := prometheus.NewGauge(prometheus.GaugeOpts{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Namespace: metricsPrefix,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Name:      \u003cspan class=\"string\"\u003e\u0026#34;gauge_metric\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Help:      \u003cspan class=\"string\"\u003e\u0026#34;This is a gauge metric\u0026#34;\u003c/span\u003e})\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    gaugeVec := *prometheus.NewGaugeVec(prometheus.GaugeOpts{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Namespace: metricsPrefix,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Name:      \u003cspan class=\"string\"\u003e\u0026#34;gauge_vec_metric\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Help:      \u003cspan class=\"string\"\u003e\u0026#34;This is a gauga vece metric\u0026#34;\u003c/span\u003e},\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        []\u003cspan class=\"type\"\u003estring\u003c/span\u003e{\u003cspan class=\"string\"\u003e\u0026#34;myLabel\u0026#34;\u003c/span\u003e})\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u0026amp;Exporter{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        gauge:        gauge,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        gaugeVec:     gaugeVec,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"params\"\u003e(e *Exporter)\u003c/span\u003e\u003c/span\u003e Collect(ch \u003cspan class=\"keyword\"\u003echan\u003c/span\u003e\u0026lt;- prometheus.Metric) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// --------\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// 业务逻辑\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        timestamp := time.Now().Unix()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        fmt.Println(\u003cspan class=\"string\"\u003e\u0026#34;Timestamp: \u0026#34;\u003c/span\u003e, timestamp)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        rand.Seed(timestamp)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        ranint := rand.Intn(\u003cspan class=\"number\"\u003e10000\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        fmt.Println(\u003cspan class=\"string\"\u003e\u0026#34;Random: \u0026#34;\u003c/span\u003e, ranint)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        e.gauge.Set(\u003cspan class=\"type\"\u003efloat64\u003c/span\u003e(timestamp))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        e.gaugeVec.WithLabelValues(\u003cspan class=\"string\"\u003e\u0026#34;helloworld\u0026#34;\u003c/span\u003e).Set(\u003cspan class=\"type\"\u003efloat64\u003c/span\u003e(ranint))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// --------\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"comment\"\u003e// Called use a concurrency safe way\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        e.gauge.Collect(ch)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        e.gaugeVec.Collect(ch)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// metric 描述, 可被重写\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"params\"\u003e(e *Exporter)\u003c/span\u003e\u003c/span\u003e Describe(ch \u003cspan class=\"keyword\"\u003echan\u003c/span\u003e\u0026lt;- *prometheus.Desc) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    e.gauge.Describe(ch)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    e.gaugeVec.Describe(ch)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"title\"\u003emain\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   fmt.Println(\u003cspan class=\"string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        prometheus exporter example,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        metrics expose at http://:18081/metrics\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    `\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// Define parameters\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    metricsPath := \u003cspan class=\"string\"\u003e\u0026#34;/metrics\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    listenAddress := \u003cspan class=\"string\"\u003e\u0026#34;0.0.0.0:18081\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    metricsPrefix := \u003cspan class=\"string\"\u003e\u0026#34;fake\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// Register exporter to Prometheus, call Collect\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    exporter := NewExporter(metricsPrefix)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    prometheus.MustRegister(exporter)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    prometheus.MustRegister(version)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e// Launch http service\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    http.Handle(metricsPath, prometheus.Handler())\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    http.Handle(\u003cspan class=\"string\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e, prometheus.Handler())\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    fmt.Println(http.ListenAndServe(listenAddress, \u003cspan class=\"literal\"\u003enil\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这是个最简单的例子，Prometheus官网推荐我们参考haproxy_exporter实现,大家可参考\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/prometheus/haproxy_exporter\"\u003e这里\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eNode_exporter算是比较复杂的实现，有兴趣也可以看看.\u003c/p\u003e\n\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e\u003cstrong\u003e参考文章:\u003c/strong\u003e\u003c/h3\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/prometheus/haproxy_exporter\"\u003ehaproxy_exporter\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://prometheus.io/docs/instrumenting/writing_exporters/\"\u003ewriting_exporters\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://terrence.logdown.com/posts/6867841\"\u003e新手玩GO語言，自己動手寫一個prometheus的exporter\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\n      \n    \u003c/div\u003e",
  "Date": "2020-01-19T13:30:53+08:00",
  "Author": "Z.S.K."
}