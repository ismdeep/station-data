{
  "Source": "izsk.me",
  "Title": "zabbix学习(批量监控指定网页)",
  "Link": "https://izsk.me/2017/08/28/zabbix%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%E4%BA%94(%E6%89%B9%E9%87%8F%E7%9B%91%E6%8E%A7%E6%8C%87%E5%AE%9A%E7%BD%91%E9%A1%B5)/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e有时需要监控业务系统特定的入口页面及页面的响应速度,节点数少的话还能写个小脚本使用curl处理,数量一多的话就有点力不从心了,而且需要自动报警功能,使用脚本不太容易实现了,特别是处于内网环境,使用zabbix的http模板则很容易解决这类问题,思路也非常简单:脚本(shell/python均可)+zabbix的simple check即能实现\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch3 id=\"脚本\"\u003e\u003ca href=\"#脚本\" class=\"headerlink\" title=\"脚本\"\u003e\u003c/a\u003e\u003cstrong\u003e脚本\u003c/strong\u003e\u003c/h3\u003e\u003cp\u003e这里还是使用curl一个网址,得到返回值,一般情况下正常能够访问返回值为200,维护一个WEB.txt,shell脚本从该文件中读取url,需要注意一点的是,\u003cstrong\u003e这里使用到了zabbix的自动发现功能,所以返回格式严格为json格式\u003c/strong\u003e,shell脚本如下:\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecat web_site_code_status.sh\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e#\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e!/bin/bash\u003c/span\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e:monitor tcp connect status from zabbix\u003c/span\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esource /etc/bashrc \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esource /etc/profile  \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e#\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e/usr/bin/curl -o /dev/null -s -w %{http_code} \u003cspan class=\"variable\"\u003e$1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eweb_site_discovery () { \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eWEB_SITE=($(cat /usr/local/zabbix/sbin/WEB.txt|grep -v \u0026#34;^#\u0026#34;)) \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        printf \u0026#39;{\\n\u0026#39; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        printf \u0026#39;\\t\u0026#34;data\u0026#34;:[\\n\u0026#39; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efor((i=0;i\u0026lt;${#WEB_SITE[@]};++i)) \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{ \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003enum=$(echo $((${#WEB_SITE[@]}-1))) \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        if [ \u0026#34;$i\u0026#34; != ${num} ]; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                then \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        printf \u0026#34;\\t\\t{ \\n\u0026#34; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        printf \u0026#34;\\t\\t\\t\\\u0026#34;{#SITENAME}\\\u0026#34;:\\\u0026#34;${WEB_SITE[$i]}\\\u0026#34;},\\n\u0026#34; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                else \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        printf  \u0026#34;\\t\\t{ \\n\u0026#34; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        printf  \u0026#34;\\t\\t\\t\\\u0026#34;{#SITENAME}\\\u0026#34;:\\\u0026#34;${WEB_SITE[$num]}\\\u0026#34;}]}\\n\u0026#34; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        fi \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eweb_site_code () { \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e/usr/bin/curl -o /dev/null -s -w %{http_code} $1 \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e} \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecase \u0026#34;$1\u0026#34; in \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eweb_site_discovery) \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eweb_site_discovery \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eweb_site_code) \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eweb_site_code $2 \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e;; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e*) \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho \u0026#34;Usage:$0 {web_site_discovery|web_site_code [URL]}\u0026#34; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e;; \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eesac\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003eWEB.txt的格式如下,一个url对应一行:\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ehttp://127.0.0.1/index.html\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ehttp://127.0.0.1:7002/\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ehttp://baidu.com/\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e...\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e把脚本加入crontab每分钟执行一次\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e*/1 * * * * root /usr/local/zabbix/script/web_site_code_status.sh\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e觉得shell脚本的格式比较费劲的等方面,也可以使用python,脚本如下:\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#!/usr/bin/env python\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#coding:utf-8\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e os\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e sys\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e json\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#这个函数主要是构造出一个特定格式的字典，用于zabbix\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003eweb_site_discovery\u003c/span\u003e():\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    web_list=[]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    web_dict={\u003cspan class=\"string\"\u003e\u0026#34;data\u0026#34;\u003c/span\u003e:\u003cspan class=\"literal\"\u003eNone\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"built_in\"\u003eopen\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;WEB.txt\u0026#34;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#34;r\u0026#34;\u003c/span\u003e) \u003cspan class=\"keyword\"\u003eas\u003c/span\u003e f: \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e url \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e f:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            url_dict={}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            url_dict[\u003cspan class=\"string\"\u003e\u0026#34;{#SITENAME}\u0026#34;\u003c/span\u003e]=url.strip()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            web_list.append(url_dict)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    web_dict[\u003cspan class=\"string\"\u003e\u0026#34;data\u0026#34;\u003c/span\u003e]=web_list\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    jsonStr = json.dumps(web_dict, sort_keys=\u003cspan class=\"literal\"\u003eTrue\u003c/span\u003e, indent=\u003cspan class=\"number\"\u003e4\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e jsonStr\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e     \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#这个函数主要是用于测试站点返回的状态码，注意在cmd命令中如果有%{}这种字符要使用占位符代替,否则会报错\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003eweb_site_code\u003c/span\u003e():\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       cmd=\u003cspan class=\"string\"\u003e\u0026#39;curl -o /dev/null -s -w %s %s\u0026#39;\u003c/span\u003e %(\u003cspan class=\"string\"\u003e\u0026#34;%{http_code}\u0026#34;\u003c/span\u003e,sys.argv[\u003cspan class=\"number\"\u003e2\u003c/span\u003e])\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       reply_code=os.popen(cmd).readlines()[\u003cspan class=\"number\"\u003e0\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e reply_code\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e __name__ == \u003cspan class=\"string\"\u003e\u0026#34;__main__\u0026#34;\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e sys.argv[\u003cspan class=\"number\"\u003e1\u003c/span\u003e] == \u003cspan class=\"string\"\u003e\u0026#34;web_site_discovery\u0026#34;\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e web_site_discovery()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eelif\u003c/span\u003e sys.argv[\u003cspan class=\"number\"\u003e1\u003c/span\u003e] == \u003cspan class=\"string\"\u003e\u0026#34;web_site_code\u0026#34;\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e web_site_code()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Pls sys.argv[0] web_site_discovery | web_site_code [URL]\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eexcept\u003c/span\u003e Exception \u003cspan class=\"keyword\"\u003eas\u003c/span\u003e msg:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e msg\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#这里对脚本传递进来的第一个参数做判断去执行不同的函数，为什么要这样，因为通过一个脚本写了两个功能\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"修改zabbix-agentd-conf\"\u003e\u003ca href=\"#修改zabbix-agentd-conf\" class=\"headerlink\" title=\"修改zabbix_agentd.conf\"\u003e\u003c/a\u003e\u003cstrong\u003e修改zabbix_agentd.conf\u003c/strong\u003e\u003c/h3\u003e\u003cp\u003e在客户端的zabbix_agentd.conf中增加自定义的key\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eUnsafeUserParameters=\u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eUserParameter=web_site_discovery,/etc/zabbix/scripts/web_site_moniter.py web_site_discovery\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eUserParameter=web_site_code[*],/etc/zabbix/scripts/web_site_moniter.py web_site_code $\u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e在服务器端测试返回值,返回数据如下:\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#测试url返回值\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ezabbix_get -s \u003cspan class=\"number\"\u003e100.12\u003c/span\u003e\u003cspan class=\"number\"\u003e.255\u003c/span\u003e\u003cspan class=\"number\"\u003e.160\u003c/span\u003e -p \u003cspan class=\"number\"\u003e10050\u003c/span\u003e -k web_site_code[http://baidu.com/]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"number\"\u003e200\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#测试zabbix自动发现\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ezabbix_get -s \u003cspan class=\"number\"\u003e100.12\u003c/span\u003e\u003cspan class=\"number\"\u003e.255\u003c/span\u003e\u003cspan class=\"number\"\u003e.160\u003c/span\u003e -p \u003cspan class=\"number\"\u003e10050\u003c/span\u003e -k web_site_discovery \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#34;data\u0026#34;\u003c/span\u003e: [\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"string\"\u003e\u0026#34;{#SITENAME}\u0026#34;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;http://127.0.0.1/index.html\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }, \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"string\"\u003e\u0026#34;{#SITENAME}\u0026#34;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;http://127.0.0.1:7001/\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }, \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"string\"\u003e\u0026#34;{#SITENAME}\u0026#34;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;http://www.baidu.com/\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"zabbix前端配置\"\u003e\u003ca href=\"#zabbix前端配置\" class=\"headerlink\" title=\"zabbix前端配置\"\u003e\u003c/a\u003e\u003cstrong\u003ezabbix前端配置\u003c/strong\u003e\u003c/h3\u003e\u003cp\u003e大家直接看图吧\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url1.png\" alt=\"zabbix-web-url1\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url2.png\" alt=\"zabbix-web-url2\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url3.png\" alt=\"zabbix-web-url3\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url4.png\" alt=\"zabbix-web-url4\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url5.png\" alt=\"zabbix-web-url5\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url6.png\" alt=\"zabbix-web-url6\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url7.png\" alt=\"zabbix-web-url7\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url8.png\" alt=\"zabbix-web-url8\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url9.png\" alt=\"zabbix-web-url9\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url10.png\" alt=\"zabbix-web-url10\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url11.png\" alt=\"zabbix-web-url11\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url12.png\" alt=\"zabbix-web-url12\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url13.png\" alt=\"zabbix-web-url13\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://zskgithubblog.oss-cn-beijing.aliyuncs.com/blogpic/zabbix-web-url14.png\" alt=\"zabbix-web-url14\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e\u003cstrong\u003e参考文章:\u003c/strong\u003e\u003c/h3\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://crazy123.blog.51cto.com/1029610/1711148\"\u003epython实现zabbix批量监控WEB网站和批量监控主机端口\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\u003chr/\u003e\n\n      \n    \u003c/div\u003e",
  "Date": "2017-08-28T16:07:53+08:00",
  "Author": "Z.S.K."
}