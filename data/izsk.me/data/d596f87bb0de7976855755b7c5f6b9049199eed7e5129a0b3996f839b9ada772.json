{
  "Source": "izsk.me",
  "Title": "有趣的Shell Snippet",
  "Link": "https://izsk.me/2021/03/21/shell-funny-snippet/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e记录下遇到的有趣的shell代码, 可能是一些常用的snippet, 也可能是使用的时候不经意踩到的坑\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e不定时更新\u003c/strong\u003e\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\n\n\u003ch3 id=\"正确传递数组到函数中\"\u003e\u003ca href=\"#正确传递数组到函数中\" class=\"headerlink\" title=\"正确传递数组到函数中\"\u003e\u003c/a\u003e正确传递数组到函数中\u003c/h3\u003e\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"function\"\u003e\u003cspan class=\"title\"\u003eupdate\u003c/span\u003e\u003c/span\u003e() {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003edeclare\u003c/span\u003e -a apps_version=(\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${!1}\u003c/span\u003e\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${apps_version[@]}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eAPPS_VERSION=(\u003cspan class=\"string\"\u003e\u0026#34;aaa\u0026#34;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;bbb\u0026#34;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;ccc\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eupdate APPS_VERSION[@]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e要特别注意的是，使用不当就造成只将数组的第一个数组到函数中\u003c/p\u003e\n\u003cp\u003e上面是正确的使用方法\u003c/p\u003e\n\u003ch3 id=\"使用sed修改Yaml文件中指定关键字的下N行\"\u003e\u003ca href=\"#使用sed修改Yaml文件中指定关键字的下N行\" class=\"headerlink\" title=\"使用sed修改Yaml文件中指定关键字的下N行\"\u003e\u003c/a\u003e使用sed修改Yaml文件中指定关键字的下N行\u003c/h3\u003e\u003cp\u003e文件如下:\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003ethis:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003eis:\u003c/span\u003e \u003cspan class=\"string\"\u003eis\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ea:\u003c/span\u003e \u003cspan class=\"string\"\u003ea\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003etest:\u003c/span\u003e \u003cspan class=\"string\"\u003etest\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eis:\u003c/span\u003e \u003cspan class=\"string\"\u003eis\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003etest:\u003c/span\u003e \u003cspan class=\"string\"\u003etest\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e现在要修改this所在行的下面2行\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esed -i \u003cspan class=\"string\"\u003e\u0026#34;/this:/!b;n;n;c\\  a: \u003cspan class=\"variable\"\u003e${tmp_version}\u003c/span\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"variable\"\u003e${file}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e!b表示中断sed命令\u003c/li\u003e\n\u003cli\u003en表示读入下一行\u003c/li\u003e\n\u003cli\u003ec表示将当前行修改为后面的字符串\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e因为a: a这行需要缩进2个空格，空格需要使用\u003ccode\u003e\\\u003c/code\u003e进行转义\u003c/p\u003e\n\u003ch3 id=\"查看进程占用的文件句柄\"\u003e\u003ca href=\"#查看进程占用的文件句柄\" class=\"headerlink\" title=\"查看进程占用的文件句柄\"\u003e\u003c/a\u003e查看进程占用的文件句柄\u003c/h3\u003e\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 用户级\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efind /proc/*/fd/* -\u003cspan class=\"built_in\"\u003etype\u003c/span\u003e l -lname \u003cspan class=\"string\"\u003e\u0026#39;anon_inode:inotify\u0026#39;\u003c/span\u003e -\u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e 2\u0026gt;/dev/null | \u003cspan class=\"built_in\"\u003ecut\u003c/span\u003e -d/ -f3 |xargs -I \u003cspan class=\"string\"\u003e\u0026#39;{}\u0026#39;\u003c/span\u003e -- ps --no-headers -o \u003cspan class=\"string\"\u003e\u0026#39;%U\u0026#39;\u003c/span\u003e -p \u003cspan class=\"string\"\u003e\u0026#39;{}\u0026#39;\u003c/span\u003e | \u003cspan class=\"built_in\"\u003esort\u003c/span\u003e | \u003cspan class=\"built_in\"\u003euniq\u003c/span\u003e -c | \u003cspan class=\"built_in\"\u003esort\u003c/span\u003e -nr\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 结果: 第一列表示打开的句柄，第二列表示用户\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#     39 root\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#     36 SENSETIME\\zhoushuke\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#      2 mfe\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 进程级\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efind /proc/*/fd/* -\u003cspan class=\"built_in\"\u003etype\u003c/span\u003e l -lname \u003cspan class=\"string\"\u003e\u0026#39;anon_inode:inotify\u0026#39;\u003c/span\u003e -\u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e 2\u0026gt;/dev/null | \u003cspan class=\"built_in\"\u003ecut\u003c/span\u003e -d/ -f3 |xargs -I \u003cspan class=\"string\"\u003e\u0026#39;{}\u0026#39;\u003c/span\u003e -- ps --no-headers -o \u003cspan class=\"string\"\u003e\u0026#39;%U %p %c\u0026#39;\u003c/span\u003e -p \u003cspan class=\"string\"\u003e\u0026#39;{}\u0026#39;\u003c/span\u003e | \u003cspan class=\"built_in\"\u003esort\u003c/span\u003e | \u003cspan class=\"built_in\"\u003euniq\u003c/span\u003e -c | \u003cspan class=\"built_in\"\u003esort\u003c/span\u003e -nr\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 结果: 第一列表示打开的句柄，第二列表示用户，第三列表示用户id，第四列表示进程\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#      6 root         1 systemd\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#      5 SENSETI+ 11808 sogou-qimpanel\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#      5 root      1072 kubelet\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"使用sed删除多行内容\"\u003e\u003ca href=\"#使用sed删除多行内容\" class=\"headerlink\" title=\"使用sed删除多行内容\"\u003e\u003c/a\u003e使用sed删除多行内容\u003c/h3\u003e\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eenv:\u003c/span\u003e \u003cspan class=\"string\"\u003eprod\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003esensebee3:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003exxx:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eyyy:\u003c/span\u003e \u003cspan class=\"string\"\u003eyyy\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003esvc_name:\u003c/span\u003e \u003cspan class=\"string\"\u003ess_class.ingress_namespace.svc.cluster.local\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003esensebee:\u003c/span\u003e \u003cspan class=\"string\"\u003esensebee\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003esvc_port:\u003c/span\u003e \u003cspan class=\"number\"\u003e8443\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003enode_port:\u003c/span\u003e \u003cspan class=\"number\"\u003e30123\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003ehttp:\u003c/span\u003e \u003cspan class=\"number\"\u003e1234\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003esensebee2:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ehttp:\u003c/span\u003e \u003cspan class=\"number\"\u003e1234\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003esvc_name:\u003c/span\u003e \u003cspan class=\"string\"\u003esensebee.default\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e对于上面的的yaml文件内容,如果想将sensebee3下的行直到http: 1234之间的内容都删除,但是\u003ccode\u003esensebee3及http: 1234\u003c/code\u003e这两行不删除，使用\u003ccode\u003esed\u003c/code\u003e如何操作呢?\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esed -i \u003cspan class=\"string\"\u003e\u0026#34;/^sensebee3:/I,/^[^[:space:]#]/{//!d;}\u0026#34;\u003c/span\u003e file\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e从上面的格式可以看出,只需要先确定范围，然后删除即可, \u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e/^sensebee3:/\u003c/code\u003e用于匹配\u003ccode\u003esensebee3\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e/^[^[:space:]#]/\u003c/code\u003e用于匹配到不是以空格及\u003ccode\u003e#\u003c/code\u003e号开头的行，自然就匹配到了\u003ccode\u003ehttp: 1234\u003c/code\u003e, 这样就选定了这两行之间的内容\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e{//!d;}\u003c/code\u003e其中\u003ccode\u003e//\u003c/code\u003e表示使用前面的正则表达式, \u003ccode\u003e!d\u003c/code\u003e表示不删除, 这样就实现了\u003ccode\u003esensebee3及http: 1234\u003c/code\u003e这两行不会删除，只删除这两行之间的内容.\u003c/p\u003e\n\u003ch3 id=\"在脚本中修改crontab\"\u003e\u003ca href=\"#在脚本中修改crontab\" class=\"headerlink\" title=\"在脚本中修改crontab\"\u003e\u003c/a\u003e在脚本中修改crontab\u003c/h3\u003e\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e(crontab -l 2\u0026gt;/dev/null; \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;*/2 * * * * bash /usr/local/src/kestrel.openfiles.check \u0026gt; /usr/local/src/logs/kestrel_openfiles.check.$(date \u0026#34;+\\%Y\\%m\\%d-\\%H\\%M\\%S\u0026#34;).details 2\u0026gt;\u0026amp;1\u0026#39;\u003c/span\u003e) | crontab -\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"善用\"\u003e\u003ca href=\"#善用\" class=\"headerlink\" title=\"善用{}\"\u003e\u003c/a\u003e善用\u003ccode\u003e{}\u003c/code\u003e\u003c/h3\u003e\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eATEST=\u0026#34;ISTEST\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e错误使用，打印为空, bash会把ATEST_exec当成是一个变量，也就是最大的查找_连接的字符\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho $ATEST_exec\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e正确\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho ${ATEST}_exec\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"使用-amp-amp\"\u003e\u003ca href=\"#使用-amp-amp\" class=\"headerlink\" title=\"使用\u0026amp;\u0026amp; ||\"\u003e\u003c/a\u003e使用\u003ccode\u003e\u0026amp;\u0026amp;\u003c/code\u003e \u003ccode\u003e||\u003c/code\u003e\u003c/h3\u003e\u003cp\u003e有时为了shell命令能够简短, 经常会连着使用 \u003ccode\u003e\u0026amp;\u0026amp;(且) ||(或)\u003c/code\u003e, 但是如果不多想一次的话，可能就会跟结果相背.\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e只有当command1成功(命令返回值为0), 才会执行command2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecommand1 \u0026amp;\u0026amp; command 2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e只有当command1失败(命令返回值不为0), 才会执行command2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecommand1 || command2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003ecommand1与command2会顺序执行, 两个命令之间没有关系.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecommand1; command2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e例子\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e假如想判断从网上下载一个东西, 如果成功继续执行, 如果失败, 则打印一句话并退出.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e思考下面三个句子，哪条符合要求\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e这句话相当于(wget -q someURL -O localdir || \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;DOWN FAILED!\u0026#34;\u003c/span\u003e); \u003cspan class=\"built_in\"\u003eexit\u003c/span\u003e 1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e因此, 不管wget是否成功, \u003cspan class=\"built_in\"\u003eexit\u003c/span\u003e 1都将被执行.\u003c/span\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewget -q someURL -O localdir || echo \u0026#34;DOWN FAILED!\u0026#34;; exit 1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e当wget成功后, 忽略 || 后面的语句, 只有失败了，才会\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e, 由于\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e成功, 因此也会执行 \u003cspan class=\"built_in\"\u003eexit\u003c/span\u003e 1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewget -q someURL -O localdir || (echo \u0026#34;DOWN FAILED!\u0026#34; \u0026amp;\u0026amp; exit 1)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e这句跟上面的效果一样, 唯一的区别在于\u003cspan class=\"built_in\"\u003eexit\u003c/span\u003e 1必然会执行而不管\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e语句有没有成功\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewget -q someURL -O localdir || (echo \u0026#34;DOWN FAILED!\u0026#34;; exit 1)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"换行符\"\u003e\u003ca href=\"#换行符\" class=\"headerlink\" title=\"换行符\"\u003e\u003c/a\u003e换行符\u003c/h3\u003e\u003cp\u003e经常会有读取文件的需要, 用的最多的是使用for循环读取文件, 使用的时候需要特别注意文件的换行符, 默认情况下，换行符为空格, 需要使用\u003ccode\u003eIFS\u003c/code\u003e指定为换行\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e测试文件\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecat xx.md\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ethis is a test\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efor readline\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efrom bash\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e读取文件脚本(错误)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecat readfromfile.sh\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e#\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e!/bin/bash\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efor LINE in `cat xx.md`\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edo\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    echo $LINE\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edone\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e输出, 没有按行输出, 第个单词都占据了一行\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ethis\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eis\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ea\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003etest\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efor\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ereadline\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efrom\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ebash\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e正确的脚本\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e#\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e!/bin/bash\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eIFS_old=$IFS      # 将原IFS值保存，以便用完后恢复\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eIFS=$\u0026#39;\\n\u0026#39;\t\t\t\t\t# 指定回车为分隔符\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efor LINE in $(cat xx.md)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edo\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        echo ${LINE}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edone\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eIFS=$IFS_old \t\t\t# 恢复原IFS值\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e输出\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ethis is a test\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efor readline\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efrom bash\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e当然以下两种方式也可以达到逐行输出效果, 大文件请考虑效率\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003esecond\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecat xx.md | while read line\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edo\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    echo \u0026#34;${line}\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edone\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e third\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewhile read line\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edo \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    echo \u0026#34;${line}\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edone \u0026lt; xx.md\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"变量默认值\"\u003e\u003ca href=\"#变量默认值\" class=\"headerlink\" title=\"变量默认值\"\u003e\u003c/a\u003e变量默认值\u003c/h3\u003e\u003cp\u003e有时候定义变量的时候, 经常需要默认值, shell中也有一些比较有趣的表达式\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e$\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e{value:=word}\u003c/span\u003e  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e#\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e如果value存在且非null 则返回value 否则把word赋值给value并返回word(=value), 适合场景：如果value没有初始化 可给它赋初值\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho ${value:=word}---\u0026gt;文件的第一行\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho ${value1:=word}---\u0026gt;word 且会把word赋值给value\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e$\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e{value:+word}\u003c/span\u003e  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e如果value存在且非null 则返回word 如果value没有设置或为空 则返回value\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho ${value:+word}---\u0026gt;word\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho ${value1:-word}---\u0026gt; 返回空 因为value1本身就是空\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e$\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e{value:?word}\u003c/span\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e如果valued存在且非Null， 那就什么也不做。否则，value:word会被发送到标准错误输出，并且程序会退出；如果没有指定word 则输出  value: parameter null or not \u003cspan class=\"built_in\"\u003eset\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho ${value:?nomessage}----\u0026gt;输出第一行\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho ${value:?nomessage}----\u0026gt;value:nomessage\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho ${value:?}-----\u0026gt;value: parameter null or not set\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"参数解析getops\"\u003e\u003ca href=\"#参数解析getops\" class=\"headerlink\" title=\"参数解析getops\"\u003e\u003c/a\u003e参数解析getops\u003c/h3\u003e\u003cp\u003e在写脚本的时候，经常需要对参数进行解析,shell毕竟是个脚本语言, 不可能像python等高级语言一样有很完善的参数解析库, \u003ccode\u003egetops是bash自带的一个用于参数解析的工具, 但是它只是用于参数解析, 不能对参数进行更高级的操作，比如参数间依赖, 参数判断等\u003c/code\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003efunction usage() {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\techo \u0026#34;${0} -m [master/slave] -t [my/db] -s [slave-ip]\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    echo \u0026#39;\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    # shellcheck disable=SC2016\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    echo \u0026#39;  -m: Specify install type: master or slave\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    # shellcheck disable=SC2016\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    echo \u0026#39;  -s: If type == master, then must specify opq slave ip\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    # shellcheck disable=SC2016\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    echo \u0026#39;  -t: Specify instll opq type: my or db, my is short for mingyuan\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    echo \u0026#39;example:\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    cat \u0026lt;\u0026lt; EOF\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    #install opq-db\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e \t\t# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003emaster\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\t\t\t# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e./auto_install_opq_from_oss.sh -m master -s 127.0.0.1 -t db\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e \t\t# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eslave\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\t\t\t# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e./auto_install_opq_from_oss.sh -m slave -t db\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e \t# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003einstall opq-mingyuan\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\t\t# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003emaster\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\t\t\t# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e./install_opq.sh -m master -s 127.0.0.1 -t my\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\t\t# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eslave\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\t\t\t# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e./install_opq.sh -m slave -t my\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eEOF\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewhile getopts \u0026#34;m:s:t:h\u0026#34; opt   # \u0026#34;:m:s:t:h\u0026#34; 如果首位的出现: 表示不打印错误信息\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e上面这句表示: -m -s -t 需要参数 -h 不需要传参\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edo\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    case ${opt} in\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       m)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         MODE=${OPTARG}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       s)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         SLAVEIP=${OPTARG}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       t)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         STYPE=${OPTARG}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       h)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         usage\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         exit 0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       \\?)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         echo \u0026#34;Invalid option: -$OPTARG\u0026#34; \u0026gt;\u0026amp;2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         usage\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         exit 1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    esac\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edone\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e这里要说明一下 \u003cspan class=\"string\"\u003e\u0026#34;m:s:t:h\u0026#34;\u003c/span\u003e的含义\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e如果首位(m前)出现 : 表示「不打印错误信息」，也就是说如果需要带参数但没有带时不会打印错误\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003e紧邻字母后面的 : 表示该选项接收一个参数, 如果没有带参数的话,则会提示错误\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"多if时不如使用case\"\u003e\u003ca href=\"#多if时不如使用case\" class=\"headerlink\" title=\"多if时不如使用case\"\u003e\u003c/a\u003e多if时不如使用case\u003c/h3\u003e\u003cp\u003e在需要使用法if进行业务判断时, 不防使用case，相对于层层if, 代码会更加清晰\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eif [[ \u0026#34;$lmode\u0026#34; == \u0026#34;master\u0026#34; ]]; then\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tcase $lstype in\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \t\tmy)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\tOPQ_UNTAR_DIR_NAME=\u0026#39;multiindex_opq_master_mingyuan\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tdb)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\tOPQ_UNTAR_DIR_NAME=\u0026#39;multiindex_opq_master\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tesac\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPROGRAM=\u0026#39;opq_master\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eelse\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tcase $lstype in\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tmy)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\tOPQ_UNTAR_DIR_NAME=\u0026#39;multiindex_opq_slave_mingyuan\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tdb)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\tOPQ_UNTAR_DIR_NAME=\u0026#39;multiindex_opq_slave\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tesac\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPROGRAM=\u0026#39;opq_slave\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efi\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"加载key-value类的配置文件\"\u003e\u003ca href=\"#加载key-value类的配置文件\" class=\"headerlink\" title=\"加载key-value类的配置文件\"\u003e\u003c/a\u003e加载key-value类的配置文件\u003c/h3\u003e\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecat xx\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ekey1=value1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ekey2=value2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecat xx.sh\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e. xx # 这里直接使用. xx即可把xx文件里的key-value引入,后续可直接使用k.\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eecho $key1, $key2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e#\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e注意, 配置文件只能是k=v的形式(多个k=v可以在一行, 使用空格隔开), 其它形式会报错\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"一行代码-字符串是否包含子串\"\u003e\u003ca href=\"#一行代码-字符串是否包含子串\" class=\"headerlink\" title=\"一行代码: 字符串是否包含子串\"\u003e\u003c/a\u003e一行代码: 字符串是否包含子串\u003c/h3\u003e\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 判断CONSUL_SERVER中是否包含逗号 如果包含EXPECT_LEN=3， 不包含EXPECT_LEN=1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e[ -z \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${CONSUL_SERVER##*,*}\u003c/span\u003e\u0026#34;\u003c/span\u003e ] \u0026amp;\u0026amp; EXPECT_LEN=3 || EXPECT_LEN=1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"for循环打印带空格字符串\"\u003e\u003ca href=\"#for循环打印带空格字符串\" class=\"headerlink\" title=\"for循环打印带空格字符串\"\u003e\u003c/a\u003efor循环打印带空格字符串\u003c/h3\u003e\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 需求, 提供个数组，循环数组中的元素， 如果元素存在于某个文件中，则不追加，如果不存在,则追加\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eK8S_CLUSTER=(\u003cspan class=\"string\"\u003e\u0026#34;172.1.52.250 k8s-master-250\u0026#34;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;172.1.52.50 k8s-master-50\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# TARGET=/etc/hosts\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 错误的写法\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"variable\"\u003e${K8S_CLUSTER[@]}\u003c/span\u003e; \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e grep \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e$x\u003c/span\u003e\u0026#34;\u003c/span\u003e /etc/hosts \u0026gt; /dev/null || \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e$x\u003c/span\u003e\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /etc/hosts;\u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 会发现cat /etc/hosts输出以下格式, 正是因为元素中存在空格, 而echo的时候会以空格进行换行，不符合预期\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e172.1.52.250 \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ek8s-master-250\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e172.1.52.50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ek8s-master-50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 正确的写法\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${K8S_CLUSTER[@]}\u003c/span\u003e\u0026#34;\u003c/span\u003e; \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e grep \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e$x\u003c/span\u003e\u0026#34;\u003c/span\u003e /etc/hosts \u0026gt; /dev/null || \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e$x\u003c/span\u003e\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /etc/hosts;\u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 将数组用引号做为一个整体进行for循环就没问题, cat /etc/hosts\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e172.1.52.250 k8s-master-250\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e172.1.52.50 k8s-master-50\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\n\n\u003ch3 id=\"未完待续\"\u003e\u003ca href=\"#未完待续\" class=\"headerlink\" title=\"未完待续\"\u003e\u003c/a\u003e未完待续\u003c/h3\u003e\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e参考文章:\u003c/h3\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://stackoverflow.com/questions/18620153/find-matching-text-and-replace-next-line\"\u003ehttps://stackoverflow.com/questions/18620153/find-matching-text-and-replace-next-line\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\n      \n    \u003c/div\u003e",
  "Date": "2021-03-21T20:10:53+08:00",
  "Author": "Z.S.K."
}