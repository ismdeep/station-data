{
  "Source": "izsk.me",
  "Title": "使用fluentd收集Kubernetes容器日志",
  "Link": "https://izsk.me/2019/12/17/container-log-fluentd-elasticsearch/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n      \n\n      \n        \u003cp\u003e使用fluentd收集kubernetes的容器日志，由elastricsearch存储，并由kibana view. 这里不仅收集业务容器的日志, 同时也收集kuberntes集群组件的日志, 由于业务容器跟集群组件的日志打印格式不一致，因此需要单独使用正则进行处理. \u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\n\n\u003ch3 id=\"dockerd配置\"\u003e\u003ca href=\"#dockerd配置\" class=\"headerlink\" title=\"dockerd配置\"\u003e\u003c/a\u003edockerd配置\u003c/h3\u003e\u003cp\u003ekubernetes组件本身也是以容器的方式部署\u003c/p\u003e\n\u003cp\u003e容器本身需要将日志都重定向到标准输出，同时指定dockerd的日志打印格式为json,这个可以全局修改dockerd的启动参数\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# /etc/docker/daemon.json|grep \u0026#34;log-driver\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"string\"\u003e\u0026#34;log-driver\u0026#34;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#34;json-file\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 日志格式如下:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{\u003cspan class=\"string\"\u003e\u0026#34;log\u0026#34;\u003c/span\u003e:\u003cspan class=\"string\"\u003e\u0026#34;64 bytes from 14.215.177.39: seq=34 ttl=55 time=7.067 ms\\r\\n\u0026#34;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#34;stream\u0026#34;\u003c/span\u003e:\u003cspan class=\"string\"\u003e\u0026#34;stdout\u0026#34;\u003c/span\u003e,\u003cspan class=\"string\"\u003e\u0026#34;time\u0026#34;\u003c/span\u003e:\u003cspan class=\"string\"\u003e\u0026#34;2019-05-16T14:14:15.030612567Z\u0026#34;\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e所有的容器日志都能在目录**/var/log/containers/*.log**找到\u003c/p\u003e\n\u003cp\u003e因些fluentd就是检测这个目录下的日志变化，类似于tail -f的机制实时获取新增日志.\u003c/p\u003e\n\u003cp\u003e fluentd本身也是容器. 配置文件是以configmap的形式存在，如下:\u003c/p\u003e\n\u003ch3 id=\"fluentd-conf\"\u003e\u003ca href=\"#fluentd-conf\" class=\"headerlink\" title=\"fluentd.conf\"\u003e\u003c/a\u003efluentd.conf\u003c/h3\u003e\u003cdetails\u003e \u003csummary\u003efluentd.conf\u003c/summary\u003e\n\u003cpre\u003e\u003ccode\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e56\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e57\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e59\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e60\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e61\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e62\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e63\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e65\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e66\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e67\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e68\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e69\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e70\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e71\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e72\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e73\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e74\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e75\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e76\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e77\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e78\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e79\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e80\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e81\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e82\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e83\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e84\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e85\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e86\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e87\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e88\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e89\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e90\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e91\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e92\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e93\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e94\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e95\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e96\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e97\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e98\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e99\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e100\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e101\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e102\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e103\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e104\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e105\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e106\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e107\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e108\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e109\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e110\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e111\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e112\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e113\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e114\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e115\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e116\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e117\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e118\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e119\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e120\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e121\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e122\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e123\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e124\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e125\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e126\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e127\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e128\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e129\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e130\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e131\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e132\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e133\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e134\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e135\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e136\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e137\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e138\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e139\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e140\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e141\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e142\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e143\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e144\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e145\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e146\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e147\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e148\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e149\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e150\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e151\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e152\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e153\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e154\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e155\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e156\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e157\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e158\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e159\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e160\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e161\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e162\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e163\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e164\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e165\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e166\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e167\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e168\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e169\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e170\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e171\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e172\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e173\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e174\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e175\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e176\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e177\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e178\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e179\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e180\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e181\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e182\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e183\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e184\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e185\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e186\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e187\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e188\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e189\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e190\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e191\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e192\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e193\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e194\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e195\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e196\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e197\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e198\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e199\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e200\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e201\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e202\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e203\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e204\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e205\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e206\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e207\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e208\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e209\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e210\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e211\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e212\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e213\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e214\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e215\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e216\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003ekind:\u003c/span\u003e \u003cspan class=\"string\"\u003eConfigMap\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003eapiVersion:\u003c/span\u003e \u003cspan class=\"string\"\u003ev1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003emetadata:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"string\"\u003efluentd-config\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003enamespace:\u003c/span\u003e \u003cspan class=\"string\"\u003elogging\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003elabels:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"attr\"\u003eaddonmanager.kubernetes.io/mode:\u003c/span\u003e \u003cspan class=\"string\"\u003eReconcile\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"attr\"\u003edata:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003esystem.conf:\u003c/span\u003e \u003cspan class=\"string\"\u003e|-\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u0026lt;system\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      \u0026lt;log\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        format json\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        log_level warn\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        time_format %Y-%m-%dT%H:%M:%S\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      \u0026lt;/log\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      root_dir /tmp/fluentd-buffers/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u0026lt;/system\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e\u003c/span\u003e  \u003cspan class=\"attr\"\u003econtainers.input.conf:\u003c/span\u003e \u003cspan class=\"string\"\u003e|-\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      @id fluentd-k8s-containers.log\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      @type tail\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      path /var/log/containers/*.log\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e\u003c/span\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e     \u003cspan class=\"string\"\u003eexclude_path\u003c/span\u003e [\u003cspan class=\"string\"\u003e\u0026#34;/var/log/containers/*install-cni*\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;/var/log/containers/*rke*\u0026#34;\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e     \u003cspan class=\"string\"\u003epos_file\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/log/fluentd-k8s-containers.log.pos\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e     \u003cspan class=\"string\"\u003etag\u003c/span\u003e \u003cspan class=\"string\"\u003ekubernetes.*\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e     \u003cspan class=\"string\"\u003e\u0026lt;parse\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e       \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003emulti_format\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e       \u003cspan class=\"string\"\u003e\u0026lt;pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e         \u003cspan class=\"string\"\u003eformat\u003c/span\u003e \u003cspan class=\"string\"\u003ejson\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e         \u003cspan class=\"string\"\u003etime_key\u003c/span\u003e \u003cspan class=\"string\"\u003etime\u003c/span\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e         \u003cspan class=\"string\"\u003etime_format\u003c/span\u003e \u003cspan class=\"string\"\u003e%Y-%m-%dT%H:%M:%S.%NZ\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e       \u003cspan class=\"string\"\u003e\u0026lt;/pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e     \u003cspan class=\"string\"\u003e\u0026lt;/parse\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e   \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# Enriches records with Kubernetes metadata\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;filter\u003c/span\u003e \u003cspan class=\"string\"\u003ekubernetes.**\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003efilter_kubernetes_metadata\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003ekubernetes_metadata\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003eskip_labels\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"comment\"\u003e#skip_container_metadata true\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003eskip_master_url\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003eskip_namespace_metadata\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/filter\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# Transfer docker logging date to Chinese time. 8H issue.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;filter\u003c/span\u003e \u003cspan class=\"string\"\u003ekubernetes.**\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003erecord_transformer\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003eenable_ruby\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;record\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003eservice_name\u003c/span\u003e \u003cspan class=\"string\"\u003e${record[\u0026#39;kubernetes\u0026#39;][\u0026#39;container_name\u0026#39;]}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003edocker_stamp\u003c/span\u003e \u003cspan class=\"string\"\u003e${time.to_i\u003c/span\u003e \u003cspan class=\"string\"\u003e+\u003c/span\u003e \u003cspan class=\"number\"\u003e3600\u003c/span\u003e \u003cspan class=\"string\"\u003e*\u003c/span\u003e \u003cspan class=\"number\"\u003e8\u003c/span\u003e\u003cspan class=\"string\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/record\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/filter\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# Fixes json fields in Elasticsearch\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;filter\u003c/span\u003e \u003cspan class=\"string\"\u003ekubernetes.**\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003ek8s_filter_parser\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003eparser\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003ekey_name\u003c/span\u003e \u003cspan class=\"string\"\u003elog\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003ereserve_data\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003eremove_key_name_field\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;parse\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003emulti_format\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"string\"\u003eformat\u003c/span\u003e \u003cspan class=\"string\"\u003ejson\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"string\"\u003etime_key\u003c/span\u003e \u003cspan class=\"string\"\u003etime\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"string\"\u003ekeep_time_key\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"string\"\u003etime_format\u003c/span\u003e \u003cspan class=\"string\"\u003e%Y-%m-%dT%H:%M:%S\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;/pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"comment\"\u003e#k8s-Component\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"comment\"\u003e#{\u0026#34;log\u0026#34;:\u0026#34;I0710 04:12:31.540733       1 vxlan_network.go:60] watching for new subnet leases\\n\u0026#34;,\u0026#34;stream\u0026#34;:\u0026#34;stderr\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2019-07-10T04:12:31.540798651Z\u0026#34;}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"string\"\u003eformat\u003c/span\u003e \u003cspan class=\"string\"\u003e/^[A-Z]+(?\u0026lt;logtime\u0026gt;.*)[\\s]+(?\u0026lt;request_file\u0026gt;[0-9]+.*)\\]\u003c/span\u003e \u003cspan class=\"string\"\u003e(?\u0026lt;msg\u0026gt;.*)$/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;/pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"comment\"\u003e#cattle-node-agent\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"comment\"\u003e#{\u0026#34;log\u0026#34;:\u0026#34;time=\\\u0026#34;2019-09-20T18:06:03Z\\\u0026#34; level=info msg=\\\u0026#34;Starting plan monitor\\\u0026#34;\\n\u0026#34;,\u0026#34;stream\u0026#34;:\u0026#34;stderr\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2019-09-20T18:06:03.149115054Z\u0026#34;}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"comment\"\u003e#format /^time=.{2}(?\u0026lt;time\u0026gt;.*Z).{2} level=(?\u0026lt;level\u0026gt;.*) msg=(?\u0026lt;log\u0026gt;.*)$/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"string\"\u003eformat\u003c/span\u003e \u003cspan class=\"string\"\u003e/^(?\u0026lt;logtime\u0026gt;.*)\u003c/span\u003e \u003cspan class=\"string\"\u003elevel=(?\u0026lt;level\u0026gt;.*)\u003c/span\u003e \u003cspan class=\"string\"\u003emsg=(?\u0026lt;msg\u0026gt;.*)$/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;/pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"comment\"\u003e#fluentd-container\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"comment\"\u003e#{\u0026#34;log\u0026#34;:\u0026#34;/var/lib/gems/2.3.0/gems/fluentd-1.6.3/lib/fluent/plugin/parser_regexp.rb:50: warning: regular expression has \u0026#39;]\u0026#39; without escape\\n\u0026#34;,\u0026#34;stream\u0026#34;:\u0026#34;stderr\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2019-09-20T18:06:03.149115054Z\u0026#34;}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"string\"\u003eformat\u003c/span\u003e \u003cspan class=\"string\"\u003e/^(?\u0026lt;request_file\u0026gt;.*[0-9]+):\u003c/span\u003e \u003cspan class=\"string\"\u003e(?\u0026lt;level\u0026gt;.*):\u003c/span\u003e \u003cspan class=\"string\"\u003e(?\u0026lt;msg\u0026gt;.*)$/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;/pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"comment\"\u003e#nginx-container error log\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"comment\"\u003e#2019/10/18 12\u0026#34;00:00 [warn] 123#123: *xxxyyy zzz...\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e          \u003cspan class=\"string\"\u003eformat\u003c/span\u003e \u003cspan class=\"string\"\u003e/^(?\u0026lt;logtime\u0026gt;.*)\u003c/span\u003e \u003cspan class=\"string\"\u003e\\[(?\u0026lt;level\u0026gt;.*)\\]\u003c/span\u003e \u003cspan class=\"string\"\u003e(?\u0026lt;pid\u0026gt;[0-9]+)#(?\u0026lt;tid\u0026gt;[0-9]+):\u003c/span\u003e \u003cspan class=\"string\"\u003e(?\u0026lt;msg\u0026gt;.*)$/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e\u0026lt;/pattern\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/parse\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/filter\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# Modify tag to container name\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;match\u003c/span\u003e \u003cspan class=\"string\"\u003ekubernetes.**\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003erewrite_tag_filter\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;rule\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003ekey\u003c/span\u003e \u003cspan class=\"string\"\u003e$[\u0026#39;kubernetes\u0026#39;][\u0026#39;container_name\u0026#39;]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003epattern\u003c/span\u003e \u003cspan class=\"string\"\u003e^(.+)$\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003etag\u003c/span\u003e \u003cspan class=\"string\"\u003e$1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/rule\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/match\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003esystem.input.conf:\u003c/span\u003e \u003cspan class=\"string\"\u003e|-\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e#Logs from systemd-journal for interesting services.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e#TODO(random-liu): Remove this after cri container runtime rolls out.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003ejournald-docker\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003esystemd\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003ematches\u003c/span\u003e [{ \u003cspan class=\"attr\"\u003e\u0026#34;_SYSTEMD_UNIT\u0026#34;:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;docker.service\u0026#34;\u003c/span\u003e }]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;storage\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003elocal\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003epersistent\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003epath\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/log/journald-docker.pos\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/storage\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;entry\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003efields_strip_underscores\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003efields_lowercase\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/entry\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003etag\u003c/span\u003e \u003cspan class=\"string\"\u003edocker\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003ejournald-container-runtime\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003esystemd\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003ematches\u003c/span\u003e [{ \u003cspan class=\"attr\"\u003e\u0026#34;_SYSTEMD_UNIT\u0026#34;:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"template-variable\"\u003e{{ fluentd_container_runtime_service }}\u003c/span\u003e.service\u0026#34;\u003c/span\u003e }]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;storage\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003elocal\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003epersistent\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003epath\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/log/journald-container-runtime.pos\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/storage\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;entry\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003efields_strip_underscores\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003efields_lowercase\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/entry\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003etag\u003c/span\u003e \u003cspan class=\"string\"\u003econtainer-runtime\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e   \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003ekernel\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003esystemd\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003ematches\u003c/span\u003e [{ \u003cspan class=\"attr\"\u003e\u0026#34;_TRANSPORT\u0026#34;:\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;kernel\u0026#34;\u003c/span\u003e }]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;storage\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003elocal\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003epersistent\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003epath\u003c/span\u003e \u003cspan class=\"string\"\u003e/var/log/kernel.pos\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/storage\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;entry\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003efields_strip_underscores\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003efields_lowercase\u003c/span\u003e \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/entry\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003etag\u003c/span\u003e \u003cspan class=\"string\"\u003ekernel\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003eforward.input.conf:\u003c/span\u003e \u003cspan class=\"string\"\u003e|-\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# Takes the messages sent over TCP\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003eforward\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003eforward\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003emonitoring.conf:\u003c/span\u003e \u003cspan class=\"string\"\u003e|-\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e#  Prometheus Exporter Plugin\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# input plugin that exports metrics\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003eprometheus\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003eprometheus\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003emonitor_agent\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003emonitor_agent\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e   \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# input plugin that collects metrics from MonitorAgent\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003eprometheus_monitor\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003eprometheus_monitor\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;labels\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003ehost\u003c/span\u003e \u003cspan class=\"string\"\u003e${hostname}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/labels\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e   \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# input plugin that collects metrics for output plugin\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003eprometheus_output_monitor\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003eprometheus_output_monitor\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;labels\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003ehost\u003c/span\u003e \u003cspan class=\"string\"\u003e${hostname}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/labels\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e    \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# input plugin that collects metrics for in_tail plugin\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@id\u003c/span\u003e \u003cspan class=\"string\"\u003eprometheus_tail_monitor\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e@type\u003c/span\u003e \u003cspan class=\"string\"\u003eprometheus_tail_monitor\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;labels\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e        \u003cspan class=\"string\"\u003ehost\u003c/span\u003e \u003cspan class=\"string\"\u003e${hostname}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e      \u003cspan class=\"string\"\u003e\u0026lt;/labels\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e​\u003c/span\u003e    \u003cspan class=\"string\"\u003e\u0026lt;/source\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"attr\"\u003eoutput.conf:\u003c/span\u003e \u003cspan class=\"string\"\u003e|-\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u0026lt;match **\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      @id elasticsearch\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      @type elasticsearch\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      type_name _doc\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      include_tag_key true\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      host your-es-cluster-endpoint\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      port 9200\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      user your-es-account\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      password your-es-password\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      logstash_format true\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      logstash_prefix your-es-index-prefix.${tag}\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      request_timeout 30s\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      \u0026lt;buffer\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        @type file\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        path /var/log/fluentd-buffers/kubernetes.system.buffer\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        chunk_limit_size 64MB\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        total_limit_size 32GB\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        flush_mode interval\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        retry_type exponential_backoff\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        flush_thread_count 2\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        flush_interval 5s\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        retry_forever\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        retry_max_interval 30\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        queue_limit_length 8\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e        overflow_action block\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e      \u0026lt;/buffer\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"string\"\u003e    \u0026lt;/match\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\n\n\n\u003cp\u003e从上面可以看到，这里不仅收集业务容器的日志, 同时也收集kuberntes集群组件的日志, 由于业务容器跟集群组件的日志虽然都是json格式，但为了更细粒度的进行数据分析，使用正则进行处理.\u003c/p\u003e\n\u003cp\u003e最后需要修改es的集群地址，用户、密码，索引前缀等信息.\u003c/p\u003e\n\u003cp\u003e这里没有使用kafka进行缓存, 一来因为使用kafka后，又需要一个logstash进行过度到es，增加了一层,又得维护一层配置，后续增加索引时不是很方便\u003c/p\u003e\n\u003cp\u003e二来数据量没达到一个量级, 没有kafka，es也能够抗住.\u003c/p\u003e\n\u003cp\u003e如果需要使用kafka的话，也可以使用kafka-connector机制来直接对接elasticsearch， \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/confluentinc/kafka-connect-elasticsearch\"\u003egithub\u003c/a\u003e上已经有现成的工具, 大家可参考使用, 我这里没用过, \u003c/p\u003e\n\u003ch3 id=\"问题总结\"\u003e\u003ca href=\"#问题总结\" class=\"headerlink\" title=\"问题总结\"\u003e\u003c/a\u003e问题总结\u003c/h3\u003e\u003cp\u003e在体验的时候，由于各个组件打印的日志格式都不尽相同, 为了接收更多的组件日志定位问题，在使用正则表达式匹配的时候花的时候最长, 同时，大家也可开启fluentd的debug日志，或者将收集到的日志直接打印在本地，对定位问题方便一点，最后切记将debug关掉即可, 不然，磁盘会扛不住\u003c/p\u003e\n\u003cp\u003eFluentd本地保存收集日志的配置\u003c/p\u003e\n\u003cfigure class=\"highlight yaml\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#  outputfile.conf: |- \u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#    \u0026lt;match **\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#      @type file\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#      path /var/log/${tag}.fluentd\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#      \u0026lt;buffer tag\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#        @type file\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#        path /var/log/xxyy\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#      \u0026lt;/buffer\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#    \u0026lt;/match\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003efluentd开启es的debug, 更多参数可参考\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/uken/fluent-plugin-elasticsearch\"\u003e这里\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e遇到一个elasticsearch 索引mapping问题，感兴趣的可参考\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/2019/10/06/ES-FGC-Fix/\"\u003e这里\u003c/a\u003e \u003c/p\u003e\n\u003ch3 id=\"参考文章\"\u003e\u003ca href=\"#参考文章\" class=\"headerlink\" title=\"参考文章:\"\u003e\u003c/a\u003e\u003cstrong\u003e参考文章:\u003c/strong\u003e\u003c/h3\u003e\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.fluentd.org/\"\u003ehttps://www.fluentd.org/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.cnblogs.com/operationhome/p/10907591.html\"\u003ehttps://www.cnblogs.com/operationhome/p/10907591.html\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/confluentinc/kafka-connect-elasticsearch\"\u003ehttps://github.com/confluentinc/kafka-connect-elasticsearch\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/uken/fluent-plugin-elasticsearch\"\u003ehttps://github.com/uken/fluent-plugin-elasticsearch\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/2019/10/06/ES-FGC-Fix/\"\u003ehttps://izsk.me/2019/10/06/ES-FGC-Fix/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"转载请注明原作者-周淑科-https-izsk-me\"\u003e\u003ca href=\"#转载请注明原作者-周淑科-https-izsk-me\" class=\"headerlink\" title=\"转载请注明原作者: 周淑科(https://izsk.me)\"\u003e\u003c/a\u003e\u003cstrong\u003e转载请注明原作者: 周淑科(\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://izsk.me/\"\u003ehttps://izsk.me\u003c/a\u003e)\u003c/strong\u003e\u003c/h3\u003e\n      \n    \u003c/div\u003e",
  "Date": "2019-12-17T08:10:53+08:00",
  "Author": "Z.S.K."
}