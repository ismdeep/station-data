{
  "Source": "liam.page",
  "Title": "使用 NTFS-3G 在 macOS 上激活对 NTFS 磁盘的读写功能",
  "Link": "https://liam.page/2020/04/08/enable-NTFS-writing-access-by-NTFS-3G/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003eNTFS 是微软的 Windows NT 文件系统。在 macOS 上，默认只支持对 NTFS 磁盘的读，但不支持对 NTFS 磁盘的写。这无疑是很不方便的。\u003c/p\u003e\n\u003cp\u003e为解决这个问题，在我近几年的 macOS 使用经历中，先后试用了 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.tuxera.com/products/tuxera-ntfs-for-mac/\"\u003eTuxera\u003c/a\u003e 及 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.paragon-software.com/home/ntfs-mac/\"\u003eParagon\u003c/a\u003e 这样的付费软件，也试用了免费但需要手动挂载的 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://enjoygineering.com/mounty/\"\u003eMounty\u003c/a\u003e。但这些工具多少都有些不令我满意。\u003c/p\u003e\n\u003cp\u003e前几天检索到 NTFS-3G 这个开源工具，发现结合 FUSE for macOS 可以很方便地挂载 NTFS 磁盘并读写。所以记录下来。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"行前准备\"\u003e\u003ca href=\"#行前准备\" class=\"headerlink\" title=\"行前准备\"\u003e\u003c/a\u003e行前准备\u003c/h2\u003e\u003cp\u003e首先，你需要在 macOS 上安装 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://brew.sh/\"\u003eHomebrew\u003c/a\u003e。按照官网的介绍，你只需要在 Terminal 中执行下列命令即可。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e/bin/bash -c \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"subst\"\u003e$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"安装-FUSE-for-macOS\"\u003e\u003ca href=\"#安装-FUSE-for-macOS\" class=\"headerlink\" title=\"安装 FUSE for macOS\"\u003e\u003c/a\u003e安装 FUSE for macOS\u003c/h2\u003e\u003cp\u003e接下来，使用 Homebrew 安装 FUSE for macOS。你需要在 Terminal 下执行下列命令。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ebrew install --cask macfuse\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003edeprecated:\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ebrew cask install osxfuse\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"安装-NTFS-3G\"\u003e\u003ca href=\"#安装-NTFS-3G\" class=\"headerlink\" title=\"安装 NTFS-3G\"\u003e\u003c/a\u003e安装 NTFS-3G\u003c/h2\u003e\u003cp\u003e接下来，使用 Homebrew 安装 NTFS-3G。你需要在 Terminal 下执行下列命令。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ebrew tap gromgit/homebrew-fuse\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ebrew install ntfs-3g-mac\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003edeprecated\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ebrew install ntfs-3g\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"切换-mount-ntfs\"\u003e\u003ca href=\"#切换-mount-ntfs\" class=\"headerlink\" title=\"切换 mount_ntfs\"\u003e\u003c/a\u003e切换 \u003ccode\u003emount_ntfs\u003c/code\u003e\u003c/h2\u003e\u003cp\u003e接下来，需要使用 NTFS-3G 提供的 \u003ccode\u003emount_ntfs\u003c/code\u003e 来替代系统自带的 \u003ccode\u003emount_ntfs\u003c/code\u003e。后者位于 \u003ccode\u003e/sbin/mount_ntfs\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e由于 macOS 自 10.11 起，启用了系统完整性保护（System Integrity Protection）功能，导致在包括 \u003ccode\u003e/sbin\u003c/code\u003e 目录在内的一些目录下，即便有 \u003ccode\u003eroot\u003c/code\u003e 权限，也无法修改目录下文件。你可以在 Terminal 中执行下列命令，查看 SIP 的状态。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ csrutil status\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eSystem Integrity Protection status: enabled.\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e为此，我们需要暂时关闭 SIP，请参考下列操作步骤：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e重启电脑；\u003c/li\u003e\n\u003cli\u003e按住 \u003ccode\u003ecommand + R\u003c/code\u003e，进入恢复模式；\u003c/li\u003e\n\u003cli\u003e选择你习惯的语言；\u003c/li\u003e\n\u003cli\u003e在顶部菜单栏，依次进入「Utilities -\u0026gt; Terminal」；\u003c/li\u003e\n\u003cli\u003e执行命令 \u003ccode\u003ecsrutil disable\u003c/code\u003e，命令预期返回：「Successfully disabled System Integrity Protection. Please restart the machine for the changes to take effect.」；\u003c/li\u003e\n\u003cli\u003e重启电脑，正常引导进入系统；\u003c/li\u003e\n\u003cli\u003e启动 Terminal；\u003c/li\u003e\n\u003cli\u003e执行下列命令\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esudo mount -uw / \u003cspan class=\"comment\"\u003e# 系统版本 10.15 (Catalina) 及以上需要执行此命令\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e /sbin\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo \u003cspan class=\"built_in\"\u003emv\u003c/span\u003e mount_ntfs mount_ntfs.sys_orig \u003cspan class=\"comment\"\u003e# 备份系统版本的 mount_ntfs\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo \u003cspan class=\"built_in\"\u003eln\u003c/span\u003e -sf /usr/local/sbin/mount_ntfs mount_ntfs \u003cspan class=\"comment\"\u003e# 将 NTFS-3G 提供的 mount_ntfs 链接到目标位置\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\u003c/li\u003e\n\u003cli\u003e重启电脑；\u003c/li\u003e\n\u003cli\u003e按住 \u003ccode\u003ecommand + R\u003c/code\u003e，进入恢复模式；\u003c/li\u003e\n\u003cli\u003e选择你习惯的语言；\u003c/li\u003e\n\u003cli\u003e在顶部菜单栏，依次进入「Utilities -\u0026gt; Terminal」；\u003c/li\u003e\n\u003cli\u003e执行命令 \u003ccode\u003ecsrutil enable\u003c/code\u003e，命令预期返回：「Successfully enabled System Integrity Protection. Please restart the machine for the changes to take effect.」；\u003c/li\u003e\n\u003cli\u003e重启电脑，正常引导进入系统；\u003c/li\u003e\n\u003cli\u003e插入文件系统格式为 NTFS 的外部磁盘；\u003c/li\u003e\n\u003cli\u003e按照 FUSE for macOS 的提示，进入「System Preferences -\u0026gt; Security and Privacy」；\u003c/li\u003e\n\u003cli\u003e在「General」标签允许 FUSE for macOS 相关的权限；\u003c/li\u003e\n\u003cli\u003e拔出文件系统格式为 NTFS 的外部磁盘，再重新插入；\u003c/li\u003e\n\u003cli\u003e此后，macOS 即可正常读写文件系统格式为 NTFS 的外部磁盘。\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr/\u003e\n\u003cp\u003e最近 \u003ccode\u003e@linjie\u003c/code\u003e 提到说，按上述方法安装好 ntfs-3g 之后，打开 NTFS 格式的外置硬盘，看不到里面内容。这个现象在我这边没有复现，其机理也未弄明白。但 \u003ccode\u003e@linjie\u003c/code\u003e 在 GitHub 上找到了一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/osxfuse/osxfuse/issues/574\"\u003eissue\u003c/a\u003e，提到了同样的问题。其中有人给出了一个解法，我翻译如下：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e原地址：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/osxfuse/osxfuse/issues/574#issuecomment-541309529\"\u003ehttps://github.com/osxfuse/osxfuse/issues/574#issuecomment-541309529\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e遇到此问题的同仁，可考虑附加参数 \u003ccode\u003e-o auto_xattr\u003c/code\u003e。在我这边，这个办法解决了问题。\u003c/p\u003e\n\u003cp\u003e我写了一个名为 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/lezgomatt/ezntfs\"\u003e\u003ccode\u003eezntfs\u003c/code\u003e\u003c/a\u003e 的 Python 脚本，来自动地完成这一工作。你可以通过 \u003ccode\u003epip3 install ezntfs\u003c/code\u003e 来安装它。它仅只要求安装有 NTFS-3G，并有 Python 3.6 以上的运行环境。\u003c/p\u003e\n\u003cp\u003e依靠它，你无需手动找到磁盘 ID、推出、设置宗卷名。当下，它的文档暂缺，但只需在终端执行 \u003ccode\u003eezntfs\u003c/code\u003e，即可看到帮助信息。\u003c/p\u003e\n\u003cp\u003e希望这对大家有所帮助。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-04-08T03:24:41Z",
  "Author": "Liam Huang"
}