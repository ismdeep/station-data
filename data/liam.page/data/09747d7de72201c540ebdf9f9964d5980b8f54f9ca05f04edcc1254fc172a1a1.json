{
  "Source": "liam.page",
  "Title": "避免 \\chapter 命令分页",
  "Link": "https://liam.page/2015/04/22/cancle-clearpage-in-chapter/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003eLaTeX 的 \u003ccode\u003ebook\u003c/code\u003e 类中，\u003ccode\u003e\\chapter\u003c/code\u003e 命令用来标记章节。在生成的 PDF 文稿中，\u003ccode\u003e\\chapter\u003c/code\u003e 总是另起一页；在打开（默认）\u003ccode\u003eopenright\u003c/code\u003e 选项的时候，可能还会空白一页。在实际使用过程中，很多人希望 \u003ccode\u003e\\chapter\u003c/code\u003e 不要换页，紧接着当前页的内容排版。\u003c/p\u003e\n\u003cp\u003e传统工具没有提供此功能，因此用户需要自行修改 \u003ccode\u003e\\chapter\u003c/code\u003e 的定义。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"找到-chapter-的定义\"\u003e\u003ca href=\"#找到-chapter-的定义\" class=\"headerlink\" title=\"找到 \\chapter 的定义\"\u003e\u003c/a\u003e找到 \u003ccode\u003e\\chapter\u003c/code\u003e 的定义\u003c/h2\u003e\u003cp\u003eLaTeX 标准文档类的定义写在 \u003ccode\u003eclasses.pdf\u003c/code\u003e 这个文档中，你可以在命令行下使用 \u003ccode\u003etexdoc classes\u003c/code\u003e 来打开这份文档。\u003c/p\u003e\n\u003cp\u003e你可以在文档的 7.2.6 节中找到 \u003ccode\u003e\\chapter\u003c/code\u003e 的定义。和我们的问题相关的，就是 \u003ccode\u003e\\chapter\u003c/code\u003e 定义的第一行。\u003c/p\u003e\n\u003cp\u003e\u003cimg data-src=\"/images/LaTeX/def-of-chapter.png\" alt=\"`\\chapter` 的定义\"/\u003e\u003c/p\u003e\n\u003cp\u003e得益于 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://liam0205.me/2015/01/23/literate-programming-in-latex/\"\u003e文学编程\u003c/a\u003e，我们看到文档中明确地写着「章节总是应该从新的一页开始，因此我们需要调用 \u003ccode\u003e\\clearpage\u003c/code\u003e」。\u003c/p\u003e\n\u003cp\u003e显然，为了达到目的，我么只需要令 \u003ccode\u003e\\chapter\u003c/code\u003e 定义的第一行失效就好了。\u003c/p\u003e\n\u003ch2 id=\"打补丁\"\u003e\u003ca href=\"#打补丁\" class=\"headerlink\" title=\"打补丁\"\u003e\u003c/a\u003e打补丁\u003c/h2\u003e\u003cp\u003e\u003ccode\u003expatch\u003c/code\u003e 宏包可以用来打补丁。它的 \u003ccode\u003e\\xpatchcmd\u003c/code\u003e 命令接受五个参数：\u003ccode\u003e\\xpatchcmd{命令}{搜索}{替换}{成功}{失败}\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e命令\u003c/code\u003e：待处理的命令\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e搜索\u003c/code\u003e：需要被替换的部分\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e替换\u003c/code\u003e：将被替换的内容\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e成功\u003c/code\u003e：替换成功执行的内容\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e失败\u003c/code\u003e：替换失败执行的内容\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这里我们需要将 \u003ccode\u003e\\if@openright\\cleardoublepage\\else\\clearpage\\fi\u003c/code\u003e 替换掉。用于替换的内容则是：\u003ccode\u003e\\par\\relax\u003c/code\u003e。因此我们有代码：\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{xpatch}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\makeatletter\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\xpatchcmd\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\chapter\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003cspan class=\"keyword\"\u003e\\if@openright\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\cleardoublepage\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\else\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\clearpage\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\fi\u003c/span\u003e}{\u003cspan class=\"keyword\"\u003e\\par\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\relax\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {}{}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\makeatother\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e注意，符号 \u003ccode\u003e@\u003c/code\u003e 是一个保留符号。它在用户编写 \u003ccode\u003e.tex\u003c/code\u003e 文档的时候和开发者编写宏包/文档类的时候具有不同含义。我们用 \u003ccode\u003e\\makeatletter\u003c/code\u003e 将 \u003ccode\u003e@\u003c/code\u003e 的含义切换到开发者模式；在进行修改之后，用 \u003ccode\u003e\\makeatother\u003c/code\u003e 将 \u003ccode\u003e@\u003c/code\u003e 的含义切换到用户模式。\u003c/p\u003e\n\u003cp\u003e这样，\u003ccode\u003e\\chapter\u003c/code\u003e 定义中的换行部分，就被替换成了分段。\u003c/p\u003e\n\u003cp\u003e完整的示例代码：\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{book}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{xpatch}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\makeatletter\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\xpatchcmd\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\chapter\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003cspan class=\"keyword\"\u003e\\if@openright\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\cleardoublepage\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\else\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\clearpage\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\fi\u003c/span\u003e}{\u003cspan class=\"keyword\"\u003e\\par\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\relax\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {}{}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\makeatother\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{blindtext}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\blindtext\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\chapter\u003c/span\u003e{test}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n    \u003c/div\u003e",
  "Date": "2015-04-22T01:39:26Z",
  "Author": "Liam Huang"
}