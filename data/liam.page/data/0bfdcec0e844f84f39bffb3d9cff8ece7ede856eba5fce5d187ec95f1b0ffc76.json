{
  "Source": "liam.page",
  "Title": "LaTeX 黑魔法（三）：定义参数变长的命令",
  "Link": "https://liam.page/2017/07/30/define-a-new-command-with-different-amount-of-parameters-in-LaTeX/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e在 C++ 中，我们可以为同一个函数赋予不同的执行内容，这种行为称之为「函数重载」。具体重载的函数，共享同一个函数名，但是接收的函数参数在数量、类型上不同。LaTeX 是宏语言，没有一般意义上的参数类型的说法。但是，有没有办法在 LaTeX 中「重载」一个宏，根据输入的参数数量不同，而产生不同的效果呢？\u003c/p\u003e\n\u003cp\u003e本文给出解决方案。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"在-TeX-和-LaTeX2e-中定义新命令\"\u003e\u003ca href=\"#在-TeX-和-LaTeX2e-中定义新命令\" class=\"headerlink\" title=\"在 TeX 和 LaTeX2e 中定义新命令\"\u003e\u003c/a\u003e在 TeX 和 LaTeX2e 中定义新命令\u003c/h2\u003e\u003cp\u003eTeX 中，定义新命令的标准方法是使用 TeX 原语 \u003ccode\u003e\\def\u003c/code\u003e。它有几个变种，记录如下。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e\\def\u003c/code\u003e：局部定义，定义时不展开；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\\edef\u003c/code\u003e：局部定义，定义时完全展开；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\\gdef\u003c/code\u003e：相当于 \u003ccode\u003e\\global\\def\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\\xdef\u003c/code\u003e：相当于 \u003ccode\u003e\\global\\edef\u003c/code\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e建立在 TeX 之上的各种格式，其提供的定义新命令的方案，都是通过这四个 \u003ccode\u003e\\def\u003c/code\u003e 来实现的。LaTeX2e 中定义新命令的标准方法是使用 \u003ccode\u003e\\newcommand\u003c/code\u003e。它也有几个变种，记录如下。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e\\newcommand\u003c/code\u003e：新定义一个命令，如果该命令已有定义，则报错；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\\renewcommand\u003c/code\u003e：重定义一个命令，如果该命令未定义，则报错；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\\providecommand\u003c/code\u003e：如果该命令未定义，则定义一个新的命令；否则，啥也不干。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e当然，在 LaTeX2e 中，也有 \u003ccode\u003e\\DeclareRobustCommand\u003c/code\u003e 一系列命令，可以用来定义新的命令。这一系列命令，是 LaTeX2e 针对「脆弱命令」问题，提供的一些保护机制。此处不表。\u003c/p\u003e\n\u003cp\u003e在标准的方法中，不论是 TeX 还是 LaTeX2e，都没有提供「参数变长」的实现方法。也就是说，如果不引入奇怪的技巧，我们在普通的 LaTeX 文稿中，是无法重载命令的。\u003c/p\u003e\n\u003ch2 id=\"ifnextchar\"\u003e\u003ca href=\"#ifnextchar\" class=\"headerlink\" title=\"\\@ifnextchar\"\u003e\u003c/a\u003e\u003ccode\u003e\\@ifnextchar\u003c/code\u003e\u003c/h2\u003e\u003cp\u003e\u003ccode\u003e\\@ifnextchar\u003c/code\u003e 是\u003ca href=\"/2015/04/10/how-to-list-unnumbered-section-in-the-table-of-contents/\"\u003e一个 LaTeX 内部宏\u003c/a\u003e。它的作用，是「预读」输入列表的下一个字符，然后判断预读的字符是否与作者期待的字符一致，执行不同的分支。\u003c/p\u003e\n\u003cp\u003e例如，我们知道，LaTeX 命令的可选参数，默认是放在所有必选参数之前。那么，我们是否有可能让可选参数放在必选参数之后呢？答案当然是肯定的，利用 \u003ccode\u003e\\@ifnextchar\u003c/code\u003e 就可以做到。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{article}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\makeatletter\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\foo@helper@i\u003c/span\u003e}[1]{One parameter: \u003cspan class=\"params\"\u003e#1\u003c/span\u003e{}.}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\def\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\foo@helper@ii\u003c/span\u003e \u003cspan class=\"params\"\u003e#1\u003c/span\u003e[\u003cspan class=\"params\"\u003e#2\u003c/span\u003e]{Two parameters: \u003cspan class=\"params\"\u003e#1\u003c/span\u003e{}, \u003cspan class=\"params\"\u003e#2\u003c/span\u003e{}.}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e}[1]{\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\@ifnextchar\u003c/span\u003e[\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003cspan class=\"keyword\"\u003e\\foo@helper@ii\u003c/span\u003e{\u003cspan class=\"params\"\u003e#1\u003c/span\u003e}}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003cspan class=\"keyword\"\u003e\\foo@helper@i\u003c/span\u003e{\u003cspan class=\"params\"\u003e#1\u003c/span\u003e}}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\makeatother\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e{hello}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e{hello}[world]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e我们来看 \u003ccode\u003e\\foo\u003c/code\u003e 的定义。它接收一个标准的 LaTeX 参数。因此不管是 \u003ccode\u003e\\foo{hello}\u003c/code\u003e 还是 \u003ccode\u003e\\foo{hello}[world]\u003c/code\u003e，LaTeX 都会把其中的 \u003ccode\u003e\\foo{hello}\u003c/code\u003e 先「吃下去」。接下来，LaTeX 会判断下一个字符是否为 \u003ccode\u003e[\u003c/code\u003e。对于 \u003ccode\u003e\\foo{hello}\u003c/code\u003e 这种用法，下一个字符是换行符，因此判定失败，执行 \u003ccode\u003e\\foo@helper@i\u003c/code\u003e。而对于 \u003ccode\u003e\\foo{hello}[world]\u003c/code\u003e 这种用法，吃下去 \u003ccode\u003e\\foo{hello}\u003c/code\u003e 之后，输入流中剩下了 \u003ccode\u003e[world]...\u003c/code\u003e，下一个字符正是 \u003ccode\u003e[\u003c/code\u003e，因此执行 \u003ccode\u003e\\foo@helper@ii\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e对于 \u003ccode\u003e\\foo@helper@ii\u003c/code\u003e，它是使用 TeX 的原语 \u003ccode\u003e\\def\u003c/code\u003e 定义的命令。参数列表 \u003ccode\u003e#1[#2]\u003c/code\u003e 表示该命令接受两个参数。第一个参数是标准的 TeX 参数——用分组包括起来。因此，上一步执行的 \u003ccode\u003e\\foo@helper@ii\u003c/code\u003e 将第一个参数喂给了 \u003ccode\u003e\\foo@helper@ii\u003c/code\u003e。接下来，\u003ccode\u003e\\foo@helper@ii\u003c/code\u003e 还要吃下去第二个参数。按照定义，第二个参数被方括号 \u003ccode\u003e[]\u003c/code\u003e 所包围。因此 \u003ccode\u003e[world]\u003c/code\u003e 中的 \u003ccode\u003eworld\u003c/code\u003e 被吃掉，作为第二个参数。\u003c/p\u003e\n\u003cp\u003e最终输出如图。\u003c/p\u003e\n\u003cp\u003e\u003cimg data-src=\"/uploads/images/LaTeX/option-brackets-later.png\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"bgroup\"\u003e\u003ca href=\"#bgroup\" class=\"headerlink\" title=\"\\bgroup\"\u003e\u003c/a\u003e\u003ccode\u003e\\bgroup\u003c/code\u003e\u003c/h2\u003e\u003cp\u003e上面的 \u003ccode\u003e\\foo\u003c/code\u003e 命令，基本已经达成了我们的目标。只不过，第二个参数必须是用方括号表达的。当然这不是不可以，但强迫症选手们可能会希望第二个参数也能用花括号来界定。强迫症们尝试把 \u003ccode\u003e\\@ifnextchar[\u003c/code\u003e 尝试换成了 \u003ccode\u003e\\@ifnextchar{\u003c/code\u003e，于是他们得到了报错\u003c/p\u003e\n\u003cfigure class=\"highlight plaintext\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eFile ended while scanning use of...\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这是因为，TeX 遇到 \u003ccode\u003e{\u003c/code\u003e 时，会将其解释为一个分组。因此，这种写法会造成 TeX 读入的分组不匹配。这样一来，我们就必须用 \u003ccode\u003e\\bgroup\u003c/code\u003e 来代替花括号。它的定义是 \u003ccode\u003e\\let\\bgroup={\u003c/code\u003e。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{article}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\makeatletter\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\foo@helper@i\u003c/span\u003e}[1]{One parameter: \u003cspan class=\"params\"\u003e#1\u003c/span\u003e{}.}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\foo@helper@ii\u003c/span\u003e}[2]{Two parameters: \u003cspan class=\"params\"\u003e#1\u003c/span\u003e{}, \u003cspan class=\"params\"\u003e#2\u003c/span\u003e{}.}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e}[1]{\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\@ifnextchar\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\bgroup\u003c/span\u003e\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003cspan class=\"keyword\"\u003e\\foo@helper@ii\u003c/span\u003e{\u003cspan class=\"params\"\u003e#1\u003c/span\u003e}}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003cspan class=\"keyword\"\u003e\\foo@helper@i\u003c/span\u003e{\u003cspan class=\"params\"\u003e#1\u003c/span\u003e}}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\makeatother\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e{hello}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e{hello}{world}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这样一来，我们就实现了一个 \u003ccode\u003e\\foo\u003c/code\u003e 命令，在参数不同的情况下，具有不同的行为。\u003c/p\u003e\n\u003ch2 id=\"xparse-宏包\"\u003e\u003ca href=\"#xparse-宏包\" class=\"headerlink\" title=\"xparse 宏包\"\u003e\u003c/a\u003e\u003ccode\u003exparse\u003c/code\u003e 宏包\u003c/h2\u003e\u003cp\u003e基于 LaTeX3 的 \u003ccode\u003exparse\u003c/code\u003e 宏包给了我们新的选项。它提供的 \u003ccode\u003e\\NewDocumentCommand\u003c/code\u003e 命令，允许用户使用新的接口定义 LaTeX 命令。其形式为\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\NewDocumentCommand\u003c/span\u003e{\u0026lt;command\u0026gt;}{\u0026lt;parameter specificers\u0026gt;}{\u0026lt;replacement text\u0026gt;}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e比如，以下两个定义，效果是一致的。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{xparse}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\baz\u003c/span\u003e}[1]{I eat \u003cspan class=\"params\"\u003e#1\u003c/span\u003e{}.}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\NewDocumentCommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\bar\u003c/span\u003e}{m}{I eat \u003cspan class=\"params\"\u003e#1\u003c/span\u003e{}.}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e其中，参数标识符 \u003ccode\u003em\u003c/code\u003e 表示 \u003ccode\u003e\\bar\u003c/code\u003e 接收一个标准的 LaTeX 参数。除去 \u003ccode\u003em\u003c/code\u003e 之外，\u003ccode\u003exparse\u003c/code\u003e 宏包还提供了许多额外的参数标识符（具体参照其手册）。其中，\u003ccode\u003eg\u003c/code\u003e 表示该参数是一个可选参数，并且以花括号界定其范围。当参数未给出时，参数值为 \u003ccode\u003e-NoValue-\u003c/code\u003e；否则是实际的参数内容。此时我们可以用 \u003ccode\u003e\\IfNoValueTF\u003c/code\u003e 命令来做分支判断。\u003c/p\u003e\n\u003cp\u003e于是，上述 \u003ccode\u003e\\foo\u003c/code\u003e 命令可以按如下方式实现。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{article}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{xparse}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\NewDocumentCommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e}{mg}{\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003e\\IfNoValueTF\u003c/span\u003e{\u003cspan class=\"params\"\u003e#2\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {One parameter: \u003cspan class=\"params\"\u003e#1\u003c/span\u003e{}.}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {Two parameters: \u003cspan class=\"params\"\u003e#1\u003c/span\u003e{}, \u003cspan class=\"params\"\u003e#2\u003c/span\u003e{}.}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e{hello}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e{hello}{world}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这样的实现方式，相对在 LaTeX2e 里用 \u003ccode\u003e\\@ifnextchar\\bgroup\u003c/code\u003e 判断就简单清晰多了。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2017-07-30T15:38:37Z",
  "Author": "Liam Huang"
}