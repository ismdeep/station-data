{
  "Source": "liam.page",
  "Title": "为 XeLaTeX 所调用时 xDVIPDFMx 的默认参数",
  "Link": "https://liam.page/2019/02/12/default-flags-for-xDVIPDFMx/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e去年，有人在群里\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://t.me/chinesetex/3441\"\u003e提及\u003c/a\u003e：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在 macOS 上，同样是使用 STFangSong 字体，使用 LaTeXmk 编译出来的文档在 Windows 上查看会\u003ca href=\"/uploads/pdf/latexmk-mac.pdf\"\u003e乱码\u003c/a\u003e，但使用 XeLaTeX 直接编译则\u003ca href=\"/uploads/pdf/xelatex-mac.pdf\"\u003e正常\u003c/a\u003e。MWE 是：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{ctexbook}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\fangsong\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e中文\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cblockquote\u003e\n\u003cp\u003e具体的编译命令分别是：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003elatexmk -\u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e -f -xelatex -interaction=nonstopmode -synctex=1 --output-directory=output foo.tex\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003exelatex -interaction=nonstopmode -synctex=1 --output-directory=output foo.tex\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这个问题直至近期查看了 XeLaTeX 的源码才得到了完整答案。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"字体嵌入\"\u003e\u003ca href=\"#字体嵌入\" class=\"headerlink\" title=\"字体嵌入\"\u003e\u003c/a\u003e字体嵌入\u003c/h2\u003e\u003cp\u003e根据 Ao Zhang 的检查，\u003ca href=\"/uploads/pdf/latexmk-mac.pdf\"\u003e\u003ccode\u003elatexmk-mac.pdf\u003c/code\u003e\u003c/a\u003e 当中没有如 \u003ca href=\"/uploads/pdf/xelatex-mac.pdf\"\u003e\u003ccode\u003exelatex-mac.pdf\u003c/code\u003e\u003c/a\u003e 那样嵌入字体。\u003c/p\u003e\n\u003cp\u003e\u003cimg data-src=\"/uploads/images/LaTeX/no-font-embedding.jpg\"/\u003e\u003c/p\u003e\n\u003cp\u003e由于找不到相应字体，Windows 上查看文档时，就乱码了。\u003c/p\u003e\n\u003ch2 id=\"驱动-xDVIPDFMx\"\u003e\u003ca href=\"#驱动-xDVIPDFMx\" class=\"headerlink\" title=\"驱动 xDVIPDFMx\"\u003e\u003c/a\u003e驱动 \u003ccode\u003exDVIPDFMx\u003c/code\u003e\u003c/h2\u003e\u003cp\u003eXeLaTeX 输出的文件格式是扩展 DVI（eXtended DVI, \u003ccode\u003e.xdv\u003c/code\u003e）。不过，XeLaTeX 在执行到最后时会调用驱动，将 \u003ccode\u003e.xdv\u003c/code\u003e 文件转为 \u003ccode\u003e.pdf\u003c/code\u003e 格式，并将 \u003ccode\u003e.xdv\u003c/code\u003e 文件删除。默认的驱动是 \u003ccode\u003exDVIPDFMx\u003c/code\u003e，它与 \u003ccode\u003eDVIPDFMx\u003c/code\u003e 系出同源。\u003c/p\u003e\n\u003cp\u003e使用 LaTeXmk 编译的文档没有嵌入字体，显然与 \u003ccode\u003exDVIPDFMx\u003c/code\u003e 有关。经检查，LaTeXmk 考虑到多次编译时，只有最后一次编译需要真正输出 PDF 文件，故而在调用 XeLaTeX 时加上了 \u003ccode\u003e-no-pdf\u003c/code\u003e 选项，同时在最后一次调用 XeLaTeX 之后去调用 \u003ccode\u003exDVIPDFMx\u003c/code\u003e。大致可以理解为 LaTeXmk 会按如下方式执行命令：\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003exelatex -no-pdf [other-options] foo.tex\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ebibtex foo\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emakeindex foo\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003exelatex -no-pdf [other-options] foo.tex\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003exelatex -no-pdf [other-options] foo.tex\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003exdvipdfmx foo\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e问题出在最后调用 \u003ccode\u003exDVIPDFMx\u003c/code\u003e 的时候。若要嵌入字体，应当加上 \u003ccode\u003e-E\u003c/code\u003e 选项。但是默认情况下，LaTeXmk 没加上这一选项。所以，默认情况下，由 LaTeXmk 编译出来的 PDF 文档不会嵌入字体。具体到我们的例子中，\u003ca href=\"/uploads/pdf/latexmk-mac.pdf\"\u003e\u003ccode\u003elatexmk-mac.pdf\u003c/code\u003e\u003c/a\u003e 在 Windows 上显示为乱码。\u003c/p\u003e\n\u003ch2 id=\"XeLaTeX-调用-xDVIPDFMx-时的默认参数\"\u003e\u003ca href=\"#XeLaTeX-调用-xDVIPDFMx-时的默认参数\" class=\"headerlink\" title=\"XeLaTeX 调用 xDVIPDFMx 时的默认参数\"\u003e\u003c/a\u003eXeLaTeX 调用 \u003ccode\u003exDVIPDFMx\u003c/code\u003e 时的默认参数\u003c/h2\u003e\u003cp\u003e至此，「在 macOS 上使用 LaTeXmk 编译的文档在 Windows 上乱码」这一问题已经可以解释。但是问题的另一半，即「为什么在 macOS 上使用 XeLaTeX 编译的文档在 Windows 上不会乱码」这一问题还没回答。显然，这仍与 \u003ccode\u003exDVIPDFMx\u003c/code\u003e 的调用参数有关。\u003c/p\u003e\n\u003cp\u003e经查，XeLaTeX 在指定输出驱动为 \u003ccode\u003exDVIPDFMx\u003c/code\u003e 时的 C 代码为：\u003c/p\u003e\n\u003cfigure class=\"highlight c\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"type\"\u003econst\u003c/span\u003e \u003cspan class=\"type\"\u003echar\u003c/span\u003e *outputdriver = \u003cspan class=\"string\"\u003e\u0026#34;xdvipdfmx -q -E\u0026#34;\u003c/span\u003e; \u003cspan class=\"comment\"\u003e/* default to portable xdvipdfmx driver */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e可见，调用时添加了 \u003ccode\u003e-q\u003c/code\u003e 和 \u003ccode\u003e-E\u003c/code\u003e 两个参数。其中 \u003ccode\u003e-q\u003c/code\u003e 表示静默模式，即 \u003ccode\u003exDVIPDFMx\u003c/code\u003e 不会输出任何回显信息；\u003ccode\u003e-E\u003c/code\u003e 表示忽略字体版权标记而总是将字体嵌入输出文件。\u003c/p\u003e\n\u003cp\u003e如此一来，问题的另一半也得到了合理解释。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-02-12T07:37:34Z",
  "Author": "Liam Huang"
}