{
  "Source": "liam.page",
  "Title": "保存和恢复 Tmux 会话",
  "Link": "https://liam.page/2016/09/10/tmux-plugin-resurrect/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003eTmux 是一个强大的终端复用软件，我们可以轻易地为它列举出一堆好处。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e支持多标签；\u003c/li\u003e\n\u003cli\u003e支持窗口内部进行面板的划分；\u003c/li\u003e\n\u003cli\u003e支持多个终端同时 attach 同一个 Tmux 会话。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e如果要为 Tmux 说一个缺点，那可能就是 Tmux 会话无法在系统重启之后比较容易地恢复。这个问题在常年开机的服务器上，可能问题不明显，但是在我们自己的计算机上，或者服务器因为某些原因需要重启，那之前的 Tmux 会话就都丢失了。\u003c/p\u003e\n\u003cp\u003e为了解决这个问题，我们需要用到 Tmux 的插件系统，并安装名为 \u003ccode\u003etmux-resurrect\u003c/code\u003e 的插件。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"Tmux-Plugin-Manager\"\u003e\u003ca href=\"#Tmux-Plugin-Manager\" class=\"headerlink\" title=\"Tmux Plugin Manager\"\u003e\u003c/a\u003eTmux Plugin Manager\u003c/h2\u003e\u003cp\u003e和大多数支持插件的软件（系统）一样，Tmux 也有一个插件管理系统，名字就叫做 Tmux Plugin Manager。首先，我们需要安装并学习如何使用这个管理器。\u003c/p\u003e\n\u003ch3 id=\"下载和安装\"\u003e\u003ca href=\"#下载和安装\" class=\"headerlink\" title=\"下载和安装\"\u003e\u003c/a\u003e下载和安装\u003c/h3\u003e\u003cp\u003eTmux Plugin Manager 的程式码托管在 GitHub 上，它的专案地址是：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/tmux-plugins/tpm\"\u003ehttps://github.com/tmux-plugins/tpm\u003c/a\u003e。首先，我们需要将 Tmux Plugin Manager 的程式码克隆到本地。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003egit \u003cspan class=\"built_in\"\u003eclone\u003c/span\u003e https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e而后，我们需要在 Tmux 的配置文件底部加上这么几行：\u003c/p\u003e\n\u003cfigure class=\"highlight plaintext\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e# List of plugins\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eset -g @plugin \u0026#39;tmux-plugins/tpm\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eset -g @plugin \u0026#39;tmux-plugins/tmux-sensible\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e# Other examples:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e# set -g @plugin \u0026#39;github_username/plugin_name\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e# set -g @plugin \u0026#39;git@github.com/user/plugin\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e# set -g @plugin \u0026#39;git@bitbucket.com/user/plugin\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003erun \u0026#39;~/.tmux/plugins/tpm/tpm\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e注意，最后的 \u003ccode\u003erun \u0026#39;~/.tmux/plugins/tpm/tpm\u0026#39;\u003c/code\u003e 一定要放在整个 \u003ccode\u003e~/.tmux.conf\u003c/code\u003e 的最后一行。\u003c/p\u003e\n\u003cp\u003e如果你尚未启动 Tmux，那么现在就可以执行 \u003ccode\u003etmux new -s foobar\u003c/code\u003e 打开一个新的窗口了。如果你已经启动了 Tmux，那么需要在 Tmux 环境里重新加载配置文件：\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003etmux \u003cspan class=\"built_in\"\u003esource\u003c/span\u003e ~/.tmux.conf\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"初始化\"\u003e\u003ca href=\"#初始化\" class=\"headerlink\" title=\"初始化\"\u003e\u003c/a\u003e初始化\u003c/h3\u003e\u003cp\u003e注意到，在默认的配置中，我们已经添加了两个插件：\u003ccode\u003etpm\u003c/code\u003e 和 \u003ccode\u003etmux-sensible\u003c/code\u003e。这里 \u003ccode\u003etpm\u003c/code\u003e 是 Tmux Plugin Manager 本身，自不必说；\u003ccode\u003etmux-sensible\u003c/code\u003e 则是插件管理器官方推荐的必装插件——当然你可以选择不装，不过我们这里就不标新立异了。\u003c/p\u003e\n\u003cp\u003e然而，\u003ccode\u003etpm\u003c/code\u003e 本身是已经通过 \u003ccode\u003egit clone\u003c/code\u003e 命令下载到本地了，\u003ccode\u003etmux-sensible\u003c/code\u003e 却没有。所以，我们这里需要通过 \u003ccode\u003eprefix shift-i\u003c/code\u003e 来安装它。\u003ccode\u003eprefix shift-i\u003c/code\u003e 中，\u003ccode\u003ei\u003c/code\u003e 是 install 的缩写。执行它会根据配置文件中的插件列表，安装所有插件。\u003c/p\u003e\n\u003cp\u003e如果你的环境里命令执行正常，那么 Tmux 会提示：\u003c/p\u003e\n\u003cfigure class=\"highlight plaintext\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eAlready installed \u0026#34;tpm\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eInstalling \u0026#34;tmux-sensible\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u0026#34;tmux-sensible\u0026#34; download success\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eTMUX environment reloaded.\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eDone, press ESCAPE to continue.\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这样，插件管理器就算是初始化成功了。\u003c/p\u003e\n\u003ch3 id=\"安装、升级和反安装插件\"\u003e\u003ca href=\"#安装、升级和反安装插件\" class=\"headerlink\" title=\"安装、升级和反安装插件\"\u003e\u003c/a\u003e安装、升级和反安装插件\u003c/h3\u003e\u003cp\u003e在 Tmux Plugin Manager 中安装、升级和反安装插件都很简单，他们的 Tmux 快捷键分别是：\u003c/p\u003e\n\u003cfigure class=\"highlight plaintext\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eprefix shift-i      # install\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eprefix shift-u      # update\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eprefix alt-u        # uninstall plugins not on the plugin list\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"tmux-resurrect\"\u003e\u003ca href=\"#tmux-resurrect\" class=\"headerlink\" title=\"tmux-resurrect\"\u003e\u003c/a\u003e\u003ccode\u003etmux-resurrect\u003c/code\u003e\u003c/h2\u003e\u003cp\u003e和 Tmux Plugin Manager 一样，\u003ccode\u003etmux-resurrect\u003c/code\u003e 的程式码也托管在 GitHub 上，专案地址是：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/tmux-plugins/tmux-resurrect\"\u003ehttps://github.com/tmux-plugins/tmux-resurrect\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 id=\"安装\"\u003e\u003ca href=\"#安装\" class=\"headerlink\" title=\"安装\"\u003e\u003c/a\u003e安装\u003c/h3\u003e\u003cp\u003e有了插件管理器，安装插件就变得很简单了。\u003c/p\u003e\n\u003cp\u003e首先，我们需要修改 \u003ccode\u003e~/.tmux.conf\u003c/code\u003e 文件，在插件列表中加上：\u003c/p\u003e\n\u003cfigure class=\"highlight plaintext\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eset -g @plugin \u0026#39;tmux-plugins/tmux-resurrect\u0026#39;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这样，在执行 \u003ccode\u003eprefix shift-i\u003c/code\u003e 的时候，Tmux Plugin Manager 就会到 GitHub 上的相应位置寻找相应专案并下载安装。\u003c/p\u003e\n\u003ch3 id=\"配置\"\u003e\u003ca href=\"#配置\" class=\"headerlink\" title=\"配置\"\u003e\u003c/a\u003e配置\u003c/h3\u003e\u003cp\u003e同样是打开配置文件，插件配置中加上：\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# tmux-resurrect\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eset\u003c/span\u003e -g @resurrect-save-bash-history \u003cspan class=\"string\"\u003e\u0026#39;on\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eset\u003c/span\u003e -g @resurrect-capture-pane-contents \u003cspan class=\"string\"\u003e\u0026#39;on\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eset\u003c/span\u003e -g @resurrect-strategy-vim \u003cspan class=\"string\"\u003e\u0026#39;session\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# set -g @resurrect-save \u0026#39;S\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# set -g @resurrect-restore \u0026#39;R\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这样，\u003ccode\u003etmux-resurrect\u003c/code\u003e 就会保存键入的命令历史、Tmux 的面板布局还有 Vim 的状态了。\u003c/p\u003e\n\u003ch3 id=\"保存和加载\"\u003e\u003ca href=\"#保存和加载\" class=\"headerlink\" title=\"保存和加载\"\u003e\u003c/a\u003e保存和加载\u003c/h3\u003e\u003cp\u003e至此，\u003ccode\u003etmux-resurrect\u003c/code\u003e 已经配置好，可以保存和加载 Tmux 会话的状态了，快捷键是：\u003c/p\u003e\n\u003cfigure class=\"highlight plaintext\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eprefix Ctrl-s       # save tmux session to local file\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eprefix Ctrl-r       # reload tmux session from local file\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这样，只要养成定期 \u003ccode\u003eprefix Ctrl-s\u003c/code\u003e 的好习惯，我们就不怕 Tmux 会话状态丢失了！\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2016-09-10T07:32:30Z",
  "Author": "Liam Huang"
}