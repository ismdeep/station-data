{
  "Source": "liam.page",
  "Title": "hyperref 宏包 psdextra 选项的 bug 及其 quick fix",
  "Link": "https://liam.page/2015/05/11/bug-of-the-hyperref-package-with-mu-in-section-heading/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e今天有人问到下列代码报错：\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{article}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%\\listfiles\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e[unicode,psdextra]{hyperref}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{unicode-math}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\setmathfont\u003c/span\u003e{Asana Math}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\section\u003c/span\u003e{\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\mu\u003c/span\u003e\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e提示：\u003c/p\u003e\n\u003cfigure class=\"highlight plaintext\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eImproper alphabetic constant\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e看了一下，是 \u003ccode\u003ehyperref\u003c/code\u003e 宏包的 bug。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e实际上，在处理 PDF 书签的时候，很多数学命令要被定义成相应的文本模式，比如 \\geq 要被定义为 \\textgeq。这个工作在 NFSS 里完成。\u003c/p\u003e\n\u003cp\u003e但是，数学符号那么多，总有 NFSS 定义不全的时候。于是 hyperref 提供了 psdextra 选项。该选项会载入 psdextra.def 这个文件，提供更多的定义。\u003c/p\u003e\n\u003cp\u003e不过 \\mu 在 NFSS 里和 psdextra.def 里都处理错了。psdextra 里是处理了 \\mugreek，而实际上应该是 \\mu。于是就出问题了。\u003c/p\u003e\n\u003cp\u003e解决方法也很简单，自己处理一下就好了。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{article}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%\\listfiles\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e[unicode, psdextra]{hyperref}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{unicode-math}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\setmathfont\u003c/span\u003e{Asana-Math.otf}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{etoolbox}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\appto\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\psdmapshortnames\u003c/span\u003e}{\u003cspan class=\"keyword\"\u003e\\let\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\mu\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\textmugreek\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\section\u003c/span\u003e{\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\mu\u003c/span\u003e\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里 \u003ccode\u003e\\appto\u003c/code\u003e 命令接受两个参数，\u003ccode\u003e\\appto{\u0026lt;需要修补的命令\u0026gt;}{\u0026lt;填在命令最后的内容\u0026gt;}\u003c/code\u003e。这里我们将 \u003ccode\u003e\\let\\mu\\textmugreek\u003c/code\u003e 添加在命令 \u003ccode\u003e\\psdmapshortnames\u003c/code\u003e 的最后，这样在处理 PDF 书签的时候，\u003ccode\u003e\\mu\u003c/code\u003e 就能被正确处理了。\u003c/p\u003e\n\u003cp\u003e该 bug 已提交给 \u003ccode\u003ehyperref\u003c/code\u003e 宏包的作者。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2015-05-11T15:04:10Z",
  "Author": "Liam Huang"
}