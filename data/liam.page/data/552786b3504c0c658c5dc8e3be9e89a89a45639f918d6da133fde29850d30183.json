{
  "Source": "liam.page",
  "Title": "在 Windows 7 的锁屏界面上执行命令/程序",
  "Link": "https://liam.page/2018/11/22/execute-command-or-executables-on-Windows-login-page/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e\u003ca href=\"/2018/11/21/replace-the-background-of-login-page/\"\u003e前作\u003c/a\u003e提到了如何在 Windows 7 上更换锁屏界面的背景图片。这就给我创造了一个新的需求——如何为锁屏界面截图？\u003c/p\u003e\n\u003cp\u003e此篇以此为例，讲讲如何在锁屏界面上执行命令/程序。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"实现思路\"\u003e\u003ca href=\"#实现思路\" class=\"headerlink\" title=\"实现思路\"\u003e\u003c/a\u003e实现思路\u003c/h2\u003e\u003cp\u003e在锁屏界面截图需要解决的主要问题是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e如何在用户没有登录的情况下，执行命令；\u003c/li\u003e\n\u003cli\u003e有什么可用的截图工具能够在锁屏界面进行截图？\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"在锁屏界面执行命令\"\u003e\u003ca href=\"#在锁屏界面执行命令\" class=\"headerlink\" title=\"在锁屏界面执行命令\"\u003e\u003c/a\u003e在锁屏界面执行命令\u003c/h2\u003e\u003ch3 id=\"PsExec\"\u003e\u003ca href=\"#PsExec\" class=\"headerlink\" title=\"PsExec\"\u003e\u003c/a\u003ePsExec\u003c/h3\u003e\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://docs.microsoft.com/zh-cn/sysinternals/downloads/psexec\"\u003ePsExec\u003c/a\u003e 是 M$ 提供的一款在远程机器上执行命令的小工具。正如 Linux 上常用的 SSH 可以将本机作为「远程机器」登录一样，PsExec 也能完成这个任务。此外，PsExec 的 \u003ccode\u003e-x\u003c/code\u003e 选项，能够在 Windows 登录页面显示 UI。这样一来，我们就能利用 PsExec 在锁屏界面执行命令了。\u003c/p\u003e\n\u003cp\u003e具体操作路径如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e下载：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://download.sysinternals.com/files/PSTools.zip\"\u003ehttps://download.sysinternals.com/files/PSTools.zip\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e安装：打开 \u003ccode\u003e.zip\u003c/code\u003e 包，将 \u003ccode\u003ePsExec.exe\u003c/code\u003e 复制到 \u003ccode\u003eC:\\Windows\\System32\u003c/code\u003e 当中\u003c/li\u003e\n\u003cli\u003e在开始菜单中搜索 \u003ccode\u003ecmd\u003c/code\u003e，右键「以管理员身份运行」\u003c/li\u003e\n\u003cli\u003e执行命令 \u003ccode\u003epsexec -sx cmd.exe\u003c/code\u003e；其中 \u003ccode\u003e-s\u003c/code\u003e 表示以系统权限运行，\u003ccode\u003e-x\u003c/code\u003e 表示在锁屏界面显示 UR\u003c/li\u003e\n\u003cli\u003e按 \u003ccode\u003eWin + L\u003c/code\u003e 锁屏\u003c/li\u003e\n\u003cli\u003e按 \u003ccode\u003eAlt + Tab\u003c/code\u003e 切换到 \u003ccode\u003ecmd.exe\u003c/code\u003e 的 UI\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg data-src=\"/uploads/images/computer-skills/cmd_on_login.jpg\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"轻松访问\"\u003e\u003ca href=\"#轻松访问\" class=\"headerlink\" title=\"轻松访问\"\u003e\u003c/a\u003e轻松访问\u003c/h3\u003e\u003cp\u003e事实上，Windows 的轻松访问有各种 bug。利用它可以实现很多 hacky 的功能。此次我们也来利用这一小漏洞。\u003c/p\u003e\n\u003ch4 id=\"直接替换可执行文件\"\u003e\u003ca href=\"#直接替换可执行文件\" class=\"headerlink\" title=\"直接替换可执行文件\"\u003e\u003c/a\u003e直接替换可执行文件\u003c/h4\u003e\u003cp\u003e默认的轻松访问可执行文件位于 \u003ccode\u003eC:\\Windows\\System32\\Utilman.exe\u003c/code\u003e。我们可以备份它，然后将其替换为其它可执行文件。如此一来，在锁屏界面点击轻松访问按钮，就能执行被替换的可执行文件了。\u003c/p\u003e\n\u003ch4 id=\"修改注册表\"\u003e\u003ca href=\"#修改注册表\" class=\"headerlink\" title=\"修改注册表\"\u003e\u003c/a\u003e修改注册表\u003c/h4\u003e\u003cp\u003e我们也可以通过修改注册表，将轻松访问的可执行文件路径，指向其它可执行文件。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在开始菜单中搜索 \u003ccode\u003eregedit\u003c/code\u003e，回车执行\u003c/li\u003e\n\u003cli\u003e导航路径\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eHKEY_LOCAL_MACHINE\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eSOFTWARE\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eMicorsoft\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eWindows NT\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eCurrentVersion\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eImage File Execution Options\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e右键，新建名为 \u003ccode\u003eUtilman.exe\u003c/code\u003e 的项\u003c/li\u003e\n\u003cli\u003e在右侧新建名为 \u003ccode\u003eDebugger\u003c/code\u003e 的字符串值\u003c/li\u003e\n\u003cli\u003e右键双击 \u003ccode\u003eDebugger\u003c/code\u003e 字符串值，将其值设置为目标可执行文件的完整路径\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"实际截图试试看\"\u003e\u003ca href=\"#实际截图试试看\" class=\"headerlink\" title=\"实际截图试试看\"\u003e\u003c/a\u003e实际截图试试看\u003c/h2\u003e\u003cp\u003e这里，我使用 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://sourceforge.net/projects/login7/\"\u003eWin 7 Logon Screen Capture\u003c/a\u003e 这个小工具来截图。我将其下载解压到了 \u003ccode\u003eE:\\Tools\\Login Screen Capture.exe\u003c/code\u003e 位置。而后，我们只需要通过上述两种方式之任一，在锁屏界面执行截图工具即可。\u003c/p\u003e\n\u003cp\u003e以下即是我截图的结果。\u003c/p\u003e\n\u003cp\u003e\u003cimg data-src=\"/uploads/images/computer-skills/login_photo.jpg\"/\u003e\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2018-11-22T03:07:27Z",
  "Author": "Liam Huang"
}