{
  "Source": "liam.page",
  "Title": "修改休眠模式以节省 macOS 睡眠时的电池电量",
  "Link": "https://liam.page/2020/07/26/change-hibernatemode-to-save-battery-on-macOS/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e切换到 Mac 已经有六年了；一直以来，就发现 MacBook Pro 在扣上盖子睡眠时，会有明显的掉电现象。我觉着这么多年，我一直没去处理它，也是挺能忍的。\u003c/p\u003e\n\u003cp\u003e然而今天忍不了了哇。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"GUI-设置\"\u003e\u003ca href=\"#GUI-设置\" class=\"headerlink\" title=\"GUI 设置\"\u003e\u003c/a\u003eGUI 设置\u003c/h2\u003e\u003cp\u003e一般用户自然是会从 GUI 设置当中找寻相关线索。\u003c/p\u003e\n\u003cp\u003e于是我们打开「系统偏好设置」-「节能」-「电池」标签。\u003c/p\u003e\n\u003cp\u003e\u003cimg data-src=\"/uploads/images/macOS/energy-saving.jpg\"/\u003e\u003c/p\u003e\n\u003cp\u003e可见，除了关闭显示器的时间，我的设置已经尽可能节能了；而我们讨论的是合盖睡眠的场景，所以关闭显示器的时间在这里不影响。\u003c/p\u003e\n\u003ch2 id=\"macOS-睡眠机制\"\u003e\u003ca href=\"#macOS-睡眠机制\" class=\"headerlink\" title=\"macOS 睡眠机制\"\u003e\u003c/a\u003emacOS 睡眠机制\u003c/h2\u003e\u003cp\u003e既然 GUI 设置不解决问题，我们就要考虑深入了解 macOS 的睡眠机制了。\u003c/p\u003e\n\u003cp\u003e在 Google 上检索 \u003cem\u003emacOS hibernate\u003c/em\u003e，比较可惜的是未能找到 Apple 官方的文档。不过，在 Stack Exchange 上我找到了\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://apple.stackexchange.com/questions/51725/do-macbooks-have-a-true-hibernate-option\"\u003e这篇回答\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e按照这篇回答的说法，macOS 默认的睡眠，会关闭屏幕，但会维持用于内存（RAM）的供电。这样一来，一旦打开盖子，macOS 就能立即恢复。若是电池电量低于某个预设阈值，则会将内存中的数据转储到硬盘，而后彻底断电。\u003c/p\u003e\n\u003cp\u003e这样一来，macOS 睡眠时掉电就解释得通了。\u003c/p\u003e\n\u003cp\u003e原作者还提供了一个 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://developer.apple.com/library/mac/#documentation/Darwin/Reference/ManPages/man1/pmset.1.html\"\u003eApple 官方的链接\u003c/a\u003e，但无法打开。根据链接内容，看起来是 \u003ccode\u003epmset\u003c/code\u003e 这个命令的 \u003ccode\u003eman\u003c/code\u003e 内容。于是在终端中执行 \u003ccode\u003eman pmset\u003c/code\u003e 查看相关信息。\u003c/p\u003e\n\u003cp\u003e经查，\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emacOS 的睡眠有两种状态\u003cul\u003e\n\u003cli\u003e不断电，数据存储在内存中，可以快速恢复。我们称这种状态为睡眠（Sleep）\u003c/li\u003e\n\u003cli\u003e断电，数据存储在硬盘中，恢复得较慢。我们称这种状态为休眠（Hibernate/Stand-by）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e睡眠和休眠可以组合出三种模式，由 \u003ccode\u003ehibernatemode\u003c/code\u003e 控制\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ehibernatemode = 0\u003c/code\u003e，这是桌面设备的默认值。系统只睡眠，不休眠，不将数据存储在硬盘中。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehibernatemode = 3\u003c/code\u003e，这是移动设备的默认值。系统默认睡眠，在一定时间后或电量低于阈值将数据存储在硬盘中，而后休眠。这是所谓的安全睡眠（Safe-Sleep）。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehibernatemode = 25\u003c/code\u003e。只休眠，不睡眠。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e无论是安全睡眠模式还是休眠模式，从磁盘上恢复时，都会需要一定的时间（经测试，大约 3 秒钟）屏幕才会被点亮。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e对于 \u003ccode\u003ehibernatemode = 3\u003c/code\u003e，即安全睡眠模式，又有几个参数来控制细节。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e当剩余电量大于 \u003ccode\u003ehighstandbythreshold\u003c/code\u003e（默认 50%）时，在 \u003ccode\u003estandbydelayhigh\u003c/code\u003e 秒（默认 86,400，即一整天）后进入休眠。\u003c/li\u003e\n\u003cli\u003e当剩余电量小于 \u003ccode\u003ehighstandbythreshold\u003c/code\u003e 时，在 \u003ccode\u003estandbydelaylow\u003c/code\u003e 秒（默认 10,800，即三小时）后进入休眠。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"实际操作看看\"\u003e\u003ca href=\"#实际操作看看\" class=\"headerlink\" title=\"实际操作看看\"\u003e\u003c/a\u003e实际操作看看\u003c/h2\u003e\u003cp\u003e搞清楚具体机制之后，我们就可以做更多细节设置了。\u003c/p\u003e\n\u003cp\u003e如果你不在乎每次开盖后需要等待 3 -- 5 秒屏幕才电量，那么你可以直接禁用安全睡眠模式，盒盖休眠。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esudo pmset -b hibernatemode 25\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e如果你仍然希望使用安全睡眠模式，但希望不要掉电得太厉害，则可以适当修改 \u003ccode\u003ehighstandbythreshold\u003c/code\u003e 和 \u003ccode\u003estandbydelayhigh\u003c/code\u003e/\u003ccode\u003estandbydelaylow\u003c/code\u003e 的值。比如我是这样设置的。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# When Using Battery\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo pmset -b hibernatemode 3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo pmset -b highstandbythreshold 95\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo pmset -b standbydelayhigh 3600  \u003cspan class=\"comment\"\u003e# 1 hour\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo pmset -b standbydelaylow  1800  \u003cspan class=\"comment\"\u003e# half an hour\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# When Using AC Power\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo pmset -c hibernatemode 3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo pmset -c highstandbythreshold 80\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo pmset -c standbydelayhigh 86400  \u003cspan class=\"comment\"\u003e# 24 hours\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo pmset -c standbydelaylow  10800  \u003cspan class=\"comment\"\u003e# 3 hours\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e如此一来，我的节能设置如下：\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ pmset -g custom\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eBattery Power:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e lidwake              1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e standbydelayhigh     3600\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e standbydelaylow      1800\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e standby              1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e proximitywake        0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e ttyskeepawake        1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e highstandbythreshold 95\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e powernap             0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e gpuswitch            2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e hibernatefile        /var/vm/sleepimage\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e hibernatemode        3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e displaysleep         64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003cspan class=\"built_in\"\u003esleep\u003c/span\u003e                1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e tcpkeepalive         1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e halfdim              1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e acwake               0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e lessbright           1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e disksleep            5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eAC Power:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e lidwake              1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e standbydelayhigh     86400\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e standbydelaylow      10800\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e standby              1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e proximitywake        1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e ttyskeepawake        1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e hibernatemode        3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e powernap             1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e gpuswitch            2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e hibernatefile        /var/vm/sleepimage\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e highstandbythreshold 80\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e womp                 1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e displaysleep         180\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e networkoversleep     0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e \u003cspan class=\"built_in\"\u003esleep\u003c/span\u003e                1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e tcpkeepalive         1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e halfdim              1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e acwake               0\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e disksleep            10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-07-26T10:38:06Z",
  "Author": "Liam Huang"
}