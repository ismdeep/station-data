{
  "Source": "liam.page",
  "Title": "为网页标题添加「崩溃了」彩蛋",
  "Link": "https://liam.page/2019/07/22/crash-title-cheat/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e经常浏览\u003ca href=\"/\"\u003e「始终」博客\u003c/a\u003e的读者很容易会发现，当你在浏览器中切换 tab 页到其它网页时，始终博客的页面会有一定概率「崩溃」。具体来说，tab 页上的标题会变成 \u003ccode\u003e╭(°A°`)╮ 页面崩溃啦~\u003c/code\u003e 这样子，切换回来之后又会发现页面其实没问题，同时标题会变成 \u003ccode\u003e(ฅ\u0026gt;ω\u0026lt;*ฅ) 咦，又好了~\u003c/code\u003e 这样子。因为这个彩蛋比较有趣，所以很多朋友回点回来看一看页面发生了什么。想想还是蛮有趣的。\u003c/p\u003e\n\u003cp\u003e最近有不少朋友问到这个效果是怎么实现的。这里记录一下。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e因为功能十分简单，所以直接放代码出来。\u003c/p\u003e\n\u003cfigure class=\"highlight javascript\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u0026lt;script type=\u003cspan class=\"string\"\u003e\u0026#34;text/javascript\u0026#34;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003evar\u003c/span\u003e originalTitle = \u003cspan class=\"variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"property\"\u003etitle\u003c/span\u003e;      \u003cspan class=\"comment\"\u003e// 1.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003evar\u003c/span\u003e crashSwitched = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e;               \u003cspan class=\"comment\"\u003e// 2.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003evar\u003c/span\u003e titleTime;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;visibilitychange\u0026#39;\u003c/span\u003e, \u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"params\"\u003e\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"property\"\u003ehidden\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"title class_\"\u003eMath\u003c/span\u003e.\u003cspan class=\"title function_\"\u003erandom\u003c/span\u003e() \u0026lt; \u003cspan class=\"built_in\"\u003eparseFloat\u003c/span\u003e({{ theme.\u003cspan class=\"property\"\u003ecrash_title_cheat\u003c/span\u003e.\u003cspan class=\"property\"\u003eprobability\u003c/span\u003e }})) {         \u003cspan class=\"comment\"\u003e// 3.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      crashSwitched = \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e;              \u003cspan class=\"comment\"\u003e// 2.a.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"property\"\u003etitle\u003c/span\u003e = \u003cspan class=\"string\"\u003e\u0026#39;{{ theme.crash_title_cheat.crash_string }}\u0026#39;\u003c/span\u003e + originalTitle;     \u003cspan class=\"comment\"\u003e// 1.a.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"built_in\"\u003eclearTimeout\u003c/span\u003e(titleTime);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  } \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e (crashSwitched == \u003cspan class=\"literal\"\u003etrue\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      crashSwitched = \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e;             \u003cspan class=\"comment\"\u003e// 2.b.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"property\"\u003etitle\u003c/span\u003e = \u003cspan class=\"string\"\u003e\u0026#39;{{ theme.crash_title_cheat.recover_string }}\u0026#39;\u003c/span\u003e + originalTitle;   \u003cspan class=\"comment\"\u003e// 1.b.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      titleTime = \u003cspan class=\"built_in\"\u003esetTimeout\u003c/span\u003e(\u003cspan class=\"keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"params\"\u003e\u003c/span\u003e) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"property\"\u003etitle\u003c/span\u003e = originalTitle;  \u003cspan class=\"comment\"\u003e// 1.c.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      }, \u003cspan class=\"number\"\u003e2000\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e});\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e首先解释一下以下一些 Hexo 变量：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003etheme.crash_title_cheat.probability\u003c/code\u003e：值为 \u003ccode\u003e0.25\u003c/code\u003e。意味着当用户从博客页面切走时，有 \u003ccode\u003e0.25\u003c/code\u003e 的概率会触发「页面崩溃」的彩蛋。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etheme.crash_title_cheat.crash_string\u003c/code\u003e：值为 \u003ccode\u003e╭(°A°`)╮ 页面崩溃啦~\u003c/code\u003e，这就是「页面崩溃」时你看到的字符串。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etheme.crash_title_cheat.recover_string\u003c/code\u003e：值为 \u003ccode\u003e (ฅ\u0026gt;ω\u0026lt;*ฅ) 咦，又好了~\u003c/code\u003e，这就是「页面恢复」时你看到的字符串。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e而后我们看 \u003ccode\u003e(1)\u003c/code\u003e 处用变量 \u003ccode\u003eoriginalTitle\u003c/code\u003e 记录了当前页面的原始标题；\u003ccode\u003e(2)\u003c/code\u003e 处用变量 \u003ccode\u003ecrashSwitched\u003c/code\u003e 记录当前页面是否有触发该彩蛋。当页面被隐藏切走时，在 \u003ccode\u003e(3)\u003c/code\u003e 处有一定概率触发页面崩溃的彩蛋。彩蛋被触发时，首先 \u003ccode\u003e(2.a)\u003c/code\u003e 修改触发标记，然后 \u003ccode\u003e(1.a)\u003c/code\u003e 修改页面标题。当页面被切回时，则会检查触发标记。若标记触发，则首先 \u003ccode\u003e(2.b)\u003c/code\u003e 抹掉触发标记，然后 \u003ccode\u003e(1.b)\u003c/code\u003e 添加「咦，又好了~」这样的字符串，最后在 \u003ccode\u003e2000\u003c/code\u003e 毫秒之后 \u003ccode\u003e(1.c)\u003c/code\u003e 恢复为真实标题。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-07-22T03:18:12Z",
  "Author": "Liam Huang"
}