{
  "Source": "liam.page",
  "Title": "一个用 TikZ 实现的简易文本框",
  "Link": "https://liam.page/2016/09/03/a-simple-text-block-by-TikZ/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e在知乎上看到\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://www.zhihu.com/question/50270196\"\u003e一个问题\u003c/a\u003e，求一个简易的文本框。恰好之前在群里用 Ti\u003cem\u003ek\u003c/em\u003eZ 给朋友实现过一个类似的，所以就做了一个回答。一些值得说的东西，记录在这里。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e首先是代码。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003cfigcaption\u003e\u003cspan\u003esimple-block.tex\u003c/span\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e[UTF8]{ctexart}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{tikz}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{calc}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usetikzlibrary\u003c/span\u003e{calc}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newlength\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\framelinewidth\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newlength\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\horizonextendwidth\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newlength\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\setlength\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\framelinewidth\u003c/span\u003e}{2pt}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\setlength\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\horizonextendwidth\u003c/span\u003e}{3pt}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\setlength\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e}{3pt}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newenvironment\u003c/span\u003e{tblock}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e{\u003cspan class=\"keyword\"\u003e\\par\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\medskip\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\noindent\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{tikzpicture}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003e\\node\u003c/span\u003e[inner sep = 0pt] (box) \u003cspan class=\"keyword\"\u003e\\bgroup\u003c/span\u003e\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{minipage}[t]{\u003cspan class=\"keyword\"\u003e\\textwidth\u003c/span\u003e-\u003cspan class=\"keyword\"\u003e\\framelinewidth\u003c/span\u003e-2\u003cspan class=\"keyword\"\u003e\\horizonextendwidth\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}{\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{minipage}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003e\\egroup\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003e\\draw\u003c/span\u003e[black, line width=\u003cspan class=\"keyword\"\u003e\\framelinewidth\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ( \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e (box.north east) + (\u003cspan class=\"keyword\"\u003e\\horizonextendwidth\u003c/span\u003e,-\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e) \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e ) -- ( \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e (box.north east) + (\u003cspan class=\"keyword\"\u003e\\horizonextendwidth\u003c/span\u003e,\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e) \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e ) -- ( \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e (box.north west) + (-\u003cspan class=\"keyword\"\u003e\\horizonextendwidth\u003c/span\u003e,\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e) \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e ) -- + (0,-2\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003e\\draw\u003c/span\u003e[black, line width=\u003cspan class=\"keyword\"\u003e\\framelinewidth\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ( \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e (box.south east) + (\u003cspan class=\"keyword\"\u003e\\horizonextendwidth\u003c/span\u003e,\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e) \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e ) -- ( \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e (box.south east) + (\u003cspan class=\"keyword\"\u003e\\horizonextendwidth\u003c/span\u003e,-\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e) \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e ) -- ( \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e (box.south west) + (-\u003cspan class=\"keyword\"\u003e\\horizonextendwidth\u003c/span\u003e,-\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e) \u003cspan class=\"built_in\"\u003e$\u003c/span\u003e ) -- + (0,2\u003cspan class=\"keyword\"\u003e\\verticalextendwidth\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{tikzpicture}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\par\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\medskip\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{mwe}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{tblock}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\blindtext\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{tblock}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e有几个地方值得一说。\u003c/p\u003e\n\u003cp\u003e主体当然是用 \u003ccode\u003e\\newenvironment{tblock}\u003c/code\u003e 定义的 \u003ccode\u003etblock\u003c/code\u003e 环境。这个环境里的文本部分是 \u003ccode\u003etikzpicture\u003c/code\u003e 里用 \u003ccode\u003e\\node\u003c/code\u003e 实现的，内里的换行用了 \u003ccode\u003eminipage\u003c/code\u003e。\u003ccode\u003eminipage\u003c/code\u003e 的宽度是 \u003ccode\u003e\\textwidth-\\framelinewidth-2\\horizonextendwidth\u003c/code\u003e，这里利用了 \u003ccode\u003ecalc\u003c/code\u003e 宏包提供的特性——直接做长度运算。为了让整个文本框宽度恰好是 \u003ccode\u003e\\textwidth\u003c/code\u003e，内里的文本部分宽度必须减去框线两边延伸的宽度（\u003ccode\u003e2\\horizonextendwidth\u003c/code\u003e）以及两边框线本身的粗细（\u003ccode\u003e2 * 0.5\\framelinewidth\u003c/code\u003e）。\u003c/p\u003e\n\u003cp\u003e再就是 \u003ccode\u003e\\node[inner sep = 0pt] (box) {}\u003c/code\u003e 的形式被修改为 \u003ccode\u003e\\node[inner sep = 0pt] (box) \\bgroup \\egroup\u003c/code\u003e 的形式。这是为了避免在定义新环境时花括号不匹配的问题。详细可以看 \u003ca target=\"_blank\" rel=\"noopener\" href=\"http://tex.stackexchange.com/a/1932/38350\"\u003eTeX.sx 上的讨论\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e最后就是引入了 \u003ccode\u003e\\usetikzlibrary{calc}\u003c/code\u003e，这个库允许我们在 Ti\u003cem\u003ek\u003c/em\u003eZ 里对点的坐标做运算。因此我们可以写出类似 \u003ccode\u003e( $ (box.south east) + (\\horizonextendwidth,\\verticalextendwidth) $ )\u003c/code\u003e 的代码，来表示 \u003ccode\u003ebox\u003c/code\u003e 右下角偏移 \u003ccode\u003e(\\horizonextendwidth,\\verticalextendwidth)\u003c/code\u003e 的那个点。\u003c/p\u003e\n\u003cp\u003e大体就是如此了。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2016-09-03T02:53:01Z",
  "Author": "Liam Huang"
}