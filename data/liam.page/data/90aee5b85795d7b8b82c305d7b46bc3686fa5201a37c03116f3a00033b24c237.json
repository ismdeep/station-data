{
  "Source": "liam.page",
  "Title": "编写 iOS 越狱插件：给 App 砸壳",
  "Link": "https://liam.page/2023/01/21/Build-an-iOS-Jailbreak-Tweak-dumpdecrypted-IPA/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e在真正开始编写插件之前，我们还必须要分析我们的目标对象。只有进行了妥善的分析之后，我们才能确定要在何处进行注入、修改。\u003c/p\u003e\n\u003cp\u003e现代软件通常会加上一层加密的壳，必须经过脱壳才能分析。脱壳也常被戏称为砸壳。此篇我们介绍可用于 iOS 平台的脱壳工具。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"iOS-端：安装-frida-server\"\u003e\u003ca href=\"#iOS-端：安装-frida-server\" class=\"headerlink\" title=\"iOS 端：安装 frida-server\"\u003e\u003c/a\u003eiOS 端：安装 frida-server\u003c/h2\u003e\u003cp\u003eFrida 是跨平台的脱壳工具。首先我们需要在 iOS 上安装其服务端。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e源：\u003ccode\u003ehttps://build.frida.re/\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e搜索 Frida 安装即可。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e目前最新版本的 Frida (16.0.8) 存在 bug 会导致无法安装。蜗牛源（\u003ccode\u003ehttps://repo.snailovet.com/\u003c/code\u003e）提供了其早先版本（15.2.2）。经测试可用。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"macOS-端：安装-frida-tools\"\u003e\u003ca href=\"#macOS-端：安装-frida-tools\" class=\"headerlink\" title=\"macOS 端：安装 frida-tools\"\u003e\u003c/a\u003emacOS 端：安装 frida-tools\u003c/h2\u003e\u003cp\u003eTerminal 中执行：\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003epip3 install frida-tools\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e为与 15.2.2 版本的 frida-server 匹配，你可能需要安装指定版本的 frida-tools。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003epip3 install frida-tools==11.0.0\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e而后，我们可以下载 dump 脚本。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003egit \u003cspan class=\"built_in\"\u003eclone\u003c/span\u003e https://github.com/AloneMonkey/frida-ios-dump\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"Dumpdecrypting\"\u003e\u003ca href=\"#Dumpdecrypting\" class=\"headerlink\" title=\"Dumpdecrypting\"\u003e\u003c/a\u003eDumpdecrypting\u003c/h2\u003e\u003cp\u003e使用 USB 线缆，连接手机和电脑。以不加载任何插件的方式启动你要砸壳的 App。（你可能需要 Choicy 这一插件来实现）\u003c/p\u003e\n\u003cp\u003e在 macOS 的 Terminal 中执行\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e /path/to/frida-ios-dump\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epython3 dump.py -H 192.168.1.3 -p 22 -u root -P \u003cspan class=\"string\"\u003e\u0026#39;alpine\u0026#39;\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;健康\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e其中 \u003ccode\u003e-H\u003c/code\u003e 指定你手机的 IP 地址，\u003ccode\u003e-p\u003c/code\u003e 指定 ssh 的端口，\u003ccode\u003e-P\u003c/code\u003e 指定 \u003ccode\u003eroot\u003c/code\u003e 账户的密码（默认是 \u003ccode\u003ealpine\u003c/code\u003e）。\u003cbr/\u003e最后的程序名字，可以是显示在你手机上的名字，也可以是它的 Package ID。所有可用的 name/ID 可以通过下列命令查看。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003epython3 dump.py -H 192.168.1.3 -p 22 -u root -P \u003cspan class=\"string\"\u003e\u0026#39;alpine\u0026#39;\u003c/span\u003e -l\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e如此，即可在当前目录下生成 \u003ccode\u003e健康.ipa\u003c/code\u003e 可供后续分析。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2023-01-21T14:47:07Z",
  "Author": "Liam Huang"
}