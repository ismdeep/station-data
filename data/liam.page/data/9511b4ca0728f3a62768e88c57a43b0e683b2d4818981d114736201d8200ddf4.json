{
  "Source": "liam.page",
  "Title": "排版伪代码时打印垂直的缩进提示线",
  "Link": "https://liam.page/2016/06/10/pseudocode-with-vertical-line/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e和实际使用中的 Python 一样，伪代码的排版很讲究缩进。书写 Python 代码，通常会使用等宽字族（打字机字族），因此缩进一板一眼十分清晰；然而，在排版算法时，经常会遇到非等宽的字族和等宽字族混用的情况——此时，缩进有时候就不那么明确了。此时，给伪代码排版加上垂直的缩进提示线能够起到很好的提示作用。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"排版欧几里得算法试试看\"\u003e\u003ca href=\"#排版欧几里得算法试试看\" class=\"headerlink\" title=\"排版欧几里得算法试试看\"\u003e\u003c/a\u003e排版欧几里得算法试试看\u003c/h2\u003e\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{article}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{algorithm}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%\\PassOptionsToPackage{noend}{algpseudocode} % 不显示循环、条件的结尾\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{algpseudocode}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{algorithm}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003e\\caption\u003c/span\u003e{Euclid’s algorithm}\u003cspan class=\"keyword\"\u003e\\label\u003c/span\u003e{euclid}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{algorithmic}[1]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\Procedure\u003c/span\u003e{Euclid}{\u003cspan class=\"built_in\"\u003e$\u003c/span\u003ea,b\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e}\u003cspan class=\"keyword\"\u003e\\Comment\u003c/span\u003e{The g.c.d.\u003cspan class=\"keyword\"\u003e\\ \u003c/span\u003eof a and b}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003e\\State\u003c/span\u003e{\u003cspan class=\"built_in\"\u003e$\u003c/span\u003er\u003cspan class=\"keyword\"\u003e\\gets\u003c/span\u003e a\u003cspan class=\"keyword\"\u003e\\bmod\u003c/span\u003e b\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003e\\While\u003c/span\u003e{\u003cspan class=\"built_in\"\u003e$\u003c/span\u003er\u003cspan class=\"keyword\"\u003e\\not\u003c/span\u003e=0\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e}\u003cspan class=\"keyword\"\u003e\\Comment\u003c/span\u003e{We have the answer if r is 0}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\State\u003c/span\u003e{\u003cspan class=\"built_in\"\u003e$\u003c/span\u003ea\u003cspan class=\"keyword\"\u003e\\gets\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\displaystyle\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\sum\u003c/span\u003e\u003cspan class=\"built_in\"\u003e_\u003c/span\u003e{i=1}\u003cspan class=\"built_in\"\u003e^\u003c/span\u003en x\u003cspan class=\"built_in\"\u003e_\u003c/span\u003ei\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e}\u003cspan class=\"keyword\"\u003e\\Comment\u003c/span\u003e{Nonsense to show that tall lines might work}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\State\u003c/span\u003e{\u003cspan class=\"built_in\"\u003e$\u003c/span\u003ea\u003cspan class=\"keyword\"\u003e\\gets\u003c/span\u003e b\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\State\u003c/span\u003e{\u003cspan class=\"built_in\"\u003e$\u003c/span\u003eb\u003cspan class=\"keyword\"\u003e\\gets\u003c/span\u003e r\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\State\u003c/span\u003e{\u003cspan class=\"built_in\"\u003e$\u003c/span\u003er\u003cspan class=\"keyword\"\u003e\\gets\u003c/span\u003e a\u003cspan class=\"keyword\"\u003e\\bmod\u003c/span\u003e b\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003e\\EndWhile\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\label\u003c/span\u003e{euclidendwhile}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003e\\State\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\Return\u003c/span\u003e \u003cspan class=\"built_in\"\u003e$\u003c/span\u003eb\u003cspan class=\"built_in\"\u003e$\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\Comment\u003c/span\u003e{The gcd is b}}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\EndProcedure\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{algorithmic}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{algorithm}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cimg data-src=\"/uploads/images/LaTeX/pseudo_euclid.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e干脆利落的代码，很好懂对吧。\u003ccode\u003e: )\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e这里，我们调用了 \u003ccode\u003ealgorithm\u003c/code\u003e 宏包，它提供了 \u003ccode\u003ealgorithm\u003c/code\u003e 环境。这是一个三线表样式的浮动体，浮动的策略和 LaTeX 标准的 \u003ccode\u003efigure\u003c/code\u003e、\u003ccode\u003etable\u003c/code\u003e 环境一致。\u003ccode\u003ealgpseudocode\u003c/code\u003e 宏包则是 \u003ccode\u003ealgorithmicx\u003c/code\u003e 宏包的一部分，它提供了实际用来排版伪代码的环境。\u003c/p\u003e\n\u003ch2 id=\"从一小段竖线开始改造\"\u003e\u003ca href=\"#从一小段竖线开始改造\" class=\"headerlink\" title=\"从一小段竖线开始改造\"\u003e\u003c/a\u003e从一小段竖线开始改造\u003c/h2\u003e\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e*{\u003cspan class=\"keyword\"\u003e\\algrule\u003c/span\u003e}[1][\u003cspan class=\"keyword\"\u003e\\algorithmicindent\u003c/span\u003e]{\u003cspan class=\"keyword\"\u003e\\makebox\u003c/span\u003e[\u003cspan class=\"params\"\u003e#1\u003c/span\u003e][l]{\u003cspan class=\"keyword\"\u003e\\hspace\u003c/span\u003e*{.1em}\u003cspan class=\"keyword\"\u003e\\vrule\u003c/span\u003e height \u003cspan class=\"keyword\"\u003e\\algrl@height\u003c/span\u003e depth \u003cspan class=\"keyword\"\u003e\\algrl@depth\u003c/span\u003e}}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e*{\u003cspan class=\"keyword\"\u003e\\algrl@height\u003c/span\u003e}{.75\u003cspan class=\"keyword\"\u003e\\baselineskip\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e*{\u003cspan class=\"keyword\"\u003e\\algrl@depth\u003c/span\u003e}{.25\u003cspan class=\"keyword\"\u003e\\baselineskip\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这一小段代码相对还是很好理解的。\u003c/p\u003e\n\u003cp\u003e主要命令 \u003ccode\u003e\\algrule\u003c/code\u003e 依赖两个长度：\u003ccode\u003e\\algrl@height\u003c/code\u003e 和 \u003ccode\u003e\\algrl@depth\u003c/code\u003e。如果你对 plainTeX 比较熟悉的话，那么显而易见，这两个长度分别是标尺 \u003ccode\u003e\\vrule\u003c/code\u003e 的高度和深度。\u003c/p\u003e\n\u003cp\u003e此外，\u003ccode\u003e\\algrule\u003c/code\u003e 还有一个默认参数 \u003ccode\u003e\\algorithmicindent\u003c/code\u003e。这是 \u003ccode\u003ealgorithmicx\u003c/code\u003e 宏包中定义的长度变量，用来保存每一个缩进块的缩进长度。这里我们将它作为默认参数传给内部的 \u003ccode\u003e\\makebox\u003c/code\u003e，\u003ccode\u003e\\makebox\u003c/code\u003e 制作了一个宽度为 \u003ccode\u003e\\algorithmicindent\u003c/code\u003e 的水平盒子，在靠左边的地方，画了一条高度为 \u003ccode\u003e\\algrl@height\u003c/code\u003e、深度为 \u003ccode\u003e\\algrl@depth\u003c/code\u003e 的标尺（一小节竖线）。\u003c/p\u003e\n\u003cp\u003e值得注意的是，\u003ccode\u003e\\algrl@height\u003c/code\u003e 和 \u003ccode\u003e\\algrl@depth\u003c/code\u003e 加起来正好是 \u003ccode\u003e\\baselineskip\u003c/code\u003e，也就是行距。这里我们将它们定义成宏，是为了方便后续调整每一节细线的具体高度。若不然，遇到超过 \u003ccode\u003e\\baselineskip\u003c/code\u003e 的情形（例如插入了一个庞大的数学公式），上下两行之间的竖线就会断开。\u003c/p\u003e\n\u003ch2 id=\"逐层打印当前行的提示线\"\u003e\u003ca href=\"#逐层打印当前行的提示线\" class=\"headerlink\" title=\"逐层打印当前行的提示线\"\u003e\u003c/a\u003e逐层打印当前行的提示线\u003c/h2\u003e\u003cp\u003e有了上面定义的竖线，我们就可以逐层打印某一行的提示线了。\u003c/p\u003e\n\u003cp\u003e在这里，我们不难总结：如果当前伪代码缩进了 $k$ 次，那么我们就需要画出 $k$ 个小竖线。为此，我们需要定义一个临时用的计数器，并构建一个以它为循环变量的 TeX 循环。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcount\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\ALG@printvrule@tempcnta\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\def\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\ALG@printvrule\u003c/span\u003e{\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\ifnum\u003c/span\u003e \u003cspan class=\"keyword\"\u003e\\theALG@nested\u003c/span\u003e\u0026gt;0\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\ifx\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\ALG@text\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\ALG@x@notext\u003c/span\u003e\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e% do nothing\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\else\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003e\\unskip\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003e\\addvspace\u003c/span\u003e{-1pt}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003e\\ALG@printvrule@tempcnta\u003c/span\u003e=1\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003e\\loop\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003e\\algrule\u003c/span\u003e[\u003cspan class=\"keyword\"\u003e\\csname\u003c/span\u003e ALG@ind@\u003cspan class=\"keyword\"\u003e\\the\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\ALG@printvrule@tempcnta\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\endcsname\u003c/span\u003e]\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003e\\advance\u003c/span\u003e \u003cspan class=\"keyword\"\u003e\\ALG@printvrule@tempcnta\u003c/span\u003e 1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003e\\ifnum\u003c/span\u003e \u003cspan class=\"keyword\"\u003e\\ALG@printvrule@tempcnta\u003c/span\u003e\u0026lt;\u003cspan class=\"keyword\"\u003e\\numexpr\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\theALG@nested\u003c/span\u003e+1\u003cspan class=\"keyword\"\u003e\\relax\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003e\\repeat\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\fi\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\fi\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e在这里，\u003ccode\u003e\\ALG@printvrule@tempcnta\u003c/code\u003e 是我们的循环变量，用来表征「即将打印的是第几级缩进」。\u003c/p\u003e\n\u003cp\u003e此外，由于 \u003ccode\u003e\\ALG@printvrule\u003c/code\u003e 会实际输出内容，因此要特别注意行末的换行符带来的额外空格。在有必要的地方，我们需要加上注释符号 \u003ccode\u003e%\u003c/code\u003e 抹掉这些空格。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\\theALG@nested\u003c/code\u003e 是 \u003ccode\u003ealgorithmicx\u003c/code\u003e 宏包的内部变量，用来保存当前行嵌套了多少层缩进。当它大于零时，我们就知道该干活了。我们主要关注循环部分。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e首先，我们将 \u003ccode\u003e\\ALG@printvrule@tempcnta\u003c/code\u003e 初始化为 \u003ccode\u003e1\u003c/code\u003e，因为我们总是从第一级缩进开始排版；\u003c/li\u003e\n\u003cli\u003e而后，我们进入循环，调用刚才定义的 \u003ccode\u003e\\algrule\u003c/code\u003e 命令；\u003c/li\u003e\n\u003cli\u003e此处，\u003ccode\u003e\\csname ALG@ind@\\the\\ALG@printvrule@tempcnta\\endcsname\u003c/code\u003e 将展开为形如 \u003ccode\u003e\\ALG@ind@1\u003c/code\u003e、``\\ALG@ind@2\u003ccode\u003e这样的变量，他们在\u003c/code\u003ealgorithmicx` 宏包里用来保存各级缩进的缩进深度；\u003c/li\u003e\n\u003cli\u003e调用 \u003ccode\u003e\\algrule\u003c/code\u003e 命令后，我们已经完成阶段性的工作，开始维护循环变量：通过 \u003ccode\u003e\\advance\u003c/code\u003e 将它自加 \u003ccode\u003e1\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003e最后的判断极好理解：我们必须确保循环变量不超过嵌套的层数。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"给-ALG-doentity-打补丁\"\u003e\u003ca href=\"#给-ALG-doentity-打补丁\" class=\"headerlink\" title=\"给 \\ALG@doentity 打补丁\"\u003e\u003c/a\u003e给 \u003ccode\u003e\\ALG@doentity\u003c/code\u003e 打补丁\u003c/h2\u003e\u003cp\u003e\u003ccode\u003e\\ALG@doentity\u003c/code\u003e 命令是 \u003ccode\u003ealgorithmicx\u003c/code\u003e 宏包内部用来输出每条算法实体（entity）的工具。在进行一系列判断、控制后，它将根据 \u003ccode\u003e\\theALG@nested\u003c/code\u003e 缩进恰当的距离，而后输出算法的具体内容。修改它需要用到 \u003ccode\u003eetoolbox\u003c/code\u003e 宏包的 \u003ccode\u003e\\patchcmd\u003c/code\u003e 命令，它能够在宏的展开中查找替换指定的内容。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\patchcmd\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\ALG@doentity\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    {\u003cspan class=\"keyword\"\u003e\\noindent\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\hskip\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\ALG@tlm\u003c/span\u003e}{\u003cspan class=\"keyword\"\u003e\\ALG@printvrule\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    {}{\u003cspan class=\"keyword\"\u003e\\errmessage\u003c/span\u003e{failed to patch}}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003ccode\u003e\\patchcmd\u003c/code\u003e 接收 5 个参数，分别表示：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e你想对哪个命令打补丁\u003c/li\u003e\n\u003cli\u003e你想替换啥\u003c/li\u003e\n\u003cli\u003e你想将它替换成啥\u003c/li\u003e\n\u003cli\u003e如果替换成功了咋办\u003c/li\u003e\n\u003cli\u003e如果替换失败了咋办\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e因此，这个补丁将会对 \u003ccode\u003e\\ALG@doentity\u003c/code\u003e 进行修改：将原本单纯的缩进输出，替换为我们自己定义的带提示线的缩进输出。\u003c/p\u003e\n\u003ch2 id=\"给-State-命令打补丁\"\u003e\u003ca href=\"#给-State-命令打补丁\" class=\"headerlink\" title=\"给 \\State 命令打补丁\"\u003e\u003c/a\u003e给 \u003ccode\u003e\\State\u003c/code\u003e 命令打补丁\u003c/h2\u003e\u003cp\u003e上面提到，在某些情况下，\u003ccode\u003e\\algrl@height\u003c/code\u003e 和 \u003ccode\u003e\\algrl@depth\u003c/code\u003e 定义的默认高度是不够的；而至今为止，我们还没有让它俩能够自动适应变化的行高。\u003ccode\u003e\\State\u003c/code\u003e 命令是 \u003ccode\u003ealgorithmicx\u003c/code\u003e 宏包中用来输出算法语句的命令，我们在它的基础上定义一个新的 \u003ccode\u003e\\vState\u003c/code\u003e 命令。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newbox\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\statebox\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\vState\u003c/span\u003e}[1]{\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\setbox\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\statebox\u003c/span\u003e=\u003cspan class=\"keyword\"\u003e\\vbox\u003c/span\u003e{\u003cspan class=\"params\"\u003e#1\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\edef\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\algrl@height\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\dimexpr\u003c/span\u003e \u003cspan class=\"keyword\"\u003e\\the\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\ht\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\statebox\u003c/span\u003e + 1pt\u003cspan class=\"keyword\"\u003e\\relax\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\edef\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\algrl@depth\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\dimexpr\u003c/span\u003e \u003cspan class=\"keyword\"\u003e\\the\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\dp\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\statebox\u003c/span\u003e + 1pt\u003cspan class=\"keyword\"\u003e\\relax\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\ifdim\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\algrl@height\u003c/span\u003e \u0026lt; .75\u003cspan class=\"keyword\"\u003e\\baselineskip\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\def\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\algrl@height\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\dimexpr\u003c/span\u003e .75\u003cspan class=\"keyword\"\u003e\\baselineskip\u003c/span\u003e + 1pt\u003cspan class=\"keyword\"\u003e\\relax\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\fi\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\ifdim\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\algrl@depth\u003c/span\u003e \u0026lt; .25\u003cspan class=\"keyword\"\u003e\\baselineskip\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\def\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\algrl@depth\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\dimexpr\u003c/span\u003e .25\u003cspan class=\"keyword\"\u003e\\baselineskip\u003c/span\u003e + 1pt\u003cspan class=\"keyword\"\u003e\\relax\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\fi\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\State\u003c/span\u003e \u003cspan class=\"params\"\u003e#1\u003c/span\u003e\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\def\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\algrl@height\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\dimexpr\u003c/span\u003e .75\u003cspan class=\"keyword\"\u003e\\baselineskip\u003c/span\u003e + 1pt\u003cspan class=\"keyword\"\u003e\\relax\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\def\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\algrl@depth\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\dimexpr\u003c/span\u003e .25\u003cspan class=\"keyword\"\u003e\\baselineskip\u003c/span\u003e + 1pt\u003cspan class=\"keyword\"\u003e\\relax\u003c/span\u003e}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里，我们将 \u003ccode\u003e\\vState\u003c/code\u003e 的参数读入一个竖直盒子中，然后将 \u003ccode\u003e\\algrl@height\u003c/code\u003e 和 \u003ccode\u003e\\algrl@depth\u003c/code\u003e 分别设置为盒子的高度和深度。同时，为了保险，还用 \u003ccode\u003e\\ifdim\u003c/code\u003e 对它俩的值做了判断，确保二者相加不会小于 \u003ccode\u003e\\baselineskip\u003c/code\u003e。在调用原始的 \u003ccode\u003e\\State\u003c/code\u003e 命令输出后，我们又将二者的定义还原回去。此处用到了大量的 \u003ccode\u003e\\dimexpr ... \\relax\u003c/code\u003e 表达式，这是 eTeX 中用来做长度计算的语句。\u003c/p\u003e\n\u003ch2 id=\"实际运行看看\"\u003e\u003ca href=\"#实际运行看看\" class=\"headerlink\" title=\"实际运行看看\"\u003e\u003c/a\u003e实际运行看看\u003c/h2\u003e\u003cp\u003e将上述补丁组合在一起，就能得到我们期待的效果了。\u003c/p\u003e\n\u003cp\u003e\u003cimg data-src=\"/uploads/images/LaTeX/pseudo_euclid_vline.png\"/\u003e\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2016-06-10T14:14:27Z",
  "Author": "Liam Huang"
}