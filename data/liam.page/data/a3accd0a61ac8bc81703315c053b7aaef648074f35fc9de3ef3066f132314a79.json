{
  "Source": "liam.page",
  "Title": "【LaTeX Tips】复制代码时避免复制行号的正确方法",
  "Link": "https://liam.page/2013/11/04/LaTeX-listings-copy/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003ch2 id=\"问题的描述\"\u003e\u003ca href=\"#问题的描述\" class=\"headerlink\" title=\"问题的描述\"\u003e\u003c/a\u003e问题的描述\u003c/h2\u003e\u003cp\u003e用 listings 包排版源代码时通常为了便于说明，会显示代码的行号，但是，我们在文档复制的时候却发现，复制代码的时候，同时会把行号也复制出来了，如下：\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e\u003cimg data-src=\"//liam.page/attachment/attachment/images/listingsCopy/wrong.png\"/\u003e\u003c/p\u003e\n\u003cp\u003e我们想实现如下的复制，更便于读者提取文档中的源代码进行相关测试。\u003c/p\u003e\n\u003cp\u003e\u003cimg data-src=\"//liam.page/attachment/attachment/images/listingsCopy/right.png\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"一次尝试\"\u003e\u003ca href=\"#一次尝试\" class=\"headerlink\" title=\"一次尝试\"\u003e\u003c/a\u003e一次尝试\u003c/h2\u003e\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.latexstudio.net/\"\u003eLaTeX studio\u003c/a\u003e 提供了一个\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.latexstudio.net/latex-tip-743-how-to-make-text-copy-in-pdf-previewers-ignore-lineno-line-numbers/\"\u003e解决方案\u003c/a\u003e。但是该方案是有问题的，因为 \\thelstnumber 在很多地方都要用到，所以直接重定义这个宏是很危险的——比如，无法和 hyperref 宏包一起使用。下面的测试代码说明了这个问题：\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{minimal}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{hyperref}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{listings}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{accsupp}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\renewcommand\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\thelstnumber\u003c/span\u003e}{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\protect\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\BeginAccSupp\u003c/span\u003e{ActualText={}}\u003cspan class=\"keyword\"\u003e\\arabic\u003c/span\u003e{lstnumber}\u003cspan class=\"keyword\"\u003e\\protect\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\EndAccSupp\u003c/span\u003e{}\u003cspan class=\"comment\"\u003e%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\lstset\u003c/span\u003e{numbers = left}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{lstlisting}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{lstlisting}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"最终的解决\"\u003e\u003ca href=\"#最终的解决\" class=\"headerlink\" title=\"最终的解决\"\u003e\u003c/a\u003e最终的解决\u003c/h2\u003e\u003cp\u003e更健壮的办法，可以定义一个新的命令，然后用 listings 宏包的 numberstyle 选项来加载这一命令，如下\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\documentclass\u003c/span\u003e{minimal}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{hyperref}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{listings}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\usepackage\u003c/span\u003e{accsupp}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\newcommand\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\emptyaccsupp\u003c/span\u003e[1]{\u003cspan class=\"keyword\"\u003e\\BeginAccSupp\u003c/span\u003e{ActualText={}}\u003cspan class=\"params\"\u003e#1\u003c/span\u003e\u003cspan class=\"keyword\"\u003e\\EndAccSupp\u003c/span\u003e{}}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\lstset\u003c/span\u003e{numbers = left, numberstyle=\u003cspan class=\"keyword\"\u003e\\emptyaccsupp\u003c/span\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\begin\u003c/span\u003e{lstlisting}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\foo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{lstlisting}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\end\u003c/span\u003e{document}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n    \u003c/div\u003e",
  "Date": "2013-11-03T16:00:00Z",
  "Author": "Liam Huang"
}