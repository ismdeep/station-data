{
  "Source": "liam.page",
  "Title": "在 Shell 脚本中解析选项",
  "Link": "https://liam.page/2016/11/11/ways-to-parse-arguments-in-shell-script/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e大多数命令行工具，都会提供一些选项。在不同的选项组合之下，这些工具会有不同的行为。GNU 标准的命令行选项解析工具是 \u003ccode\u003egetopts\u003c/code\u003e，它比其兄弟 \u003ccode\u003egetopt\u003c/code\u003e 更为强大。除了介绍 \u003ccode\u003egetopts\u003c/code\u003e 的用法之外，这里还会介绍两种手工解析参数的方法。\u003c/p\u003e\n\u003cp\u003e在正式介绍之前，有必要区分几个概念（在 Shell 脚本中）。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eArgument, Option: 中文对应「选项」，形如 \u003ccode\u003e-a\u003c/code\u003e, \u003ccode\u003e--save\u003c/code\u003e 的都是选项；选项可以接收参数（Parameter），也可以不接受参数。\u003c/li\u003e\n\u003cli\u003eFlag: 中文对应「标签」，形如 \u003ccode\u003e-v\u003c/code\u003e(verbose)；标签是布尔值，不接受参数。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e下面正式开始介绍。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"手工解析\"\u003e\u003ca href=\"#手工解析\" class=\"headerlink\" title=\"手工解析\"\u003e\u003c/a\u003e手工解析\u003c/h2\u003e\u003cp\u003e手工解析部分比较简单，这里不做过多的展开。涉及到参数截取的内容，可以参考\u003ca href=\"/2016/11/08/Shell-variable-reference-and-string-cut-off/\"\u003e前作\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e手工解析部分提供两种传参的方式：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e形如 \u003ccode\u003e--save foo.txt\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003e形如 \u003ccode\u003e--save=foo.txt\u003c/code\u003e。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003cfigcaption\u003e\u003cspan\u003espace_mode.sh\u003c/span\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#!/usr/bin/env bash\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e [[ \u003cspan class=\"variable\"\u003e$#\u003c/span\u003e -gt 1 ]]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ekey=\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e$1\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"variable\"\u003e$key\u003c/span\u003e \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    -e|--extension)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    EXTENSION=\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e$2\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eshift\u003c/span\u003e \u003cspan class=\"comment\"\u003e# past argument\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    -s|--searchpath)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    SEARCHPATH=\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e$2\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eshift\u003c/span\u003e \u003cspan class=\"comment\"\u003e# past argument\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    -l|--lib)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    LIBPATH=\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e$2\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eshift\u003c/span\u003e \u003cspan class=\"comment\"\u003e# past argument\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    --default)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    DEFAULT=YES\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    *)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e# unknown option\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eesac\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eshift\u003c/span\u003e \u003cspan class=\"comment\"\u003e# past argument or value\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e FILE EXTENSION  = \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${EXTENSION}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e SEARCH PATH     = \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${SEARCHPATH}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e LIBRARY PATH    = \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${LIBPATH}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Number files in SEARCH PATH with EXTENSION:\u0026#34;\u003c/span\u003e $(\u003cspan class=\"built_in\"\u003els\u003c/span\u003e -1 \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${SEARCHPATH}\u003c/span\u003e\u0026#34;\u003c/span\u003e/*.\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${EXTENSION}\u003c/span\u003e\u0026#34;\u003c/span\u003e | \u003cspan class=\"built_in\"\u003ewc\u003c/span\u003e -l)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e [[ -n \u003cspan class=\"variable\"\u003e$1\u003c/span\u003e ]]; \u003cspan class=\"keyword\"\u003ethen\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Last line of file specified as non-opt/last argument:\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003etail\u003c/span\u003e -1 \u003cspan class=\"variable\"\u003e$1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cfigure class=\"highlight bash\"\u003e\u003cfigcaption\u003e\u003cspan\u003eequal_sign_mode.sh\u003c/span\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#!/usr/bin/env bash\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e$@\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"variable\"\u003e$i\u003c/span\u003e \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    -e=*|--extension=*)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    EXTENSION=\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${i#*=}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eshift\u003c/span\u003e \u003cspan class=\"comment\"\u003e# past argument=value\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    -s=*|--searchpath=*)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    SEARCHPATH=\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${i#*=}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eshift\u003c/span\u003e \u003cspan class=\"comment\"\u003e# past argument=value\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    -l=*|--lib=*)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    LIBPATH=\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${i#*=}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eshift\u003c/span\u003e \u003cspan class=\"comment\"\u003e# past argument=value\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    --default)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    DEFAULT=YES\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eshift\u003c/span\u003e \u003cspan class=\"comment\"\u003e# past argument with no value\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    *)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"comment\"\u003e# unknown option\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eesac\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;FILE EXTENSION  = \u003cspan class=\"variable\"\u003e${EXTENSION}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;SEARCH PATH     = \u003cspan class=\"variable\"\u003e${SEARCHPATH}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;LIBRARY PATH    = \u003cspan class=\"variable\"\u003e${LIBPATH}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Number files in SEARCH PATH with EXTENSION:\u0026#34;\u003c/span\u003e $(\u003cspan class=\"built_in\"\u003els\u003c/span\u003e -1 \u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${SEARCHPATH}\u003c/span\u003e\u0026#34;\u003c/span\u003e/*.\u003cspan class=\"string\"\u003e\u0026#34;\u003cspan class=\"variable\"\u003e${EXTENSION}\u003c/span\u003e\u0026#34;\u003c/span\u003e | \u003cspan class=\"built_in\"\u003ewc\u003c/span\u003e -l)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e [[ -n \u003cspan class=\"variable\"\u003e$1\u003c/span\u003e ]]; \u003cspan class=\"keyword\"\u003ethen\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Last line of file specified as non-opt/last argument:\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003etail\u003c/span\u003e -1 \u003cspan class=\"variable\"\u003e$1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"getopts-的用法\"\u003e\u003ca href=\"#getopts-的用法\" class=\"headerlink\" title=\"getopts 的用法\"\u003e\u003c/a\u003e\u003ccode\u003egetopts\u003c/code\u003e 的用法\u003c/h2\u003e\u003cp\u003e\u003ccode\u003egetopts\u003c/code\u003e 是成熟的选项解析工具，因此功能相对手工解析来说自然是更加完备和强大。我们先来看看使用 \u003ccode\u003egetopts\u003c/code\u003e 解析选项的脚本的一个用法示例。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emybackup -x -f /etc/mybackup.conf ./foo.txt ./bar.txt\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里，\u003ccode\u003emybackup\u003c/code\u003e 是一个 Shell 脚本，它接收了几个选项：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-x\u003c/code\u003e，这是一个标签，由 \u003ccode\u003e-\u003c/code\u003e 和标签名字 \u003ccode\u003ex\u003c/code\u003e 组成；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-f\u003c/code\u003e，这是一个选项，它的参数是 \u003ccode\u003e/etc/mybackup.conf\u003c/code\u003e；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e./foo.txt\u003c/code\u003e 和 \u003ccode\u003e./bar.txt\u003c/code\u003e 则是余下的参数，他们作为操作数 (operands) 传递给脚本。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e使用 \u003ccode\u003egetopts\u003c/code\u003e 的话，这个调用方法等价于\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emybackup -xf /etc/mybackup.conf ./foo.txt ./bar.txt\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"getopts-的工作方式\"\u003e\u003ca href=\"#getopts-的工作方式\" class=\"headerlink\" title=\"getopts 的工作方式\"\u003e\u003c/a\u003e\u003ccode\u003egetopts\u003c/code\u003e 的工作方式\u003c/h3\u003e\u003cp\u003e通常来说，我们会将 \u003ccode\u003egetopts\u003c/code\u003e 放在 \u003ccode\u003ewhile\u003c/code\u003e 循环的条件判断式中。\u003ccode\u003egetopts\u003c/code\u003e 在顺利解析到参数的时候，会返回 \u003ccode\u003eTRUE\u003c/code\u003e；否则返回 \u003ccode\u003eFALSE\u003c/code\u003e，用以结束循环。（类似 C++ 中 \u003ccode\u003ewhile (cin \u0026gt;\u0026gt; var)\u003c/code\u003e 的用法）\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003egetopts\u003c/code\u003e 在两种情况下会停止解析并返回 \u003ccode\u003eFALSE\u003c/code\u003e：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003egetopts\u003c/code\u003e 读入不以 \u003ccode\u003e-\u003c/code\u003e 开始的字符串；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003egetopts\u003c/code\u003e 读入连续的两个 \u003ccode\u003e-\u003c/code\u003e (i.e. \u003ccode\u003e--\u003c/code\u003e)。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意：\u003ccode\u003egetopts\u003c/code\u003e 不支持两个连字符引导的选项，而是将两个连续的连字符作为「选项结束的标志」。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"built_in\"\u003egetopts\u003c/span\u003e ...; \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"变量和用法\"\u003e\u003ca href=\"#变量和用法\" class=\"headerlink\" title=\"变量和用法\"\u003e\u003c/a\u003e变量和用法\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eOPTIND\u003c/code\u003e: \u003ccode\u003egetopts\u003c/code\u003e 在解析传入 Shell 脚本的参数时（也就是 \u003ccode\u003e#@\u003c/code\u003e），并不会执行 \u003ccode\u003eshift\u003c/code\u003e 操作，而是通过变量 \u003ccode\u003eOPTIND\u003c/code\u003e 来记住\u003cstrong\u003e接下来要解析的参数的位置\u003c/strong\u003e。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eOPTARG\u003c/code\u003e: \u003ccode\u003egetopts\u003c/code\u003e 在解析到选项的参数时，就会将参数保存在 \u003ccode\u003eOPTARG\u003c/code\u003e 变量当中；如果 \u003ccode\u003egetopts\u003c/code\u003e 遇到不合法的选项，择把选项本身保存在 \u003ccode\u003eOPTARG\u003c/code\u003e 当中。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003egetopts\u003c/code\u003e 的用法如下\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003egetopts\u003c/span\u003e OPTSTRING VARNAME [ARGS...]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eOPTSTRING\u003c/code\u003e 记录合法的选项列表（以及参数情况）；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eVARNAME\u003c/code\u003e 则传入一个 Shell 变量的名字，用于保存 \u003ccode\u003egetopts\u003c/code\u003e 解析到的选项的名字（而不是参数值，参数值保存在 \u003ccode\u003eOPTARG\u003c/code\u003e 里）；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eATGS...\u003c/code\u003e 是可选的，默认是 \u003ccode\u003e$@\u003c/code\u003e，即传入 Shell 脚本的全部参数。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"OPTSTRING\"\u003e\u003ca href=\"#OPTSTRING\" class=\"headerlink\" title=\"OPTSTRING\"\u003e\u003c/a\u003e\u003ccode\u003eOPTSTRING\u003c/code\u003e\u003c/h3\u003e\u003cp\u003e通过 \u003ccode\u003eOPTSTRING\u003c/code\u003e，我们可以告诉 \u003ccode\u003egetopts\u003c/code\u003e 哪些参数是合法的，哪些参数又是需要接受参数的。\u003ccode\u003eOPTSTRING\u003c/code\u003e 的格式很简单，就是一个简单的字符串。字符串里，每一个字母（大小写均可，但区分大小写）都是一个选项的名字。\u003c/p\u003e\n\u003cp\u003e值得一提的是冒号 (\u003ccode\u003e:\u003c/code\u003e)。在 \u003ccode\u003eOPTSTRING\u003c/code\u003e 中，冒号有两种含义：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e首位的 \u003ccode\u003e:\u003c/code\u003e 表示「不打印错误信息」；\u003c/li\u003e\n\u003cli\u003e紧邻字母（选项名字）的 \u003ccode\u003e:\u003c/code\u003e 表示该选项接收一个参数。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e举几个例子。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003egetopts\u003c/span\u003e fAx VARNAME\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e表示 \u003ccode\u003egetopts\u003c/code\u003e 会寻找 \u003ccode\u003e-f\u003c/code\u003e, \u003ccode\u003e-A\u003c/code\u003e 和 \u003ccode\u003e-x\u003c/code\u003e 三个选项。它们都是标签，不接受参数。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003egetopts\u003c/span\u003e :f:Ax VARNAME\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e表示 \u003ccode\u003egetopts\u003c/code\u003e 会寻找 \u003ccode\u003e-f\u003c/code\u003e, \u003ccode\u003e-A\u003c/code\u003e 和 \u003ccode\u003e-x\u003c/code\u003e 三个选项，并且不打印错误信息。其中 \u003ccode\u003e-A\u003c/code\u003e 和 \u003ccode\u003e-x\u003c/code\u003e 是标签，不接受参数；\u003ccode\u003e-f\u003c/code\u003e 是可以接受参数的选项。\u003c/p\u003e\n\u003ch3 id=\"举个栗子\"\u003e\u003ca href=\"#举个栗子\" class=\"headerlink\" title=\"举个栗子\"\u003e\u003c/a\u003e举个栗子\u003c/h3\u003e\u003cfigure class=\"highlight bash\"\u003e\u003cfigcaption\u003e\u003cspan\u003egetopts_test.sh\u003c/span\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#!/usr/bin/env bash\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"built_in\"\u003egetopts\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;:a\u0026#34;\u003c/span\u003e opt; \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"variable\"\u003e$opt\u003c/span\u003e \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    a)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;-a was triggered!\u0026#34;\u003c/span\u003e \u0026gt;\u0026amp;2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \\?)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Invalid option: -\u003cspan class=\"variable\"\u003e$OPTARG\u003c/span\u003e\u0026#34;\u003c/span\u003e \u0026gt;\u0026amp;2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eesac\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e首先给一点解释。\u003c/p\u003e\n\u003cp\u003e我们首先看 \u003ccode\u003egetopts\u003c/code\u003e 的 \u003ccode\u003eOPTSTRING\u003c/code\u003e 部分：\u003ccode\u003e:a\u003c/code\u003e。按照上面的介绍，我们知道，\u003ccode\u003egetopts\u003c/code\u003e 将不会打印错误信息，并且会寻找 \u003ccode\u003e-a\u003c/code\u003e 这个选项。而后，\u003ccode\u003eVARNAME\u003c/code\u003e 是 \u003ccode\u003eopt\u003c/code\u003e。这就是说，\u003ccode\u003egetopts\u003c/code\u003e 会将找到的选项的名字（例如 \u003ccode\u003ea\u003c/code\u003e）存在 \u003ccode\u003eopt\u003c/code\u003e 这个 Shell 变量当中。在后续的处理过程中，我们可以引用它。\u003c/p\u003e\n\u003cp\u003e将上述内容保存为 \u003ccode\u003egetopts_test.sh\u003c/code\u003e，然后就可以验证了。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e啥也不做\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ ./getopts_test.sh\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003ccode\u003egetopts\u003c/code\u003e 解析的内容是 \u003ccode\u003e$@\u003c/code\u003e，在这个例子里是空。于是 \u003ccode\u003egetopts\u003c/code\u003e 返回 \u003ccode\u003eFALSE\u003c/code\u003e 结束循环。整个脚本什么也不做。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e传入不是选项的参数\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ ./getopts_test.sh foo.txt\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这次 \u003ccode\u003e$@\u003c/code\u003e 有东西了。但是 \u003ccode\u003efoo.txt\u003c/code\u003e 不以连字符 \u003ccode\u003e-\u003c/code\u003e 开始，所以 \u003ccode\u003egetopts\u003c/code\u003e 仍然返回 \u003ccode\u003eFALSE\u003c/code\u003e，结束循环。整个脚本什么也不做。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e传入参数\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ ./getopts_test.sh -a\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-a was triggered!\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e如约打印了「标签 \u003ccode\u003ea\u003c/code\u003e 激活了」的字样。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ ./go_test.sh -a -x -b -c\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-a was triggered!\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eInvalid option: -x\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eInvalid option: -b\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eInvalid option: -c\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e注意，这里传入的 \u003ccode\u003e-x\u003c/code\u003e, \u003ccode\u003e-b\u003c/code\u003e 和 \u003ccode\u003e-c\u003c/code\u003e 都是不合法的选项，于是 \u003ccode\u003egetopts\u003c/code\u003e 将 \u003ccode\u003e?\u003c/code\u003e 存入 \u003ccode\u003e$opt\u003c/code\u003e，而将非法的选项名字 \u003ccode\u003ex\u003c/code\u003e, \u003ccode\u003eb\u003c/code\u003e 和 \u003ccode\u003ec\u003c/code\u003e 保存在 \u003ccode\u003e$OPTARG\u003c/code\u003e 当中；进而被 \u003ccode\u003ecase\u003c/code\u003e 语句抓住，并打印相关内容。\u003c/p\u003e\n\u003ch3 id=\"又一个栗子\"\u003e\u003ca href=\"#又一个栗子\" class=\"headerlink\" title=\"又一个栗子\"\u003e\u003c/a\u003e又一个栗子\u003c/h3\u003e\u003cfigure class=\"highlight bash\"\u003e\u003cfigcaption\u003e\u003cspan\u003eanother_test.sh\u003c/span\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#!/usr/bin/env bash\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"built_in\"\u003egetopts\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;:a:\u0026#34;\u003c/span\u003e opt; \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"variable\"\u003e$opt\u003c/span\u003e \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    a)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;-a was triggered, Parameter: \u003cspan class=\"variable\"\u003e$OPTARG\u003c/span\u003e\u0026#34;\u003c/span\u003e \u0026gt;\u0026amp;2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \\?)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Invalid option: -\u003cspan class=\"variable\"\u003e$OPTARG\u003c/span\u003e\u0026#34;\u003c/span\u003e \u0026gt;\u0026amp;2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"built_in\"\u003eexit\u003c/span\u003e 1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    :)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Option -\u003cspan class=\"variable\"\u003e$OPTARG\u003c/span\u003e requires an argument.\u0026#34;\u003c/span\u003e \u0026gt;\u0026amp;2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"built_in\"\u003eexit\u003c/span\u003e 1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      ;;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eesac\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e参照之前的例子和已有的解释，不难理解这个脚本会有怎样的行为。除去和上一个例子相同的测试之外，我们看看下面两个测试。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e合法选项、缺少参数\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ ./another_test.sh -a\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eOption -a requires an argument.\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e在遇到 \u003ccode\u003e:\u003c/code\u003e 时，\u003ccode\u003egetopts\u003c/code\u003e 尝试解析一个参数却失败了。此时，\u003ccode\u003egetopts\u003c/code\u003e 将 \u003ccode\u003e:\u003c/code\u003e 保存在 \u003ccode\u003e$opt\u003c/code\u003e 当中，而后将参数名（这里是 \u003ccode\u003ea\u003c/code\u003e）保存在 \u003ccode\u003e$OPTARG\u003c/code\u003e 当中。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e合法选项和参数\u003c/strong\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ ./another_test.sh -a /etc/passwd\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-a was triggered, Parameter: /etc/passwd\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003ch3 id=\"一点黑魔法：-的妙用\"\u003e\u003ca href=\"#一点黑魔法：-的妙用\" class=\"headerlink\" title=\"一点黑魔法：-- 的妙用\"\u003e\u003c/a\u003e一点黑魔法：\u003ccode\u003e--\u003c/code\u003e 的妙用\u003c/h3\u003e\u003cp\u003e*nix 中，\u003ccode\u003els\u003c/code\u003e 命令是用来列出当前目录下的文件和子目录的。它可以接受一些选项（如 \u003ccode\u003e-lrt\u003c/code\u003e）。现在的问题是，如果有一个文件，它的名字叫做 \u003ccode\u003e-foobar\u003c/code\u003e，要怎样才能列出它的相关信息呢？\u003c/p\u003e\n\u003cp\u003e实际上 \u003ccode\u003els\u003c/code\u003e 内部使用了 \u003ccode\u003egetopts\u003c/code\u003e 解析参数。于是我们可以这样\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003els\u003c/span\u003e -lrt -- -foobar\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e利用两个连续的连字符 \u003ccode\u003e--\u003c/code\u003e，显式地告诉 \u003ccode\u003egetopts\u003c/code\u003e：到这为止！然后，\u003ccode\u003els\u003c/code\u003e 会读入 \u003ccode\u003e-foobar\u003c/code\u003e 作为文件名，显示它的相关信息。\u003c/p\u003e\n\u003ch2 id=\"参考文献\"\u003e\u003ca href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"\u003e\u003c/a\u003e参考文献\u003c/h2\u003e\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://stackoverflow.com/a/14203146/3419508\"\u003ehttp://stackoverflow.com/a/14203146/3419508\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://wiki.bash-hackers.org/dict/terms/end_of_options\"\u003ehttp://wiki.bash-hackers.org/dict/terms/end_of_options\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n    \u003c/div\u003e",
  "Date": "2016-11-11T15:23:28Z",
  "Author": "Liam Huang"
}