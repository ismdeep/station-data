{
  "Source": "liam.page",
  "Title": "在 Homebrew 上发布自己的 App",
  "Link": "https://liam.page/2016/07/30/release-your-own-app-in-Homebrew/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://brew.sh/\"\u003eHomebrew\u003c/a\u003e 是最初由 Max Howell 用 Ruby 写的 OS X 软件管理系统，其代码开源在 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/Homebrew/brew/\"\u003eGitHub\u003c/a\u003e 上。\u003c/p\u003e\n\u003cp\u003eHomebrew 给自己贴了个一句话简介：The missing package manager for OS X。翻译过来成中文就是：寻它千百度的软件包管理器。名副其实地是，Homebrew 真的很好用。安装、升级、卸载等操作，在 Homebrew 的生态下，都只需要一条命令就可以了。并且 Homebrew 会自动为你解决软件包的依赖问题。\u003c/p\u003e\n\u003cp\u003e近日，\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://typeof.net/\"\u003eBelleve\u003c/a\u003e 邀请我协助他维护 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/caryll/otfcc\"\u003e\u003ccode\u003eotfcc\u003c/code\u003e\u003c/a\u003e 在 OS X 上的预编译版本，并请我为之发布 Homebrew 的软件包。以下是对发布 Homebrew 软件包的总结。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"显而易见的对比\"\u003e\u003ca href=\"#显而易见的对比\" class=\"headerlink\" title=\"显而易见的对比\"\u003e\u003c/a\u003e显而易见的对比\u003c/h2\u003e\u003cp\u003e\u003ccode\u003eotfcc\u003c/code\u003e 现在已经有了预编译好的 Mac 版本。对于用户来说，只需要执行\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ewget https://github.com/caryll/otfcc/releases/download/v0.2.3/otfcc-mac64-0.2.3.tar.xz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003etar Jvxf otfcc-mac64-0.2.3.tar.xz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esudo \u003cspan class=\"built_in\"\u003emv\u003c/span\u003e otfcc* /usr/local/bin\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e好吧，那个「只」字，我应该加上引号表示夸张的。现在看看有了 Homebrew 包我们可以怎样做\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ebrew tap caryll/tap \u0026amp;\u0026amp; brew install otfcc-mac64\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e对比确实是显而易见的，不是吗？使用 \u003ccode\u003ebrew\u003c/code\u003e 安装，只需要执行命令。剩下的东西，只需要交给 Homebrew 去处理就好了。\u003c/p\u003e\n\u003ch2 id=\"基本概念\"\u003e\u003ca href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"\u003e\u003c/a\u003e基本概念\u003c/h2\u003e\u003cp\u003e在 Homebrew 的架构下，至少有 4 层概念\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eKeg（酒桶）：安装好的脚本、软件等；\u003c/li\u003e\n\u003cli\u003eCellar（酒窖）：所有用 Homebrew 安装在本地的脚本、软件组成的集合；\u003c/li\u003e\n\u003cli\u003eFormula（配方）：定义如何下载、编译和安装脚本或软件的 Ruby 脚本；\u003c/li\u003e\n\u003cli\u003eTap：一个包含若干 Formula 的 GitHub 专案。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我们平时使用 \u003ccode\u003ebrew install foobar\u003c/code\u003e 安装软件时，实际上是从 \u003ccode\u003eHomebrew/homebrew-core\u003c/code\u003e 这个 Tap 中获取相应的 Formula，然后将 Keg 安装在 Cellar 中。现在的问题是，\u003ccode\u003eHomebrew/homebrew-core\u003c/code\u003e \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/Homebrew/brew/blob/master/share/doc/homebrew/Acceptable-Formulae.md\"\u003e不允许普通用户提交自己写的小众脚本、软件\u003c/a\u003e。所以，我们需要建立一个新的 Tap（GitHub 专案），包含对应我们软件的 Formula，然后将 Keg 放入本地的 Cellar 中。\u003c/p\u003e\n\u003cp\u003e于是我们知道，我们要做的事情是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e理顺安装程序的步骤；\u003c/li\u003e\n\u003cli\u003e创建一个 Formula，将上述步骤用 Ruby 表述出来；\u003c/li\u003e\n\u003cli\u003e创建一个 GitHub 专案，将上述 Formula 纳于该专案的版本控制之下。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"创建-Homebrew-Package-并安装\"\u003e\u003ca href=\"#创建-Homebrew-Package-并安装\" class=\"headerlink\" title=\"创建 Homebrew Package 并安装\"\u003e\u003c/a\u003e创建 Homebrew Package 并安装\u003c/h2\u003e\u003cp\u003eHomebrew 提供了一个\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/Homebrew/brew/blob/master/share/doc/homebrew/Formula-Cookbook.md\"\u003e官方指南\u003c/a\u003e。不过，这个指南写得比较晦涩难懂。所以，我另起炉灶，按照更容易理解的方式介绍一下创建 Homebrew\u003c/p\u003e\n\u003ch3 id=\"理顺步骤\"\u003e\u003ca href=\"#理顺步骤\" class=\"headerlink\" title=\"理顺步骤\"\u003e\u003c/a\u003e理顺步骤\u003c/h3\u003e\u003cp\u003e第一节中，我们已经看到手工安装 \u003ccode\u003eotfcc\u003c/code\u003e 的操作步骤。其中第一步是下载，这一步在执行 \u003ccode\u003ebrew install\u003c/code\u003e 时，Homebrew 会根据 Formula 的指示完成。第二步是解包，这一步 Homebrew 也会为我们自动完成。因此，实际我们要做的，就是将二进制文件放到 \u003ccode\u003e/usr/local/bin\u003c/code\u003e 目录下。\u003c/p\u003e\n\u003ch3 id=\"创建-Formula\"\u003e\u003ca href=\"#创建-Formula\" class=\"headerlink\" title=\"创建 Formula\"\u003e\u003c/a\u003e创建 Formula\u003c/h3\u003e\u003cp\u003e假设我们的软件已经有了一个发布版本，并且可供下载，比如 \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/caryll/otfcc/releases/download/v0.2.3/otfcc-mac64-0.2.3.tar.xz\"\u003ehttps://github.com/caryll/otfcc/releases/download/v0.2.3/otfcc-mac64-0.2.3.tar.xz\u003c/a\u003e。接下来，我们在终端里执行\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ebrew create https://github.com/caryll/otfcc/releases/download/v0.2.3/otfcc-mac64-0.2.3.tar.xz\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这条命令会在 \u003ccode\u003e/usr/local/Library/Formula/\u003c/code\u003e 下创建一个 \u003ccode\u003e.rb\u003c/code\u003e 文件，其文件名取决于传给 \u003ccode\u003ebrew create\u003c/code\u003e 的 URL。比如，我们这里会创建 \u003ccode\u003e/usr/local/Library/Formula/otfcc-mac64.rb\u003c/code\u003e。\u003c/p\u003e\n\u003cfigure class=\"highlight ruby\"\u003e\u003cfigcaption\u003e\u003cspan\u003eotfcc-mac64.rb\u003c/span\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# Documentation: https://github.com/Homebrew/brew/blob/master/share/doc/homebrew/Formula-Cookbook.md\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#                http://www.rubydoc.info/github/Homebrew/brew/master/Formula\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# PLEASE REMOVE ALL GENERATED COMMENTS BEFORE SUBMITTING YOUR PULL REQUEST!\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eOtfccMac64\u003c/span\u003e \u0026lt; \u003cspan class=\"title class_ inherited__\"\u003eFormula\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  desc \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  homepage \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  url \u003cspan class=\"string\"\u003e\u0026#34;https://github.com/caryll/otfcc/releases/download/v0.2.3/otfcc-mac64-0.2.3.tar.xz\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  version \u003cspan class=\"string\"\u003e\u0026#34;0.2.3\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  sha256 \u003cspan class=\"string\"\u003e\u0026#34;f393b14f9c42c890b8a60949b13a8f9b5c3f814daa8b18901656ccc3b866f646\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e# depends_on \u0026#34;cmake\u0026#34; =\u0026gt; :build\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  depends_on \u003cspan class=\"symbol\"\u003e:x11\u003c/span\u003e \u003cspan class=\"comment\"\u003e# if your formula requires any X11/XQuartz components\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003einstall\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# ENV.deparallelize  # if your formula fails when building in parallel\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# Remove unrecognized options if warned by configure\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    system \u003cspan class=\"string\"\u003e\u0026#34;./configure\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;--disable-debug\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                          \u003cspan class=\"string\"\u003e\u0026#34;--disable-dependency-tracking\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                          \u003cspan class=\"string\"\u003e\u0026#34;--disable-silent-rules\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                          \u003cspan class=\"string\"\u003e\u0026#34;--prefix=\u003cspan class=\"subst\"\u003e#{prefix}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# system \u0026#34;cmake\u0026#34;, \u0026#34;.\u0026#34;, *std_cmake_args\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    system \u003cspan class=\"string\"\u003e\u0026#34;make\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;install\u0026#34;\u003c/span\u003e \u003cspan class=\"comment\"\u003e# if this fails, try separate make/make install steps\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  test \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# `test do` will create, run in and delete a temporary directory.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e#\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# This test will fail and we won\u0026#39;t accept that! It\u0026#39;s enough to just replace\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# \u0026#34;false\u0026#34; with the main program this formula installs, but it\u0026#39;d be nice if you\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# were more thorough. Run the test with `brew test otfcc-win32`. Options passed\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# to `brew install` such as `--HEAD` also need to be provided to `brew test`.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e#\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# The installed folder is not in the path, so use the entire path to any\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# executables being tested: `system \u0026#34;#{bin}/program\u0026#34;, \u0026#34;do\u0026#34;, \u0026#34;something\u0026#34;`.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    system \u003cspan class=\"string\"\u003e\u0026#34;false\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e我们先来看类的头部\u003c/p\u003e\n\u003cfigure class=\"highlight ruby\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003edesc \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ehomepage \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eurl \u003cspan class=\"string\"\u003e\u0026#34;https://github.com/caryll/otfcc/releases/download/v0.2.3/otfcc-mac64-0.2.3.tar.xz\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eversion \u003cspan class=\"string\"\u003e\u0026#34;0.2.3\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esha256 \u003cspan class=\"string\"\u003e\u0026#34;f393b14f9c42c890b8a60949b13a8f9b5c3f814daa8b18901656ccc3b866f646\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003ccode\u003edesc\u003c/code\u003e 是 description 的缩写，我们应该在这里填上 \u003ccode\u003eotfcc\u003c/code\u003e 的简介。\u003ccode\u003ehomepage\u003c/code\u003e 相应地填上项目主页。后面的 \u003ccode\u003eurl\u003c/code\u003e/\u003ccode\u003eversion\u003c/code\u003e/\u003ccode\u003esha256\u003c/code\u003e 都由 Homebrew 默认给我们填好了，我们只需要检查一下是否正确即可。\u003c/p\u003e\n\u003cp\u003e接下来是依赖项部分\u003c/p\u003e\n\u003cfigure class=\"highlight ruby\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# depends_on \u0026#34;cmake\u0026#34; =\u0026gt; :build\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edepends_on \u003cspan class=\"symbol\"\u003e:x11\u003c/span\u003e \u003cspan class=\"comment\"\u003e# if your formula requires any X11/XQuartz components\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e由于 \u003ccode\u003eotfcc\u003c/code\u003e 没有任何其他的依赖项，所以不需要在此填入任何内容。\u003c/p\u003e\n\u003cp\u003e接下来是安装部分\u003c/p\u003e\n\u003cfigure class=\"highlight ruby\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003einstall\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e# ENV.deparallelize  # if your formula fails when building in parallel\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e# Remove unrecognized options if warned by configure\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  system \u003cspan class=\"string\"\u003e\u0026#34;./configure\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;--disable-debug\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"string\"\u003e\u0026#34;--disable-dependency-tracking\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"string\"\u003e\u0026#34;--disable-silent-rules\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"string\"\u003e\u0026#34;--prefix=\u003cspan class=\"subst\"\u003e#{prefix}\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"comment\"\u003e# system \u0026#34;cmake\u0026#34;, \u0026#34;.\u0026#34;, *std_cmake_args\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  system \u003cspan class=\"string\"\u003e\u0026#34;make\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;install\u0026#34;\u003c/span\u003e \u003cspan class=\"comment\"\u003e# if this fails, try separate make/make install steps\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e默认情况下，Homebrew 会并行地编译源代码。不过，有些程序并不适用并行编译。此时可以将 \u003ccode\u003e# ENV.deparallelize\u003c/code\u003e 的注释解开。后续的内容也比较简单，先后调用 \u003ccode\u003e./configure\u003c/code\u003e 和 \u003ccode\u003emake install\u003c/code\u003e——这是标准的 \u003ccode\u003e*nix\u003c/code\u003e 编译安装流程。\u003c/p\u003e\n\u003cp\u003e由于我们现在讨论的是安装 \u003ccode\u003eotfcc\u003c/code\u003e 的预编译版本，所以不需要考虑编译的过程。只需要调用 Homebrew 提供的 \u003ccode\u003ebin.install\u003c/code\u003e 就可以了。\u003c/p\u003e\n\u003cp\u003e最后的测试部分，我们暂时不探讨。\u003c/p\u003e\n\u003cp\u003e于是我们就得到了最后的 \u003ccode\u003eotfcc-mac64.rb\u003c/code\u003e\u003c/p\u003e\n\u003cfigure class=\"highlight ruby\"\u003e\u003cfigcaption\u003e\u003cspan\u003eotfcc-mac64.rb\u003c/span\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# Documentation: https://github.com/Homebrew/brew/blob/master/share/doc/homebrew/Formula-Cookbook.md\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#                http://www.rubydoc.info/github/Homebrew/brew/master/Formula\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# PLEASE REMOVE ALL GENERATED COMMENTS BEFORE SUBMITTING YOUR PULL REQUEST!\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title class_\"\u003eOtfccMac64\u003c/span\u003e \u0026lt; \u003cspan class=\"title class_ inherited__\"\u003eFormula\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  desc \u003cspan class=\"string\"\u003e\u0026#34;Parses \u0026amp; writes SFNT structures.\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  homepage \u003cspan class=\"string\"\u003e\u0026#34;https://github.com/caryll/otfcc/releases/\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  url \u003cspan class=\"string\"\u003e\u0026#34;https://github.com/caryll/otfcc/releases/download/v0.2.3/otfcc-mac64-0.2.3.tar.xz\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  version \u003cspan class=\"string\"\u003e\u0026#34;0.2.3\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  sha256 \u003cspan class=\"string\"\u003e\u0026#34;f393b14f9c42c890b8a60949b13a8f9b5c3f814daa8b18901656ccc3b866f646\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title function_\"\u003einstall\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# ENV.deparallelize  # if your formula fails when building in parallel\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# system \u0026#34;tar -Jvxf otfcc-mac64-0.2.3.tar.zx\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    bin.install \u003cspan class=\"string\"\u003e\u0026#34;otfccbuild\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    bin.install \u003cspan class=\"string\"\u003e\u0026#34;otfccdump\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e保存后，你就可以执行 \u003ccode\u003ebrew install otfcc-mac64\u003c/code\u003e 了。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ brew install otfcc-mac64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e==\u0026gt; Downloading https://github.com/caryll/otfcc/releases/download/v0.2.3/otfcc-mac64-0.2.3.tar.xz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eAlready downloaded: /Library/Caches/Homebrew/otfcc-mac64-0.2.3.tar.xz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e🍺  /usr/local/Cellar/otfcc-mac64/0.2.3: 3 files, 882.2K, built \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e 0 seconds\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$ \u003cspan class=\"built_in\"\u003ewhich\u003c/span\u003e otfccdump\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e/usr/local/bin/otfccdump\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$ \u003cspan class=\"built_in\"\u003ewhich\u003c/span\u003e otfccbuild\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e/usr/local/bin/otfccbuild\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e由于之前在 \u003ccode\u003ebrew create\u003c/code\u003e 的过程中，已经下载了 \u003ccode\u003eotfcc-mac64-0.2.3.tar.zx\u003c/code\u003e 这一文件，所以 Homebrew 不会再次下载。执行完毕后，我们发现，\u003ccode\u003eotfccdump\u003c/code\u003e 和 \u003ccode\u003eotfccbuild\u003c/code\u003e 两个二进制程序已经被安装在了 \u003ccode\u003e/usr/local/bin/\u003c/code\u003e 目录下——这是 Homebrew 安装二进制的默认目录。\u003c/p\u003e\n\u003cp\u003e我们的 Formula 比较简单，不涉及 Homebrew 提供的更深的功能。如果有必要，你需要参考\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/Homebrew/brew/blob/master/share/doc/homebrew/Formula-Cookbook.md\"\u003e官方指南\u003c/a\u003e。\u003c/p\u003e\n\u003ch3 id=\"创建-Tap\"\u003e\u003ca href=\"#创建-Tap\" class=\"headerlink\" title=\"创建 Tap\"\u003e\u003c/a\u003e创建 Tap\u003c/h3\u003e\u003cp\u003e至此我们已经创建了 Formula。根据这个 Formula，我们本地的 Homebrew 已经可以将 \u003ccode\u003eotfcc\u003c/code\u003e 安装到 \u003ccode\u003e/usr/local/bin\u003c/code\u003e 目录下了。然而，其他人暂时还不能获取、安装我们的软件。为此，我们需要创建自己的 Tap。\u003c/p\u003e\n\u003cp\u003e前面已经说过，Tap 实际上是 GitHub 网站上的一个专案。这个专案有些特殊，它的名字必须是 \u003ccode\u003ehomebrew-foobar\u003c/code\u003e 的形式。也就是说，它必须有 \u003ccode\u003ehomebrew-\u003c/code\u003e 这一前缀。\u003ccode\u003eotfcc\u003c/code\u003e 放在 GitHub 上的 \u003ccode\u003ecaryll\u003c/code\u003e 组织中开发。于是我们可以在 \u003ccode\u003ecaryll\u003c/code\u003e 中创建一个名为 \u003ccode\u003ehomebrew-tap\u003c/code\u003e 的专案，然后将上述 \u003ccode\u003eotfcc-mac64.rb\u003c/code\u003e 纳入 \u003ccode\u003ehomebrew-tap\u003c/code\u003e 这一专案的版本控制之下。\u003c/p\u003e\n\u003cp\u003e创建专案及纳入版本控制的过程是基本的 Git 操作，这里就不做展开了。创建好的专案在此：\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/caryll/homebrew-tap\"\u003ehttps://github.com/caryll/homebrew-tap\u003c/a\u003e，可供一观。\u003c/p\u003e\n\u003ch3 id=\"实际安装看看\"\u003e\u003ca href=\"#实际安装看看\" class=\"headerlink\" title=\"实际安装看看\"\u003e\u003c/a\u003e实际安装看看\u003c/h3\u003e\u003cp\u003e现在，我们创建了自己的 Formula 和 Tap，并在 GitHub 上为 Tap 创建了一个公开的专案。那么，世界上所有的 Homebrew 用户就可以使用下列指令很方便地安装 \u003ccode\u003eotfcc\u003c/code\u003e 了。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ebrew tap caryll/tap \u0026amp;\u0026amp; brew install otfcc-mac64\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e注意，这里我们首先调用了 \u003ccode\u003ebrew tap\u003c/code\u003e 命令，将我们自建的 Tap 加入到本地 Homebrew 的搜索列表中。加入搜索列表的内容是 \u003ccode\u003ecaryll/tap\u003c/code\u003e——相比 GitHub 上的专案名称，Homebrew 会自动在传入 \u003ccode\u003ebrew tap\u003c/code\u003e 的地址里加上 \u003ccode\u003ehomebrew-\u003c/code\u003e 这一前缀。而后，我们照常调用 \u003ccode\u003ebrew install\u003c/code\u003e 命令，就能顺利地安装 \u003ccode\u003eotfcc\u003c/code\u003e 在 OS X 上了。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2016-07-30T09:17:00Z",
  "Author": "Liam Huang"
}