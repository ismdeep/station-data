{
  "Source": "liam.page",
  "Title": "在 Linux 上挂载/卸载磁盘",
  "Link": "https://liam.page/2019/08/23/mount-and-unmount-disk-in-Linux/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e昨天正在训练线上模型的机器被人误操作，不得不重做系统。万幸模型相关的训练状态保存在另一块磁盘上，没有受到影响。要想恢复训练状态相关数据，就必须把磁盘挂载好。因为这个操作不常用，一时居然都没想起来怎么做。因此这里「烂笔头」记录下来。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"查看机器上的磁盘\"\u003e\u003ca href=\"#查看机器上的磁盘\" class=\"headerlink\" title=\"查看机器上的磁盘\"\u003e\u003c/a\u003e查看机器上的磁盘\u003c/h2\u003e\u003cp\u003e\u003ccode\u003efdisk\u003c/code\u003e 是 Linux 上用来操作磁盘分区表的工具。使用 \u003ccode\u003efdisk -l\u003c/code\u003e 命令，可以列出系统识别的所有磁盘及其分区。\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eDisk /dev/sda: 599.1 GB, 599051206656 bytes, 1170021888 sectors\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eUnits = sectors of 1 * 512 = 512 bytes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eSector size (logical/physical): 512 bytes / 4096 bytes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eI/O size (minimum/optimal): 262144 bytes / 262144 bytes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eDisk label type: # masked\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eDisk identifier: # masked\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   Device Boot      Start         End      Blocks   Id  System\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e/dev/sda1            2048   204802047   102400000   83  Linux\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e/dev/sda2       204802048   213190655     4194304   82  Linux swap / Solaris\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e/dev/sda3   *   213190656  1170020351   478414848   83  Linux\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eDisk /dev/sdb: 6118.5 GB, 6118546079744 bytes, 11950285312 sectors\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eUnits = sectors of 1 * 512 = 512 bytes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eSector size (logical/physical): 512 bytes / 4096 bytes\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eI/O size (minimum/optimal): 262144 bytes / 262144 bytes\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003ccode\u003e/dev\u003c/code\u003e 目录下的 \u003ccode\u003esd?\u003c/code\u003e 即是物理磁盘。例如 \u003ccode\u003esda\u003c/code\u003e 是系统读到的第一块磁盘，\u003ccode\u003esdb\u003c/code\u003e 则是第二块磁盘。在较老的 kernel 中，由于没有 ATA 支持，因此物理磁盘可能是 \u003ccode\u003e/dev/hd?\u003c/code\u003e（IDE）或者是 \u003ccode\u003e/dev/sd?\u003c/code\u003e（SCSI）。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e/dev/sda?\u003c/code\u003e 则是 \u003ccode\u003esda\u003c/code\u003e 这块物理磁盘上的分区。\u003ccode\u003e/dev/sda1\u003c/code\u003e 是该磁盘上的第一块分区。\u003c/p\u003e\n\u003cp\u003e这里 \u003ccode\u003e/dev/sdb\u003c/code\u003e 这块磁盘尚未被正确挂载，而正是它保存了所需的数据。\u003c/p\u003e\n\u003ch2 id=\"创建挂载点\"\u003e\u003ca href=\"#创建挂载点\" class=\"headerlink\" title=\"创建挂载点\"\u003e\u003c/a\u003e创建挂载点\u003c/h2\u003e\u003cp\u003e在挂载磁盘之前，首先要为它创建一个挂载点。挂载点说白了是一个目录，在执行 \u003ccode\u003emount\u003c/code\u003e 命令挂载前，它必须是已经存在的目录。挂载成功后，访问该目录即可访问相应磁盘的内容。若挂载前挂载点中存在内容，则挂载后这些内容暂不可见，当卸载后这些内容又会变得可见。\u003c/p\u003e\n\u003cp\u003e比如我想将磁盘挂载于 \u003ccode\u003e/mnt/data\u003c/code\u003e 就要创建这样一个空目录。\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emkdir -p /mnt/data\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"确定磁盘文件系统类型\"\u003e\u003ca href=\"#确定磁盘文件系统类型\" class=\"headerlink\" title=\"确定磁盘文件系统类型\"\u003e\u003c/a\u003e确定磁盘文件系统类型\u003c/h2\u003e\u003cp\u003e在挂载磁盘之前，还需要确定磁盘（分区）的文件系统类型。若不然，挂载时选错文件系统类型可能造成一系列奇怪的现象。为此，我们需要执行 \u003ccode\u003eparted -l\u003c/code\u003e 命令。\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta prompt_\"\u003e# \u003c/span\u003e\u003cspan class=\"language-bash\"\u003eparted -l\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eModel: # masked\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eDisk /dev/sda: 599GB\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eSector size (logical/physical): 512B/4096B\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ePartition Table: msdos\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eDisk Flags:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eNumber  Start   End    Size    Type     File system     Flags\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e 1      1049kB  105GB  105GB   primary  xfs\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e 2      105GB   109GB  4295MB  primary  linux-swap(v1)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e 3      109GB   599GB  490GB   primary  xfs             boot\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eModel: # masked\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eDisk /dev/sdb: 6119GB\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eSector size (logical/physical): 512B/4096B\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ePartition Table: loop\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eDisk Flags:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eNumber  Start  End     Size    File system  Flags\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e 1      0.00B  6119GB  6119GB  ext4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e由此可见，目标磁盘 \u003ccode\u003e/dev/sdb\u003c/code\u003e 的文件系统类型是 \u003ccode\u003eext4\u003c/code\u003e。\u003c/p\u003e\n\u003ch2 id=\"挂载磁盘\"\u003e\u003ca href=\"#挂载磁盘\" class=\"headerlink\" title=\"挂载磁盘\"\u003e\u003c/a\u003e挂载磁盘\u003c/h2\u003e\u003cp\u003e此时，我们就能挂载磁盘了。\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emount -t ext4 /dev/sdb /mnt/data\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里 \u003ccode\u003e-t ext4\u003c/code\u003e 表示目标磁盘（分区）的文件系统类型是 \u003ccode\u003eext4\u003c/code\u003e，\u003ccode\u003e/dev/sdb\u003c/code\u003e 是待挂载的磁盘（分区），\u003ccode\u003e/mnt/data\u003c/code\u003e 是目标挂载点。\u003c/p\u003e\n\u003ch2 id=\"卸载磁盘\"\u003e\u003ca href=\"#卸载磁盘\" class=\"headerlink\" title=\"卸载磁盘\"\u003e\u003c/a\u003e卸载磁盘\u003c/h2\u003e\u003cp\u003e与 \u003ccode\u003emount\u003c/code\u003e 相对的命令是 \u003ccode\u003eumount\u003c/code\u003e。注意是 \u003ccode\u003eumount\u003c/code\u003e 而不是 \u003ccode\u003eunmount\u003c/code\u003e——没有那个 \u003ccode\u003en\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e卸载时，给 \u003ccode\u003eumount\u003c/code\u003e 的参数可以是挂载点，也可以是磁盘（分区）的名字。在这里，以下两种操作等价：\u003c/p\u003e\n\u003cfigure class=\"highlight shell\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eumount /dev/sdb\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eumount /mnt/data\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e若是希望挂载的磁盘正在被其他进程读写，则 Linux 会提示 \u003ccode\u003edevice is busy\u003c/code\u003e。此时，可以执行 \u003ccode\u003eumount -l\u003c/code\u003e 命令，让 Linux 在无其他进程读写目标磁盘时，再行卸载。或者，也可以用 \u003ccode\u003eps\u003c/code\u003e 命令查看使用该磁盘的进程有哪些，然后妥当处理后再卸载。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-08-23T06:30:19Z",
  "Author": "Liam Huang"
}