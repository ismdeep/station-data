{
  "Source": "liam.page",
  "Title": "解决公司 Win7 更新时的 0x80092004 错误",
  "Link": "https://liam.page/2019/10/18/0x80092004-error-on-Windows-7/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e从大概 8 月份开始，公司配发的电脑（Windows 7 系统）就总是提示有更新，但每次更新都安装失败。不断提示更新很打扰工作思路，于是下决心解决。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e经检查，问题出在 KB4512506/KB4516065（Windows 7 月安全质量汇总更新）上，尝试安装该更新时，系统会提示 \u003ccode\u003e0x80092004\u003c/code\u003e 错误。上网检查后确认，该错误代码与 \u003ccode\u003eCRYPT_E_NOT_FOUND\u003c/code\u003e 有关。也就是说，Windows Update 发现更新文件的散列值不匹配，于是拒绝安装。\u003c/p\u003e\n\u003cp\u003e\u003cimg data-src=\"/uploads/images/computer-skills/kb4516065.png\" alt=\"`0x80092004` 错误\"/\u003e\u003c/p\u003e\n\u003cp\u003e进一步检查发现，微软在给 Windows 7 和 Windows Server 2008 R2 的更新中修改了散列值签名方式，而 19 年 8 月发布的 7 月安全质量汇总更新，正是新签名方式第一次生效的时候。具体来说，原先会使用 SHA-1 和 SHA-2 同时签名；但因为众所周知的安全问题，微软放弃了 SHA-1 签名转而仅使用 SHA-2 签名。但如果 Windows 7 上的 Windows Update 依旧检查 SHA-1 签名，则会发现更新文件的散列值不匹配，于是拒绝安装，并报错 \u003ccode\u003e0x80092004\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e为解决这一问题，微软先期发布了两个相关更新：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://support.microsoft.com/en-us/help/4474419/sha-2-code-signing-support-update\"\u003eKB4474419\u003c/a\u003e：用于在 Windows 7 等系统上支持 SHA-2 签名。\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://support.microsoft.com/en-us/help/4490628/servicing-stack-update-for-windows-7-sp1-and-windows-server-2008-r2\"\u003eKB4490628\u003c/a\u003e：服务堆栈更新，解决了安装仅使用 SHA-2 哈希算法签名的更新时服务堆栈中的问题。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e安装 KB4512506 前，系统必须安装好这两个前置依赖，否则就会因签名问题报错 \u003ccode\u003e0x80092004\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e经检查，我的系统里安装了 KB4474419，但是没有安装 KB4490628。那么这就是导致问题的直接原因了。\u003c/p\u003e\n\u003cp\u003e那么根本原因在哪里呢？答案是：公司电脑的组策略配置决定了 Windows Update 由公司 IT 管理员来管理。公司 IT 可能没有正确配置安装 KB4490628，于是有后续问题。更加无奈的是，因为组策略配置的限制，我无法在 Windows Update 中搜索安装 KB4490628。幸运的是，我在\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://catalog.update.microsoft.com/v7/site/search.aspx?q=4490628\"\u003e微软 Update Catalog\u003c/a\u003e 当中找到了 KB4490628 的独立安装包。下载安装 KB4490628 的过程一切顺利。\u003c/p\u003e\n\u003cp\u003e安装完 KB4490628 之后，再次打开 Windows Update，尝试安装 KB4516065 则一切顺利。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-10-18T07:57:06Z",
  "Author": "Liam Huang"
}