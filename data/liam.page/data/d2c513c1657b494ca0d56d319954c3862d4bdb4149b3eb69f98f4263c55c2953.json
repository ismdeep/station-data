{
  "Source": "liam.page",
  "Title": "在 LaTeX 中进行文学编程",
  "Link": "https://liam.page/2015/01/23/literate-programming-in-latex/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e文学编程是 TeX 的作者高德纳提出的编程方式，主张程序员在编写代码的过程中详细地记录自己的思维方式和内在逻辑。\u003c/p\u003e\n\u003cp\u003e这种编程方式注重编码的逻辑而将编码本身放在更次要的位置，因而不充分的设计在这种编程方式下无所遁形。文学编程的另一个优点是它产生的代码文档能帮助程序员在任意时候重新会想起当时编码的思路。\u003c/p\u003e\n\u003cp\u003e在 LaTeX 中，可以用 Doc 和 DocStrip 这两个工具来实现文学编程。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e对于程序员来说，最重要的有三个部分：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e代码；\u003c/li\u003e\n\u003cli\u003e代码文档；\u003c/li\u003e\n\u003cli\u003e用户手册。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e使用 Doc 和 DocStrip 可以将这三个部分集中到一个 \u003ccode\u003e.dtx\u003c/code\u003e 文件当中。这篇文章将分三个部分讲述如何构建这样一个 \u003ccode\u003e.dtx\u003c/code\u003e 文件。\u003c/p\u003e\n\u003ch2 id=\"ins-文件\"\u003e\u003ca href=\"#ins-文件\" class=\"headerlink\" title=\".ins 文件\"\u003e\u003c/a\u003e\u003ccode\u003e.ins\u003c/code\u003e 文件\u003c/h2\u003e\u003cp\u003eINS 三个字母是「Install」的缩写，顾名思义，这个文件是和安装相关的。\u003ccode\u003e.ins\u003c/code\u003e 文件通常用来控制 TeX 从 \u003ccode\u003e.dtx\u003c/code\u003e 文件里释放宏包文件，它的结构最为简单，大概是这样的。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e作为注释的版权信息\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e载入 \u003ccode\u003edocstrip.tex\u003c/code\u003e\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e写入 DocStrip 的控制命令\u003c/li\u003e\n\u003cli\u003e编写将写入生成文件的版权信息\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e生成文件指令\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e写入提示信息用以完成安装\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e结束安装文件\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e这里粗体标记的是必不可少的部分，其他部分或多或少都可以省略。\u003c/p\u003e\n\u003cp\u003e我们逐步构建一个完整的 \u003ccode\u003e.ins\u003c/code\u003e 文件。\u003c/p\u003e\n\u003chr/\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% Copyright (C) 2003--2015\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% CTEX.ORG and any individual authors listed elsewhere in this file.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% --------------------------------------------------------------------------\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% This work may be distributed and/or modified under the\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% conditions of the LaTeX Project Public License, either\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% version 1.3c of this license or (at your option) any later\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% version. This version of this license is in\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%%    http://www.latex-project.org/lppl/lppl-1-3c.txt\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% and the latest version of this license is in\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%%    http://www.latex-project.org/lppl.txt\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% and version 1.3 or later is part of all distributions of\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% LaTeX version 2005/12/01 or later.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% This work has the LPPL maintenance status `maintained\u0026#39;.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%%\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% The Current Maintainers of this work are Leo Liu, Qing Lee and Liam Huang.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e%% --------------------------------------------------------------------------\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这是 \u003ccode\u003ectex\u003c/code\u003e 宏包的版权声明信息。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e这里的每一行都以百分号开头，因此在声明版权的同时不会影响正常的编译流程。\u003c/li\u003e\n\u003cli\u003e版权声明部分，首先是声明版权的归属。\u003c/li\u003e\n\u003cli\u003e接下来，声明许可协议为 LPPL。大多数 TeX 相关的宏包或软件，都在 LPPL 协议下发布。\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr/\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\input\u003c/span\u003e docstrip.tex\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e载入 \u003ccode\u003edocstrip.tex\u003c/code\u003e。\u003c/p\u003e\n\u003chr/\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\keepsilent\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这是 DocStrip 的控制命令之一，其作用是关闭 DocStrip 的日志输出功能。默认情况下，DocStrip 会详细输出它的每一步操作。对于大多数人来说，成百上千行的日志徒惹人嫌弃，因此我们关闭它。\u003c/p\u003e\n\u003cp\u003e更多的控制命令可以参考 DocStrip 的文档。\u003c/p\u003e\n\u003chr/\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\preamble\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    Copyright (C) 2003-2015\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    CTEX.ORG and any individual authors listed in the documentation.\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e------------------------------------------------------------------------------\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    This work may be distributed and/or modified under the\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    conditions of the LaTeX Project Public License, either\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    version 1.3c of this license or (at your option) any later\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    version. This version of this license is in\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       http://www.latex-project.org/lppl/lppl-1-3c.txt\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    and the latest version of this license is in\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e       http://www.latex-project.org/lppl.txt\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    and version 1.3 or later is part of all distributions of\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    LaTeX version 2005/12/01 or later.\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    This work has the LPPL maintenance status `maintained\u0026#39;.\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    The Current Maintainers of this work are Leo Liu, Qing Lee and Liam Huang.\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e------------------------------------------------------------------------------\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\endpreamble\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e在 \u003ccode\u003e\\preamble\u003c/code\u003e 和 \u003ccode\u003e\\endpreamble\u003c/code\u003e 之间的部分，将被写入由 DocStrip 生成的所有文档（默认情况下）。比如上面这段 \u003ccode\u003ectex\u003c/code\u003e 宏包的版权信息将写入每一个生成的文件。\u003c/p\u003e\n\u003chr/\u003e\n\u003cp\u003e下面的内容是整个 \u003ccode\u003e.ins\u003c/code\u003e 文件里最重要的部分，它控制着如何生成最终的宏包文件。\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\generate\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\usedir\u003c/span\u003e{tex/latex/ctex}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\file\u003c/span\u003e{ctex.sty}                 {\u003cspan class=\"keyword\"\u003e\\from\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\jobname\u003c/span\u003e.dtx}{package,style}}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\file\u003c/span\u003e{ctexcap.sty}              {\u003cspan class=\"keyword\"\u003e\\from\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\jobname\u003c/span\u003e.dtx}{package,ctexcap}}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\file\u003c/span\u003e{ctexsize.sty}             {\u003cspan class=\"keyword\"\u003e\\from\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\jobname\u003c/span\u003e.dtx}{package,ctexsize}}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\file\u003c/span\u003e{ctexart.cls}              {\u003cspan class=\"keyword\"\u003e\\from\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\jobname\u003c/span\u003e.dtx}{class,article}}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\file\u003c/span\u003e{ctexbook.cls}             {\u003cspan class=\"keyword\"\u003e\\from\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\jobname\u003c/span\u003e.dtx}{class,book}}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\file\u003c/span\u003e{ctexrep.cls}              {\u003cspan class=\"keyword\"\u003e\\from\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\jobname\u003c/span\u003e.dtx}{class,report}}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003e\\file\u003c/span\u003e{ctexspa.def}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\from\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\jobname\u003c/span\u003e.dtx}         {ctexspa}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003e\\from\u003c/span\u003e{ctexpunct.spa}        {}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003ccode\u003e\\generate\u003c/code\u003e 命令中的\u003ccode\u003e\\file{⟨filename⟩}{\\from{⟨sourcefilename⟩}{⟨optionlist⟩}}\u003c/code\u003e 用来指定宏包文件的生成方式。这里的含义是，从 \u003ccode\u003e⟨sourcefilename⟩\u003c/code\u003e 中抽取含有 \u003ccode\u003e⟨optionlist⟩\u003c/code\u003e 标记的部分，生成 \u003ccode\u003e⟨filename⟩\u003c/code\u003e 这个文件。\u003c/p\u003e\n\u003cp\u003e一个 \u003ccode\u003e\\generate\u003c/code\u003e 里可以有多个 \u003ccode\u003e\\file\u003c/code\u003e 命令。一个 \u003ccode\u003e\\file\u003c/code\u003e 命令里可以有多个 \u003ccode\u003e\\from\u003c/code\u003e 命令。一个 \u003ccode\u003e\\from\u003c/code\u003e 命令里的 \u003ccode\u003e⟨option⟩\u003c/code\u003e，组成 \u003ccode\u003e⟨optionlist⟩\u003c/code\u003e。其中 \u003ccode\u003e⟨option⟩\u003c/code\u003e 需要用逗号隔开，\u003ccode\u003e\\file\u003c/code\u003e 之间和 \u003ccode\u003e\\from\u003c/code\u003e 之间则不需要。\u003c/p\u003e\n\u003chr/\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\obeyspaces\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*************************************************************}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*                                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{* To finish the installation you have to move the following *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{* file into proper directories searched by TeX:             *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*                                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{* The recommended directory is TDS:tex/latex/ctex           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*                                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*     ctex.sty                                              *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*     ctexcap.sty                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*     ctexsize.sty                                          *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*     ctexart.cls                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*     ctexbook.cls                                          *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*     ctexrep.cls                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*     ctexspa.def                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*                                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{* To produce the documentation run the file ctex.dtx        *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{* through XeLaTeX.                                          *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*                                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{* Happy TeXing!                                             *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*                                                           *}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\Msg\u003c/span\u003e{*************************************************************}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里的内容会在处理完 \u003ccode\u003e.ins\u003c/code\u003e 文件之后显示在控制台，用来提示使用者将文件置入指定的目录。TeX 会忽略连续的空格，第一行的 \u003ccode\u003e\\obeyspaces\u003c/code\u003e 则会让 TeX 输出这些空格。\u003c/p\u003e\n\u003chr/\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\endbatchfile\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e显式地结束安装文件，此后的所有内容都会被忽略。\u003c/p\u003e\n\u003cp\u003e将上面的代码依次粘贴到一起，就是一个最简单的 \u003ccode\u003e.ins\u003c/code\u003e 文件了。\u003c/p\u003e\n\u003ch2 id=\"dtx-文件\"\u003e\u003ca href=\"#dtx-文件\" class=\"headerlink\" title=\".dtx 文件\"\u003e\u003c/a\u003e\u003ccode\u003e.dtx\u003c/code\u003e 文件\u003c/h2\u003e\u003cp\u003e\u003ccode\u003e.dtx\u003c/code\u003e 文件比 \u003ccode\u003e.ins\u003c/code\u003e 文件复杂得多。\u003ccode\u003e.ins\u003c/code\u003e 文件在整个过程中会被读取一次，而 \u003ccode\u003e.dtx\u003c/code\u003e 文件却会被读取三次。下面是对此三个步骤的简略描述。如果暂时看不懂也没有关系，下一节我们将会化身人肉编译器，逐行分析示例。\u003c/p\u003e\n\u003cp\u003e处理 \u003ccode\u003e.ins\u003c/code\u003e 文件的时候，会载入 \u003ccode\u003e.dtx\u003c/code\u003e 文件。这时候 \u003ccode\u003e.dtx\u003c/code\u003e 文件中以 \u003ccode\u003e%\u003c/code\u003e 开头的行将被全部忽略，而以 \u003ccode\u003e%\u003c/code\u003e 开头的行则会用于记录 \u003ccode\u003e⟨option⟩\u003c/code\u003e。程序会根据 \u003ccode\u003e.ins\u003c/code\u003e 文件中 \u003ccode\u003e\\generate\u003c/code\u003e 命令里 \u003ccode\u003e\\from\u003c/code\u003e 的指示的 \u003ccode\u003e⟨option⟩\u003c/code\u003e 抽取 \u003ccode\u003e.dtx\u003c/code\u003e 文件中 \u003ccode\u003e⟨option⟩\u003c/code\u003e 相关内容。这个过程中，没有以 \u003ccode\u003e%\u003c/code\u003e 开头的行会根据 \u003ccode\u003e⟨option⟩\u003c/code\u003e 写入文件，而 \u003ccode\u003e%\u003c/code\u003e 开头的行则被抑制并保护起来。最终生成宏包文件。\u003c/p\u003e\n\u003cp\u003e第二遍处理 \u003ccode\u003e.dtx\u003c/code\u003e 文件的时候，在读入 \u003ccode\u003e\\documentclass{ltxdoc}\u003c/code\u003e 之前，所有的内容与通常意义上的 LaTeX 代码完全一致。因此需要依靠 \u003ccode\u003e\\iffalse\u003c/code\u003e 和 \u003ccode\u003e% \\iffalse\u003c/code\u003e 来保护相关代码，这些代码通常是 README 文件和 LICENSE 文件。在读入 \u003ccode\u003e\\DocInput{filename.dtx}\u003c/code\u003e 之后，\u003ccode\u003e.dtx\u003c/code\u003e 文件会被第三次载入处理。处理完成之后遇到 \u003ccode\u003e\\end{document}\u003c/code\u003e，后续的内容被全部忽略。最终生成说明文档。\u003c/p\u003e\n\u003cp\u003e第三遍处理 \u003ccode\u003e.dtx\u003c/code\u003e 是被 \u003ccode\u003e\\DocInput\u003c/code\u003e 载入的。此时，文档内（几乎）所有的 \u003ccode\u003e%\u003c/code\u003e 都被忽略。因为 LaTeX 只能有一个 \u003ccode\u003e\\documentclass\u003c/code\u003e 以及一对 \u003ccode\u003e\\begin{document}\u003c/code\u003e 和 \u003ccode\u003e\\end{document}\u003c/code\u003e，所以 \u003ccode\u003e\\end{document}\u003c/code\u003e 之前的所有内容都应当在这一次处理的时候被忽略。因此这部分内容应该被 \u003ccode\u003e\\iffalse\u003c/code\u003e 和 \u003ccode\u003e\\fi\u003c/code\u003e 保护起来。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e.dtx\u003c/code\u003e 文件由以下部分组成。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e包含在 \u003ccode\u003e% \\iffalse\u003c/code\u003e 和 \u003ccode\u003e% \\fi\u003c/code\u003e 中间的版权信息\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e包含在 \u003ccode\u003e% \\iffalse\u003c/code\u003e 和 \u003ccode\u003e% \\fi\u003c/code\u003e 中间的宏包基本信息\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e包含在 \u003ccode\u003e%\u0026lt;*driver\u0026gt;\u003c/code\u003e 和 \u003ccode\u003e%\u0026lt;/driver\u0026gt;\u003c/code\u003e 中间的 \u003ccode\u003eltxdoc\u003c/code\u003e 文档类及相关代码，这部分代码也应包含在 \u003ccode\u003e% \\iffalse\u003c/code\u003e 和 \u003ccode\u003e% \\fi\u003c/code\u003e 中间\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e在 \u003ccode\u003e\\end{document}\u003c/code\u003e 之后的说明文档，这部分文档应该隐藏在行首的 \u003ccode\u003e%\u003c/code\u003e 之后\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e在说明文档最后的代码说明，以及间杂在代码说明中间的代码，其中代码说明也应该隐藏在行首的 \u003ccode\u003e%\u003c/code\u003e 之后，而代码本身则不应该被 \u003ccode\u003e%\u003c/code\u003e 保护\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e示例 \u003ccode\u003e.dtx\u003c/code\u003e 文件的具体内容，可以参看下一节。\u003c/p\u003e\n\u003ch2 id=\"人肉编译器\"\u003e\u003ca href=\"#人肉编译器\" class=\"headerlink\" title=\"人肉编译器\"\u003e\u003c/a\u003e人肉编译器\u003c/h2\u003e\u003cp\u003e我们来看两个文件，分别是 \u003ca href=\"//liam.page/attachment/attachment/LaTeX-useful-tools/dtxtut/dtxtut.ins\"\u003e\u003ccode\u003edtxtut.ins\u003c/code\u003e\u003c/a\u003e 和 \u003ca href=\"//liam.page/attachment/attachment/LaTeX-useful-tools/dtxtut/dtxtut.dtx\"\u003e\u003ccode\u003edtxtut.dtx\u003c/code\u003e\u003c/a\u003e。你可以下载这两个文件，然后跟着我的思路一起分析。\u003c/p\u003e\n\u003cp\u003e首先我们要生成宏包文件，在命令行中运行\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003exelatex dtxtut.ins\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e注意，这里的后缀名不可省略。\u003c/p\u003e\n\u003cp\u003e文件读入之后，直到 12 行都是注释，直接忽略。接着到了第 13 行，读入了 \u003ccode\u003edocstrip.tex\u003c/code\u003e 这个文件。随后进行了一些设置之后来到了第 26 行.\u003c/p\u003e\n\u003cfigure class=\"highlight tex\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003e\\generate\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\file\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\jobname\u003c/span\u003e.sty}{\u003cspan class=\"keyword\"\u003e\\from\u003c/span\u003e{\u003cspan class=\"keyword\"\u003e\\jobname\u003c/span\u003e.dtx}{package}}}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里 \u003ccode\u003e\\jobname\u003c/code\u003e 是当前文件的名字（不含后缀），即 \u003ccode\u003edtxtut\u003c/code\u003e。所以这里会从 \u003ccode\u003edtxtut.dtx\u003c/code\u003e 文件中，抽取 \u003ccode\u003epackage\u003c/code\u003e 的部分，组成名为 \u003ccode\u003edtxtut.sty\u003c/code\u003e 这个文件。\u003c/p\u003e\n\u003cp\u003e现在我们读取 \u003ccode\u003edtxtut.dtx\u003c/code\u003e。前 18 行都是注释，忽略。19 -- 21 行是 \u003ccode\u003epackage\u003c/code\u003e 部分，输出。23 行开始了名为 \u003ccode\u003edriver\u003c/code\u003e 的部分，直到 32 行结束。接下来一直到 81 行都是注释，忽略。82行开始了名为 \u003ccode\u003epackage\u003c/code\u003e 的部分，于是程序将 82 行开始到 100 行中没有注释掉的部分抽出来，输出。这样，输出的内容接在 \u003ccode\u003e\\preamble\u003c/code\u003e 之后，保存为 \u003ccode\u003edtxtut.sty\u003c/code\u003e 文件。\u003c/p\u003e\n\u003cp\u003e接下来我们生成宏包文档，在命令行中运行\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003exelatex dtxtut.dtx\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e同样，这里的后缀名不可省略。\u003c/p\u003e\n\u003cp\u003e前 23 行都是注释，忽略。24 行载入了 \u003ccode\u003eltxdoc\u003c/code\u003e 文档类，随后载入了刚刚生成的 \u003ccode\u003edtxtut.sty\u003c/code\u003e 宏包。26 行的 \u003ccode\u003e\\EnableCrossrefs\u003c/code\u003e 打开了代码索引的生成（如果你将来不需要，可以用 \u003ccode\u003e\\DisableCrossrefs\u003c/code\u003e 打开）。27 行的 \u003ccode\u003e\\CodelineIndex\u003c/code\u003e 则使得索引指向代码行号，而不是页码。28 行的 \u003ccode\u003e\\RecordChanges\u003c/code\u003e 则会让文档类记录宏包的变化记录。\u003c/p\u003e\n\u003cp\u003e接下来，30 行的 \u003ccode\u003e\\DocInput{\\jobname.dtx}\u003c/code\u003e 重新载入了这个文件本身，但（几乎）所有的 \u003ccode\u003e%\u003c/code\u003e 符号都被忽略。第 1 行遇到 \u003ccode\u003e\\iffalse\u003c/code\u003e，直到 16 行的 \u003ccode\u003e\\fi\u003c/code\u003e，中间的内容都被忽略。17 行是空行。18 行又遇到 \u003ccode\u003e\\iffalse\u003c/code\u003e，直到 33 行的 \u003ccode\u003e\\fi\u003c/code\u003e，中间的内容都被忽略。注意，这里正好跳过了 \u003ccode\u003edriver\u003c/code\u003e 部分。\u003c/p\u003e\n\u003cp\u003e接下来的 \u003ccode\u003e\\CheckSum\u003c/code\u003e 和 \u003ccode\u003e\\CharacterTable\u003c/code\u003e 是为了检测 \u003ccode\u003e.dtx\u003c/code\u003e 文件完整性的两个工具。众所周知，\u003ccode\u003e.dtx\u003c/code\u003e 文件包含了一个宏包的几乎所有信息，如果文件在网络传输的过程中出错，则宏包安装必然失败。因此，检测文件的完整性就变得很有必要。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\\CheckSum\u003c/code\u003e 采用了一个很简单的方案来检验完整性。它将从 \u003ccode\u003e\\StopEventually\u003c/code\u003e 开始到 \u003ccode\u003e\\Finale\u003c/code\u003e 结尾的，在 \u003ccode\u003emacrocode\u003c/code\u003e 环境里的反斜杠 \u003ccode\u003e\\\u003c/code\u003e 计数，将计数的值作为校验和。在生成文档的过程中，程序将会计算这个值，并于 \u003ccode\u003e\\CheckSum{}\u003c/code\u003e 中的值进行比对。若二者不一致，则说明传输过程中可能出现错误。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\\CharacterTable\u003c/code\u003e 更为直接一点。程序将检查代码中出现的符号均包含在 \u003ccode\u003e\\CharacterTable\u003c/code\u003e 之中。若不然，则认为传输过程中可能出错。\u003c/p\u003e\n\u003cp\u003e接下来的内容，直到第 76 行都很好理解。77 行出现了 \u003ccode\u003e\\StopEventually\u003c/code\u003e 命令，并在参数中启动了 \u003ccode\u003e\\PrintIndex\u003c/code\u003e 命令。我们刚才说了 \u003ccode\u003e\\StopEventually\u003c/code\u003e 会开启校验和的检查，而 \u003ccode\u003e\\PrintIndex\u003c/code\u003e 则会在此处打印代码索引。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003emacrocode\u003c/code\u003e 环境是一个特殊的环境，它有点类似于 LaTeX 原生的 \u003ccode\u003everbatim\u003c/code\u003e 环境。它在大多数情况下的行为和 \u003ccode\u003everbatim\u003c/code\u003e 环境相同，大体上是将代码输出到最终的文档当中。\u003c/p\u003e\n\u003cp\u003e这样持续运行到 103 行，遇到 \u003ccode\u003e\\Finale\u003c/code\u003e 命令，校验和计算的终点。此时，程序将会计算出校验和，并与文档中给出的校验和进行比较。如果 \u003ccode\u003e\\CheckSum\u003c/code\u003e 不存在，或者给出的值为 \u003ccode\u003e0\u003c/code\u003e，那么程序会给出正确的值，让你填入文档。如果 \u003ccode\u003e\\CheckSum\u003c/code\u003e 存在，但值与程序计算的不符，那么程序会报错，并给出正确的值。改正后重新编译才能得到文档。如果 \u003ccode\u003e\\CheckSum\u003c/code\u003e 存在，且校验和通过，那么程序会继续运行。\u003c/p\u003e\n\u003cp\u003e104 行是 \u003ccode\u003e\\endinput\u003c/code\u003e，结束整个文件，本次对 \u003ccode\u003edtxtut.dtx\u003c/code\u003e 的处理结束，回到上一次的断点。\u003c/p\u003e\n\u003cp\u003e30 行之后，31 行就是 \u003ccode\u003e\\end{document}\u003c/code\u003e，文档处理结束，之后的内容全都被忽略。输出文档，退出。\u003c/p\u003e\n\u003ch2 id=\"将-dtx-和-ins-合二为一\"\u003e\u003ca href=\"#将-dtx-和-ins-合二为一\" class=\"headerlink\" title=\"将 .dtx 和 .ins 合二为一\"\u003e\u003c/a\u003e将 \u003ccode\u003e.dtx\u003c/code\u003e 和 \u003ccode\u003e.ins\u003c/code\u003e 合二为一\u003c/h2\u003e\u003cp\u003e细心的读者会发现，整个过程中，\u003ccode\u003e.dtx\u003c/code\u003e 文件承担了几乎所有的功能，而 \u003ccode\u003e.ins\u003c/code\u003e 文件只是一个「指路人」。这些读者可能会思考，是不是有办法将 \u003ccode\u003e.ins\u003c/code\u003e 文件并入 \u003ccode\u003e.dtx\u003c/code\u003e 文件呢？答案是肯定的。\u003c/p\u003e\n\u003cp\u003e对于这类合二为一的 \u003ccode\u003e.dtx\u003c/code\u003e 文件，使用 Plain TeX 格式编译，会启动 DocStrip 工具，得到宏包文件；使用 LaTeX 格式编译，则会生成文档。\u003c/p\u003e\n\u003cp\u003e这里给出一个来自\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.zhihu.com/question/27693438\"\u003e知乎提问\u003c/a\u003e的\u003ca href=\"//liam.page/attachment/attachment/LaTeX-useful-tools/dtxtut/insdtxtut.dtx\"\u003e示例\u003c/a\u003e（略有修改），你可以在\u003ca target=\"_blank\" rel=\"noopener\" href=\"http://www.zhihu.com/question/27693438/answer/37669407\"\u003e我的答案\u003c/a\u003e里看到对此的具体分析。\u003c/p\u003e\n\u003ch2 id=\"最后的最后\"\u003e\u003ca href=\"#最后的最后\" class=\"headerlink\" title=\"最后的最后\"\u003e\u003c/a\u003e最后的最后\u003c/h2\u003e\u003cp\u003e今天是 W 的生日。祝你生日快乐~\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2015-01-23T07:48:35Z",
  "Author": "Liam Huang"
}