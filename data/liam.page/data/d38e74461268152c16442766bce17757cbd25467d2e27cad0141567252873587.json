{
  "Source": "liam.page",
  "Title": "让 Vim 在保存文件时自动格式化代码",
  "Link": "https://liam.page/2020/11/04/Vim-auto-format-codes-on-save/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e写代码时，遵循一定的代码风格是很有必要的。对于这种机械性的工作，我们的主张是要寻找自动化的解决方案。\u003c/p\u003e\n\u003cp\u003e对于 Vim 和 C++ 的组合，这里推荐以下搭配，并辅以适当配置：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eclang-format\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/Chiel92/vim-autoformat\"\u003e\u003ccode\u003evim-autoformat\u003c/code\u003e 插件\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cp\u003e配置分为两部分。一是实现在保存文件时自动格式化代码；二是实现在 visual 模式下格式化部分代码。\u003c/p\u003e\n\u003cfigure class=\"highlight vim\"\u003e\u003cfigcaption\u003e\u003cspan\u003e在保存文件时自动格式化代码\u003c/span\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eautocmd\u003c/span\u003e FileType \u003cspan class=\"keyword\"\u003ec\u003c/span\u003e,cpp \u003cspan class=\"keyword\"\u003eautocmd\u003c/span\u003e BufWritePre * :Autoformat\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里对 C 和 C++ 代码，在保存文件之前，自动执行 \u003ccode\u003e:Autoformat\u003c/code\u003e，以便使用 \u003ccode\u003evim-autoformat\u003c/code\u003e 插件调用 \u003ccode\u003eclang-format\u003c/code\u003e 格式化代码。\u003c/p\u003e\n\u003cfigure class=\"highlight vim\"\u003e\u003cfigcaption\u003e\u003cspan\u003e在 visual 模式下格式化部分代码\u003c/span\u003e\u003c/figcaption\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\u0026#34; autoformat\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"symbol\"\u003e\u0026lt;leader\u0026gt;\u003c/span\u003eff :\u003cspan class=\"keyword\"\u003ecall\u003c/span\u003e FormatCode(\u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;file\u0026#34;\u003c/span\u003e)\u003cspan class=\"symbol\"\u003e\u0026lt;CR\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003evnoremap\u003c/span\u003e \u003cspan class=\"symbol\"\u003e\u0026lt;leader\u0026gt;\u003c/span\u003eff :\u003cspan class=\"keyword\"\u003ecall\u003c/span\u003e FormatCode(\u003cspan class=\"built_in\"\u003evisualmode\u003c/span\u003e(), \u003cspan class=\"string\"\u003e\u0026#34;file\u0026#34;\u003c/span\u003e)\u003cspan class=\"symbol\"\u003e\u0026lt;CR\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"symbol\"\u003e\u0026lt;leader\u0026gt;\u003c/span\u003egf :\u003cspan class=\"keyword\"\u003ecall\u003c/span\u003e FormatCode(\u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;Google\u0026#34;\u003c/span\u003e)\u003cspan class=\"symbol\"\u003e\u0026lt;CR\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003evnoremap\u003c/span\u003e \u003cspan class=\"symbol\"\u003e\u0026lt;leader\u0026gt;\u003c/span\u003egf :\u003cspan class=\"keyword\"\u003ecall\u003c/span\u003e FormatCode(\u003cspan class=\"built_in\"\u003evisualmode\u003c/span\u003e(), \u003cspan class=\"string\"\u003e\u0026#34;Google\u0026#34;\u003c/span\u003e)\u003cspan class=\"symbol\"\u003e\u0026lt;CR\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"symbol\"\u003e\u0026lt;leader\u0026gt;\u003c/span\u003e\u003cspan class=\"keyword\"\u003ecf\u003c/span\u003e :\u003cspan class=\"keyword\"\u003ecall\u003c/span\u003e FormatCode(\u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;Chromium\u0026#34;\u003c/span\u003e)\u003cspan class=\"symbol\"\u003e\u0026lt;CR\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003evnoremap\u003c/span\u003e \u003cspan class=\"symbol\"\u003e\u0026lt;leader\u0026gt;\u003c/span\u003e\u003cspan class=\"keyword\"\u003ecf\u003c/span\u003e :\u003cspan class=\"keyword\"\u003ecall\u003c/span\u003e FormatCode(\u003cspan class=\"built_in\"\u003evisualmode\u003c/span\u003e(), \u003cspan class=\"string\"\u003e\u0026#34;Chromium\u0026#34;\u003c/span\u003e)\u003cspan class=\"symbol\"\u003e\u0026lt;CR\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003ennoremap\u003c/span\u003e \u003cspan class=\"symbol\"\u003e\u0026lt;leader\u0026gt;\u003c/span\u003e\u003cspan class=\"keyword\"\u003elf\u003c/span\u003e :\u003cspan class=\"keyword\"\u003ecall\u003c/span\u003e FormatCode(\u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;LLVM\u0026#34;\u003c/span\u003e)\u003cspan class=\"symbol\"\u003e\u0026lt;CR\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003evnoremap\u003c/span\u003e \u003cspan class=\"symbol\"\u003e\u0026lt;leader\u0026gt;\u003c/span\u003e\u003cspan class=\"keyword\"\u003elf\u003c/span\u003e :\u003cspan class=\"keyword\"\u003ecall\u003c/span\u003e FormatCode(\u003cspan class=\"built_in\"\u003evisualmode\u003c/span\u003e(), \u003cspan class=\"string\"\u003e\u0026#34;LLVM\u0026#34;\u003c/span\u003e)\u003cspan class=\"symbol\"\u003e\u0026lt;CR\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efunc! FormatCode(exe_mode, style) \u003cspan class=\"built_in\"\u003erange\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"variable\"\u003ea:exe_mode\u003c/span\u003e == \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003elet\u003c/span\u003e firstline_no = \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003elet\u003c/span\u003e lastline_no = \u003cspan class=\"built_in\"\u003eline\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#34;$\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003elet\u003c/span\u003e firstline_no = \u003cspan class=\"variable\"\u003ea:firstline\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003elet\u003c/span\u003e lastline_no = \u003cspan class=\"variable\"\u003ea:lastline\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"variable\"\u003el:save_formatdef\u003c/span\u003e = \u003cspan class=\"variable\"\u003eg:formatdef_clangformat\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"variable\"\u003el:tmpa\u003c/span\u003e = \u003cspan class=\"keyword\"\u003ejoin\u003c/span\u003e([\u003cspan class=\"string\"\u003e\u0026#34;clang-format --lines=\u0026#34;\u003c/span\u003e, firstline_no, \u003cspan class=\"string\"\u003e\u0026#34;:\u0026#34;\u003c/span\u003e, lastline_no], \u003cspan class=\"string\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"variable\"\u003eg:formatdef_clangformat\u003c/span\u003e = \u003cspan class=\"string\"\u003e\u0026#34;\u0026#39;\u0026#34;\u003c/span\u003e . \u003cspan class=\"variable\"\u003el:tmpa\u003c/span\u003e . \u003cspan class=\"string\"\u003e\u0026#34; --assume-filename=\u0026#39; . bufname(\u0026#39;%\u0026#39;) . \u0026#39; -style=\u0026#34;\u003c/span\u003e . \u003cspan class=\"variable\"\u003ea:style\u003c/span\u003e . \u003cspan class=\"string\"\u003e\u0026#34;\u0026#39;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003elet\u003c/span\u003e formatcommand = \u003cspan class=\"string\"\u003e\u0026#34;:Autoformat\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  exec formatcommand\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"variable\"\u003eg:formatdef_clangformat\u003c/span\u003e = \u003cspan class=\"variable\"\u003el:save_formatdef\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eendfunc\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这里利用 range 函数，根据调用时的所在的模式的不同，格式化整个文件，或者是在 Visual 模式下格式化选中的行。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2020-11-04T02:45:15Z",
  "Author": "Liam Huang"
}