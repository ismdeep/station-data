{
  "Source": "liam.page",
  "Title": "寻找不小于给定整数的最小的 2 的幂方",
  "Link": "https://liam.page/2019/02/14/find-smallest-power-of-2-that-is-not-less-than-a-given-integer/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cblockquote\u003e\n\u003cp\u003e这是一篇简单的记录。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e最近在写 YTL 的过程中遇到这样一个子问题：需要定义一个函数 \u003ccode\u003euint32_t func(uint32_t num)\u003c/code\u003e，返回不小于 \u003ccode\u003enum\u003c/code\u003e 的最小的 2 的幂方。例如\u003c/p\u003e\n\u003cfigure class=\"highlight cpp\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"number\"\u003e1\u003c/span\u003e == \u003cspan class=\"built_in\"\u003efunc\u003c/span\u003e(\u003cspan class=\"number\"\u003e1\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"number\"\u003e2\u003c/span\u003e == \u003cspan class=\"built_in\"\u003efunc\u003c/span\u003e(\u003cspan class=\"number\"\u003e2\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"number\"\u003e4\u003c/span\u003e == \u003cspan class=\"built_in\"\u003efunc\u003c/span\u003e(\u003cspan class=\"number\"\u003e3\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"number\"\u003e4\u003c/span\u003e == \u003cspan class=\"built_in\"\u003efunc\u003c/span\u003e(\u003cspan class=\"number\"\u003e4\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// ……\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e一开始我想了个用位运算的奇技淫巧，自我感觉还不错：\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003cfigure class=\"highlight cpp\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"type\"\u003euint32_t\u003c/span\u003e \u003cspan class=\"title\"\u003efunc\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003euint32_t\u003c/span\u003e num)\u003c/span\u003e \u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"type\"\u003euint32_t\u003c/span\u003e res = \u003cspan class=\"number\"\u003e1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e (res \u0026lt; num) {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    res \u0026lt;\u0026lt;= \u003cspan class=\"number\"\u003e1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e res;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e后来一想，「不要在编译器面前装屄」，于是发现老实用 \u003ccode\u003estd::log2\u003c/code\u003e 来计算的话，效率要高出五倍多：\u003c/p\u003e\n\u003cfigure class=\"highlight cpp\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// #include \u0026lt;cmath\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"type\"\u003euint32_t\u003c/span\u003e \u003cspan class=\"title\"\u003efunc\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003euint32_t\u003c/span\u003e num)\u003c/span\u003e \u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"number\"\u003e1\u003c/span\u003e \u0026lt;\u0026lt; \u003cspan class=\"built_in\"\u003estatic_cast\u003c/span\u003e\u0026lt;\u003cspan class=\"type\"\u003eint\u003c/span\u003e\u0026gt;(std::\u003cspan class=\"built_in\"\u003eceil\u003c/span\u003e(std::\u003cspan class=\"built_in\"\u003elog2\u003c/span\u003e(num)));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e再一想，\u003ccode\u003estd::ceil\u003c/code\u003e 本来就快，\u003ccode\u003estd::log2\u003c/code\u003e 有快速解法。那么如果把 \u003ccode\u003e1 \u0026lt;\u0026lt; foo\u003c/code\u003e 换成 \u003ccode\u003estd::pow(2.0, foo)\u003c/code\u003e 会怎样呢？结果发现，大概是由于 \u003ccode\u003estd::pow\u003c/code\u003e 是为浮点数运算设计的，所以没为 2 的幂方做优化，所以效率还不如位运算：\u003c/p\u003e\n\u003cfigure class=\"highlight cpp\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e// #include \u0026lt;cmath\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"type\"\u003euint32_t\u003c/span\u003e \u003cspan class=\"title\"\u003efunc\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"type\"\u003euint32_t\u003c/span\u003e num)\u003c/span\u003e \u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e std::\u003cspan class=\"built_in\"\u003epow\u003c/span\u003e(\u003cspan class=\"number\"\u003e2.0\u003c/span\u003e, std::\u003cspan class=\"built_in\"\u003eceil\u003c/span\u003e(std::\u003cspan class=\"built_in\"\u003elog2\u003c/span\u003e(num)));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e以上。\u003c/p\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-02-14T02:36:18Z",
  "Author": "Liam Huang"
}