{
  "Source": "liam.page",
  "Title": "于 CentOS 7 上编译安装 Python 3.7.2",
  "Link": "https://liam.page/2019/03/19/compile-and-install-Python-3-7-2-on-CentOS-7/",
  "Content": "\u003cdiv class=\"post-body\" itemprop=\"articleBody\"\u003e\n\n      \n        \u003cp\u003e又到了愉悦地配置系统的时间……今日的任务是在 CentOS 7 上安装最新版本的 Python 3.7.2。\u003c/p\u003e\n\u003cp\u003e由于前些日子，蛤力橙表示 Anaconda 是 some what 邪恶的，所以这次不打算偷懒用 Anaconda 了，而是选择从源码编译安装。这里记录一些踩过的坑。\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\n\u003ch2 id=\"安装完成后-yum-等脚本挂掉\"\u003e\u003ca href=\"#安装完成后-yum-等脚本挂掉\" class=\"headerlink\" title=\"安装完成后 yum 等脚本挂掉\"\u003e\u003c/a\u003e安装完成后 \u003ccode\u003eyum\u003c/code\u003e 等脚本挂掉\u003c/h2\u003e\u003cp\u003e原因：\u003ccode\u003eyum\u003c/code\u003e 等脚本依赖 Python2 而非 Python3。这次跨大版本升级，会破坏 \u003ccode\u003eyum\u003c/code\u003e 等脚本 shebang 头部的指令。\u003c/p\u003e\n\u003cp\u003e解决办法：使 \u003ccode\u003eyum\u003c/code\u003e 等脚本显式依赖 Python2。\u003c/p\u003e\n\u003cp\u003e具体：修改 \u003ccode\u003e/usr/bin\u003c/code\u003e 下 \u003ccode\u003eyum\u003c/code\u003e 相关脚本的 shebang 头，将 \u003ccode\u003epython\u003c/code\u003e 修改为 \u003ccode\u003epython2\u003c/code\u003e。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ \u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e /usr/bin\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$ \u003cspan class=\"built_in\"\u003els\u003c/span\u003e -al yum*\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-rwxr-xr-x. 1 root root   801 11月 15 2016 yum\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-rwxr-xr-x. 1 root root  9429 11月  6 2016 yum-builddep\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-rwxr-xr-x. 1 root root  8582 11月  6 2016 yum-config-manager\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-rwxr-xr-x. 1 root root  7609 11月  6 2016 yum-debug-dump\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-rwxr-xr-x. 1 root root  7903 11月  6 2016 yum-debug-restore\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-rwxr-xr-x. 1 root root 10999 11月  6 2016 yumdownloader\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e-rwxr-xr-x. 1 root root 11031 11月  6 2016 yum-groups-manager\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"安装过程中缺胳膊少腿\"\u003e\u003ca href=\"#安装过程中缺胳膊少腿\" class=\"headerlink\" title=\"安装过程中缺胳膊少腿\"\u003e\u003c/a\u003e安装过程中缺胳膊少腿\u003c/h2\u003e\u003cp\u003e原因：Python 依赖其他第三方库，而这些库在系统内没有安装，或者安装的位置不在 Python 安装脚本默认搜索的范围内。\u003c/p\u003e\n\u003cp\u003e解决办法：使用 \u003ccode\u003eyum\u003c/code\u003e 一口气安装就好了。\u003c/p\u003e\n\u003cp\u003e具体：执行下列 \u003ccode\u003eyum\u003c/code\u003e 命令。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ yum install -y ncurses-libs zlib-devel mysql-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel libffi-devel\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"安装完成后-pip-提示没有可用的-SSL，以至于无法访问-https-协议的源\"\u003e\u003ca href=\"#安装完成后-pip-提示没有可用的-SSL，以至于无法访问-https-协议的源\" class=\"headerlink\" title=\"安装完成后 pip 提示没有可用的 SSL，以至于无法访问 https 协议的源\"\u003e\u003c/a\u003e安装完成后 \u003ccode\u003epip\u003c/code\u003e 提示没有可用的 SSL，以至于无法访问 \u003ccode\u003ehttps\u003c/code\u003e 协议的源\u003c/h2\u003e\u003cp\u003e原因：Python 编译时没有将 SSL 编译进去。\u003c/p\u003e\n\u003cp\u003e解决办法：安装符合要求的 OpenSSL 版本，并在 \u003ccode\u003e./configure\u003c/code\u003e 时添加 \u003ccode\u003e--with-ssl\u003c/code\u003e 参数。\u003c/p\u003e\n\u003cp\u003e具体：执行下列命令。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e$ \u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e /path/to/downloads\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$ wget https://www.openssl.org/source/openssl-1.1.1b.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$ tar zvxf openssl-1.1.1b.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$ \u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e openssl-1.1.1b\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$ ./config -fPIC --prefix=/usr/ --openssldir=/usr/openssl enable-shared shared zlib\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$ make -j24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e$ make install\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e注意：必须安装 1.0.2 以上版本的 OpenSSL，故而 \u003ccode\u003eyum\u003c/code\u003e 源当中的 1.0.1 版本不可用。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"依赖-SSL-之后提示-UUID-编译失败\"\u003e\u003ca href=\"#依赖-SSL-之后提示-UUID-编译失败\" class=\"headerlink\" title=\"依赖 SSL 之后提示 UUID 编译失败\"\u003e\u003c/a\u003e依赖 SSL 之后提示 UUID 编译失败\u003c/h2\u003e\u003cp\u003e原因：Python 的 UUID 相关扩展的代码有 bug；无法正确载入 \u003ccode\u003euuid.h\u003c/code\u003e 头文件或者载入了两个版本的头文件。\u003c/p\u003e\n\u003cp\u003e解决办法：修改相应头文件。\u003c/p\u003e\n\u003cp\u003e具体：在 Python 源码根目录，编辑 \u003ccode\u003e./Modules/_uuidmodule.c\u003c/code\u003e 文件，修改头部 \u003ccode\u003e#include\u003c/code\u003e 部分的代码如下：\u003c/p\u003e\n\u003cfigure class=\"highlight c\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"keyword\"\u003edefine\u003c/span\u003e PY_SSIZE_T_CLEAN\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Python.h\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"keyword\"\u003eifdef\u003c/span\u003e HAVE_UUID_UUID_H\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026lt;uuid/uuid.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026lt;uuid.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"总结\"\u003e\u003ca href=\"#总结\" class=\"headerlink\" title=\"总结\"\u003e\u003c/a\u003e总结\u003c/h2\u003e\u003cp\u003e总结一下编译安装 Python 3.7.2 时用到的命令。\u003c/p\u003e\n\u003cfigure class=\"highlight bash\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eyum install -y ncurses-libs zlib-devel mysql-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel uuid-devel libuuid-devel libffi-devel\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e /path/to/downloads\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewget https://www.openssl.org/source/openssl-1.1.1b.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003etar zvxf openssl-1.1.1b.tar.gz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e openssl-1.1.1b\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e./config -fPIC --prefix=/usr/ --openssldir=/usr/openssl enable-shared shared zlib\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emake -j24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emake install\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e /path/to/downloads\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ewget https://www.python.org/ftp/python/3.7.2/Python-3.7.2.tgz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003etar zvxf Python-3.7.2.tgz\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e Python-3.7.2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esed -i \u003cspan class=\"string\"\u003e\u0026#34;6s/endif/else/\u0026#34;\u003c/span\u003e ./Modules/_uuidmodule.c\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esed -i \u003cspan class=\"string\"\u003e\u0026#34;7d\u0026#34;\u003c/span\u003e ./Modules/_uuidmodule.c\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e./configure --prefix=/usr/local/python3.7.2 --enable-optimizations --enable-shared --enable-profiling --with-ssl\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emake -j24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emake install\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003ecd\u003c/span\u003e /usr/bin\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e fname \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e $(\u003cspan class=\"built_in\"\u003els\u003c/span\u003e /usr/local/python3.7.2/bin/); \u003cspan class=\"keyword\"\u003edo\u003c/span\u003e \u003cspan class=\"built_in\"\u003eln\u003c/span\u003e -sf /usr/local/python3.7.2/bin/\u003cspan class=\"variable\"\u003e${fname}\u003c/span\u003e ./\u003cspan class=\"variable\"\u003e${fname}\u003c/span\u003e; \u003cspan class=\"keyword\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eln\u003c/span\u003e -sf pydoc3 pydoc\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eln\u003c/span\u003e -sf python3 python\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eln\u003c/span\u003e -sf python3-config python-config\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"built_in\"\u003eln\u003c/span\u003e -sf pip3 pip\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-03-19T08:59:02Z",
  "Author": "Liam Huang"
}