{
  "Source": "morningspace",
  "Title": "Docker Registry CLI Tutorial - More Use",
  "Link": "https://morningspace.github.io/tech/reg-cli-tutorial-2/",
  "Content": "\u003cdiv class=\"page__inner-wrap\"\u003e\n      \n\n      \u003csection class=\"page__content e-content\" itemprop=\"text\"\u003e\n        \n          \u003caside class=\"sidebar__right sticky\"\u003e\n            \u003cnav class=\"toc\"\u003e\n              \u003cheader\u003e\u003ch4 class=\"nav__title\"\u003e\u003ci class=\"fas fa-file-alt\"\u003e\u003c/i\u003e 在本页上\u003c/h4\u003e\u003c/header\u003e\n              \u003cul class=\"toc__menu\"\u003e\u003cli\u003e\u003ca href=\"#copy-more-images\"\u003eCopy more images\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#copy-in-batch-using-list-file\"\u003eCopy in batch using .list file\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#remove-images-or-tags\"\u003eRemove images or tags\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\n\n            \u003c/nav\u003e\n          \u003c/aside\u003e\n        \n        \u003cp\u003eThe open source project \u003ca href=\"https://github.com/morningspace/docker-registry-cli\"\u003eDocker Registry CLI\u003c/a\u003e is released by MorningSpace Studio! This post tells you more advanced use.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/studio/docker_registry.png\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003ch2 id=\"copy-more-images\"\u003eCopy more images\u003c/h2\u003e\n\n\u003cp\u003eLet’s copy more images to the registry. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereg-cli cp\u003c/code\u003e can copy multiple images at a time. Just append the images after the command and separate them by space.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# reg-cli \u003cspan class=\"nb\"\u003ecp \u003c/span\u003emorningspace/docker-registry-cli morningspace/elastic-shell mr.io\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThis will copy both \u003ccode class=\"language-plaintext highlighter-rouge\"\u003edocker-registry-cli\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eelastic-shell\u003c/code\u003e images to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emr.io\u003c/code\u003e. Apply the same pattern to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereg-cli ls\u003c/code\u003e, we can list tags for multiple images.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# reg-cli \u003cspan class=\"nb\"\u003els \u003c/span\u003emr.io/docker-registry-cli mr.io/elastic-shell\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eOf course you can use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-ld\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-lm\u003c/code\u003e options to list digests and manifests for these images.\u003c/p\u003e\n\n\u003ch2 id=\"copy-in-batch-using-list-file\"\u003eCopy in batch using .list file\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereg-cli cp\u003c/code\u003e can also support to read from configuration files. We can use the registry name as the file name and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.list\u003c/code\u003e as the extension name, add the name of each image that you want to copy to the file, one image per line. Then run \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereg-cli cp\u003c/code\u003e, and specify the registry name. It will find the corresponding \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.list\u003c/code\u003e file in current folder by using the registry name and read the images from the file one by one, then copy them to the target registry.\u003c/p\u003e\n\n\u003cp\u003eThere are some examples distributed with the cli on the \u003ca href=\"https://github.com/morningspace/docker-registry-cli\"\u003eGit repository\u003c/a\u003e at the folder \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e/samples/registries\u003c/code\u003e. Let’s take \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emorningspace.list\u003c/code\u003e as example, it includes some images where the names are all started with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emorningspace\u003c/code\u003e. These images are all from \u003ca href=\"https://hub.docker.com/u/morningspace\"\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003emorningspace\u003c/code\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003emorningspace/lab-web\nmorningspace/lab-lb\nmorningspace/lab-git-remote\nmorningspace/lab-git-local\nmorningspace/elastic-shell\nmorningspace/docker-registry-cli\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eMove to that folder, and run \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereg-cli cp\u003c/code\u003e. That will copy all these images from Docker Hub to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emr.io\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eMoreover, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.list\u003c/code\u003e files can be nested. For example, let’s check \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eall.list\u003c/code\u003e. It has two entries, where each one references the corresponding \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.list\u003c/code\u003e file stored in the same folder.\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ek8s.gcr.io\nmorningspace\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eLet’s run the reg-cli cp for all.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# reg-cli \u003cspan class=\"nb\"\u003ecp \u003c/span\u003eall mr.io\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWhen finished, let’s run \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereg-cli ls\u003c/code\u003e to list the catalog of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emr.io\u003c/code\u003e.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# reg-cli \u003cspan class=\"nb\"\u003els \u003c/span\u003emr.io\nmr.io\n\u003cspan class=\"nt\"\u003e---------------------------------------\u003c/span\u003e\ncoredns\ndocker-registry-cli\nelastic-shell\netcd\nhyperkube\nkubernetes-dashboard-amd64\nlab-git-local\nlab-git-remote\nlab-lb\nlab-web\npause\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eYou will see images that are configured in the two \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.list\u003c/code\u003e files are all copied to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emr.io\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eAgain, we can use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereg-cli ls\u003c/code\u003e with multiple images to list tags for these images, use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-ld\u003c/code\u003e to list digests, and use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-lm\u003c/code\u003e to list manifests.\u003c/p\u003e\n\n\u003cp\u003eWe can even apply these options to the whole registry, to list all images, their tags, digests and manifests. For example, let’s use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-lt\u003c/code\u003e to list tags for all images, and append \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eless\u003c/code\u003e as it may be too tedious to read the whole bunch of these contents.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# reg-cli \u003cspan class=\"nb\"\u003els \u003c/span\u003emr.io \u003cspan class=\"nt\"\u003e-lt\u003c/span\u003e\nmr.io/coredns\n\u003cspan class=\"nt\"\u003e---------------------------------------\u003c/span\u003e\n1.2.6\n\nmr.io/docker-registry-cli\n\u003cspan class=\"nt\"\u003e---------------------------------------\u003c/span\u003e\nlatest\n\nmr.io/elastic-shell\n\u003cspan class=\"nt\"\u003e---------------------------------------\u003c/span\u003e\nlatest\nv0.3\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAs you can see, we only used two commands with just a few options. But they can be combined in many different ways to do a lot of things.\u003c/p\u003e\n\n\u003ch2 id=\"remove-images-or-tags\"\u003eRemove images or tags\u003c/h2\u003e\n\n\u003cp\u003eNow, let’s remove some images from the registry. We can run \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ereg-cli rm\u003c/code\u003e to remove just one tag for an image.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# reg-cli \u003cspan class=\"nb\"\u003erm \u003c/span\u003emr.io/hyperkube:v1.13.0\nreg-cli:\u003cspan class=\"o\"\u003e(\u003c/span\u003eINFO\u003cspan class=\"o\"\u003e)\u003c/span\u003e going to remove hyperkube:v1.13.0\nAre you sure? \u003cspan class=\"o\"\u003e[\u003c/span\u003ey/N] y\nreg-cli:\u003cspan class=\"o\"\u003e(\u003c/span\u003eINFO\u003cspan class=\"o\"\u003e)\u003c/span\u003e digest: sha256:8ef688eb5bb739e7f22502e15b78eb6bd684d2957dfda7c64638cec0e9eacb3d\nreg-cli:\u003cspan class=\"o\"\u003e(\u003c/span\u003eINFO\u003cspan class=\"o\"\u003e)\u003c/span\u003e ✔ hyperkube:v1.13.0 removed\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe tag is removed after we input y to confirm.\u003c/p\u003e\n\n\u003cp\u003eAlso, we can remove multiple tags for the same image in one line.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# reg-cli \u003cspan class=\"nb\"\u003erm \u003c/span\u003emr.io/hyperkube:v1.13.0,v1.12.1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIf there’s no tag appended, it will remove all tags for that image.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# reg-cli \u003cspan class=\"nb\"\u003erm \u003c/span\u003emr.io/hyperkube\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd, if you want to enforce the removal, you can use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-f\u003c/code\u003e option.\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# reg-cli \u003cspan class=\"nb\"\u003erm \u003c/span\u003emr.io/hyperkube:v1.13.0,v1.12.1 \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(The end)\u003c/p\u003e\n\n\u003chr/\u003e\n\u003cp\u003e\u003cem\u003eHave fun!\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eMorningSpace Studio\u003c/em\u003e\u003c/p\u003e\n\n        \n      \u003c/section\u003e\n\n      \u003cfooter class=\"page__meta\"\u003e\n        \n        \n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-tags\" aria-hidden=\"true\"\u003e\u003c/i\u003e 标签: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/tags/#docker\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003edocker\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#shell\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003eshell\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#studio\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003estudio\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#studio-reg-cli\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003estudio-reg-cli\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n\n\n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-folder-open\" aria-hidden=\"true\"\u003e\u003c/i\u003e 分类: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/categories/#tech\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003etech\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n        \n\n  \u003cp class=\"page__date\"\u003e\u003cstrong\u003e\u003ci class=\"fas fa-fw fa-calendar-alt\" aria-hidden=\"true\"\u003e\u003c/i\u003e 更新时间:\u003c/strong\u003e \u003ctime class=\"dt-published\" datetime=\"2019-06-01T00:00:00+08:00\"\u003eJune 1, 2019\u003c/time\u003e\u003c/p\u003e\n\n      \u003c/footer\u003e\n\n      \u003csection class=\"page__share\"\u003e\n  \n    \u003ch4 class=\"page__share-title\"\u003e分享\u003c/h4\u003e\n  \n\n  \u003ca href=\"https://twitter.com/intent/tweet?text=Docker+Registry+CLI+Tutorial+-+More+Use%20https%3A%2F%2Fmorningspace.github.io%2Ftech%2Freg-cli-tutorial-2%2F\" class=\"btn btn--twitter\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Twitter\"\u003e\u003ci class=\"fab fa-fw fa-twitter\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Twitter\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Freg-cli-tutorial-2%2F\" class=\"btn btn--facebook\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Facebook\"\u003e\u003ci class=\"fab fa-fw fa-facebook\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Facebook\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.linkedin.com/shareArticle?mini=true\u0026amp;url=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Freg-cli-tutorial-2%2F\" class=\"btn btn--linkedin\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 LinkedIn\"\u003e\u003ci class=\"fab fa-fw fa-linkedin\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e LinkedIn\u003c/span\u003e\u003c/a\u003e\n\u003c/section\u003e\n\n\n      \n  \u003cnav class=\"pagination\"\u003e\n    \n      \u003ca href=\"/tech/reg-cli-tutorial-1/\" class=\"pagination--pager\" title=\"Docker Registry CLI Tutorial - Basic Use\n\"\u003e向前\u003c/a\u003e\n    \n    \n      \u003ca href=\"/tech/books/morningspace-books/\" class=\"pagination--pager\" title=\"晴耕书斋栏目正式上线\n\"\u003e向后\u003c/a\u003e\n    \n  \u003c/nav\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-06-01T00:00:00+08:00",
  "Author": "MornigSpace"
}