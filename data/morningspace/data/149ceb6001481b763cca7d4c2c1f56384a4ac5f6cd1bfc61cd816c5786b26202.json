{
  "Source": "morningspace",
  "Title": "增强版OpenShift CLI的更多功能",
  "Link": "https://morningspace.github.io/tech/enhanced-oc-3/",
  "Content": "\u003cdiv class=\"page__inner-wrap\"\u003e\n      \n\n      \u003csection class=\"page__content e-content\" itemprop=\"text\"\u003e\n        \n          \u003caside class=\"sidebar__right sticky\"\u003e\n            \u003cnav class=\"toc\"\u003e\n              \u003cheader\u003e\u003ch4 class=\"nav__title\"\u003e\u003ci class=\"fas fa-file-alt\"\u003e\u003c/i\u003e 在本页上\u003c/h4\u003e\u003c/header\u003e\n              \u003cul class=\"toc__menu\"\u003e\u003cli\u003e\u003ca href=\"#层级化管理集群\"\u003e层级化管理集群\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#在多个集群中选择\"\u003e在多个集群中选择\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#模糊查找\"\u003e模糊查找\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#定制shell提示\"\u003e定制Shell提示\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#小结\"\u003e小结\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\n\n            \u003c/nav\u003e\n          \u003c/aside\u003e\n        \n        \u003cblockquote\u003e\n  \u003cp\u003e增强版OpenShift CLI可以帮助我们高效而安全的管理大量的OpenShift集群。它是一个位于\u003ca href=\"https://github.com/morningspace/enhanced-oc\"\u003eGitHub\u003c/a\u003e上的开源项目。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e作为增强版OpenShift CLI系列文章的第三篇，本文将和大家分享有关这一工具所提供的更多有意思的功能。\u003c/p\u003e\n\n\u003ch2 id=\"层级化管理集群\"\u003e层级化管理集群\u003c/h2\u003e\n\n\u003cp\u003e在一个实际项目里，同时管理多个集群是一件很常见的事。使用增强版oc，通过指定别名可以实现在多个集群之间的快速切换，这样做即安全又高效。不过，随着集群数量的增加，管理成本还是会逐步上升。针对这种情况，一种更为有效的方法，是将这些集群以层级化的方式进行管理。\u003c/p\u003e\n\n\u003cp\u003e增强版oc底层依赖于gopass，而gopass天生就具备层级化管理加密数据的能力。这是因为，gopass在存储加密数据时，把一组加密数据以一个独立文件的形式保存在secret store里，而彼此相关的一组文件可以根据需要存放在同一目录下面。例如，假设有三个集群，我们可以采用\u003ccode class=\"language-plaintext highlighter-rouge\"\u003epath/to/your/context\u003c/code\u003e这样的格式来为集群定义别名。\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eoc login \u003cspan class=\"nt\"\u003e-s\u003c/span\u003e https://api.foo.example.com \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e dev-env/cluster-foo\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eoc login \u003cspan class=\"nt\"\u003e-s\u003c/span\u003e https://api.bar.example.com \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e dev-env/cluster-bar\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eoc login \u003cspan class=\"nt\"\u003e-s\u003c/span\u003e https://api.baz.example.com \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e dev-env/cluster-baz\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e这样，集群的访问信息就会以层级化的方式保存在secret store里，相应的目录结构与我们定义别名时的格式保持一致。这一点可以通过执行\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egopass ls\u003c/code\u003e命令清楚直观的展现出来：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egopass \u003cspan class=\"nb\"\u003els\n\u003c/span\u003egopass\n└── dev-env\n    ├── cluster-foo\n    ├── cluster-bar\n    └── cluster-baz\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e当我们在这些集群之间切换时，只要给出\u003ccode class=\"language-plaintext highlighter-rouge\"\u003epath/to/your/context\u003c/code\u003e别名即可：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eoc login \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e dev-env/cluster-foo\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eoc login \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e dev-env/cluster-bar\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eoc login \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e dev-env/cluster-baz\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"在多个集群中选择\"\u003e在多个集群中选择\u003c/h2\u003e\n\n\u003cp\u003e以层级化方式对集群进行管理允许我们能够非常高效的管理大量集群，我们可以把集群按照不同的用途进行分类。不过，由于别名里包含了层级结构，输入完整的别名就会变得有点冗长。\u003c/p\u003e\n\n\u003cp\u003e增强版oc允许我们在输入集群的别名时只输入名字的一部分。例如，如果我们把所有开发用的集群环境都放到\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edev-env\u003c/code\u003e类别下，相应的集群别名均以\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edev-env\u003c/code\u003e打头。那么，当我们指定别名的时候，只要输入完整名字的几个首字母，比如：\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ede\u003c/code\u003e，\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edev\u003c/code\u003e，\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edev-\u003c/code\u003e，\u003ccode class=\"language-plaintext highlighter-rouge\"\u003edev-env\u003c/code\u003e，就会有多个满足输入条件的集群返回回来。这些集群会以有序列表的形式依次排列，要想选中其中一个集群登录，只要输入集群前面的数字即可：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eoc login \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e dev\n1\u003cspan class=\"o\"\u003e)\u003c/span\u003e dev-env/cluster-bar\n2\u003cspan class=\"o\"\u003e)\u003c/span\u003e dev-env/cluster-baz\n3\u003cspan class=\"o\"\u003e)\u003c/span\u003e dev-env/cluster-foo\n\u003cspan class=\"c\"\u003e#? 1\u003c/span\u003e\nRead context \u003cspan class=\"s1\"\u003e\u0026#39;dev-env/cluster-bar\u0026#39;\u003c/span\u003e from secret store...\nContext loaded successfully.\nLogin successful.\n\nYou have access to 59 projects, the list has been suppressed. You can list all projects with \u003cspan class=\"s1\"\u003e\u0026#39;oc projects\u0026#39;\u003c/span\u003e\n\nUsing project \u003cspan class=\"s2\"\u003e\u0026#34;default\u0026#34;\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"模糊查找\"\u003e模糊查找\u003c/h2\u003e\n\n\u003cp\u003e增强版oc允许我们在输入集群的别名时只输入名字的一部分，从而进一步提高了在多个集群间切换的效率。不仅如此，如果我们安装了\u003ca href=\"https://github.com/junegunn/fzf\"\u003efzf\u003c/a\u003e，一个通用的支持模糊查找与过滤的命令行工具，就可以在指定别名时利用typeahead实现模糊查找的功能了。增强版oc与fzf做了无缝集成，不需要额外配置，它会自动监测fzf存在与否，并开启相应的模糊查找功能。有关fzf的安装，请参考其\u003ca href=\"https://github.com/junegunn/fzf#installation\"\u003e文档\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/studio/enhanced-oc/enhanced-oc-2.gif\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003ch2 id=\"定制shell提示\"\u003e定制Shell提示\u003c/h2\u003e\n\n\u003cp\u003e我们还可以安装\u003ca href=\"https://github.com/jonmosco/kube-ps1\"\u003ekube-ps1\u003c/a\u003e。这是一个脚本程序，允许把当前集群的上下文信息，包括当前所在的namespace，在命令行的Shell提示里显示出来。当我们需要同时管理多个集群，并在这些集群之间来回切换的时候，这一功能就会非常有用。通过查看命令行的Shell提示信息，我们可以快速获知当前操作的是哪个集群，从而避免了误操作。\u003c/p\u003e\n\n\u003cp\u003e增强版oc和kube-ps1做了无缝集成，不需要额外配置，它会自动监测kube-ps1存在与否，并对kube-ps1控制的Shell提示进行定制，将完整的集群上下文名称替换为相应的集群别名，通常而言，后者要比前者更短更易于记忆。有关kube-ps1的安装，请参考其\u003ca href=\"https://github.com/jonmosco/kube-ps1#installing\"\u003e文档\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/studio/enhanced-oc/enhanced-oc-3.gif\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003ch2 id=\"小结\"\u003e小结\u003c/h2\u003e\n\n\u003cp\u003e本文中，我们学习了有关增强版oc的更多有趣的功能，比如：以层级化方式对集群进行管理；通过只输入别名的一部分，实现多个集群间的快速切换；以及通过对Shell提示的定制，显示当前操作的集群。在下一篇文章里，我将向大家介绍增强版oc的另一个重要的功能：如何将集群访问信息分享给团队中的其他成员。\u003c/p\u003e\n\n\u003cp\u003e如果你想了解更多有关增强版OpenShift CLI的信息，请阅读它的\u003ca href=\"https://morningspace.github.io/oc/docs/\"\u003e在线文档\u003c/a\u003e。如果你喜欢这个项目，欢迎给它\u003ca href=\"https://github.com/morningspace/oc\"\u003e加星\u003c/a\u003e。同时，也非常欢迎针对该项目的任何形式的贡献，比如bug报告以及代码提交。\u003c/p\u003e\n\n        \n      \u003c/section\u003e\n\n      \u003cfooter class=\"page__meta\"\u003e\n        \n        \n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-tags\" aria-hidden=\"true\"\u003e\u003c/i\u003e 标签: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/tags/#kubernetes\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003ekubernetes\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#openshift\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003eopenshift\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n\n\n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-folder-open\" aria-hidden=\"true\"\u003e\u003c/i\u003e 分类: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/categories/#tech\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003etech\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n        \n\n  \u003cp class=\"page__date\"\u003e\u003cstrong\u003e\u003ci class=\"fas fa-fw fa-calendar-alt\" aria-hidden=\"true\"\u003e\u003c/i\u003e 更新时间:\u003c/strong\u003e \u003ctime class=\"dt-published\" datetime=\"2021-08-02T00:00:00+08:00\"\u003eAugust 2, 2021\u003c/time\u003e\u003c/p\u003e\n\n      \u003c/footer\u003e\n\n      \u003csection class=\"page__share\"\u003e\n  \n    \u003ch4 class=\"page__share-title\"\u003e分享\u003c/h4\u003e\n  \n\n  \u003ca href=\"https://twitter.com/intent/tweet?text=%E5%A2%9E%E5%BC%BA%E7%89%88OpenShift+CLI%E7%9A%84%E6%9B%B4%E5%A4%9A%E5%8A%9F%E8%83%BD%20https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fenhanced-oc-3%2F\" class=\"btn btn--twitter\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Twitter\"\u003e\u003ci class=\"fab fa-fw fa-twitter\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Twitter\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fenhanced-oc-3%2F\" class=\"btn btn--facebook\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Facebook\"\u003e\u003ci class=\"fab fa-fw fa-facebook\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Facebook\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.linkedin.com/shareArticle?mini=true\u0026amp;url=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fenhanced-oc-3%2F\" class=\"btn btn--linkedin\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 LinkedIn\"\u003e\u003ci class=\"fab fa-fw fa-linkedin\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e LinkedIn\u003c/span\u003e\u003c/a\u003e\n\u003c/section\u003e\n\n\n      \n  \u003cnav class=\"pagination\"\u003e\n    \n      \u003ca href=\"/tech/enhanced-oc-2/\" class=\"pagination--pager\" title=\"增强版OpenShift CLI快速入门\n\"\u003e向前\u003c/a\u003e\n    \n    \n      \u003ca href=\"/tech/enhanced-oc-4/\" class=\"pagination--pager\" title=\"在团队中使用增强版OpenShift CLI\n\"\u003e向后\u003c/a\u003e\n    \n  \u003c/nav\u003e\n\n    \u003c/div\u003e",
  "Date": "2021-08-02T00:00:00+08:00",
  "Author": "MornigSpace"
}