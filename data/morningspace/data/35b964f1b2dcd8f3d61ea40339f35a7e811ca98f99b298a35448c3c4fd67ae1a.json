{
  "Source": "morningspace",
  "Title": "Git合并那些事——Rebase的烦恼",
  "Link": "https://morningspace.github.io/tech/git-merge-stories-8/",
  "Content": "\u003cdiv class=\"page__inner-wrap\"\u003e\n      \n\n      \u003csection class=\"page__content e-content\" itemprop=\"text\"\u003e\n        \n          \u003caside class=\"sidebar__right sticky\"\u003e\n            \u003cnav class=\"toc\"\u003e\n              \u003cheader\u003e\u003ch4 class=\"nav__title\"\u003e\u003ci class=\"fas fa-file-alt\"\u003e\u003c/i\u003e 在本页上\u003c/h4\u003e\u003c/header\u003e\n              \u003cul class=\"toc__menu\"\u003e\u003cli\u003e\u003ca href=\"#烦恼在哪里\"\u003e烦恼在哪里\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#烦恼的前奏\"\u003e烦恼的前奏\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#烦恼的开始\"\u003e烦恼的开始\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#烦恼的解决\"\u003e烦恼的解决\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\n\n            \u003c/nav\u003e\n          \u003c/aside\u003e\n        \n        \u003cblockquote\u003e\n  \u003cp\u003e多人开发中的合并冲突是我们使用Git时常常会遇到的情况，小小合并门道大，讲述合并的那些事儿，晴耕 · 白话之“Git合并那些事”系列​持续连载中……\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e注：\n本文的部分写作灵感来自于\u003ca href=\"https://git-scm.com/book/en/v2\"\u003e“Pro Git book”\u003c/a\u003e。感谢原作者的精彩分享。\n本文采用\u003ca rel=\"license\" href=\"http://creativecommons.org/licenses/by-sa/4.0/\"\u003e知识共享署名-相同方式共享 4.0 国际许可协议\u003c/a\u003e进行许可。\u003ca rel=\"license\" href=\"http://creativecommons.org/licenses/by-sa/4.0/\"\u003e\u003cimg alt=\"知识共享许可协议\" style=\"border-width:0\" src=\"https://i.creativecommons.org/l/by-sa/4.0/80x15.png\"/\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/lab/git/rebase-3.jpeg\" alt=\"\" class=\"align-center\"/\u003e\u003c/p\u003e\n\n\u003ch2 id=\"烦恼在哪里\"\u003e烦恼在哪里\u003c/h2\u003e\n\n\u003cp\u003e通过\u003ca href=\"/tech/git-merge-stories-6/\"\u003e“Git合并那些事儿——神奇的Rebase”\u003c/a\u003e一文我们明白了，Rebase本质上就是丢弃已有的提交记录，创建新的提交记录，从内容上看是完全一样的，但提交历史却改变了。\u003c/p\u003e\n\n\u003cp\u003e对提交历史的修改是需要谨慎的。如果我们已经把提交推送到远程，而其他人又从远程下载了我们的提交，并在这个基础上工作。这个时候，如果我们又利用Rebase修改了提交记录，并再次推送到远程，那么其他人就不得不重新合并他们之前的工作了。\u003c/p\u003e\n\n\u003ch2 id=\"烦恼的前奏\"\u003e烦恼的前奏\u003c/h2\u003e\n\n\u003cp\u003e对于Rebase使用不当所造成的后果，下面让我们通过一个例子来演示整个过程，从而加深对它的理解。\u003c/p\u003e\n\n\u003cp\u003e本文推荐大家使用\u003ca href=\"https://github.com/morningspace/lab-hello-git\"\u003eHello Git\u003c/a\u003e提供的两个Docker镜像作为实验环境：一个代表远程Git服务（\u003ccode class=\"language-plaintext highlighter-rouge\"\u003elab-git-remote\u003c/code\u003e），一个代表本地Git客户端（\u003ccode class=\"language-plaintext highlighter-rouge\"\u003elab-git-local\u003c/code\u003e）。\u003c/p\u003e\n\n\u003cp\u003e关于实验环境的准备，请同学们查看“\u003ca href=\"/tech/git-merge-stories-6\"\u003eGit合并那些事儿——认识几种Merge方法\u003c/a\u003e”一文的“准备实验环境”部分。按照文章里介绍的步骤一步步做，最终我们会得到一个远程Git服务和用户William的本地Git客户端。由于这个例子里，我们会涉及到两个人的协作开发，所以还需要启动另一个本地Git客户端，用户名为Nicole：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003edocker run \u003cspan class=\"nt\"\u003e-it\u003c/span\u003e \u003cspan class=\"nt\"\u003e--name\u003c/span\u003e git-local-nicole \u003cspan class=\"nt\"\u003e--hostname\u003c/span\u003e git-local-nicole \u003cspan class=\"nt\"\u003e--net\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003elab \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \u003cspan class=\"nv\"\u003euser_name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eNicole \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \u003cspan class=\"nv\"\u003euser_email\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enicole@example.com morningspace/lab-git-local\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e假设William和Nicole都在开发test-rebase项目。首先，William在本地创建了test-rebase项目，并建立了提交记录c0：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit init test-rebase\nInitialized empty Git repository \u003cspan class=\"k\"\u003ein\u003c/span\u003e /root/test-rebase/.git/\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecd \u003c/span\u003etest-rebase/\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003evi README\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecat \u003c/span\u003eREADME\nThe magic rebase\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e When to use?\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit add \u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit commit \u003cspan class=\"nt\"\u003e-m\u003c/span\u003e c0\n\u003cspan class=\"o\"\u003e[\u003c/span\u003emaster \u003cspan class=\"o\"\u003e(\u003c/span\u003eroot-commit\u003cspan class=\"o\"\u003e)\u003c/span\u003e f14301e] c0\n 1 file changed, 2 insertions\u003cspan class=\"o\"\u003e(\u003c/span\u003e+\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n create mode 100644 README\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e然后，他登录到远程Git服务，创建了test-rebase的远程Git库：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003essh git@my-git-remote\ngit\u0026gt; create test-rebase\nInitialized empty Git repository \u003cspan class=\"k\"\u003ein\u003c/span\u003e /home/git/test-rebase.git/\ngit\u0026gt; list\nhello-git.git\ntest-rebase.git\ngit\u0026gt; \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e把本地库和远程库关联起来的同时，又把本地的c0推送到了远程：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit remote add origin git@my-git-remote:~/test-rebase.git\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit push origin master\nCounting objects: 3, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nWriting objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e3/3\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 232 bytes | 21.00 KiB/s, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nTotal 3 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e, reused 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nTo my-git-remote:~/test-rebase.git\n \u003cspan class=\"k\"\u003e*\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003enew branch]      master -\u0026gt; master\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e之后又继续在本地工作，并建立了提交记录c1：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003evi README\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecat \u003c/span\u003eREADME\nThe magic rebase\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e What is it?\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e When to use?\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit commit \u003cspan class=\"nt\"\u003e-am\u003c/span\u003e c1\n\u003cspan class=\"o\"\u003e[\u003c/span\u003emaster 9a5bdd2] c1\n 1 file changed, 1 insertion\u003cspan class=\"o\"\u003e(\u003c/span\u003e+\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e另一方面，Nicole也把test-rebase从远程克隆到了本地：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit clone git@my-git-remote:~/test-rebase.git\nCloning into \u003cspan class=\"s1\"\u003e\u0026#39;test-rebase\u0026#39;\u003c/span\u003e...\nremote: Counting objects: 3, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nremote: Total 3 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e, reused 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nReceiving objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e3/3\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e并在本地新建了一个dev分支后，继续在master上工作，并产生了提交记录c2：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit branch dev\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003etouch\u003c/span\u003e .gitignore\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit add .gitignore\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit commit \u003cspan class=\"nt\"\u003e-m\u003c/span\u003e c2\n\u003cspan class=\"o\"\u003e[\u003c/span\u003emaster f0f4430] c2\n 1 file changed, 0 insertions\u003cspan class=\"o\"\u003e(\u003c/span\u003e+\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 0 deletions\u003cspan class=\"o\"\u003e(\u003c/span\u003e-\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n create mode 100644 .gitignore\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e然后切换到dev分支上工作，产生提交记录c3：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit checkout dev\nSwitched to branch \u003cspan class=\"s1\"\u003e\u0026#39;dev\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003etouch \u003c/span\u003eVERSION\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit add VERSION\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit commit \u003cspan class=\"nt\"\u003e-m\u003c/span\u003e c3\n\u003cspan class=\"o\"\u003e[\u003c/span\u003edev 9aff71a] c3\n 1 file changed, 0 insertions\u003cspan class=\"o\"\u003e(\u003c/span\u003e+\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 0 deletions\u003cspan class=\"o\"\u003e(\u003c/span\u003e-\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n create mode 100644 VERSION\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e再切换回master分支，合并dev分支，产生合并提交c4：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit checkout master\nSwitched to branch \u003cspan class=\"s1\"\u003e\u0026#39;master\u0026#39;\u003c/span\u003e\nYour branch is ahead of \u003cspan class=\"s1\"\u003e\u0026#39;origin/master\u0026#39;\u003c/span\u003e by 1 commit.\n  \u003cspan class=\"o\"\u003e(\u003c/span\u003euse \u003cspan class=\"s2\"\u003e\u0026#34;git push\u0026#34;\u003c/span\u003e to publish your \u003cspan class=\"nb\"\u003elocal \u003c/span\u003ecommits\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit merge \u003cspan class=\"nt\"\u003e-m\u003c/span\u003e c4 dev\nMerge made by the \u003cspan class=\"s1\"\u003e\u0026#39;recursive\u0026#39;\u003c/span\u003e strategy.\n VERSION | 0\n 1 file changed, 0 insertions\u003cspan class=\"o\"\u003e(\u003c/span\u003e+\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 0 deletions\u003cspan class=\"o\"\u003e(\u003c/span\u003e-\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n create mode 100644 VERSION\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e然后删除dev分支，把本地提交推送到远程：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit branch \u003cspan class=\"nt\"\u003e-d\u003c/span\u003e dev\nDeleted branch dev \u003cspan class=\"o\"\u003e(\u003c/span\u003ewas 9aff71a\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit push origin master\nCounting objects: 7, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nDelta compression using up to 4 threads.\nCompressing objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e6/6\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nWriting objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e7/7\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 619 bytes | 47.00 KiB/s, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nTotal 7 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 2\u003cspan class=\"o\"\u003e)\u003c/span\u003e, reused 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nTo my-git-remote:~/test-rebase.git\n   f14301e..05ca470  master -\u0026gt; master\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e这时候远程Git库的提交历史是这样的：\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/lab/git/merge-stories-25.png\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003cp\u003e而William在他本地和远程进行同步以后：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit pull origin master\nFrom my-git-remote:~/test-rebase\n \u003cspan class=\"k\"\u003e*\u003c/span\u003e branch            master     -\u0026gt; FETCH_HEAD\nMerge made by the \u003cspan class=\"s1\"\u003e\u0026#39;recursive\u0026#39;\u003c/span\u003e strategy.\n .gitignore | 0\n VERSION    | 0\n 2 files changed, 0 insertions\u003cspan class=\"o\"\u003e(\u003c/span\u003e+\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 0 deletions\u003cspan class=\"o\"\u003e(\u003c/span\u003e-\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n create mode 100644 .gitignore\n create mode 100644 VERSION\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e本地的提交历史就变成下面这样了：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e   1b9384a \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c5\n|\u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e   05ca470 \u003cspan class=\"o\"\u003e(\u003c/span\u003eorigin/master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c4\n| |\u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n| | \u003cspan class=\"k\"\u003e*\u003c/span\u003e 9aff71a c3\n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e | f0f4430 c2\n| |/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e | 9a5bdd2 c1\n|/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e其中，c5是同步远程修改以后自动形成的合并提交：\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/lab/git/merge-stories-26.png\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003ch2 id=\"烦恼的开始\"\u003e烦恼的开始\u003c/h2\u003e\n\n\u003cp\u003e这个时候，Nicole开始在她本地进行Rebase了。她首先重建（恢复）了dev分支，并让dev分支的head指针指向c3（9aff71a）\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit branch dev 9aff71a\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e然后让master分支的head指针退回到上次合并之前的提交记录c2：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit reset \u003cspan class=\"nt\"\u003e--hard\u003c/span\u003e HEAD^\nHEAD is now at f0f4430 c2\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e \u003cspan class=\"nt\"\u003e--all\u003c/span\u003e\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e   05ca470 \u003cspan class=\"o\"\u003e(\u003c/span\u003eorigin/master, origin/HEAD\u003cspan class=\"o\"\u003e)\u003c/span\u003e c4\n|\u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e 9aff71a \u003cspan class=\"o\"\u003e(\u003c/span\u003edev\u003cspan class=\"o\"\u003e)\u003c/span\u003e c3\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e | f0f4430 \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c2\n|/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e并针对master和dev进行Rebase操作：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit rebase master dev\nFirst, rewinding \u003cspan class=\"nb\"\u003ehead \u003c/span\u003eto replay your work on top of it...\nApplying: c3\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit checkout master\nSwitched to branch \u003cspan class=\"s1\"\u003e\u0026#39;master\u0026#39;\u003c/span\u003e\nYour branch is behind \u003cspan class=\"s1\"\u003e\u0026#39;origin/master\u0026#39;\u003c/span\u003e by 2 commits, and can be fast-forwarded.\n  \u003cspan class=\"o\"\u003e(\u003c/span\u003euse \u003cspan class=\"s2\"\u003e\u0026#34;git pull\u0026#34;\u003c/span\u003e to update your \u003cspan class=\"nb\"\u003elocal \u003c/span\u003ebranch\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit merge dev\nUpdating f0f4430..604a471\nFast-forward\n VERSION | 0\n 1 file changed, 0 insertions\u003cspan class=\"o\"\u003e(\u003c/span\u003e+\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 0 deletions\u003cspan class=\"o\"\u003e(\u003c/span\u003e-\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n create mode 100644 VERSION\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e完成Rebase以后，再次清除多余的dev分支：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit branch \u003cspan class=\"nt\"\u003e-d\u003c/span\u003e dev\nDeleted branch dev \u003cspan class=\"o\"\u003e(\u003c/span\u003ewas 604a471\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e这个时候，Nicole本地的提交历史是这样的：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e \u003cspan class=\"nt\"\u003e--all\u003c/span\u003e\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e 604a471 \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c3\n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e   05ca470 \u003cspan class=\"o\"\u003e(\u003c/span\u003eorigin/master, origin/HEAD\u003cspan class=\"o\"\u003e)\u003c/span\u003e c4\n| |\u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n|/ /  \n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e 9aff71a c3\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e | f0f4430 c2\n|/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e注意，这里出现了两个c3。其中，SHA-1值为\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e604a471\u003c/code\u003e的c3是Rebase完成后新建的提交记录。而SHA-1值为\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e9aff71a\u003c/code\u003e的c3则是保存在远程库以及William的本地库里的原来的c3。\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/lab/git/merge-stories-27.png\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003cp\u003e现在，Nicole利用\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit push\u003c/code\u003e加上\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e--force\u003c/code\u003e参数，把她本地的修改强制推送到了远程：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit push \u003cspan class=\"nt\"\u003e--force\u003c/span\u003e origin master\nCounting objects: 2, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nDelta compression using up to 4 threads.\nCompressing objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e2/2\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nWriting objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e2/2\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 270 bytes | 24.00 KiB/s, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nTotal 2 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e, reused 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nTo my-git-remote:~/test-rebase.git\n + 05ca470...604a471 master -\u0026gt; master \u003cspan class=\"o\"\u003e(\u003c/span\u003eforced update\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e这个时候再看远程库的提交历史，就会变成这个样子：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e \u003cspan class=\"nt\"\u003e--all\u003c/span\u003e\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e 604a471 \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master, origin/master, origin/HEAD\u003cspan class=\"o\"\u003e)\u003c/span\u003e c3\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f0f4430 c2\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/lab/git/merge-stories-28.png\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003cp\u003e如果这个时候William把远程库的改动同步到本地：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit pull origin master\nremote: Counting objects: 2, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nremote: Compressing objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e2/2\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nremote: Total 2 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e, reused 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nUnpacking objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e2/2\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nFrom my-git-remote:~/test-rebase\n \u003cspan class=\"k\"\u003e*\u003c/span\u003e branch            master     -\u0026gt; FETCH_HEAD\n + 05ca470...604a471 master     -\u0026gt; origin/master  \u003cspan class=\"o\"\u003e(\u003c/span\u003eforced update\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nMerge made by the \u003cspan class=\"s1\"\u003e\u0026#39;recursive\u0026#39;\u003c/span\u003e strategy.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e那么，本地的提交历史就会变成这样：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e   aac5943 \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c6\n|\u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e 604a471 \u003cspan class=\"o\"\u003e(\u003c/span\u003eorigin/master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c3\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e |   1b9384a c5\n|\u003cspan class=\"se\"\u003e\\ \\ \u003c/span\u003e \n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e  05ca470 c4\n| |\u003cspan class=\"se\"\u003e\\ \\ \u003c/span\u003e \n| | |/  \n| |/|   \n| | \u003cspan class=\"k\"\u003e*\u003c/span\u003e 9aff71a c3\n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e | f0f4430 c2\n| |/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e | 9a5bdd2 c1\n|/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e其中，c6是同步远程修改以后自动形成的合并提交：\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/lab/git/merge-stories-29.png\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003cp\u003e于是，在本地的提交历史里，我们会看到两个c3。它们的作者，创建日期，备注信息是完全相同的。如果William再把目前的本地修改推送到远程：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit push origin master\nCounting objects: 9, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nDelta compression using up to 4 threads.\nCompressing objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e7/7\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nWriting objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e9/9\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 1.00 KiB | 44.00 KiB/s, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nTotal 9 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 1\u003cspan class=\"o\"\u003e)\u003c/span\u003e, reused 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nTo my-git-remote:~/test-rebase.git\n   604a471..aac5943  master -\u0026gt; master\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e那么，这种混乱而复杂的提交历史又会出现在远程库里。如果Nicole再次从远程同步变更到她本地：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit pull origin master\nremote: Counting objects: 9, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nremote: Compressing objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e7/7\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nremote: Total 9 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 1\u003cspan class=\"o\"\u003e)\u003c/span\u003e, reused 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nUnpacking objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e9/9\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nFrom my-git-remote:~/test-rebase\n \u003cspan class=\"k\"\u003e*\u003c/span\u003e branch            master     -\u0026gt; FETCH_HEAD\n   604a471..aac5943  master     -\u0026gt; origin/master\nUpdating 604a471..aac5943\nFast-forward\n README | 1 +\n 1 file changed, 1 insertion\u003cspan class=\"o\"\u003e(\u003c/span\u003e+\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e就会发现原来经过Rebase之后变得很干净的本地提交历史，一下子多了很多复杂的分叉，并且还出现了两个一摸一样的提交记录（c3）：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e \u003cspan class=\"nt\"\u003e--all\u003c/span\u003e\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e   aac5943 \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master, origin/master, origin/HEAD\u003cspan class=\"o\"\u003e)\u003c/span\u003e c6\n|\u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e 604a471 c3\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e |   1b9384a c5\n|\u003cspan class=\"se\"\u003e\\ \\ \u003c/span\u003e \n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e  05ca470 c4\n| |\u003cspan class=\"se\"\u003e\\ \\ \u003c/span\u003e \n| | |/  \n| |/|   \n| | \u003cspan class=\"k\"\u003e*\u003c/span\u003e 9aff71a c3\n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e | f0f4430 c2\n| |/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e | 9a5bdd2 c1\n|/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/lab/git/merge-stories-30.png\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003ch2 id=\"烦恼的解决\"\u003e烦恼的解决\u003c/h2\u003e\n\n\u003cp\u003e本地的提交历史被别人的Rebase操作“污染”了。当这种情况发生时，我们所面临的最大挑战，是如何把“真正需要”的那部分提交历史找出来，去掉那些因为分支合并而形成的提交记录，还有那些像c3一样的重复提交。Git为我们提供了自动完成这一工作的方法，那就是在执行\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit pull\u003c/code\u003e时加上\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e--rebase\u003c/code\u003e参数。或者，也可以先执行\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit fetch\u003c/code\u003e把改动从远程下载到本地，然后再在本地执行\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit rebase origin/master\u003c/code\u003e，两者的效果是一样的。\u003c/p\u003e\n\n\u003cp\u003e接下来，我们就通过实验来进一步理解\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit pull --rebase\u003c/code\u003e是怎么工作的。还是接着上面的实验，首先，让我们把Nicole的本地环境恢复到执行\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit pull\u003c/code\u003e以前的状态：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit reset \u003cspan class=\"nt\"\u003e--hard\u003c/span\u003e 604a471\nHEAD is now at 604a471 c3\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e 604a471 \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c3\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f0f4430 c2\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e然后再把这个提交历史强制推送到远程，从而让远程Git库也恢复到之前的状态，和Nicole本地的提交历史保持一致：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit push \u003cspan class=\"nt\"\u003e--force\u003c/span\u003e origin master\nTotal 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e, reused 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nTo my-git-remote:~/test-rebase.git\n + aac5943...604a471 master -\u0026gt; master \u003cspan class=\"o\"\u003e(\u003c/span\u003eforced update\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n \n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e \u003cspan class=\"nt\"\u003e--all\u003c/span\u003e\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e 604a471 \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master, origin/master, origin/HEAD\u003cspan class=\"o\"\u003e)\u003c/span\u003e c3\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f0f4430 c2\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e另一方面，我们把William的本地库也恢复到最近一次远程同步之前的状态：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit reset \u003cspan class=\"nt\"\u003e--hard\u003c/span\u003e 1b9384a\nHEAD is now at 1b9384a c5\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e注意这个时候William本地的提交历史：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e      \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e   1b9384a \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c5\n|\u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e   05ca470 c4\n| |\u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n| | \u003cspan class=\"k\"\u003e*\u003c/span\u003e 9aff71a c3\n| \u003cspan class=\"k\"\u003e*\u003c/span\u003e | f0f4430 c2\n| |/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e | 9a5bdd2 c1\n|/  \n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e现在，执行\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit pull --rebase\u003c/code\u003e：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit pull \u003cspan class=\"nt\"\u003e--rebase\u003c/span\u003e origin master\nFrom my-git-remote:~/test-rebase\n \u003cspan class=\"k\"\u003e*\u003c/span\u003e branch            master     -\u0026gt; FETCH_HEAD\nFirst, rewinding \u003cspan class=\"nb\"\u003ehead \u003c/span\u003eto replay your work on top of it...\nApplying: c1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e在\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit pull\u003c/code\u003e执行的过程中，Git会做这么几件事情：\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003e找出所有只在William本地出现，而不在远程（或Nicole本地）出现的提交记录，结果是：c1，c3，c4，c5；\u003c/li\u003e\n  \u003cli\u003e从中去掉所有合并提交（因为这些提交只负责合并，它们所包含的变更在其他提交记录里已经有了），结果是：c1，c3；\u003c/li\u003e\n  \u003cli\u003e再从中去掉那些内容重复的提交记录，如：c3，最后剩下：c1；\u003c/li\u003e\n  \u003cli\u003e把所有剩余的提交记录（即：c1）在origin/master的最新提交后面重新“回放”一遍；\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e对于上面的第三步，Git之所以能做到，是因为每个提交记录除了包含有作为唯一键的SHA-1值以外，还有一个叫做“patch-id”的东西，它是Git根据该提交记录所引入的变更计算其校验和（checksum）得到的。如果两个提交的变更内容一摸一样（比如：c3），那它们的patch-id就是一样的。\u003c/p\u003e\n\n\u003cp\u003e经过这样的处理以后，再来看William本地的提交历史：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e \u003cspan class=\"nt\"\u003e--graph\u003c/span\u003e\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e 2665bc4 \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c1\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e 604a471 \u003cspan class=\"o\"\u003e(\u003c/span\u003eorigin/master\u003cspan class=\"o\"\u003e)\u003c/span\u003e c3\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f0f4430 c2\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e f14301e c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e我们发现，提交历史又变干净了！和远程库的提交历史相比，我们只多了一个提交记录：c1，其他提交记录，由于对项目的内容本身都没有引入真正的变更，所以都被Git去掉了。这样的提交历史才是我们真正需要的！\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/lab/git/merge-stories-31.png\" alt=\"\"/\u003e\u003c/p\u003e\n\n        \n      \u003c/section\u003e\n\n      \u003cfooter class=\"page__meta\"\u003e\n        \n        \n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-tags\" aria-hidden=\"true\"\u003e\u003c/i\u003e 标签: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/tags/#dummies\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003edummies\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#dummies-git\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003edummies_git\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#git\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003egit\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#lab\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003elab\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n\n\n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-folder-open\" aria-hidden=\"true\"\u003e\u003c/i\u003e 分类: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/categories/#tech\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003etech\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n        \n\n  \u003cp class=\"page__date\"\u003e\u003cstrong\u003e\u003ci class=\"fas fa-fw fa-calendar-alt\" aria-hidden=\"true\"\u003e\u003c/i\u003e 更新时间:\u003c/strong\u003e \u003ctime class=\"dt-published\" datetime=\"2019-11-16T00:00:00+08:00\"\u003eNovember 16, 2019\u003c/time\u003e\u003c/p\u003e\n\n      \u003c/footer\u003e\n\n      \u003csection class=\"page__share\"\u003e\n  \n    \u003ch4 class=\"page__share-title\"\u003e分享\u003c/h4\u003e\n  \n\n  \u003ca href=\"https://twitter.com/intent/tweet?text=Git%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B%E2%80%94%E2%80%94Rebase%E7%9A%84%E7%83%A6%E6%81%BC%20https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fgit-merge-stories-8%2F\" class=\"btn btn--twitter\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Twitter\"\u003e\u003ci class=\"fab fa-fw fa-twitter\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Twitter\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fgit-merge-stories-8%2F\" class=\"btn btn--facebook\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Facebook\"\u003e\u003ci class=\"fab fa-fw fa-facebook\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Facebook\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.linkedin.com/shareArticle?mini=true\u0026amp;url=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fgit-merge-stories-8%2F\" class=\"btn btn--linkedin\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 LinkedIn\"\u003e\u003ci class=\"fab fa-fw fa-linkedin\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e LinkedIn\u003c/span\u003e\u003c/a\u003e\n\u003c/section\u003e\n\n\n      \n  \u003cnav class=\"pagination\"\u003e\n    \n      \u003ca href=\"/tech/git-merge-stories-7/\" class=\"pagination--pager\" title=\"Git合并那些事——交互式Rebase\n\"\u003e向前\u003c/a\u003e\n    \n    \n      \u003ca href=\"/tech/k8s-net-docker0/\" class=\"pagination--pager\" title=\"Kubernetes网络篇——从docker0开始\n\"\u003e向后\u003c/a\u003e\n    \n  \u003c/nav\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-11-16T00:00:00+08:00",
  "Author": "MornigSpace"
}