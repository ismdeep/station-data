{
  "Source": "morningspace",
  "Title": "在团队中使用增强版OpenShift CLI",
  "Link": "https://morningspace.github.io/tech/enhanced-oc-4/",
  "Content": "\u003cdiv class=\"page__inner-wrap\"\u003e\n      \n\n      \u003csection class=\"page__content e-content\" itemprop=\"text\"\u003e\n        \n          \u003caside class=\"sidebar__right sticky\"\u003e\n            \u003cnav class=\"toc\"\u003e\n              \u003cheader\u003e\u003ch4 class=\"nav__title\"\u003e\u003ci class=\"fas fa-file-alt\"\u003e\u003c/i\u003e 在本页上\u003c/h4\u003e\u003c/header\u003e\n              \u003cul class=\"toc__menu\"\u003e\u003cli\u003e\u003ca href=\"#分享你的secretstore\"\u003e分享你的Secret Store\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#为团队成员做准备\"\u003e为团队成员做准备\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#克隆远程的secretstore\"\u003e克隆远程的Secret Store\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#小结\"\u003e小结\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\n\n            \u003c/nav\u003e\n          \u003c/aside\u003e\n        \n        \u003cblockquote\u003e\n  \u003cp\u003e增强版OpenShift CLI可以帮助我们高效而安全的管理大量的OpenShift集群。它是一个位于\u003ca href=\"https://github.com/morningspace/enhanced-oc\"\u003eGitHub\u003c/a\u003e上的开源项目。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e作为增强版OpenShift CLI系列文章的第四篇，本文将向大家介绍如何把保存在本地secret store里的集群访问信息分享给团队中的其他成员。\u003c/p\u003e\n\n\u003cp\u003e通过把存有集群访问信息的本地secret store分享到远程，我们可以很方便的在整个团队范围内实现统一的集群管理。任何时候，当你有新的集群访问信息通过增强版oc加入到secret store，同样的访问信息将会被自动同步到其他团队成员的本地secret store里。这样，大家在不关心集群访问信息具体内容的情况下，只通过集群的别名就可以实现对同一集群的访问了。\u003c/p\u003e\n\n\u003ch2 id=\"分享你的secretstore\"\u003e分享你的Secret Store\u003c/h2\u003e\n\n\u003cp\u003e如果你打算把保存在本地secret store里的集群访问信息分享给其他人，首先需要为secret store添加git remote信息，并将本地的secret store通过git push推送到远程：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egopass git remote add origin git@github.example.com:william/team-clusters.git\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egopass git push origin master\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e当连接远程的git服务器时（比如GitHub），尽管我们可以使用HTTPS协议，但还是建议大家使用SSH进行连接。利用SSH key，我们在每次访问远程git库时，可以无需提供用户名和access token。有关如何以SSH方式连接GitHub，请参考GitHub的\u003ca href=\"https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh\"\u003e相关文档\u003c/a\u003e。\u003c/p\u003e\n\n\u003ch2 id=\"为团队成员做准备\"\u003e为团队成员做准备\u003c/h2\u003e\n\n\u003cp\u003e为了让团队成员能够成功解密保存在远程secret store里的经过加密的集群访问信息，我们还需要做一点准备工作。首先，要求团队成员在各自的机器上安装好必要的工具和软件，包括：\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egpg\u003c/code\u003e，\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egit\u003c/code\u003e，\u003ccode class=\"language-plaintext highlighter-rouge\"\u003egopass\u003c/code\u003e，\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eoc\u003c/code\u003e等。然后，要求大家用如下命令生成各自的密钥对：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egpg \u003cspan class=\"nt\"\u003e--full-generate-key\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e选择\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRSA and RSA\u003c/code\u003e作为密钥类型，keysize为2048，密钥永不过期，然后输入团队成员的用户名，邮箱地址，以及密钥对应的密码（passphrase）。\u003c/p\u003e\n\n\u003cp\u003e等密钥对生成完毕以后，要求大家把其中的公钥导出并发送给你。在团队成员所在的机器上执行如下命令，可以找到公钥的ID：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egpg \u003cspan class=\"nt\"\u003e--list-keys\u003c/span\u003e \u003cspan class=\"nt\"\u003e--keyid-format\u003c/span\u003e LONG\n/root/.gnupg/pubring.gpg\n\u003cspan class=\"nt\"\u003e------------------------\u003c/span\u003e\npub   2048R/93E7B0300BB9C91B 2021-03-17\nuid                          Nicole \u0026lt;nicole@example.com\u0026gt;\nsub   2048R/3AE8C980579D103C 2021-03-17\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e从输出结果中选取与当前团队成员的用户名及邮箱地址相匹配的公钥，复制相应的密钥ID，即\u003ccode class=\"language-plaintext highlighter-rouge\"\u003epub\u003c/code\u003e所在的那一行，本例中为\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e93E7B0300BB9C91B\u003c/code\u003e。然后用如下命令，把公钥导出到一个文件里：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egpg \u003cspan class=\"nt\"\u003e--armor\u003c/span\u003e \u003cspan class=\"nt\"\u003e--export\u003c/span\u003e 93E7B0300BB9C91B \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e nicole_pub.gpg\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e当我们接收到团队成员的公钥以后，通过如下命令将公钥导入到本地：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egpg \u003cspan class=\"nt\"\u003e--import\u003c/span\u003e nicole_pub.gpg\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e并将该团队成员作为\u003ccode class=\"language-plaintext highlighter-rouge\"\u003erecipient\u003c/code\u003e，加入到本地的secret store里：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egopass recipients add 93E7B0300BB9C91B\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e然后用我们自己的私钥对团队成员的公钥进行签名，并选择对其永久信任：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egpg \u003cspan class=\"nt\"\u003e--edit-key\u003c/span\u003e 93E7B0300BB9C91B\nlsign\ntrust\nsave\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e最后，重新加一次\u003ccode class=\"language-plaintext highlighter-rouge\"\u003erecipient\u003c/code\u003e，以触发gopass对保存在本地secret store里的数据重新进行加密：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egopass recipients \u003cspan class=\"nb\"\u003erm \u003c/span\u003e93E7B0300BB9C91B\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egopass recipients add 93E7B0300BB9C91B\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上述所有步骤都会被自动同步到远程的secret store里。\u003c/p\u003e\n\n\u003ch2 id=\"克隆远程的secretstore\"\u003e克隆远程的Secret Store\u003c/h2\u003e\n\n\u003cp\u003e现在，我们可以通知团队成员，让大家把远程的secret store克隆到本地了。同时，请确保这些团队成员已经以\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecollaborator\u003c/code\u003e的身份被添加到了远程git库里。然后在每位团队成员所在的机器上执行如下命令，将远程secret store克隆到本地：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egopass \u003cspan class=\"nt\"\u003e--yes\u003c/span\u003e setup \u003cspan class=\"nt\"\u003e--remote\u003c/span\u003e git@github.example.com:william/team-clusters.git \u003cspan class=\"nt\"\u003e--alias\u003c/span\u003e team-clusters \u003cspan class=\"nt\"\u003e--name\u003c/span\u003e Nicole \u003cspan class=\"nt\"\u003e--email\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;nicole@example.com\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e其中，参数\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e--name\u003c/code\u003e和\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e--email\u003c/code\u003e的取值和团队成员在生成各自密钥对时所使用的取值保持一致。这样，其他人就可以和我们一样，利用\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eoc login\u003c/code\u003e命令及别名，对同一组集群进行访问了。\u003c/p\u003e\n\n\u003cp\u003e下图演示了整个准备工作的端到端流程：\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/images/studio/enhanced-oc/enhanced-oc-4.jpg\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003ch2 id=\"小结\"\u003e小结\u003c/h2\u003e\n\n\u003cp\u003e本文中，我们学习了如何把保存在本地secret store里的集群访问信息分享给团队中的其他成员。\u003c/p\u003e\n\n\u003cp\u003e如果你想了解更多有关增强版OpenShift CLI的信息，请阅读它的\u003ca href=\"https://morningspace.github.io/oc/docs/\"\u003e在线文档\u003c/a\u003e。如果你喜欢这个项目，欢迎给它\u003ca href=\"https://github.com/morningspace/oc\"\u003e加星\u003c/a\u003e。同时，也非常欢迎针对该项目的任何形式的贡献，比如bug报告以及代码提交。\u003c/p\u003e\n\n        \n      \u003c/section\u003e\n\n      \u003cfooter class=\"page__meta\"\u003e\n        \n        \n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-tags\" aria-hidden=\"true\"\u003e\u003c/i\u003e 标签: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/tags/#kubernetes\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003ekubernetes\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#openshift\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003eopenshift\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n\n\n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-folder-open\" aria-hidden=\"true\"\u003e\u003c/i\u003e 分类: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/categories/#tech\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003etech\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n        \n\n  \u003cp class=\"page__date\"\u003e\u003cstrong\u003e\u003ci class=\"fas fa-fw fa-calendar-alt\" aria-hidden=\"true\"\u003e\u003c/i\u003e 更新时间:\u003c/strong\u003e \u003ctime class=\"dt-published\" datetime=\"2021-08-11T00:00:00+08:00\"\u003eAugust 11, 2021\u003c/time\u003e\u003c/p\u003e\n\n      \u003c/footer\u003e\n\n      \u003csection class=\"page__share\"\u003e\n  \n    \u003ch4 class=\"page__share-title\"\u003e分享\u003c/h4\u003e\n  \n\n  \u003ca href=\"https://twitter.com/intent/tweet?text=%E5%9C%A8%E5%9B%A2%E9%98%9F%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%A2%9E%E5%BC%BA%E7%89%88OpenShift+CLI%20https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fenhanced-oc-4%2F\" class=\"btn btn--twitter\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Twitter\"\u003e\u003ci class=\"fab fa-fw fa-twitter\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Twitter\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fenhanced-oc-4%2F\" class=\"btn btn--facebook\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Facebook\"\u003e\u003ci class=\"fab fa-fw fa-facebook\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Facebook\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.linkedin.com/shareArticle?mini=true\u0026amp;url=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fenhanced-oc-4%2F\" class=\"btn btn--linkedin\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 LinkedIn\"\u003e\u003ci class=\"fab fa-fw fa-linkedin\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e LinkedIn\u003c/span\u003e\u003c/a\u003e\n\u003c/section\u003e\n\n\n      \n  \u003cnav class=\"pagination\"\u003e\n    \n      \u003ca href=\"/tech/enhanced-oc-3/\" class=\"pagination--pager\" title=\"增强版OpenShift CLI的更多功能\n\"\u003e向前\u003c/a\u003e\n    \n    \n      \u003ca href=\"#\" class=\"pagination--pager disabled\"\u003e向后\u003c/a\u003e\n    \n  \u003c/nav\u003e\n\n    \u003c/div\u003e",
  "Date": "2021-08-11T00:00:00+08:00",
  "Author": "MornigSpace"
}