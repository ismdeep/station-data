{
  "Source": "morningspace",
  "Title": "Elastic Shell 101 - Manage Snapshot Interactively",
  "Link": "https://morningspace.github.io/tech/elash101-3/",
  "Content": "\u003cdiv class=\"page__inner-wrap\"\u003e\n      \n\n      \u003csection class=\"page__content e-content\" itemprop=\"text\"\u003e\n        \n          \u003caside class=\"sidebar__right sticky\"\u003e\n            \u003cnav class=\"toc\"\u003e\n              \u003cheader\u003e\u003ch4 class=\"nav__title\"\u003e\u003ci class=\"fas fa-file-alt\"\u003e\u003c/i\u003e 在本页上\u003c/h4\u003e\u003c/header\u003e\n              \u003cul class=\"toc__menu\"\u003e\u003cli\u003e\u003ca href=\"#what-is-it\"\u003eWhat is it\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#run-interactively\"\u003eRun interactively\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#create-repository\"\u003eCreate repository\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#list-snapshots\"\u003eList snapshots\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#restore-from-snapshot\"\u003eRestore from snapshot\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\n\n            \u003c/nav\u003e\n          \u003c/aside\u003e\n        \n        \u003cp\u003e\u003cimg src=\"/assets/images/studio/elash/101.jpg\" alt=\"\"/\u003e\u003c/p\u003e\n\n\u003ch2 id=\"what-is-it\"\u003eWhat is it\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/morningspace/elastic-shell\"\u003eElastic Shell\u003c/a\u003e is an open source project that includes a set of command line utilities and run as a client to help you manage \u003ca href=\"https://www.elastic.co/products/elasticsearch\"\u003eElasticsearch\u003c/a\u003e. It is entirely written in Bash Shell.\u003c/p\u003e\n\n\u003cp\u003e“Elastic Shell 101” is a series of posts that tells you how to use it.\u003c/p\u003e\n\n\u003cp\u003eIn this post, I will use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esnapshot\u003c/code\u003e command as example to show you how to run Elastic Shell in interactive mode using plain text UI.\u003c/p\u003e\n\n\u003ch2 id=\"run-interactively\"\u003eRun interactively\u003c/h2\u003e\n\n\u003cp\u003eUsually, we run Elastic Shell as a command line tool. It does not require user input when the command is running. However, Elastic Shell can also be run in interactive mode which provides context menu that allows user input to drive the way it goes. It is useful when you want to demonstrate, test, or investigate something with your Elasticsearch cluster. It clearly gives people the execution path.\u003c/p\u003e\n\n\u003cp\u003eTo run Elastic Shell in interactive mode, you just need to add an option called \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e--ui-text\u003c/code\u003e. Let’s choose \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esnapshot\u003c/code\u003e command as an example.\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e##################################################\n#\n# Main Menu\n#\n##################################################\n# Select a function:\n1) cat\n2) repo\n3) create\n4) list\n5) restore\n6) config\n7) return\n# Select a function:\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eYou will see a welcome message followed by the main menu. Each menu item maps to the sub-command that is also available when run Elastic Shell in non-interactive mode. Input the number in front of each menu item to select the corresponding menu item. For example, if we input 1, it will take us to the sub-menu of command \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecat\u003c/code\u003e, which includes all \u003ca href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/cat.html\"\u003eElasticsearch /_cat APIs\u003c/a\u003e supported by the Elasticsearch cluster. Select the last menu item on the menu at any level will go back to the menu at upper level. If it’s the main menu, it will exit from Elastic Shell.\u003c/p\u003e\n\n\u003ch2 id=\"create-repository\"\u003eCreate repository\u003c/h2\u003e\n\n\u003cp\u003eTo backup or restore snapshots, let’s create a snapshot repository at first. From main menu, select 2, then 1. Elastic Shell will ask for a repository name, you can input a name or use the default one by pressing the Enter key.\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e##################################################\n#\n# Main Menu\n#\n##################################################\n# Select a function:\n1) cat\n2) repo\n3) create\n4) list\n5) restore\n6) config\n7) return\n# Select a function:2\n\n##################################################\n#\n# Repo\n#\n##################################################\n# Select a function:\n1) new\n2) return\n# Select a function:1\n\n##################################################\n#\n# Repository Name\n#\n##################################################\n# Input repository name(press Enter to use \u0026#39;my_backup\u0026#39;):\n\n##################################################\n#\n# Create Repository my_backup\n#\n##################################################\n{\n  \u0026#34;acknowledged\u0026#34;: true\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe returned response tells us it’s created successfully.\u003c/p\u003e\n\n\u003cp\u003eHere, the default repository name is actually defined in the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emain.properties\u003c/code\u003e file. This can also be verified by selecting \u003ccode class=\"language-plaintext highlighter-rouge\"\u003econfig\u003c/code\u003e on main menu to run \u003ccode class=\"language-plaintext highlighter-rouge\"\u003econfig\u003c/code\u003e command. It lists all the configurations that are available based on the context.\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e##################################################\n#\n# Main Menu\n#\n##################################################\n# Select a function:\n1) cat\n2) repo\n3) create\n4) list\n5) restore\n6) config\n7) return\n# Select a function:6\n\n##################################################\n#\n# Config\n#\n##################################################\n# Available configuration:\n1) net_host=http://elasticsearch:9200\n2) net_use_ssl=false\n3) net_ssl_no_validate=true\n4) net_client_cert=./certs/admin.crt.pem\n5) net_client_key=./certs/admin.key.pem\n6) net_certificate=\n7) snapshot_repository=my_backup\n8) return\n# Choose one item:\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIf you want to change it, input 7, then input the new value.\u003c/p\u003e\n\n\u003cp\u003eAnother thing to note is the configuration file of the snapshot repository. It is called \u003ccode class=\"language-plaintext highlighter-rouge\"\u003erepo.json\u003c/code\u003e and located at \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esnapshot\u003c/code\u003e folder under Elastic Shell \u003ccode class=\"language-plaintext highlighter-rouge\"\u003econfig\u003c/code\u003e folder.\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebash-4.4# \u003cspan class=\"nb\"\u003ecat \u003c/span\u003eelash/config/snapshot/repo.json \n\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;fs\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;settings\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\u0026#34;location\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;my_backup\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eOf course, you can modify it as you wish.\u003c/p\u003e\n\n\u003ch2 id=\"list-snapshots\"\u003eList snapshots\u003c/h2\u003e\n\n\u003cp\u003eTo list all snapshots that are available to the specified repository, let’s select \u003ccode class=\"language-plaintext highlighter-rouge\"\u003elist\u003c/code\u003e on main menu, then input the repository name. Here, we use the default name, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emy_backup\u003c/code\u003e, by pressing Enter key. You will see all snapshots that’ve been created previously in this repository.\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e##################################################\n#\n# List Snapshots\n#\n##################################################\n{\n  \u0026#34;snapshots\u0026#34;: [\n    {\n      \u0026#34;snapshot\u0026#34;: \u0026#34;github\u0026#34;,\n      \u0026#34;uuid\u0026#34;: \u0026#34;KtoEO1IPSYiF5mBuUjF9dw\u0026#34;,\n      \u0026#34;version_id\u0026#34;: 6030299,\n      \u0026#34;version\u0026#34;: \u0026#34;6.3.2\u0026#34;,\n      \u0026#34;indices\u0026#34;: [\n        \u0026#34;github\u0026#34;\n      ],\n      \u0026#34;include_global_state\u0026#34;: true,\n      \u0026#34;state\u0026#34;: \u0026#34;SUCCESS\u0026#34;,\n      \u0026#34;start_time\u0026#34;: \u0026#34;2019-01-18T13:22:01.491Z\u0026#34;,\n      \u0026#34;start_time_in_millis\u0026#34;: 1547817721491,\n      \u0026#34;end_time\u0026#34;: \u0026#34;2019-01-18T13:22:01.996Z\u0026#34;,\n      \u0026#34;end_time_in_millis\u0026#34;: 1547817721996,\n      \u0026#34;duration_in_millis\u0026#34;: 505,\n      \u0026#34;failures\u0026#34;: [],\n      \u0026#34;shards\u0026#34;: {\n        \u0026#34;total\u0026#34;: 5,\n        \u0026#34;failed\u0026#34;: 0,\n        \u0026#34;successful\u0026#34;: 5\n      }\n    }\n ]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2 id=\"restore-from-snapshot\"\u003eRestore from snapshot\u003c/h2\u003e\n\n\u003cp\u003eLet’s choose \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egithub\u003c/code\u003e snapshot, and restore from it. Select \u003ccode class=\"language-plaintext highlighter-rouge\"\u003erestore\u003c/code\u003e on main menu, press Enter key to use the default repository name, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emy_backup\u003c/code\u003e. Input the snapshot name, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egithub\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e##################################################\n#\n# Main Menu\n#\n##################################################\n# Select a function:\n1) cat\n2) repo\n3) create\n4) list\n5) restore\n6) config\n7) return\n# Select a function:5\n\n##################################################\n#\n# Repository Name\n#\n##################################################\n# Input repository name(press Enter to use \u0026#39;my_backup\u0026#39;):\n\n##################################################\n#\n# Snapshot Name\n#\n##################################################\n# Input snapshot name:github\n\n##################################################\n#\n# Restore Snapshot github\n#\n##################################################\n{\n  \u0026#34;accepted\u0026#34;: true\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen, run the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecat indices\u003c/code\u003e command. You will see the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003egithub\u003c/code\u003e index and its documents are restored from the snapshot.\u003c/p\u003e\n\n\u003cp\u003eFor more stories on Elastic Shell, stay tuned for next posts! Any question about this post or Elastic Shell, feel free to leave comments or drop email at morningspace@yahoo.com.\u003c/p\u003e\n\n        \n      \u003c/section\u003e\n\n      \u003cfooter class=\"page__meta\"\u003e\n        \n        \n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-tags\" aria-hidden=\"true\"\u003e\u003c/i\u003e 标签: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/tags/#elasticsearch\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003eelasticsearch\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#shell\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003eshell\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#studio\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003estudio\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#studio-elash-101\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003estudio-elash-101\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n\n\n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-folder-open\" aria-hidden=\"true\"\u003e\u003c/i\u003e 分类: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/categories/#tech\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003etech\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n        \n\n  \u003cp class=\"page__date\"\u003e\u003cstrong\u003e\u003ci class=\"fas fa-fw fa-calendar-alt\" aria-hidden=\"true\"\u003e\u003c/i\u003e 更新时间:\u003c/strong\u003e \u003ctime class=\"dt-published\" datetime=\"2019-04-07T00:00:00+08:00\"\u003eApril 7, 2019\u003c/time\u003e\u003c/p\u003e\n\n      \u003c/footer\u003e\n\n      \u003csection class=\"page__share\"\u003e\n  \n    \u003ch4 class=\"page__share-title\"\u003e分享\u003c/h4\u003e\n  \n\n  \u003ca href=\"https://twitter.com/intent/tweet?text=Elastic+Shell+101+-+Manage+Snapshot+Interactively%20https%3A%2F%2Fmorningspace.github.io%2Ftech%2Felash101-3%2F\" class=\"btn btn--twitter\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Twitter\"\u003e\u003ci class=\"fab fa-fw fa-twitter\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Twitter\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Felash101-3%2F\" class=\"btn btn--facebook\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Facebook\"\u003e\u003ci class=\"fab fa-fw fa-facebook\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Facebook\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.linkedin.com/shareArticle?mini=true\u0026amp;url=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Felash101-3%2F\" class=\"btn btn--linkedin\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 LinkedIn\"\u003e\u003ci class=\"fab fa-fw fa-linkedin\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e LinkedIn\u003c/span\u003e\u003c/a\u003e\n\u003c/section\u003e\n\n\n      \n  \u003cnav class=\"pagination\"\u003e\n    \n      \u003ca href=\"/tech/elash101-2/\" class=\"pagination--pager\" title=\"Elastic Shell 101 - Working with Index\n\"\u003e向前\u003c/a\u003e\n    \n    \n      \u003ca href=\"/tech/elash101-4/\" class=\"pagination--pager\" title=\"Elastic Shell 101 - Reindex Using Dialog\n\"\u003e向后\u003c/a\u003e\n    \n  \u003c/nav\u003e\n\n    \u003c/div\u003e",
  "Date": "2019-04-07T00:00:00+08:00",
  "Author": "MornigSpace"
}