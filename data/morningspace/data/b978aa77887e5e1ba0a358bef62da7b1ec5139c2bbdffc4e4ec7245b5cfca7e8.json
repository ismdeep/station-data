{
  "Source": "morningspace",
  "Title": "增强版OpenShift CLI快速入门",
  "Link": "https://morningspace.github.io/tech/enhanced-oc-2/",
  "Content": "\u003cdiv class=\"page__inner-wrap\"\u003e\n      \n\n      \u003csection class=\"page__content e-content\" itemprop=\"text\"\u003e\n        \n          \u003caside class=\"sidebar__right sticky\"\u003e\n            \u003cnav class=\"toc\"\u003e\n              \u003cheader\u003e\u003ch4 class=\"nav__title\"\u003e\u003ci class=\"fas fa-file-alt\"\u003e\u003c/i\u003e 在本页上\u003c/h4\u003e\u003c/header\u003e\n              \u003cul class=\"toc__menu\"\u003e\u003cli\u003e\u003ca href=\"#安装增强版openshift-cli\"\u003e安装增强版OpenShift CLI\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#设置环境\"\u003e设置环境\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#首次登录集群\"\u003e首次登录集群\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#通过别名登录集群\"\u003e通过别名登录集群\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#小结\"\u003e小结\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\n\n            \u003c/nav\u003e\n          \u003c/aside\u003e\n        \n        \u003cblockquote\u003e\n  \u003cp\u003e增强版OpenShift CLI可以帮助我们高效而安全的管理大量的OpenShift集群。它是一个位于\u003ca href=\"https://github.com/morningspace/enhanced-oc\"\u003eGitHub\u003c/a\u003e上的开源项目。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e作为增强版OpenShift CLI系列文章的第二篇，本文将向大家介绍如何安装增强版oc，并为大家演示它的一些基本用法。\u003c/p\u003e\n\n\u003ch2 id=\"安装增强版openshift-cli\"\u003e安装增强版OpenShift CLI\u003c/h2\u003e\n\n\u003cp\u003e为了让增强版OpenShift CLI能够正常工作，我们在安装增强版OpenShift CLI之前，首先需要确保其所依赖的软件已经安装就绪，这其中包括：\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003egpg：用于数据加密和解密\u003c/li\u003e\n  \u003cli\u003egit：用于存储和共享加密数据\u003c/li\u003e\n  \u003cli\u003egopass：用于加密数据的管理，运行于gpg和git之上\u003c/li\u003e\n  \u003cli\u003eoc：RedHat官方提供的OpenShift CLI\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e根据你所使用的操作系统，从下列命令中选择正确的命令，安装git与gpg：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# MacOS\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ebrew \u003cspan class=\"nb\"\u003einstall \u003c/span\u003egnupg2 git\n\u003cspan class=\"c\"\u003e# RHEL \u0026amp; CentOS\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ebrew \u003cspan class=\"nb\"\u003einstall \u003c/span\u003egnupg2 git\n\u003cspan class=\"c\"\u003e# Ubuntu \u0026amp; Debian\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eapt-get \u003cspan class=\"nb\"\u003einstall \u003c/span\u003egnupg2 git\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e关于gopass的安装，推荐到gopass在GitHub上的\u003ca href=\"https://github.com/gopasspw/gopass/releases\"\u003ereleases页面\u003c/a\u003e下载并安装最新的版本。根据你所使用的操作系统，选择相应的压缩包，将之下载到本地并解压，然后从中找出gopass的可执行文件，放入\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e$PATH\u003c/code\u003e能访问的路径下。\u003c/p\u003e\n\n\u003cp\u003e关于oc的安装，请参考\u003ca href=\"https://docs.openshift.com/container-platform/latest/cli_reference/openshift_cli/getting-started-cli.html#installing-openshift-cli\"\u003eOpenShift的官方文档\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e当增强版OpenShift CLI的所有依赖软件安装完毕以后，请从GitHub上下载增强版oc的Shell脚本：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecurl \u003cspan class=\"nt\"\u003e-OL\u003c/span\u003e https://raw.githubusercontent.com/morningspace/oc/master/oc.sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e如果你用的是Bash，请在用户主目录下找到Shell初始化文件\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.bashrc\u003c/code\u003e，并将下列代码加入其中。如果你用的是其他Shell，比如Zsh，则相应的Shell初始化文件会有所不同。\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e[[\u003c/span\u003e \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e /path/to/oc.sh \u003cspan class=\"o\"\u003e]]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003esource\u003c/span\u003e /path/to/oc.sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e随后，我们打开一个新的终端窗口，并运行\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eoc\u003c/code\u003e命令，以验证安装是否成功。如果一切正常，我们会看到，在oc命令输出的正常帮助信息前面，会有几行提示信息，代表这是一个增强版的OpenShift CLI。\u003c/p\u003e\n\n\u003ch2 id=\"设置环境\"\u003e设置环境\u003c/h2\u003e\n\n\u003cp\u003egopass是依赖于gpg对数据进行加密和解密的。在我们开始使用增强版oc之前，我们必须先创建一组密钥对：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egpg \u003cspan class=\"nt\"\u003e--full-generate-key\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e选择\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRSA and RSA\u003c/code\u003e作为密钥类型，keysize为2048，密钥永不过期，然后输入你的用户名，邮箱地址，以及密钥对应的密码（passphrase）。\u003c/p\u003e\n\n\u003cp\u003e此外，我们还应该把下列代码加入位于用户主目录下的Shell初始化文件内：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eGPG_TTY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003etty\u003c/span\u003e\u003cspan class=\"si\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e然后运行gopass命令初始化secret store：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egopass init\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e根据提示，选择之前生成的密钥对中的私钥，用它对存储于secret store中的数据进行加密，随后输入你的邮箱地址用于git的配置。\u003c/p\u003e\n\n\u003ch2 id=\"首次登录集群\"\u003e首次登录集群\u003c/h2\u003e\n\n\u003cp\u003e第一次登录某个集群时，我们将使用\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eoc login\u003c/code\u003e命令：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eoc login\nServer \u003cspan class=\"o\"\u003e[\u003c/span\u003ehttps://localhost:8443]: https://api.cluster-foo.example.com:6443\nUsername \u003cspan class=\"o\"\u003e[\u003c/span\u003ekubeadmin]:\nPassword:\nContext \u003cspan class=\"nb\"\u003ealias\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eapi-cluster-foo-example-com-6443]: cluster-foo\nLogin successful.\n\nYou have access to 59 projects, the list has been suppressed. You can list all projects with \u003cspan class=\"s1\"\u003e\u0026#39;oc projects\u0026#39;\u003c/span\u003e\n\nUsing project \u003cspan class=\"s2\"\u003e\u0026#34;default\u0026#34;\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nSave context \u003cspan class=\"s1\"\u003e\u0026#39;cluster-foo\u0026#39;\u003c/span\u003e into secret store...\nContext saved successfully.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e根据提示，输入集群的服务器地址，登录用户名，以及密码。这些都是原有oc命令所支持的功能。在这之后，增强版oc会提示我们为即将访问的集群指定一个便于记忆的别名。这个别名相当于一个”助记符“，不仅对应于所访问的集群，还包括所使用的登录账号等信息。稍后我们会看到，增强版oc是如何利用这个别名，实现在多个集群之间的快速切换的。\u003c/p\u003e\n\n\u003cp\u003e当然，就像原有oc命令所支持的那样，我们也可以把上述输入的信息作为命令行参数，直接放在\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eoc login\u003c/code\u003e命令的后面。不过，为了避免登录信息通过命令行执行历史暴露出来，还是建议大家不要这样做。\u003c/p\u003e\n\n\u003ch2 id=\"通过别名登录集群\"\u003e通过别名登录集群\u003c/h2\u003e\n\n\u003cp\u003e当集群的登录会话超时以后，我们就需要用\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eoc login\u003c/code\u003e命令再次进行登录。不过和原有oc命令不同，这一次我们无需再重新输入全部登录信息了，只要通过\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e-c\u003c/code\u003e参数告诉oc命令我们要访问的集群别名即可：\u003c/p\u003e\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eoc login \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e cluster-foo\nRead context \u003cspan class=\"s1\"\u003e\u0026#39;cluster-foo\u0026#39;\u003c/span\u003e from secret store...\nContext loaded successfully.\nLogin successful.\n\nYou have access to 59 projects, the list has been suppressed. You can list all projects with \u003cspan class=\"s1\"\u003e\u0026#39;oc projects\u0026#39;\u003c/span\u003e\n\nUsing project \u003cspan class=\"s2\"\u003e\u0026#34;default\u0026#34;\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e这是因为，之前我们所提供的有关该集群的全部访问信息，连同对应的别名，都已经被保存在gopass的secret store里了。因此，只要我们提供别名信息，增强版oc就会根据别名找到对应的集群访问信息，并自动登录集群。\u003c/p\u003e\n\n\u003ch2 id=\"小结\"\u003e小结\u003c/h2\u003e\n\n\u003cp\u003e本文中，我们学习了增强版OpenShift CLI的安装，及其基本使用方法。在下一篇文章里，我将和大家分享有关这一工具所提供的更多有意思的功能。\u003c/p\u003e\n\n\u003cp\u003e如果你想了解更多有关增强版OpenShift CLI的信息，请阅读它的\u003ca href=\"https://morningspace.github.io/oc/docs/\"\u003e在线文档\u003c/a\u003e。如果你喜欢这个项目，欢迎给它\u003ca href=\"https://github.com/morningspace/oc\"\u003e加星\u003c/a\u003e。同时，也非常欢迎针对该项目的任何形式的贡献，比如bug报告以及代码提交。\u003c/p\u003e\n\n        \n      \u003c/section\u003e\n\n      \u003cfooter class=\"page__meta\"\u003e\n        \n        \n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-tags\" aria-hidden=\"true\"\u003e\u003c/i\u003e 标签: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/tags/#kubernetes\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003ekubernetes\u003c/a\u003e\u003cspan class=\"sep\"\u003e, \u003c/span\u003e\n    \n      \u003ca href=\"/tags/#openshift\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003eopenshift\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n\n\n  \n\n\n  \n\n  \u003cp class=\"page__taxonomy\"\u003e\n    \u003cstrong\u003e\u003ci class=\"fas fa-fw fa-folder-open\" aria-hidden=\"true\"\u003e\u003c/i\u003e 分类: \u003c/strong\u003e\n    \u003cspan itemprop=\"keywords\"\u003e\n    \n      \u003ca href=\"/categories/#tech\" class=\"page__taxonomy-item p-category\" rel=\"tag\"\u003etech\u003c/a\u003e\n    \n    \u003c/span\u003e\n  \u003c/p\u003e\n\n\n        \n\n  \u003cp class=\"page__date\"\u003e\u003cstrong\u003e\u003ci class=\"fas fa-fw fa-calendar-alt\" aria-hidden=\"true\"\u003e\u003c/i\u003e 更新时间:\u003c/strong\u003e \u003ctime class=\"dt-published\" datetime=\"2021-07-25T00:00:00+08:00\"\u003eJuly 25, 2021\u003c/time\u003e\u003c/p\u003e\n\n      \u003c/footer\u003e\n\n      \u003csection class=\"page__share\"\u003e\n  \n    \u003ch4 class=\"page__share-title\"\u003e分享\u003c/h4\u003e\n  \n\n  \u003ca href=\"https://twitter.com/intent/tweet?text=%E5%A2%9E%E5%BC%BA%E7%89%88OpenShift+CLI%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%20https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fenhanced-oc-2%2F\" class=\"btn btn--twitter\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Twitter\"\u003e\u003ci class=\"fab fa-fw fa-twitter\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Twitter\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fenhanced-oc-2%2F\" class=\"btn btn--facebook\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 Facebook\"\u003e\u003ci class=\"fab fa-fw fa-facebook\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e Facebook\u003c/span\u003e\u003c/a\u003e\n\n  \u003ca href=\"https://www.linkedin.com/shareArticle?mini=true\u0026amp;url=https%3A%2F%2Fmorningspace.github.io%2Ftech%2Fenhanced-oc-2%2F\" class=\"btn btn--linkedin\" onclick=\"window.open(this.href, \u0026#39;window\u0026#39;, \u0026#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0\u0026#39;); return false;\" title=\"分享 LinkedIn\"\u003e\u003ci class=\"fab fa-fw fa-linkedin\" aria-hidden=\"true\"\u003e\u003c/i\u003e\u003cspan\u003e LinkedIn\u003c/span\u003e\u003c/a\u003e\n\u003c/section\u003e\n\n\n      \n  \u003cnav class=\"pagination\"\u003e\n    \n      \u003ca href=\"/tech/enhanced-oc-1/\" class=\"pagination--pager\" title=\"如何高效安全的管理OpenShift集群\n\"\u003e向前\u003c/a\u003e\n    \n    \n      \u003ca href=\"/tech/enhanced-oc-3/\" class=\"pagination--pager\" title=\"增强版OpenShift CLI的更多功能\n\"\u003e向后\u003c/a\u003e\n    \n  \u003c/nav\u003e\n\n    \u003c/div\u003e",
  "Date": "2021-07-25T00:00:00+08:00",
  "Author": "MornigSpace"
}