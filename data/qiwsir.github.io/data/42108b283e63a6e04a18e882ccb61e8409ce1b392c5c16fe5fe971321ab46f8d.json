{
  "Source": "qiwsir.github.io",
  "Title": "自动驾驶中的车道识别",
  "Link": "https://qiwsir.github.io/2021/12/08/lane-detection/",
  "Content": "\u003carticle class=\"post-article\"\u003e\n    \u003ch2\u003e自动驾驶中的车道识别\u003c/h2\u003e\n    \u003cp class=\"post-date\"\u003e2021-12-08\u003c/p\u003e\n    \u003csection class=\"markdown-content\"\u003e\u003cp\u003e车道识别，是自动驾驶中必不可少的，且实现方法也不止一种。\u003c/p\u003e\n\u003ch2 id=\"车道的基本概念\"\u003e\u003ca href=\"#车道的基本概念\" class=\"headerlink\" title=\"车道的基本概念\"\u003e\u003c/a\u003e车道的基本概念\u003c/h2\u003e\u003cp\u003e“车道”，其相关解释在维基百科或者百度百科上都有，不过，正如我们日常所言，都是用来专指“机动车道”。所以，“车道识别”、“自动驾驶”等术语，也是针对机动车而言。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e自行车的“自动驾驶”也值得探索。\u003c/p\u003e\n\u003cp\u003e其实已经有了，比如：\u003ca href=\"https://www.designboom.com/technology/self-driving-bicycle-huawei-engineers-operate-unmanned-06-14-2021/\" target=\"_blank\" rel=\"noopener\"\u003ehttps://www.designboom.com/technology/self-driving-bicycle-huawei-engineers-operate-unmanned-06-14-2021/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"问题描述\"\u003e\u003ca href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"\u003e\u003c/a\u003e问题描述\u003c/h2\u003e\u003cp\u003e如同前面视频演示的实时车道识别，可以用多种方法实现。比如可以用基于学习的方法，也就是训练一个深度学习模型。\u003c/p\u003e\n\u003cp\u003e本文不用这种方法，本文要介绍一种更简单的方法：用 OpenCV 实现车道识别。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://gitee.com/qiwsir/images/raw/master/2021-12-8/1638930067979-lane.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003cp\u003e如上图所示，车道识别的重要任务就是要识别出车道两边的分道线，这是问题的关键。\u003c/p\u003e\n\u003cp\u003e那么，怎么识别这些车道的分道线呢？\u003c/p\u003e\n\u003cp\u003e从机动车的角度开出去，所看到的场景范围中，除了分道线之外，还有许多其他物体，比如车辆、路边障碍物、路灯等。通过前面的视频以及生活尝试，都容易知道，场景中的每一帧都在变化。这就是现实生活中的驾驶情况——有点复杂。\u003c/p\u003e\n\u003cp\u003e所以，要解决车道识别问题，首先要找到一种方法，能忽略场景中不应该看到的物体——只看到分道线。即如下图所示，除了分道线，别的物体都没有了。随着机动车的行驶，分道线只呈现在这个场景中。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://gitee.com/qiwsir/images/raw/master/2021-12-8/1638953096079-lane_5.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003cp\u003e在接下来的内容中，会演示如何从视频中选择指定的区域，顺带介绍必要的图像预处理技巧。\u003c/p\u003e\n\u003ch2 id=\"图像掩膜\"\u003e\u003ca href=\"#图像掩膜\" class=\"headerlink\" title=\"图像掩膜\"\u003e\u003c/a\u003e图像掩膜\u003c/h2\u003e\u003cp\u003e\u003cstrong\u003e图像掩模（image mask）\u003c/strong\u003e：用选定的图像、图形或物体，对待处理的图像（局部或全部）进行遮挡来控制图像处理的区域或处理过程。在图像处理中，对图像掩膜会有多种要求。\u003c/p\u003e\n\u003cp\u003e图像掩膜的本质就是 Numpy 的数组，如下图所示，改变图中选定区域的像素值，比如都改为 0 ，就实现了图中所示的遮罩效果。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://gitee.com/qiwsir/images/raw/master/2021-12-8/1638953757595-mask.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003cp\u003e这是一种非常简单而有效的移除不想看到的物体的方法。\u003c/p\u003e\n\u003ch2 id=\"基本思路\"\u003e\u003ca href=\"#基本思路\" class=\"headerlink\" title=\"基本思路\"\u003e\u003c/a\u003e基本思路\u003c/h2\u003e\u003cp\u003e首先是要将图片转化为“黑白”，即设置一个转化的阈值，这样就能得到如下图中右侧的效果。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://gitee.com/qiwsir/images/raw/master/2021-12-9/1639012386675-lane_6.webp\" alt=\"\"/\u003e\u003c/p\u003e\n\u003cp\u003e接下来要解决的问题就是如何让机器“看到”分道线。通常使用霍夫变换（Hough Transformation），这是一种特征提取的技术，其数学原理请参阅：\u003ca href=\"http://math.itdiffer.com\" target=\"_blank\" rel=\"noopener\"\u003ehttp://math.itdiffer.com\u003c/a\u003e 中的有关内容。\u003c/p\u003e\n\u003ch2 id=\"用-OpenCV-实现车道识别\"\u003e\u003ca href=\"#用-OpenCV-实现车道识别\" class=\"headerlink\" title=\"用 OpenCV 实现车道识别\"\u003e\u003c/a\u003e用 OpenCV 实现车道识别\u003c/h2\u003e\u003cp\u003e下面就开始编写实现车道识别的代码。建议使用谷歌的 Colab 或者百度的 AiStudio 执行代码，因为在本地跑的话，对计算能力要求有点高。本文代码就发布到了 AiStudio 上，并且相关视频也可以在该项目中下载，地址是：\u003ca href=\"https://aistudio.baidu.com/aistudio/projectdetail/3215224?contributionType=1。\" target=\"_blank\" rel=\"noopener\"\u003ehttps://aistudio.baidu.com/aistudio/projectdetail/3215224?contributionType=1。\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e先引入下列各模块和库，如果本地没有安装，请自行安装。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e os\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e re\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e cv2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e numpy \u003cspan class=\"keyword\"\u003eas\u003c/span\u003e np\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efrom\u003c/span\u003e tqdm \u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e tqdm_notebook\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e matplotlib.pyplot \u003cspan class=\"keyword\"\u003eas\u003c/span\u003e plt\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e然后读入视频。此视频文件已经放到本项目中，可以自行下载。\u003c/p\u003e\n\u003ch3 id=\"准备\"\u003e\u003ca href=\"#准备\" class=\"headerlink\" title=\"准备\"\u003e\u003c/a\u003e准备\u003c/h3\u003e\u003cp\u003e加载视频文件，并从视频中抽取若干帧作为后续应用的图片。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 将视频按照指定的帧率，将帧转化为图片\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eimage_path = \u003cspan class=\"string\"\u003e\u0026#39;frames\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title\"\u003eget_frame\u003c/span\u003e\u003cspan class=\"params\"\u003e(video, image_path, frame_rate=\u003cspan class=\"number\"\u003e0.5\u003c/span\u003e)\u003c/span\u003e:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    vidcap = cv2.VideoCapture(video)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    sec = \u003cspan class=\"number\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    count = \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    image_lst = []\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"number\"\u003e1\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        vidcap.set(cv2.CAP_PROP_POS_MSEC, sec*\u003cspan class=\"number\"\u003e1000\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        has_frames, image = vidcap.read()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e has_frames:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            image_name = \u003cspan class=\"string\"\u003ef\u0026#34;imge\u003cspan class=\"subst\"\u003e{count}\u003c/span\u003e.jpg\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            cv2.imwrite(\u003cspan class=\"string\"\u003ef\u0026#34;\u003cspan class=\"subst\"\u003e{image_path}\u003c/span\u003e/\u003cspan class=\"subst\"\u003e{image_name}\u003c/span\u003e\u0026#34;\u003c/span\u003e, image)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            image_lst.append(image_name)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003ebreak\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        count += \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        sec += frame_rate\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        sec = round(sec, \u003cspan class=\"number\"\u003e2\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e image_lst\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eimages = get_frame(\u003cspan class=\"string\"\u003e\u0026#34;road.mp4\u0026#34;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#39;frames\u0026#39;\u003c/span\u003e, frame_rate=\u003cspan class=\"number\"\u003e5\u003c/span\u003e)   \u003cspan class=\"comment\"\u003e# 此处每隔5秒取一帧，在真实的业务中，时间较长。\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003elen(images)    \u003cspan class=\"comment\"\u003e# 共计得到了167张图片\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e特别注意，上面设置的 \u003ccode\u003eframe_rate=5\u003c/code\u003e 显然比较粗糙，这是为了演示而设置的。\u003c/p\u003e\n\u003cp\u003e下面显示其中一张图片。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eimage_path = \u003cspan class=\"string\"\u003e\u0026#39;frames/\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 显示其中一张图片\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eidx = \u003cspan class=\"number\"\u003e2\u003c/span\u003e    \u003cspan class=\"comment\"\u003e# 指定一个索引\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eimage_example = image_path + os.listdir(\u003cspan class=\"string\"\u003e\u0026#34;frames\u0026#34;\u003c/span\u003e)[idx]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eimg = cv2.imread(image_example) \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 显示图片\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.figure(figsize=(\u003cspan class=\"number\"\u003e10\u003c/span\u003e,\u003cspan class=\"number\"\u003e10\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.imshow(img, cmap= \u003cspan class=\"string\"\u003e\u0026#34;gray\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.show()\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cimg src=\"https://gitee.com/qiwsir/images/raw/master/2021-12-9/1639027991087-lane_7.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"创建掩膜\"\u003e\u003ca href=\"#创建掩膜\" class=\"headerlink\" title=\"创建掩膜\"\u003e\u003c/a\u003e创建掩膜\u003c/h3\u003e\u003cp\u003e显然，我们感兴趣的区域是一个多边形范围，其他区域都是应该被遮罩起来的。 因此，首先要指定多边形的坐标，然后通过它创建掩膜。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 创建 0 数组\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003estencil = np.zeros_like(img[:,:,\u003cspan class=\"number\"\u003e0\u003c/span\u003e])\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 确定多边形的坐标\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epolygon = np.array([[\u003cspan class=\"number\"\u003e80\u003c/span\u003e,\u003cspan class=\"number\"\u003e370\u003c/span\u003e], [\u003cspan class=\"number\"\u003e300\u003c/span\u003e,\u003cspan class=\"number\"\u003e250\u003c/span\u003e], [\u003cspan class=\"number\"\u003e450\u003c/span\u003e,\u003cspan class=\"number\"\u003e250\u003c/span\u003e], [\u003cspan class=\"number\"\u003e580\u003c/span\u003e,\u003cspan class=\"number\"\u003e370\u003c/span\u003e]])\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 用 1 填充多边形\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecv2.fillConvexPoly(stencil, polygon, \u003cspan class=\"number\"\u003e1\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 显示多边形效果\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.figure(figsize=(\u003cspan class=\"number\"\u003e10\u003c/span\u003e,\u003cspan class=\"number\"\u003e10\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.imshow(stencil, cmap= \u003cspan class=\"string\"\u003e\u0026#34;gray\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.show()\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cimg src=\"https://gitee.com/qiwsir/images/raw/master/2021-12-9/1639028889975-polygon.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003cp\u003e将多边形作为掩膜，用到其中一帧图片上。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emask_img = cv2.bitwise_and(img[:,:,\u003cspan class=\"number\"\u003e0\u003c/span\u003e], \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                      img[:,:,\u003cspan class=\"number\"\u003e0\u003c/span\u003e], \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                      mask=stencil)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 显示效果\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.figure(figsize=(\u003cspan class=\"number\"\u003e10\u003c/span\u003e,\u003cspan class=\"number\"\u003e10\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.imshow(mask_img, cmap= \u003cspan class=\"string\"\u003e\u0026#34;gray\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.show()\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cimg src=\"https://gitee.com/qiwsir/images/raw/master/2021-12-8/1638953096079-lane_5.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003ch3 id=\"图片预处理\"\u003e\u003ca href=\"#图片预处理\" class=\"headerlink\" title=\"图片预处理\"\u003e\u003c/a\u003e图片预处理\u003c/h3\u003e\u003cp\u003e为了识别视频中每帧图片中的车道，必须对所有图片进行预处理，主要是前面提过的两个方面：阈值和霍夫变换\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e阈值\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eret, thresh = cv2.threshold(img, \u003cspan class=\"number\"\u003e130\u003c/span\u003e, \u003cspan class=\"number\"\u003e145\u003c/span\u003e, cv2.THRESH_BINARY)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# plot image\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.figure(figsize=(\u003cspan class=\"number\"\u003e10\u003c/span\u003e,\u003cspan class=\"number\"\u003e10\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.imshow(thresh, cmap= \u003cspan class=\"string\"\u003e\u0026#34;gray\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.show()\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cimg src=\"https://gitee.com/qiwsir/images/raw/master/2021-12-10/1639115520636-threshold.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e霍夫变换\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003elines = cv2.HoughLinesP(thresh, \u003cspan class=\"number\"\u003e1\u003c/span\u003e, np.pi/\u003cspan class=\"number\"\u003e180\u003c/span\u003e, \u003cspan class=\"number\"\u003e30\u003c/span\u003e, maxLineGap=\u003cspan class=\"number\"\u003e200\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 拷贝帧图片\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edmy = img[:,:,\u003cspan class=\"number\"\u003e0\u003c/span\u003e].copy()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 绘制霍夫线\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e line \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e lines:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    x1, y1, x2, y2 = line[\u003cspan class=\"number\"\u003e0\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    cv2.line(dmy, (x1, y1), (x2, y2), (\u003cspan class=\"number\"\u003e255\u003c/span\u003e, \u003cspan class=\"number\"\u003e0\u003c/span\u003e, \u003cspan class=\"number\"\u003e0\u003c/span\u003e), \u003cspan class=\"number\"\u003e3\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 画图显示\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.figure(figsize=(\u003cspan class=\"number\"\u003e10\u003c/span\u003e,\u003cspan class=\"number\"\u003e10\u003c/span\u003e))\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.imshow(dmy, cmap= \u003cspan class=\"string\"\u003e\u0026#34;gray\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eplt.show()\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e\u003cimg src=\"https://gitee.com/qiwsir/images/raw/master/2021-12-10/1639115716135-hough.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003cp\u003e现在，将上面的操作用在每一帧上。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecnt = \u003cspan class=\"number\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e image \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e images:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    print(image)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    img = cv2.imread(\u003cspan class=\"string\"\u003ef\u0026#39;frames/\u003cspan class=\"subst\"\u003e{image}\u003c/span\u003e\u0026#39;\u003c/span\u003e) \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# 对帧掩膜\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    masked = cv2.bitwise_and(img[:,:,\u003cspan class=\"number\"\u003e0\u003c/span\u003e], img[:,:,\u003cspan class=\"number\"\u003e0\u003c/span\u003e], mask=stencil)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# 阈值\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    ret, thresh = cv2.threshold(masked, \u003cspan class=\"number\"\u003e130\u003c/span\u003e, \u003cspan class=\"number\"\u003e145\u003c/span\u003e, cv2.THRESH_BINARY)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# 霍夫变换\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    lines = cv2.HoughLinesP(thresh, \u003cspan class=\"number\"\u003e1\u003c/span\u003e, np.pi/\u003cspan class=\"number\"\u003e180\u003c/span\u003e, \u003cspan class=\"number\"\u003e30\u003c/span\u003e, maxLineGap=\u003cspan class=\"number\"\u003e200\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    dmy = img[:,:,\u003cspan class=\"number\"\u003e0\u003c/span\u003e].copy()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   \u003cspan class=\"comment\"\u003e# 识别到的线\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e line \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e lines:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            x1, y1, x2, y2 = line[\u003cspan class=\"number\"\u003e0\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            cv2.line(dmy, (x1, y1), (x2, y2), (\u003cspan class=\"number\"\u003e255\u003c/span\u003e, \u003cspan class=\"number\"\u003e0\u003c/span\u003e, \u003cspan class=\"number\"\u003e0\u003c/span\u003e), \u003cspan class=\"number\"\u003e3\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cv2.imwrite(\u003cspan class=\"string\"\u003e\u0026#39;detected/\u0026#39;\u003c/span\u003e+str(cnt)+\u003cspan class=\"string\"\u003e\u0026#39;.png\u0026#39;\u003c/span\u003e,dmy)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eexcept\u003c/span\u003e TypeError: \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cv2.imwrite(\u003cspan class=\"string\"\u003e\u0026#39;detected/\u0026#39;\u003c/span\u003e+str(cnt)+\u003cspan class=\"string\"\u003e\u0026#39;.png\u0026#39;\u003c/span\u003e,img)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    cnt+= \u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch3 id=\"用于视频\"\u003e\u003ca href=\"#用于视频\" class=\"headerlink\" title=\"用于视频\"\u003e\u003c/a\u003e用于视频\u003c/h3\u003e\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 输入路径\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epathIn= \u003cspan class=\"string\"\u003e\u0026#39;detected/\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 输出视频\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003epathOut = \u003cspan class=\"string\"\u003e\u0026#39;roads_v2.mp4\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 设定每秒的帧数\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efps = \u003cspan class=\"number\"\u003e30.0\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efrom\u003c/span\u003e os.path \u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e isfile, join\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 读取文件\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efiles = [f \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e f \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e os.listdir(pathIn) \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e isfile(join(pathIn, f))]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efiles.sort(key=\u003cspan class=\"keyword\"\u003elambda\u003c/span\u003e f: int(re.sub(\u003cspan class=\"string\"\u003e\u0026#39;\\D\u0026#39;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e, f)))\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e将所有检测到车道的帧保存到列表中。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eframe_list = []\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e range(len(files)):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    filename=pathIn + files[i]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e#reading each files\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    img = cv2.imread(filename)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    height, width, layers = img.shape\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    size = (width,height)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e#inserting the frames into an image array\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    frame_list.append(img)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e最后，将所有的帧合并为视频。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# write the video\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eout = cv2.VideoWriter(pathOut,cv2.VideoWriter_fourcc(*\u003cspan class=\"string\"\u003e\u0026#39;DIVX\u0026#39;\u003c/span\u003e), \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                      fps, size)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"keyword\"\u003ein\u003c/span\u003e range(len(frame_list)):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"comment\"\u003e# writing to a image array\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    out.write(frame_list[i])\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eout.release()\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e齐活儿。\u003c/p\u003e\n\u003c/section\u003e\n    \u003c!-- Tags START --\u003e\n    \n    \u003c!-- Tags END --\u003e\n    \u003c!-- NAV START --\u003e\n    \n  \u003cdiv class=\"nav-container\"\u003e\n    \u003c!-- reverse left and right to put prev and next in a more logic postition --\u003e\n    \n      \u003ca class=\"nav-left\" href=\"/2021/12/03/regex-md/\"\u003e\n        \u003cspan class=\"nav-arrow\"\u003e← \u003c/span\u003e\n        \n          正则表达式\n        \n      \u003c/a\u003e\n    \n    \n      \u003ca class=\"nav-right\" href=\"/2021/12/23/gnn-and-applications/\"\u003e\n        \n          图神经网络及其应用概述\n        \n        \u003cspan class=\"nav-arrow\"\u003e →\u003c/span\u003e\n      \u003c/a\u003e\n    \n  \u003c/div\u003e\n\n    \u003c!-- NAV END --\u003e\n    \u003c!-- 打赏 START --\u003e\n    \n      \u003cdiv class=\"money-like\"\u003e\n        \u003cdiv class=\"reward-btn\"\u003e\n          赏\n          \u003cspan class=\"money-code\"\u003e\n            \u003cspan class=\"alipay-code\"\u003e\n              \u003cdiv class=\"code-image\"\u003e\u003c/div\u003e\n              \u003cb\u003e使用支付宝打赏\u003c/b\u003e\n            \u003c/span\u003e\n            \u003cspan class=\"wechat-code\"\u003e\n              \u003cdiv class=\"code-image\"\u003e\u003c/div\u003e\n              \u003cb\u003e使用微信打赏\u003c/b\u003e\n            \u003c/span\u003e\n          \u003c/span\u003e\n        \u003c/div\u003e\n        \u003cp class=\"notice\"\u003e若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏\u003c/p\u003e\n      \u003c/div\u003e\n    \n    \u003c!-- 打赏 END --\u003e\n    \u003c!-- 二维码 START --\u003e\n    \u003c!--% if (theme.qrcode) { %--\u003e\n      \u003cdiv class=\"qrcode\"\u003e\n        \u003c!--canvas id=\"share-qrcode\"\u003e\u003c/!--canvas--\u003e\n        \u003cimg src=\"https://public-tuchuang.oss-cn-hangzhou.aliyuncs.com/WechatIMG6_20200109154827.jpeg\" width=\"400\"/\u003e\n        \u003cp class=\"notice\"\u003e关注微信公众号，读文章、听课程，提升技能\u003c/p\u003e\n      \u003c/div\u003e\n    \u003c!--% } %--\u003e\n    \u003c!-- 二维码 END --\u003e\n    \n      \u003c!-- No Comment --\u003e\n    \n  \u003c/article\u003e",
  "Date": "2021-12-08T00:00:00Z",
  "Author": "老齐教室"
}