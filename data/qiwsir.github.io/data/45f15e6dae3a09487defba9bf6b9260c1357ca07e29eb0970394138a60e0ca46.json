{
  "Source": "qiwsir.github.io",
  "Title": "基于矩阵分解原理的推荐系统",
  "Link": "https://qiwsir.github.io/2020/07/18/recommender-system-matrix/",
  "Content": "\u003carticle class=\"post-article\"\u003e\n    \u003ch2\u003e基于矩阵分解原理的推荐系统\u003c/h2\u003e\n    \u003cp class=\"post-date\"\u003e2020-07-18\u003c/p\u003e\n    \u003csection class=\"markdown-content\"\u003e\u003cp\u003e作者：Pytholabs\u003c/p\u003e\n\u003cp\u003e翻译：老齐\u003c/p\u003e\n\u003cp\u003e相关图书推荐：《跟老齐学Python：数据分析》\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://public-tuchuang.oss-cn-hangzhou.aliyuncs.com/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_20200209114241.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003cp\u003e本书是数据科学、机器学习、深度学习等方向的入门读物，介绍了这些领域必用工具Numpy、Pandas和数据可视化方法，并且配有大量实例。\u003c/p\u003e\n\u003chr/\u003e\n\u003cp\u003e本文，我们将创建一个电影推荐系统。\u003c/p\u003e\n\u003ch2 id=\"原理：矩阵分解\"\u003e\u003ca href=\"#原理：矩阵分解\" class=\"headerlink\" title=\"原理：矩阵分解\"\u003e\u003c/a\u003e原理：矩阵分解\u003c/h2\u003e\u003cp\u003e矩阵分解是推荐系统系列中的一种算法，顾名思义，就是将矩阵分解成两个（或多个）矩阵，它们相乘后得到原始矩阵。 在推荐系统中，我们通常从用户与项目之间的交互/评分矩阵开始，矩阵分解算法会将用户和项目特征矩阵分解，这也称为嵌入。下面以电影推荐中的评分，购买等矩阵为例。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://public-tuchuang.oss-cn-hangzhou.aliyuncs.com/r1_20200718083343.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003cp\u003e通常，在数据集中，要挖掘用户和项目属性的潜在特征。 本质上，潜在特征是用户/项目在任意空间中的表示，表示用户如何评价电影。 在电影推荐系统的示例中，一个用户样本中包含了他所观看的多个电影，潜在特征的值越高，则表示他喜欢该类型的电影，那么就应该推荐此类型的电影。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://public-tuchuang.oss-cn-hangzhou.aliyuncs.com/0*R-6cGRwkOGUpRUMF_20200718084055.gif\" alt=\"\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"准备\"\u003e\u003ca href=\"#准备\" class=\"headerlink\" title=\"准备\"\u003e\u003c/a\u003e准备\u003c/h2\u003e\u003cp\u003e本文所用数据来自kaggle（\u003ca href=\"https://www.kaggle.com/CooperUnion/anime-recommendations-database），包含了76000个用户样本。\" target=\"_blank\" rel=\"noopener\"\u003ehttps://www.kaggle.com/CooperUnion/anime-recommendations-database），包含了76000个用户样本。\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e首先，导入数据和有关库。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efrom\u003c/span\u003e recsys \u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e * \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efrom\u003c/span\u003e generic_preprocessing \u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003efrom\u003c/span\u003e IPython.display \u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e HTML \u003cspan class=\"comment\"\u003e## 以Ipython Notebook显示\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e pandas \u003cspan class=\"keyword\"\u003eas\u003c/span\u003e pd,numpy \u003cspan class=\"keyword\"\u003eas\u003c/span\u003e np\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eanime = pd.read_csv(\u003cspan class=\"string\"\u003e\u0026#39;anime.csv\u0026#39;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eratings = pd.read_csv(\u003cspan class=\"string\"\u003e\u0026#39;rating.csv\u0026#39;\u003c/span\u003e).iloc[:\u003cspan class=\"number\"\u003e5000000\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e以上代码中的\u003ccode\u003erecsys\u003c/code\u003e模块来自：\u003ca href=\"https://github.com/aayushmnit/cookbook/blob/master/recsys.py，`generic_preprocessing`模块来自：https://github.com/aayushmnit/cookbook/blob/master/generic_preprocessing.py\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/aayushmnit/cookbook/blob/master/recsys.py，`generic_preprocessing`模块来自：https://github.com/aayushmnit/cookbook/blob/master/generic_preprocessing.py\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e为了创建推荐系统，我们需要一个可交互的矩阵。为此，使用\u003ccode\u003erecsys\u003c/code\u003e模块中的\u003ccode\u003ecreate_interaction_matrix\u003c/code\u003e函数，这个眼熟要求以Pandas的DataFrame类型的数据为输入，输入数据的列必须有诸如用户id，项目id和评分等。此函数的中如果设置\u003ccode\u003enorm=True\u003c/code\u003e，则意味着任何评分的值都应该是正的。在这个示例中，没有必要设置，因为实际的购买数据和评分都是正的。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 利用评分数据创建矩阵\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003einteractions = create_interaction_matrix(df = ratings,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t user_col = ‘user_id’,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t item_col = ‘anime_id’,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t rating_col = ‘rating’)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003einteractions.shape\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e然后用\u003ccode\u003ecreate_user_dict\u003c/code\u003e和\u003ccode\u003ecreate_item_dict\u003c/code\u003e函数（\u003ccode\u003erecsys\u003c/code\u003e模块）创建关于用户和项目的字典。\u003c/p\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 用户字典\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003euser_dict = create_user_dict(interactions=interactions)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# 项目字典\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emovies_dict = create_item_dict(df = anime,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                               id_col = \u003cspan class=\"string\"\u003e\u0026#39;anime_id\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                               name_col = \u003cspan class=\"string\"\u003e\u0026#39;name\u0026#39;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"矩阵分解模型\"\u003e\u003ca href=\"#矩阵分解模型\" class=\"headerlink\" title=\"矩阵分解模型\"\u003e\u003c/a\u003e矩阵分解模型\u003c/h2\u003e\u003cp\u003e用\u003ccode\u003erecsys\u003c/code\u003e中的\u003ccode\u003erunMF\u003c/code\u003e函数来创建矩阵分解模型，这个函数的参数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003einteraction\u003c/code\u003e：前面所创建的矩阵\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003en_components\u003c/code\u003e：对于每个用户和项目嵌入的数量\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eloss\u003c/code\u003e：定义一个损失函数，本例中我们使用warp损失函数（详见：\u003ca href=\"https://making.lyst.com/lightfm/docs/examples/warp_loss.html），因为我们更关心矩阵的秩。\" target=\"_blank\" rel=\"noopener\"\u003ehttps://making.lyst.com/lightfm/docs/examples/warp_loss.html），因为我们更关心矩阵的秩。\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eepoch\u003c/code\u003e：运行的次数\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003en_jobs\u003c/code\u003e：并行处理中使用的核数\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emf_model = runMF(interactions = interactions,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                 n_components = \u003cspan class=\"number\"\u003e30\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                 loss = \u003cspan class=\"string\"\u003e\u0026#39;warp\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                 epoch = \u003cspan class=\"number\"\u003e30\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                 n_jobs = \u003cspan class=\"number\"\u003e4\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e本系统的完整代码请参考：\u003ca href=\"https://colab.research.google.com/drive/1qPA_t4O0KXHZY7fI8N69U5ikTDC9wpRy\" target=\"_blank\" rel=\"noopener\"\u003ehttps://colab.research.google.com/drive/1qPA_t4O0KXHZY7fI8N69U5ikTDC9wpRy\u003c/a\u003e\u003c/p\u003e\n\u003chr/\u003e\n\u003cp\u003e原文链接：\u003ca href=\"https://medium.com/@pytholabs/anime-recommendation-with-matrix-factorization-pytholabs-a59f7ed05516\" target=\"_blank\" rel=\"noopener\"\u003ehttps://medium.com/@pytholabs/anime-recommendation-with-matrix-factorization-pytholabs-a59f7ed05516\u003c/a\u003e\u003c/p\u003e\n\u003c/section\u003e\n    \u003c!-- Tags START --\u003e\n    \n    \u003c!-- Tags END --\u003e\n    \u003c!-- NAV START --\u003e\n    \n  \u003cdiv class=\"nav-container\"\u003e\n    \u003c!-- reverse left and right to put prev and next in a more logic postition --\u003e\n    \n      \u003ca class=\"nav-left\" href=\"/2020/07/15/nan-vs-2/\"\u003e\n        \u003cspan class=\"nav-arrow\"\u003e← \u003c/span\u003e\n        \n          比较NaN和整数\n        \n      \u003c/a\u003e\n    \n    \n      \u003ca class=\"nav-right\" href=\"/2020/07/20/what-is-EOF/\"\u003e\n        \n          EOF是不是字符\n        \n        \u003cspan class=\"nav-arrow\"\u003e →\u003c/span\u003e\n      \u003c/a\u003e\n    \n  \u003c/div\u003e\n\n    \u003c!-- NAV END --\u003e\n    \u003c!-- 打赏 START --\u003e\n    \n      \u003cdiv class=\"money-like\"\u003e\n        \u003cdiv class=\"reward-btn\"\u003e\n          赏\n          \u003cspan class=\"money-code\"\u003e\n            \u003cspan class=\"alipay-code\"\u003e\n              \u003cdiv class=\"code-image\"\u003e\u003c/div\u003e\n              \u003cb\u003e使用支付宝打赏\u003c/b\u003e\n            \u003c/span\u003e\n            \u003cspan class=\"wechat-code\"\u003e\n              \u003cdiv class=\"code-image\"\u003e\u003c/div\u003e\n              \u003cb\u003e使用微信打赏\u003c/b\u003e\n            \u003c/span\u003e\n          \u003c/span\u003e\n        \u003c/div\u003e\n        \u003cp class=\"notice\"\u003e若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏\u003c/p\u003e\n      \u003c/div\u003e\n    \n    \u003c!-- 打赏 END --\u003e\n    \u003c!-- 二维码 START --\u003e\n    \u003c!--% if (theme.qrcode) { %--\u003e\n      \u003cdiv class=\"qrcode\"\u003e\n        \u003c!--canvas id=\"share-qrcode\"\u003e\u003c/!--canvas--\u003e\n        \u003cimg src=\"https://public-tuchuang.oss-cn-hangzhou.aliyuncs.com/WechatIMG6_20200109154827.jpeg\" width=\"400\"/\u003e\n        \u003cp class=\"notice\"\u003e关注微信公众号，读文章、听课程，提升技能\u003c/p\u003e\n      \u003c/div\u003e\n    \u003c!--% } %--\u003e\n    \u003c!-- 二维码 END --\u003e\n    \n      \u003c!-- No Comment --\u003e\n    \n  \u003c/article\u003e",
  "Date": "2020-07-18T00:00:00Z",
  "Author": "老齐教室"
}