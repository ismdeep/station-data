{
  "Source": "qiwsir.github.io",
  "Title": "Python中的SQL库：MySQL",
  "Link": "https://qiwsir.github.io/2020/05/04/sql-library-mysql/",
  "Content": "\u003carticle class=\"post-article\"\u003e\n    \u003ch2\u003ePython中的SQL库：MySQL\u003c/h2\u003e\n    \u003cp class=\"post-date\"\u003e2020-05-04\u003c/p\u003e\n    \u003csection class=\"markdown-content\"\u003e\u003cp\u003e作者：老齐\u003c/p\u003e\n\u003cp\u003e与本文相关的图书推荐：《跟老齐学Python：轻松入门》\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://public-tuchuang.oss-cn-hangzhou.aliyuncs.com/%E8%BD%BB%E6%9D%BE%E5%85%A5%E9%97%A8_20200122130623.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003chr/\u003e\n\u003cp\u003e在上一篇《Python中的SQL库：SQLite》中，已经对数据库的基本操作有所概括，并且用SQLite做了演示。本文将重点介绍在Python程序中如何操作MySQL。\u003c/p\u003e\n\u003cp\u003e本文中所用的数据库，其基本结构与上一篇文章相同，此处不再赘述。\u003c/p\u003e\n\u003ch2 id=\"连接数据库\"\u003e\u003ca href=\"#连接数据库\" class=\"headerlink\" title=\"连接数据库\"\u003e\u003c/a\u003e连接数据库\u003c/h2\u003e\u003cp\u003e对于MySQL而言，与SQLite不同之处在于Python中没有内置的模块，如果要连接MySQL数据库，需要安装第三方的模块。这方面的模块比较多，比如本文使用的\u003ccode\u003emysql-connector-python\u003c/code\u003e只是其中之一。\u003c/p\u003e\n\u003cp\u003e首先，要安装这个模块。\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003epip install mysql-connector-python\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e然后，编写创建连接MySQL的函数：\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eimport mysql.connector\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efrom mysql.connector import Error\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edef create_connection(host_name, user_name, user_password):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    connection = None\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    try:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        connection = mysql.connector.connect(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            host=host_name,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            user=user_name,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            passwd=user_password\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        print(\u0026#39;Connection to MySQL DB successful\u0026#39;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    except Error as e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        print(f\u0026#34;The error \u0026#39;{e}\u0026#39; occurred.\u0026#34;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    return connection\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econnection = create_connection(\u0026#34;localhost\u0026#34;, \u0026#39;root\u0026#39;, \u0026#34;12345678\u0026#34;)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e上面的函数汇总，有三个需要提供的参数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ehost_name\u003c/code\u003e：MySQL服务的远程地址，如果是使用的本地服务，则可以写成\u003ccode\u003elocalhost\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euser_name\u003c/code\u003e：登录MySQL的用户名，本例中直接使用\u003ccode\u003eroot\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euser_password\u003c/code\u003e：即\u003ccode\u003eroot\u003c/code\u003e对应的密码\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e通过上述参数，利用\u003ccode\u003emysql.connector.connect()\u003c/code\u003e函数建立起数据库连接，并且返回连接对象。\u003c/p\u003e\n\u003cp\u003e然后，可以创建数据库，为此编写如下函数：\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003edef create_database(connection, query):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    cursor = connection.cursor()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    try:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cursor.execute(query)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        print(\u0026#34;Database create successfully\u0026#34;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    except Error as e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        print(f\u0026#34;The error \u0026#39;{e}\u0026#39; occurred.\u0026#34;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecreate_database_query = \u0026#34;CREATE DATABASE readers\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecreate_database(connection, create_database_query)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e函数\u003ccode\u003ecreate_database\u003c/code\u003e的参数\u003ccode\u003econnection\u003c/code\u003e是前面已经创建的连接对象，\u003ccode\u003equery\u003c/code\u003e是SQL语句，利用游标对象的\u003ccode\u003eexecute\u003c/code\u003e方法执行SQL语句。如此，创建了名为\u003ccode\u003ereaders\u003c/code\u003e的MySQL数据库。\u003c/p\u003e\n\u003cp\u003e然后，重写\u003ccode\u003ecreate_connection\u003c/code\u003e函数，在其中指定所要连接的具体数据库。\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eimport mysql.connector\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efrom mysql.connector import Error\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edef create_connection(host_name, user_name, user_password, db_name):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    connection = None\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    try:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        connection = mysql.connector.connect(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            host=host_name,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            user=user_name,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            passwd=user_password,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            database=db_name\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        print(\u0026#39;Connection to MySQL DB successful\u0026#39;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    except Error as e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        print(f\u0026#34;The error \u0026#39;{e}\u0026#39; occurred.\u0026#34;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    return connection\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econnection = create_connection(\u0026#34;localhost\u0026#34;, \u0026#39;root\u0026#39;, \u0026#34;12345678\u0026#34;, \u0026#39;readers\u0026#39;)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这样，就得到了链接数据库\u003ccode\u003ereaders\u003c/code\u003e的连接对象\u003ccode\u003econnection\u003c/code\u003e。\u003c/p\u003e\n\u003ch2 id=\"创建数据库表\"\u003e\u003ca href=\"#创建数据库表\" class=\"headerlink\" title=\"创建数据库表\"\u003e\u003c/a\u003e创建数据库表\u003c/h2\u003e\u003cp\u003e前面已经看到，要在Python中执行各种SQL语句，需要通过\u003ccode\u003ecursor.execute()\u003c/code\u003e函数。下面就创建一个专门的函数，来完成各种SQL语句的操作。\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003edef execute_query(connection, query):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    cursor = connection.cursor()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    try:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cursor.execute(query)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        connection.commit()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        print(\u0026#34;Query executed successfully\u0026#34;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    except Error as e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        print(f\u0026#34;The error \u0026#39;{e}\u0026#39; occurred\u0026#34;)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e这个函数完成的，其实是所有针对数据库的“写入”操作。\u003c/p\u003e\n\u003cp\u003e例如，如下是创建\u003ccode\u003eusers\u003c/code\u003e表的SQL语句：\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecreate_users_table = \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCREATE TABLE IF NOT EXISTS users(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    id INT AUTO_INCREMENT,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    name TEXT NOT NULL,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    age INT,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    gender TEXT,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    PRIMARY KEY (id)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e) ENGINE = InnoDB\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e通过此语句，将创建\u003ccode\u003eusers\u003c/code\u003e数据库表，其中包括的字段有：\u003ccode\u003eid, name, age, gender\u003c/code\u003e，然后用下面的方式，调用函数：\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eexecute_query(connection, create_users_table)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e如此，即创建了\u003ccode\u003eusers\u003c/code\u003e数据库表，并具有前述个字段。\u003c/p\u003e\n\u003cp\u003e同样方法，编写创建\u003ccode\u003eposts\u003c/code\u003e表的SQL语句字符串：\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003ecreate_posts_table = \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eCREATE TABLE IF NOT EXISTS posts (\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  id INT AUTO_INCREMENT, \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  title TEXT NOT NULL, \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  description TEXT NOT NULL, \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  user_id INTEGER NOT NULL, \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  FOREIGN KEY fk_user_id (user_id) REFERENCES users(id), \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  PRIMARY KEY (id)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e) ENGINE = InnoDB\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eexecute_query(connection, create_posts_table)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e在上一篇中已经说过，\u003ccode\u003eusers\u003c/code\u003e和\u003ccode\u003eposts\u003c/code\u003e两张表之间是一对多的关系，在\u003ccode\u003eposts\u003c/code\u003e表中就增加了一个名为\u003ccode\u003euser_id\u003c/code\u003e的字段作为外键，它的值与\u003ccode\u003eusers\u003c/code\u003e表中的\u003ccode\u003eid\u003c/code\u003e字段值对应。\u003c/p\u003e\n\u003cp\u003e以上操作，与上一篇中SQLite操作类似。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://public-tuchuang.oss-cn-hangzhou.aliyuncs.com/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90_20200209114241.png\" alt=\"\"/\u003e\u003c/p\u003e\n\u003ch2 id=\"插入\"\u003e\u003ca href=\"#插入\" class=\"headerlink\" title=\"插入\"\u003e\u003c/a\u003e插入\u003c/h2\u003e\u003cp\u003e插入记录，当然也是“写入”操作，继续使用前面已经编写的\u003ccode\u003eexecute_query()\u003c/code\u003e函数，我们需要做的就是编写\u003ccode\u003eINSERT INTO\u003c/code\u003e语句。例如：\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003einsert_users = \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eINSERT INTO \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e`users` (`name`, `age`, `gender`)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eVALUES\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e(\u0026#39;zhagnsan\u0026#39;,23,\u0026#39;male\u0026#39;),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e(\u0026#39;lisi\u0026#39;,24,\u0026#39;female\u0026#39;),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e(\u0026#39;wangwu\u0026#39;,25,\u0026#39;male\u0026#39;);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eexecute_query(connection, insert_users)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e上述操作是向\u003ccode\u003eusers\u003c/code\u003e表中增加几条用户记录。\u003c/p\u003e\n\u003cp\u003e在前面的\u003ccode\u003eexecute_query()\u003c/code\u003e函数中，使用的是游标对象的\u003ccode\u003eexecute\u003c/code\u003e方法，此外，还有另外一个方法，在写入多条记录的时候，速度更快，如下所示：\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003esql = \u0026#34;INSERT INTO likes ( user_id, post_id ) VALUES ( %s, %s )\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eval = [(4, 5), (3, 4)]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecursor = connection.cursor()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecursor.executemany(sql, val)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003econnection.commit()\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"查询\"\u003e\u003ca href=\"#查询\" class=\"headerlink\" title=\"查询\"\u003e\u003c/a\u003e查询\u003c/h2\u003e\u003cp\u003e查询，即“读”的操作，与上一篇的中所写的函数一样。\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003edef execute_read_query(connection, query):\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    cursor = connection.cursor()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    result = None\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    try:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cursor.execute(query)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        result = cursor.fetchall()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        return result\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    except Error as e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        print(f\u0026#34;The error \u0026#39;{e}\u0026#39; occurred\u0026#34;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eselect_users = \u0026#34;SELECT * FROM users\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eusers = execute_read_query(connection, select_users)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003efor user in users:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   print(user)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e返回结果如下：\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e(1, \u0026#39;zhagnsan\u0026#39;, 23, \u0026#39;male\u0026#39;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e(2, \u0026#39;lisi\u0026#39;, 24, \u0026#39;female\u0026#39;)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e(3, \u0026#39;wangwu\u0026#39;, 25, \u0026#39;male\u0026#39;)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003ch2 id=\"更新\"\u003e\u003ca href=\"#更新\" class=\"headerlink\" title=\"更新\"\u003e\u003c/a\u003e更新\u003c/h2\u003e\u003cp\u003e对数据库的update，显然是一种“写入”操作，因此，前面编写的\u003ccode\u003eexecute_query\u003c/code\u003e函数对于更新操作依然有效。\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003eupdate_post_description = \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eUPDATE\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  posts\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eSET\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  description = \u0026#34;The weather has become pleasant now\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eWHERE\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  id = 2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eexecute_query(connection, update_post_description)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e如果再用前面的方法进行查询，就可以看到更新之后的结果了。\u003c/p\u003e\n\u003ch2 id=\"删除\"\u003e\u003ca href=\"#删除\" class=\"headerlink\" title=\"删除\"\u003e\u003c/a\u003e删除\u003c/h2\u003e\u003cp\u003e执行删除操作的SQL语句，可以通过前面所创建的\u003ccode\u003eexecute_query()\u003c/code\u003e函数完成。\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003edelete_comment = \u0026#34;DELETE FROM comments WHERE id = 2\u0026#34;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eexecute_query(connection, delete_comment)\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\n\u003cp\u003e以上演示了在Python程序中对MySQL数据库的各项操作，基本上与上一篇中SQLite的操作类似。其实，其他关系型数据库，操作都是如此进行。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e搜索技术问答的公众号：老齐教室\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在公众号中回复：\u003cstrong\u003e老齐\u003c/strong\u003e，可查看所有文章、书籍、课程。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/section\u003e\n    \u003c!-- Tags START --\u003e\n    \n    \u003c!-- Tags END --\u003e\n    \u003c!-- NAV START --\u003e\n    \n  \u003cdiv class=\"nav-container\"\u003e\n    \u003c!-- reverse left and right to put prev and next in a more logic postition --\u003e\n    \n      \u003ca class=\"nav-left\" href=\"/2020/05/03/sql-library-sqlite/\"\u003e\n        \u003cspan class=\"nav-arrow\"\u003e← \u003c/span\u003e\n        \n          Python中的SQL库：SQLite\n        \n      \u003c/a\u003e\n    \n    \n      \u003ca class=\"nav-right\" href=\"/2020/05/08/regular-expression-first/\"\u003e\n        \n          Python中的正则表达式（一）\n        \n        \u003cspan class=\"nav-arrow\"\u003e →\u003c/span\u003e\n      \u003c/a\u003e\n    \n  \u003c/div\u003e\n\n    \u003c!-- NAV END --\u003e\n    \u003c!-- 打赏 START --\u003e\n    \n      \u003cdiv class=\"money-like\"\u003e\n        \u003cdiv class=\"reward-btn\"\u003e\n          赏\n          \u003cspan class=\"money-code\"\u003e\n            \u003cspan class=\"alipay-code\"\u003e\n              \u003cdiv class=\"code-image\"\u003e\u003c/div\u003e\n              \u003cb\u003e使用支付宝打赏\u003c/b\u003e\n            \u003c/span\u003e\n            \u003cspan class=\"wechat-code\"\u003e\n              \u003cdiv class=\"code-image\"\u003e\u003c/div\u003e\n              \u003cb\u003e使用微信打赏\u003c/b\u003e\n            \u003c/span\u003e\n          \u003c/span\u003e\n        \u003c/div\u003e\n        \u003cp class=\"notice\"\u003e若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏\u003c/p\u003e\n      \u003c/div\u003e\n    \n    \u003c!-- 打赏 END --\u003e\n    \u003c!-- 二维码 START --\u003e\n    \u003c!--% if (theme.qrcode) { %--\u003e\n      \u003cdiv class=\"qrcode\"\u003e\n        \u003c!--canvas id=\"share-qrcode\"\u003e\u003c/!--canvas--\u003e\n        \u003cimg src=\"https://public-tuchuang.oss-cn-hangzhou.aliyuncs.com/WechatIMG6_20200109154827.jpeg\" width=\"400\"/\u003e\n        \u003cp class=\"notice\"\u003e关注微信公众号，读文章、听课程，提升技能\u003c/p\u003e\n      \u003c/div\u003e\n    \u003c!--% } %--\u003e\n    \u003c!-- 二维码 END --\u003e\n    \n      \u003c!-- No Comment --\u003e\n    \n  \u003c/article\u003e",
  "Date": "2020-05-04T00:00:00Z",
  "Author": "老齐教室"
}