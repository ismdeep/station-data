{
  "Source": "tech.meituan.com",
  "Title": "CAT 3.0 开源发布，支持多语言客户端及多项性能提升",
  "Link": "https://tech.meituan.com/2018/11/01/cat-pr.html",
  "Content": "\u003cdiv class=\"post-content\"\u003e\u003cdiv class=\"content\"\u003e\u003ch2 id=\"项目背景\"\u003e项目背景\u003c/h2\u003e\u003cp\u003e\u003cimg src=\"https://p0.meituan.net/travelcube/83345ea439339ec421cc4727212a875840027.png\" alt=\"\"/\u003e\u003c/p\u003e\u003cp\u003eCAT（Central Application Tracking），是美团点评基于 Java 开发的一套开源的分布式实时监控系统。美团点评基础架构部希望在基础存储、高性能通信、大规模在线访问、服务治理、实时监控、容器化及集群智能调度等领域提供业界领先的、统一的解决方案，CAT 目前在美团点评的产品定位是应用层的统一监控组件，在中间件（RPC、数据库、缓存、MQ 等）框架中得到广泛应用，为各业务线提供系统的性能指标、健康状况、实时告警等服务。\u003c/p\u003e\u003cp\u003e本文会对 CAT 的客户端、性能等做详细深入的介绍，前不久我们也发过一篇 CAT 相关的文章，里面详细介绍了 CAT 客户端和服务端的设计思路，欲知更多细节，欢迎阅读\u003ca href=\"https://tech.meituan.com/CAT_in_Depth_Java_Application_Monitoring.html\"\u003e《深度剖析开源分布式监控CAT》\u003c/a\u003e\u003c/p\u003e\u003ch2 id=\"产品价值\"\u003e产品价值\u003c/h2\u003e\u003cul\u003e\u003cli\u003e减少故障发现时间。\u003c/li\u003e\u003cli\u003e降低故障定位成本。\u003c/li\u003e\u003cli\u003e辅助应用程序优化。\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"技术优势\"\u003e技术优势\u003c/h2\u003e\u003cul\u003e\u003cli\u003e实时处理：信息的价值会随时间锐减，尤其是在事故处理过程中。\u003c/li\u003e\u003cli\u003e全量数据：全量采集指标数据，便于深度分析故障案例。\u003c/li\u003e\u003cli\u003e高可用：故障的还原与问题定位，需要高可用监控来支撑。\u003c/li\u003e\u003cli\u003e故障容忍：故障不影响业务正常运转、对业务透明。\u003c/li\u003e\u003cli\u003e高吞吐：海量监控数据的收集，需要高吞吐能力做保证。\u003c/li\u003e\u003cli\u003e可扩展：支持分布式、跨 IDC 部署，横向扩展的监控系统。\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"使用现状\"\u003e使用现状\u003c/h2\u003e\u003cp\u003e目前，CAT 已经覆盖了美团点评的外卖、酒旅、出行、金融等核心业务线，几乎已经接入美团点评的所有核心应用，并在生产环境中大规模地得到使用。\u003c/p\u003e\u003cp\u003e2016 年初至今，CAT 接入的应用增加了400%，机器数增加了 900%，每天处理的消息总量高达 3200 亿，存储消息量近 400TB，高峰期集群 QPS 达 650万/秒。\u003c/p\u003e\u003cp\u003e面对流量的成倍增长，CAT 在通信、计算、存储方面都遇到了前所未有的挑战。整个系统架构也经历了一系列的升级和改造，包括消息采样聚合、消息存储、业务多维度指标监控、统一告警等等，项目最终稳定落地。为公司未来几年内业务流量的稳定增长，打下了坚定的基石。\u003c/p\u003e\u003cp\u003e经过 7 年的持续建设，CAT 也在不断发展，我们也希望更好的回馈社区，将 CAT 提供的服务惠及更多的外部公司。我们今年将对开源版本进行较大的迭代与更新，未来也会持续把公司内部一些比较好的实践推广出去，欢迎大家跟我们一起共建这个开源社区。\u003c/p\u003e\u003ch2 id=\"新版特性\"\u003e新版特性\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://github.com/dianping/cat/blob/master/cat-doc/posts/new.md\"\u003eCAT 3.0.0 Release Notes\u003c/a\u003e\u003c/p\u003e\u003ch3 id=\"多语言客户端\"\u003e多语言客户端\u003c/h3\u003e\u003cp\u003e随着业务的不断发展，很多产品和应用需要使用不同的语言，CAT 多语言客户端需求日益增多，除 Java 客户端外，目前提供了 C/C++、Python、Node.js、Golang 客户端，基本覆盖了主流的开发语言。对于多语言客户端，核心设计目标是利用 C 客户端提供核心 API 接口作为底层基石，封装其他语言 SDK。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/b84c7dc9.png\" alt=\"\"/\u003e\u003c/p\u003e\u003cp\u003e目前支持的主流语言使用指南：\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003ca href=\"https://github.com/dianping/cat/blob/master/lib/java/README.md\"\u003eJava\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://github.com/dianping/cat/blob/master/lib/c/README.md\"\u003eC/C++\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://github.com/dianping/cat/blob/master/lib/python/README.md\"\u003ePython\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://github.com/dianping/cat/blob/master/lib/node.js/README.md\"\u003eNode.js\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://github.com/dianping/cat/blob/master/lib/go/README.md\"\u003eGolang\u003c/a\u003e\u003c/li\u003e\u003c/ul\u003e\u003ch3 id=\"性能提升\"\u003e性能提升\u003c/h3\u003e\u003cul\u003e\u003cli\u003e\u003cp\u003e\u003cstrong\u003e消息采样聚合\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e消息采样聚合在客户端应对大流量时起到了至关重要的作用，当采样命中或者内存队列已满时都会经过采样聚合上报。采样聚合是对消息树拆分归类，利用本地内存做分类统计，将聚合之后的数据进行上报，减少客户端的消息量以及降低网络开销。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/df3d7a72.png\" alt=\"\"/\u003e\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e\u003cstrong\u003e通信协议优化\u003c/strong\u003e\u003c/p\u003e\u003cp\u003eCAT 客户端与服务端通信协议由自定义文本协议升级为自定义二进制协议，在大规模数据实时处理场景下性能提升显著。目前服务端同时支持两种版本的通信协议，向下兼容旧版客户端。\u003c/p\u003e\u003cul\u003e\u003cli\u003e测试环境：CentOS 6.5，4C8G 虚拟机\u003c/li\u003e\u003cli\u003e测试结果：新版相比旧版，序列化耗时降低约 3 倍\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/d4a2b701.jpg\" alt=\"\"/\u003e\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e\u003cstrong\u003e消息文件存储\u003c/strong\u003e\u003c/p\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e新版消息文件存储进行了重新设计，解决旧版本的文件存储索引、数据文件节点过多以及随机 IO 恶化的问题。\u003c/p\u003e\u003cp\u003e新版消息文件存储为了同时兼顾读写性能，引入了二级索引存储方案，对同一个应用的 IP 节点进行合并，并且保证一定的顺序存储。下图是索引结构的最小单元，每个索引文件由若干个最小单元组成。每个单元分为 4×1024 个桶，第一个桶作为我们的一级索引 Header，存储 IP、消息序列号与分桶的映射信息。剩余 4×1024 - 1 个桶作为二级索引，存储消息的地址。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/5672928a.png\" alt=\"\"/\u003e\u003c/p\u003e\u003cp\u003e新版消息文件存储文件节点数与应用数量成正比，有效减少随机 IO，消息实时存储的性能提升显著。以下为美团点评内部 CAT 线上环境单机消息存储的数据对比：\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/b3c80136.jpg\" alt=\"\"/\u003e\u003c/p\u003e\u003ch2 id=\"未来规划\"\u003e未来规划\u003c/h2\u003e\u003cul\u003e\u003cli\u003e\u003cp\u003e\u003cstrong\u003e技术栈升级\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e拥抱主流技术栈，降低学习和开发成本，使用开源社区主流技术工具（Spring、Mybatis等），建设下一代开源产品。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e\u003cstrong\u003e产品体验\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e对产品、交互进行全新设计，提升用户体验。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e\u003cstrong\u003e开源社区建设\u003c/strong\u003e\u003c/p\u003e\u003cp\u003e产品官网建设、组织技术交流。\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003e\u003cstrong\u003e更多语言 SDK\u003c/strong\u003e\u003c/p\u003e\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"关于开源\"\u003e关于开源\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://github.com/dianping/cat/\"\u003ehttps://github.com/dianping/cat\u003c/a\u003e\u003c/p\u003e\u003cp\u003e自2014年开源以来，Github 收获 7700+ Star，2800+ Forks，被 100+ 公司企业使用，其中不乏携程、陆金所、猎聘网、平安等业内知 名公司。在每年全球 QCon 大会、全球架构与运维技术峰会等都有持续的技术输出，受到行业内认可，越来越多的企业伙伴加入了 CAT 的开 源建设工作，为 CAT 的成⻓贡献了巨大的力量。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/0b2d4b9e.png\" alt=\"\"/\u003e\u003c/p\u003e\u003cp\u003e美团点评基础架构部负责人黄斌强表示，在过去四年中，美团点评在架构中间件领域有比较多的积累沉淀，很多系统服务都经历过大规模线上业务实际运营的检验。我们在使用业界较多开源产品的同时，也希望能把积累的技术开源出去，一方面是回馈社区，贡献给整个行业生态；另一方面，让更多感兴趣的开发工程师也能参与进来，共同加速系统软件的升级与创新。所以，像 CAT 这样的优秀项目，我们将陆续开源输出并长期持续运营，保证开源软件本身的成熟度、支撑度与社区的活跃度，也欢迎大家给我们提出更多的宝贵意见和建议。\u003c/p\u003e\u003ch2 id=\"结语\"\u003e结语\u003c/h2\u003e\u003cp\u003e这是一场没有终点的长跑，我们整个 CAT 项目组将长期有耐心地不断前行。愿同行的朋友积极参与我们，关注我们，共同打造一款企业级高可用、高可靠的分布式监控中间件产品，共同描绘 CAT 的新未来！\u003c/p\u003e\u003cp\u003e这次开源仅仅是一个新的起点，如果你对 CAT 新版本有一些看法以及建议，欢迎联系我们：cat@dianping.com or \u003ca href=\"https://github.com/dianping/cat/issues\"\u003eGithub issues\u003c/a\u003e\u003c/p\u003e\u003ch2 id=\"招聘信息\"\u003e招聘信息\u003c/h2\u003e\u003cp\u003e美团点评基础架构团队诚招 Java 高级、资深技术专家，Base北京、上海。我们是集团致力于研发公司级、业界领先基础架构组件的核心团队，涵盖分布式监控、服务治理、高性能通信、消息中间件、基础存储、容器化、集群调度等技术领域。欢迎有兴趣的同学投送简历到 yong.you@dianping.com。\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e",
  "Date": "2018-11-01T00:00:00Z",
  "Author": "soulteary@gmail.com"
}