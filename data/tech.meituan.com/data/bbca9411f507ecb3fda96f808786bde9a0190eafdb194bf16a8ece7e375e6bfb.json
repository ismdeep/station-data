{
  "Source": "tech.meituan.com",
  "Title": "AI技术在智能海报设计中的应用",
  "Link": "https://tech.meituan.com/2018/12/27/ai-in-banner-design.html",
  "Content": "\u003cdiv class=\"post-content\"\u003e\u003cdiv class=\"content\"\u003e\u003ch2 id=\"背景\"\u003e背景\u003c/h2\u003e\u003cp\u003e在视觉设计领域中，设计师们往往会因为一些简单需求付出相当多的时间，比如修改文案内容，设计简单的海报版式，针对不同机型、展位的多尺寸拓展等。这些工作需要耗费大量的时间、人力成本（5~6张/人日），但对设计师的进步成长起到的作用却非常有限。另一方面，精准营销是未来的大趋势，在大流量背景下，首页的海报资源展位需要展示“千人千面”的效果，这对海报的生产效率也提出了非常高的要求。所以，我们美团外卖技术团队尝试结合AI技术，来协助设计师避免这种低收益、高重复的任务，同时低成本、高效率、高质量地完成海报图片的生成。本文以Banner（横版海报）为例，介绍我们在海报设计与AI技术结合方面所进行的一些探索和研究。\u003c/p\u003e\u003ch2 id=\"分析\"\u003e分析\u003c/h2\u003e\u003cp\u003e什么是Banner的设计过程？我们尝试总结了对Banner设计的理解，Banner的设计过程是一系列的具备某种特征属性的素材图层的有序叠加过程。这里的特征属性既包括颜色、形状、纹理、主题等视觉属性，也包括位置、大小、贴边等空间属性。在这个过程中，哪些环节可以被机器算法所探索呢？文献[1]研究了如何调整图像的颜色分布，使杂志封面的视觉效果更加符合人眼的视觉特性；文献[2]以此为基础，引入了基于显著性识别的图像裁剪，并使用优化方法来解决布局问题。阿里巴巴的“鹿班”系统在去年双十一当天，生成1.7亿张Banner，京东内部也在孵化玲珑和莎士比亚系统，更加智能地设计文案和Banner。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/c1dc0f68.png\" alt=\"图1 封面配色\u0026amp;布局设计[2]\"/\u003e\u003c/p\u003e\u003cp\u003e在设计领域的一些子问题上，可以用算法来挖掘出数据背后的规律（如图1所示）。那么，能否构建一个完整的学习算法和处理系统，统一解决Banner设计中所有的子问题（配色、布局、搭配、生成）呢？\u003c/p\u003e\u003ch2 id=\"技术方案\"\u003e技术方案\u003c/h2\u003e\u003cp\u003e素材图层是Banner的基础元素，其本身可以被\u003cstrong\u003e特征化\u003c/strong\u003e，同时组成Banner的若干元素间的叠加顺序可以被\u003cstrong\u003e序列化\u003c/strong\u003e，因此，算法实际是在学习“\u003cstrong\u003e在什么时候，选择某种素材，放在哪里\u003c/strong\u003e”。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/e22b263a.png\" alt=\"图2 流程框架\"/\u003e\u003c/p\u003e\u003cp\u003e如图2所示，为了解决这个问题，我们设计规划器、优化器、生成器来共同构建海报设计的\u003cstrong\u003e学习与生产\u003c/strong\u003e过程。其中：\u003c/p\u003e\u003col\u003e\u003cli\u003e规划器从数据中学习设计师对不同风格下的设计习惯与规律；\u003c/li\u003e\u003cli\u003e优化器基于美学质量和设计原则，对前者的输出结果做精细化调整；\u003c/li\u003e\u003cli\u003e最后，由生成器选取/生成素材并渲染成图；\u003c/li\u003e\u003cli\u003e素材库作为这三个环节的基础，负责\u003cstrong\u003e素材管理\u003c/strong\u003e和\u003cstrong\u003e素材标签化\u003c/strong\u003e。\u003c/li\u003e\u003c/ol\u003e\u003ch3 id=\"素材库\"\u003e素材库\u003c/h3\u003e\u003cp\u003e如何提取素材图片的特征属性，这是比较典型的分类问题。在计算机视觉领域，传统方案是提取图像的颜色、梯度等低级语义特征[3]，结合传统的分类器（LR、SVM等）来实现分类。近年来，基于深度学习的方法因为能表达更为复杂的语义特征，逐渐成为主流方法[4]。如图3所示我们提取传统的低级语义特征，以及基于CNN的高级语义特征，来共同完成素材\u003cstrong\u003e特征属性提取\u003c/strong\u003e。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/5c60e8ba.png\" alt=\"图3 素材库-特征提取\"/\u003e\u003c/p\u003e\u003ch3 id=\"规划器\"\u003e规划器\u003c/h3\u003e\u003cp\u003e完成素材的数据化工作后，怎样学习Banner的设计过程？\u003c/p\u003e\u003cp\u003e作为一种生成模型，对抗生成网络（GAN）[5]在近年广为应用，其优势是可以端到端地训练图像生成模型，但在我们的应用场景下，GAN存在以下两个问题：\u003c/p\u003e\u003col\u003e\u003cli\u003eGAN的过程更像是“黑盒”的过程：输入方面，虽然Conditional-GAN之类的方法可以实现某种程度有条件地可控生成，但对于Banner设计任务来说，其输入信息（文案、目标风格、主体信息）仍然过于复杂；\u003c/li\u003e\u003cli\u003e输出方面，GAN直接生成源数据（即图像），但非常缺乏解释性。我们需要的是更加直观、更有解释性的信息，比如素材的类型、颜色、轮廓、位置等。\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e在上文中有提到，Banner设计过程是\u003cstrong\u003e素材图层依次叠加\u003c/strong\u003e的过程。因此，我们可以用\u003cstrong\u003e序列生成模型\u003c/strong\u003e来拟合这个过程[6]。在建模过程中，我们把素材视作词汇（Word），海报视作句子（Sentence），词汇索引视为离散化的特征索引，素材叠加顺序就可以视为句子中的词顺序[7]。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/614bf7b6.png\" alt=\"图4 规划器-序列生成\"/\u003e\u003c/p\u003e\u003cp\u003e图4是我们使用的序列生成模型，输入主体信息和目标风格，输出素材特征的序列。为了增强预测过程中多条路径结果的多样性，我们在监督性地训练每个时刻的输出之外，还引入了评估整个序列合理性的Object loss。如图5所示，借鉴SeqGAN的思想，Object loss可以由判别器来提供[8]。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/27a5e2f0.png\" alt=\"图5 SeqGAN[8]\"/\u003e\u003c/p\u003e\u003ch3 id=\"优化器\"\u003e优化器\u003c/h3\u003e\u003cp\u003e规划器预测素材的量化特征，为了确保最终成图符合美学标准，需要一个后处理的过程（图6）。我们用优化器来解决这个问题。从本质上讲，这是一个\u003cstrong\u003e优化过程\u003c/strong\u003e。通过和设计师们的沟通，我们设计了一些基于常规设计理念和美学标准的目标函数，动作集合包括移动、缩放、亮度调整等，结合优化方法，提升Banner的视觉效果。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/955dbc74.png\" alt=\"图6 优化器\"/\u003e\u003c/p\u003e\u003ch3 id=\"生成器\"\u003e生成器\u003c/h3\u003e\u003cp\u003e优化后的素材特征序列，通过生成器来渲染成图。如图7所示，对于素材库检索不到符合某种特征属性的素材的情况，我们设计了图像风格迁移的方法来实现图像特征迁移。这里的特征可以是颜色、形状、纹理等低级特征，也可以是某种语义化的视觉风格特征，对后者来说，可以将源图像的内容Content和目标图像的风格Style在某种特征空间（CNN中的某一层）里做融合，实现\u003cstrong\u003e风格迁移\u003c/strong\u003e[9,10]。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/b5a1675b.png\" alt=\"图7 素材生成\"/\u003e\u003c/p\u003e\u003ch2 id=\"应用场景及功能拓展\"\u003e应用场景及功能拓展\u003c/h2\u003e\u003cp\u003e\u003cstrong\u003e“千人千面”\u003c/strong\u003e的精准营销是未来营销策略的趋势，这对商品素材的丰富性提出了非常高的要求；从为商家赋能的角度来说，也需要为商家提供更多样的海报版式，这也要求系统具备海报风格的快速学习能力和拓展能力。对此，在常规设计风格的研究之外，我们从以下3个方面做了一些拓展研究。\u003c/p\u003e\u003ch3 id=\"主体图片加工\"\u003e主体图片加工\u003c/h3\u003e\u003cp\u003e商品素材的丰富度与美学质量是精细化营销及海报美学质量非常重要的一环。其中最核心的要求是图像分割的能力[11,12]。以全卷积网络（FCN）为基础，如图8所示，我们采取以下几个在目标分割领域常见的技巧，来实现商品图片的目标分割：\u003c/p\u003e\u003col\u003e\u003cli\u003eEncoder-Decoder结构\u003c/li\u003e\u003cli\u003e空洞卷积\u003c/li\u003e\u003cli\u003e多尺度特征融合\u003c/li\u003e\u003cli\u003eTwo-Stage微调网络\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/ab7d81bd.png\" alt=\"图8 图像语义分割\u0026amp;抠图（结构图部分参考DeepLab v3+[12]）\"/\u003e\u003c/p\u003e\u003cp\u003e这种基于语义分割方法的结果，在专业设计师人工评审质量的过程中，发现主体边缘有时会出现明显的\u003cstrong\u003e锯齿感\u003c/strong\u003e。经过分析，我们认为有以下两个原因：\u003c/p\u003e\u003col\u003e\u003cli\u003e语义分割模型把问题建模为一个“像素级分类过程”，每一个像素的类别都天然地被假设为“非此即彼”，大多数的Segmentation模型都采用Cross-Entropy作为损失函数；\u003c/li\u003e\u003cli\u003e因此，无论是从模型结构（CNN）还是从损失函数的角度来说，分割模型会更倾向于全局信息从而丢弃局部结构信息，导致只能得到边缘比较粗糙的分割结果。\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e为此，如图8所示，我们在图像分割的输出结果之外，结合了Image Matting方法：\u003c/p\u003e\u003col\u003e\u003cli\u003e对分割模型的输出结果做形态学变换，生成三值Trimap，分别表示前景区、背景区、未知区；\u003c/li\u003e\u003cli\u003e应用常规的Matting方法，比如Bayesian、Close-Form等，以原图像和Trimap图像为输入，输出前景图的Alpha通道；\u003c/li\u003e\u003cli\u003eMatting可以使前景主体的边缘更加平滑，视觉质量更高（图9）。\u003c/li\u003e\u003c/ol\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/89ddd6a6.png\" alt=\"图9 商品主体抠图\"/\u003e\u003c/p\u003e\u003cp\u003e另外，基于图像美学质量评分模型，我们会优先选择质量分高的图片作为主体素材来源。对中低分的图片，未来可以考虑借鉴Cycle-GAN[13]的思想，设计基于半监督和GAN的图像增强网络，美化后再经过图像分割产生主体素材。\u003c/p\u003e\u003ch3 id=\"海报模板拓展\"\u003e海报模板拓展\u003c/h3\u003e\u003cp\u003e上述的常规设计风格的学习属于一种广义的设计风格，需要设计师先期投入很多精力做风格划分以及数据收集、处理。为了快速适配热点场景，我们借鉴\u003cstrong\u003e图像检索\u003c/strong\u003e技术（如图10所示），提取素材图片的\u003cstrong\u003eCNN特征及颜色特征\u003c/strong\u003e，使用欧式距离来度量素材相似度，这能节省人工打标签的成本，实现基于固定模板的自动拓展及生成（海报临摹）。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/847a641b.png\" alt=\"图10 素材图像检索与模板拓展\"/\u003e\u003c/p\u003e\u003ch3 id=\"多分辨率拓展\"\u003e多分辨率拓展\u003c/h3\u003e\u003cp\u003e在日常工作中，设计师在设计出Banner后，往往要花费很长时间对不同展位、不同版本、不同机型做多尺寸适配（如图11所示）。能否用算法来协助人工提效？在素材已经确定，并且相互的位置关系近乎确定的条件下做多分辨率适配，这本质上是一个\u003cstrong\u003e优化问题\u003c/strong\u003e，我们在上文布局优化器的基础上，增加元素的局部相对位置与全局绝对位置的拓扑关系作为目标函数。目前，系统支持在某个固定宽高比\u003cstrong\u003e±30%范围内的任意分辨率适配\u003c/strong\u003e，未来会进一步扩大适配范围。\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/5434358f.png\" alt=\"图11 多分辨率拓展\"/\u003e\u003c/p\u003e\u003ch2 id=\"总结\"\u003e总结\u003c/h2\u003e\u003cp\u003e目前，我们的Banner智能设计系统为钻展（外卖首页广告位）、商家店铺装修等业务提供稳定的设计能力；素材加工等子能力也在为外卖、闪购等商品图片提供技术支持。后续我们会从扩展常规设计风格、语义相关的颜色及素材挖掘、自动解析数据、构建自评估学习闭环等方面继续研究，进一步提高算法的设计能力和适用性，尽可能协助设计师提高效率，降低高重复性工作的时间和经济成本。\u003c/p\u003e\u003cp\u003e\u003cstrong\u003e参考文献\u003c/strong\u003e\u003c/p\u003e\u003cul\u003e\u003cli\u003e[1] A. Jahanian, J. Liu, D. Tretter, Q. Lin, E. O’Brien-Strain, S. Lee, N. Lyons, and J. P. Allebach. “Automatic Design of Colors for Magazine Covers”. In Proc. IS\u0026amp;T/SPIE Electronic Imaging, International Society for Optics and Photonics, 2013\u003c/li\u003e\u003cli\u003e[2] X. Y. Yang, T. Mei, Y. Q. Xu, Y. Rui, S. P. Li. “Automatic Generation of Visual-Textual Presentation Layout”. ACM Transactions on Multimedia Computing, Communications, and Applications, 2017\u003c/li\u003e\u003cli\u003e[3] David G. Lowe. “Distinctive Image Features from Scale-Invariant Keypoints”. International journal of computer vision, 2004\u003c/li\u003e\u003cli\u003e[4] Alex Krizhevsky, Ilya Sutskever, Geoffrey E. Hinton. “ImageNet Classification with Deep Convolutional Neural Networks”. NIPS, 2012\u003c/li\u003e\u003cli\u003e[5] I. Goodfellow, J. Pouget-Abadie, M. Mirza, B. Xu, D. Warde-Farley, S. Ozair, A. Courville, Y. Bengio. “Generative Adversarial Networks”. NIPS, 2014\u003c/li\u003e\u003cli\u003e[6] K. Kawakami. “Supervised Sequence Labelling with Recurrent Neural Networks”. Studies in Computational Intelligence, 2008\u003c/li\u003e\u003cli\u003e[7] T. Mikolov. “Statistical Language Models based on Neural Networks”. 2012\u003c/li\u003e\u003cli\u003e[8] L. Yu, W. Zhang, J. Wang, Y. Yu. “SeqGAN: Sequence Generative Adversarial Nets with Policy Gradient”. AAAI, 2017\u003c/li\u003e\u003cli\u003e[9] L.A. Gatys, A.S. Ecker, M. Bethge. “Image Style Transfer Using Convolutional Neural Networks”. CVPR, 2016\u003c/li\u003e\u003cli\u003e[10] Y. Li, M.Y. Liu, X. Li, M.H. Yang, J. Kautz. “A Closed-form Solution to Photorealistic Image Stylization”. ECCV, 2018\u003c/li\u003e\u003cli\u003e[11] J. Long, E. Shelhamer, T. Darrell. “Fully Convolutional Networks for Semantic Segmentation”. CVPR, 2015\u003c/li\u003e\u003cli\u003e[12] L.C. Chen, Y. Zhu, G. Papandreou, F. Schroff, H. Adam. “Encoder-Decoder with Atrous Separable Convolution for Semantic Image Segmentation”. ECCV, 2018\u003c/li\u003e\u003cli\u003e[13] J.Y. Zhu, T. Park, P. Isola, A. A. Efros. “Unpaired Image-to-Image Translation using Cycle-Consistent Adversarial Networks”. ICCV, 2017\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"作者简介\"\u003e作者简介\u003c/h2\u003e\u003cul\u003e\u003cli\u003e晓星，2017年6月加入美团，目前主要负责美团外卖图像内容挖掘、增强、生成方面的相关工作，致力于图像相关技术的积累及落地。\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/div\u003e",
  "Date": "2018-12-27T00:00:00Z",
  "Author": "soulteary@gmail.com"
}