{
  "Source": "www.evilsocket.net",
  "Title": "On Windows Syscall Mechanism and Syscall Numbers Extraction Methods",
  "Link": "https://www.evilsocket.net/2014/02/11/On-Windows-syscall-mechanism-and-syscall-numbers-extraction-methods/",
  "Content": "\u003cdiv class=\"content\" itemprop=\"articleBody\"\u003e\n\u003cp\u003eEveryone who’s familiar with operating systems theoretical structure, whether he attented a college course or he has just read a book on this subject, knows the concept of a \u003cstrong\u003esystem call\u003c/strong\u003e i.e. how a user space application talks with the kernel asking it to perform various jobs such as opening a file, creating a memory mapped region, etc.\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\u003cp\u003eThose system calls are usually described as putting some value ( the syscall number ) in a CPU register and then call an OS dependant interrupt, for instance ( the syscall number here was totally invented, just showing you an example )\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emov eax, 0x1234\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003elea edx, [esp+4]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eint 0x2E\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003eThis piece of assembly code would invoke the 0x1234 syscall on a 32bit Windows 2000 system, but this mechanism had deeply changed starting from Windows XP and later versions.\u003c/p\u003e\n\u003ch4 id=\"XP-SYSENTER-and-KiFastSystemCall\"\u003e\u003ca href=\"#XP-SYSENTER-and-KiFastSystemCall\" class=\"headerlink\" title=\"XP, SYSENTER and KiFastSystemCall\"\u003e\u003c/a\u003eXP, SYSENTER and KiFastSystemCall\u003c/h4\u003e\u003cp\u003eWindows XP was the first version of the Microsoft OS which introduced the \u003cstrong\u003eKiFastSystemCall\u003c/strong\u003e mechanism, look at the following code which is basically the same as the previous one:\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emov eax, 0x1234\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emov edx, address of ntdll!KiFastSystemCall\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecall edx\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eretn 8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003eIf we disassemble the KiFastSystemCall symbol exported by ntdll.dll we find the following code:\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emov edx, esp\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esysenter\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eretn\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003eNotice the \u003cstrong\u003esysenter\u003c/strong\u003e operator, as stated by the Intel instruction set reference manual ( vol. 2 p. 721 ) :\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eThe SYSENTER instruction is part of the \u0026#34;Fast System Call\u0026#34; facility introduced on the\nPentium® II processor. The SYSENTER instruction is optimized to provide the maximum\nperformance for transitions to protection ring 0 (CPL = 0).\n\nThe SYSENTER and SYSEXIT instructions do not constitute a call/return pair; therefore, the\nsystem call \u0026#34;stub\u0026#34; routines executed by user code (typically in shared libraries or DLLs) must\nperform the required register state save to create a system call/return pair.\nThe SYSENTER instruction always transfers to a flat protected mode kernel at CPL = 0.\nSYSENTER can be invoked from all modes except real mode.\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSo this is basically a new opcode introduced by Intel which makes swapping from Ring 3 to Ring 0 and back faster than it was with the old interrupt call.\u003c/p\u003e\n\u003ch4 id=\"64bit-Systems\"\u003e\u003ca href=\"#64bit-Systems\" class=\"headerlink\" title=\"64bit Systems\"\u003e\u003c/a\u003e64bit Systems\u003c/h4\u003e\u003cp\u003eYou will find that on 64bit systems things are slightly different ( I’ve just tested this on a Windows 7 SP1 64bit installation, please correct me if I’m wrong for other OS versions ), if we take a look at the code of \u003cstrong\u003eNtCreateFile\u003c/strong\u003e inside ntdll, the code is:\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emov     r10, rcx\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003emov     eax, 52h\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003esyscall\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eretn\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003eAs you can see there’s no call to KiFastSystemCall, instead the eax register is filled with the syscall number ( 52h in this case ) and sysenter is called directly by the NT API, but what about 32bit applications running under a \u003cstrong\u003eWOW64\u003c/strong\u003e environment ?\u003c/p\u003e\n\u003ch4 id=\"Just-WOW64\"\u003e\u003ca href=\"#Just-WOW64\" class=\"headerlink\" title=\"Just WOW64\"\u003e\u003c/a\u003eJust WOW64\u003c/h4\u003e\u003cp\u003eObviously there’s some trick behind it, how a 32bit application could ask a 64bit processor to perform a transition from Ring3 to Ring0? As you probably know, Windows has a subsystem called WOW64 which acts as an emulation layer for 32bit apps under 64bit architectures. Among other things WOW64 is composed by a full set of 32bit stub/proxy libraries who make the app run without problems while WOW manages the switch between 32bit and 64bit OS code. An example of the KiFastSystemCall mechanism under WOW64 would be ( always talking about NtCreateFile )\u003c/p\u003e\n\u003cfigure class=\"highlight plain\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003emov\teax,52h\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003exor\tecx,ecx\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003elea\tedx,[esp+04h]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecall\tfs:[C0h]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eadd\tesp,04h\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eretn\t002Ch\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003eVery similar to the 32bit counterpart, but this time the call is towards \u003cstrong\u003eFS:C0h\u003c/strong\u003e, a field in the \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://en.wikipedia.org/wiki/Win32_Thread_Information_Block\"\u003eTIB\u003c/a\u003e which contains a pointer to another call. So let’s try to see what’s in there with the following C application.\u003c/p\u003e\n\u003cfigure class=\"highlight c\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;windows.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;stdio.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"title\"\u003emain\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"keyword\"\u003eint\u003c/span\u003e argc, \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e* argv[])\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;FS:[C0h]         : %08X\\n\u0026#34;\u003c/span\u003e, __readfsdword(\u003cspan class=\"number\"\u003e0xc0\u003c/span\u003e) );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;KiFastSystemCall : %08X\\n\u0026#34;\u003c/span\u003e, GetProcAddress( GetModuleHandle(\u003cspan class=\"string\"\u003e\u0026#34;ntdll\u0026#34;\u003c/span\u003e), \u003cspan class=\"string\"\u003e\u0026#34;KiFastSystemCall\u0026#34;\u003c/span\u003e ) );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003eOn my computer this program prints the following results:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eFS:[C0h]         : 75452320\nKiFastSystemCall : 77B101D0\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt is clear that we’re not invoking KiFastSystemCall anymore, so what’s at address 75452320 and by whom is contained? Nothing OllyDbg can’t find out :)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2014/Feb/hidden_module_wow.png\" alt=\"OllyDbg WOW64 Syscall\"/\u003e\u003c/p\u003e\n\u003cp\u003eWait, what?! An anonymous memory region? Let’s go deeper …\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2014/Feb/dump.png\" alt=\"OllyDbg WOW64 jmp\"/\u003e\u003c/p\u003e\n\u003cp\u003eAnd this is where the transition from 32bit to 64bit code occurs, with a \u003cstrong\u003efar\u003c/strong\u003e jump to \u003cstrong\u003e7545271E\u003c/strong\u003e with the code segment being set at \u003cstrong\u003e33h\u003c/strong\u003e, i.e. a jmp to the symbol \u003cstrong\u003eCpupReturnFromSimulatedCode\u003c/strong\u003e of \u003cstrong\u003ewow64cpu.dll\u003c/strong\u003e, a 64bit library which is always loaded into a 32bit application address space but it’s hidden from the PEB by the OS itself ( that’s why Olly saw it as an anonymous memory region ).\u003cbr/\u003eGoing deeper in its content we would see that the syscall is performed just as we saw before, setting the proper syscall number and then calling \u003cstrong\u003ethe real\u003c/strong\u003e KiFastSystemCall from 64bit ntdll.dll.\u003c/p\u003e\n\u003ch4 id=\"Extracting-Syscall-Numbers\"\u003e\u003ca href=\"#Extracting-Syscall-Numbers\" class=\"headerlink\" title=\"Extracting Syscall Numbers\"\u003e\u003c/a\u003eExtracting Syscall Numbers\u003c/h4\u003e\u003cp\u003eUsing raw system calls instead of normal high level API is obviously unusual and unnecessarily uncomfortable, except if you want to evade some monitoring/hooking software and obtain a basic code obfuscation … think about it, you won’t use any API but just set up some registers and then calling sysenter, isn’t it cool ? :)\u003cbr/\u003eThe problem here is on every Windows version, and among each service pack too syscall numbers may vary and there’s no \u003cem\u003eofficial\u003c/em\u003e way to obtain the correct values for the system your application is running on.\u003cbr/\u003eBy “official ways” I mean there’s no API Microsoft implemented to have this information, but we can always extract those values from the ntdll library we can find during runtime.\u003cbr/\u003eWe can load it with a simple \u003cstrong\u003eLoadLibrary\u003c/strong\u003e, obtain a pointer to the API we’re interested in ( let’s say NtCreateFile ) with \u003cstrong\u003eGetProcAddress\u003c/strong\u003e and examine the first opcodes in it … would’t it be cool if we could achieve the same result without loading the library but manually inspecting its content as a portable executable file? Of course it would, we can easily open ntdll.dll, inspect its export directory, obtain the RVA and raw offset of NtCreateFile and then check the first bytes of opcodes. We’ve to expect the first byte to be \u003cstrong\u003eB8h\u003c/strong\u003e which is a \u003cstrong\u003eMOV EAX, IMM32\u003c/strong\u003e so we can take the four next bytes and have our syscall number.\u003c/p\u003e\n\u003cp\u003eThe following is an example program I’ve made for this purpose, it parses ntdll export directory and prints a table with each syscall number, RVA and relative API name.\u003c/p\u003e\n\u003cfigure class=\"highlight c\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e53\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e54\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e55\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e56\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e57\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e58\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e59\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e60\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e61\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e62\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e63\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e64\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e65\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e66\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e67\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e68\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e69\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e70\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e71\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e72\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e73\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e74\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e75\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e76\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e77\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e78\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e79\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e80\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e81\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e82\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e83\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e84\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e85\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e86\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e87\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e88\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e89\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e90\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e91\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e92\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e93\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e94\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e95\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e96\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e97\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e98\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e99\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e100\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e101\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e102\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e103\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e104\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e105\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e106\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e107\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e108\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e109\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e110\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e111\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e112\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e113\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e114\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e115\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e116\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e117\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e118\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e119\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e120\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e121\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e122\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e123\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e124\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e125\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e126\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e127\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e128\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e129\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e130\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e131\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e132\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e133\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e134\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e135\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e136\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e137\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e138\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e139\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e140\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e141\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e142\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e143\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e144\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e145\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e146\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e147\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e148\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e149\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e150\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e151\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e152\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e153\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e154\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e155\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e156\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e157\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e158\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e159\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e160\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e161\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e162\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e163\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e164\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e165\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e166\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e167\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e168\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e169\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e170\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e171\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e172\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e173\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e174\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e175\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e176\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e177\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e178\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e179\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e180\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e181\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e182\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e183\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e184\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e185\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e186\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e187\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e188\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e189\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e190\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e191\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e192\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e193\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e194\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e195\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e196\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e197\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e198\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e199\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e200\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e201\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e202\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e203\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e204\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e205\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e206\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e207\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e208\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e209\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e210\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e211\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;stdio.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"meta-string\"\u003e\u0026lt;Windows.h\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003edefine\u003c/span\u003e IS_ADDRESS_BETWEEN( left, right, address ) ( (address) \u0026gt;= (left) \u0026amp;\u0026amp; (address) \u0026lt; (right) )\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003ePIMAGE_SECTION_HEADER \u003cspan class=\"title\"\u003eSectionByRVA\u003c/span\u003e\u003cspan class=\"params\"\u003e( PIMAGE_SECTION_HEADER pSections, DWORD dwSections, DWORD rva )\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   PIMAGE_SECTION_HEADER pSectionHeader = pSections;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   DWORD i;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   \u003cspan class=\"keyword\"\u003efor\u003c/span\u003e( i = \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; dwSections; i++, pSectionHeader++ )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   {\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"comment\"\u003e// Is the RVA within this section?\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e      \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( IS_ADDRESS_BETWEEN( pSectionHeader-\u0026gt;VirtualAddress, ( pSectionHeader-\u0026gt;VirtualAddress + pSectionHeader-\u0026gt;SizeOfRawData ), rva ) )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e         \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e pSectionHeader;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e   \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003eDWORD \u003cspan class=\"title\"\u003eRawOffsetByRVA\u003c/span\u003e\u003cspan class=\"params\"\u003e( PIMAGE_SECTION_HEADER pSections, DWORD dwSections, DWORD dwFileSize, DWORD rva )\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPIMAGE_SECTION_HEADER pSectionHeader;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tDWORD dwOffset, dwDelta;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tpSectionHeader = SectionByRVA( pSections, dwSections, rva );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e ( !pSectionHeader )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwDelta  = rva - pSectionHeader-\u0026gt;VirtualAddress;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwOffset = pSectionHeader-\u0026gt;PointerToRawData + dwDelta;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( dwOffset \u0026gt;= dwFileSize )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e dwOffset;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e#\u003cspan class=\"meta-keyword\"\u003edefine\u003c/span\u003e GET_POINTER(RVA) ( pBuffer + RawOffsetByRVA( Sections, dwSections, dwFileSize, (RVA) ) )\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"title\"\u003emain\u003c/span\u003e\u003cspan class=\"params\"\u003e(\u003cspan class=\"keyword\"\u003eint\u003c/span\u003e argc, \u003cspan class=\"keyword\"\u003echar\u003c/span\u003e* argv[])\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003c/span\u003e{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tHANDLE hFile = INVALID_HANDLE_VALUE,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t   hMap  = \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPBYTE pBuffer = \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e, pOps = \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tDWORD dwFileSize = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t  dwSizeOfHeaders = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t  dwSections = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t  dwBaseAddress = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t  dwImageSize = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e  \t      dwExportRVA  = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t  dwExportSize = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t  dwExportRaw  = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t  dwExports = \u003cspan class=\"number\"\u003e0\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPDWORD pdwFunctions, pszFunctionNames;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPWORD  pwOrdinals;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPIMAGE_NT_HEADERS     NTHeader;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPIMAGE_DOS_HEADER     DOSHeader;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPIMAGE_SECTION_HEADER Sections;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tPIMAGE_EXPORT_DIRECTORY pExportDirectory;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\thFile = CreateFile\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"string\"\u003e\u0026#34;c:\\\\windows\\\\system32\\\\ntdll.dll\u0026#34;\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tGENERIC_READ,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tFILE_SHARE_READ | FILE_SHARE_DELETE,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tOPEN_EXISTING,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tFILE_ATTRIBUTE_NORMAL,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( hFile == INVALID_HANDLE_VALUE )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"built_in\"\u003efprintf\u003c/span\u003e( \u003cspan class=\"built_in\"\u003estderr\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;Could not open file: %08X\\n\u0026#34;\u003c/span\u003e, GetLastError() );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003egoto\u003c/span\u003e done;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwFileSize = GetFileSize( hFile, \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\thMap = CreateFileMapping( hFile, \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e, PAGE_READONLY, \u003cspan class=\"number\"\u003e0\u003c/span\u003e, \u003cspan class=\"number\"\u003e0\u003c/span\u003e, \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( hMap == \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"built_in\"\u003efprintf\u003c/span\u003e( \u003cspan class=\"built_in\"\u003estderr\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;Could not create memory map: %08X\\n\u0026#34;\u003c/span\u003e, GetLastError() );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003egoto\u003c/span\u003e done;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tpBuffer = (PBYTE)MapViewOfFile( hMap, FILE_MAP_READ, \u003cspan class=\"number\"\u003e0\u003c/span\u003e, \u003cspan class=\"number\"\u003e0\u003c/span\u003e, \u003cspan class=\"number\"\u003e0\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( hMap == \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"built_in\"\u003efprintf\u003c/span\u003e( \u003cspan class=\"built_in\"\u003estderr\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;Could not obtain memory map view: %08X\\n\u0026#34;\u003c/span\u003e, GetLastError() );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003egoto\u003c/span\u003e done;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( pBuffer[\u003cspan class=\"number\"\u003e0\u003c/span\u003e] != \u003cspan class=\"string\"\u003e\u0026#39;M\u0026#39;\u003c/span\u003e || pBuffer[\u003cspan class=\"number\"\u003e1\u003c/span\u003e] != \u003cspan class=\"string\"\u003e\u0026#39;Z\u0026#39;\u003c/span\u003e )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"built_in\"\u003efprintf\u003c/span\u003e( \u003cspan class=\"built_in\"\u003estderr\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;Unexpected file header.\\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003egoto\u003c/span\u003e done;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"comment\"\u003e// start reading PE headers\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tDOSHeader = (PIMAGE_DOS_HEADER)pBuffer;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tNTHeader  = (PIMAGE_NT_HEADERS)( pBuffer + DOSHeader-\u0026gt;e_lfanew );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwSizeOfHeaders = NTHeader-\u0026gt;OptionalHeader.SizeOfHeaders;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwBaseAddress   = NTHeader-\u0026gt;OptionalHeader.ImageBase;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwImageSize     = NTHeader-\u0026gt;OptionalHeader.SizeOfImage;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwSections      = NTHeader-\u0026gt;FileHeader.NumberOfSections;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"comment\"\u003e// get first section header\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tSections = (PIMAGE_SECTION_HEADER)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tpBuffer +\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tDOSHeader-\u0026gt;e_lfanew +\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003esizeof\u003c/span\u003e(IMAGE_NT_HEADERS)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"comment\"\u003e// now parse the export directory\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwExportRVA  = NTHeader-\u0026gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwExportSize = NTHeader-\u0026gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].Size;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwExportRaw  = RawOffsetByRVA( Sections, dwSections, dwFileSize, dwExportRVA );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( !dwExportRVA || !dwExportSize || !dwExportRaw )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"built_in\"\u003efprintf\u003c/span\u003e( \u003cspan class=\"built_in\"\u003estderr\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;Unexpected export directory structure.\\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003egoto\u003c/span\u003e done;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tpExportDirectory = (PIMAGE_EXPORT_DIRECTORY)( pBuffer + dwExportRaw );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tpdwFunctions     = (PDWORD)GET_POINTER( pExportDirectory-\u0026gt;AddressOfFunctions );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tpwOrdinals       = (PWORD)GET_POINTER( pExportDirectory-\u0026gt;AddressOfNameOrdinals );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tpszFunctionNames = (PDWORD)GET_POINTER( pExportDirectory-\u0026gt;AddressOfNames );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\tdwExports\t\t = pExportDirectory-\u0026gt;NumberOfNames;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;SYSCALL   RVA       NAME\\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;-----------------------------------------------\\n\u0026#34;\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"comment\"\u003e// loop each exported symbol by name\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003efor\u003c/span\u003e( DWORD i = \u003cspan class=\"number\"\u003e0\u003c/span\u003e; i \u0026lt; pExportDirectory-\u0026gt;NumberOfNames; ++i )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tDWORD dwNameRVA = pszFunctionNames[ i ],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t  dwApiRVA  = pdwFunctions[ pwOrdinals[ i ] ],\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t  dwSyscall = \u003cspan class=\"number\"\u003e0\u003c/span\u003e,\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t  dwApiRaw  = RawOffsetByRVA( Sections, dwSections, dwFileSize, dwApiRVA ),\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t  dwNameRaw = RawOffsetByRVA( Sections, dwSections, dwFileSize, dwNameRVA );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tpOps = pBuffer + dwApiRaw;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"comment\"\u003e/*\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t * Check if the API entry begins with:\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *\tMOV  EAX, IMM32\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *  XOR  ECX, ECX\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *  LEA  EDX, [ESP+04h]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *  CALL FS:[C0h]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t * Or\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *\tMOV  EAX, IMM32\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *  MOV  ECX, IMM32\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *  LEA  EDX, [ESP+04h]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t *  CALL FS:[C0h]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( pOps[\u003cspan class=\"number\"\u003e0\u003c/span\u003e] == \u003cspan class=\"number\"\u003e0xB8\u003c/span\u003e \u0026amp;\u0026amp;\t\t\t\t\t\t\t\t\t            \u003cspan class=\"comment\"\u003e// mov eax, imm32\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t\tpOps[\u003cspan class=\"number\"\u003e5\u003c/span\u003e] == \u003cspan class=\"number\"\u003e0x33\u003c/span\u003e \u0026amp;\u0026amp; pOps[\u003cspan class=\"number\"\u003e6\u003c/span\u003e] == \u003cspan class=\"number\"\u003e0xC9\u003c/span\u003e \u0026amp;\u0026amp;\t\t            \u003cspan class=\"comment\"\u003e// xor ecx, ecx\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t\t!\u003cspan class=\"built_in\"\u003ememcmp\u003c/span\u003e( \u0026amp;pOps[\u003cspan class=\"number\"\u003e7\u003c/span\u003e],  \u003cspan class=\"string\"\u003e\u0026#34;\\x8D\\x54\\x24\\x04\u0026#34;\u003c/span\u003e, \u003cspan class=\"number\"\u003e4\u003c/span\u003e ) \u0026amp;\u0026amp;          \u003cspan class=\"comment\"\u003e// lea edx, [esp+04h]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t\t!\u003cspan class=\"built_in\"\u003ememcmp\u003c/span\u003e( \u0026amp;pOps[\u003cspan class=\"number\"\u003e11\u003c/span\u003e], \u003cspan class=\"string\"\u003e\u0026#34;\\x64\\xFF\\x15\\xC0\\x00\\x00\\x00\u0026#34;\u003c/span\u003e, \u003cspan class=\"number\"\u003e7\u003c/span\u003e ) \u003cspan class=\"comment\"\u003e// call fs:[C0h]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t||\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t(\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t\tpOps[\u003cspan class=\"number\"\u003e5\u003c/span\u003e] == \u003cspan class=\"number\"\u003e0xB9\u003c/span\u003e \u0026amp;\u0026amp;\t\t\t\t\t\t\t\t        \u003cspan class=\"comment\"\u003e// mov ecx, imm32\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t\t!\u003cspan class=\"built_in\"\u003ememcmp\u003c/span\u003e( \u0026amp;pOps[\u003cspan class=\"number\"\u003e10\u003c/span\u003e], \u003cspan class=\"string\"\u003e\u0026#34;\\x8D\\x54\\x24\\x04\u0026#34;\u003c/span\u003e, \u003cspan class=\"number\"\u003e4\u003c/span\u003e ) \u0026amp;\u0026amp;          \u003cspan class=\"comment\"\u003e// lea edx, [esp+04h]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t\t!\u003cspan class=\"built_in\"\u003ememcmp\u003c/span\u003e( \u0026amp;pOps[\u003cspan class=\"number\"\u003e13\u003c/span\u003e], \u003cspan class=\"string\"\u003e\u0026#34;\\x64\\xFF\\x15\\xC0\\x00\\x00\\x00\u0026#34;\u003c/span\u003e, \u003cspan class=\"number\"\u003e7\u003c/span\u003e ) \u003cspan class=\"comment\"\u003e// call fs:[C0h]\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\t)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\u003cspan class=\"comment\"\u003e/*\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t\t * Extract the IMM32 part, this is our syscall number.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e\t\t\t */\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\tdwSyscall  = *(DWORD *)( pOps + \u003cspan class=\"number\"\u003e1\u003c/span\u003e );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\t\u003cspan class=\"built_in\"\u003eprintf\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#34;%08X  %08X  %s\\n\u0026#34;\u003c/span\u003e, dwSyscall, dwBaseAddress + dwApiRVA, pBuffer + dwNameRaw );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003edone:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( hFile != INVALID_HANDLE_VALUE )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tCloseHandle( hFile );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( pBuffer != \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tUnmapViewOfFile( pBuffer );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e( hMap != \u003cspan class=\"literal\"\u003eNULL\u003c/span\u003e )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t{\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\tCloseHandle( hMap );\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"number\"\u003e0\u003c/span\u003e;\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003eOn my Windows 7 computer the output is:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eSYSCALL   RVA       NAME\n-----------------------------------------------\n00000060  7DE90210  NtAcceptConnectPort\n00000061  7DE90228  NtAccessCheck\n00000026  7DE8FC68  NtAccessCheckAndAuditAlarm\n00000062  7DE90240  NtAccessCheckByType\n00000056  7DE90114  NtAccessCheckByTypeAndAuditAlarm\n00000063  7DE90258  NtAccessCheckByTypeResultList\n00000064  7DE90270  NtAccessCheckByTypeResultListAndAuditAlarm\n00000065  7DE90288  NtAccessCheckByTypeResultListAndAuditAlarmByHandle\n00000066  7DE902A0  NtAddBootEntry\n00000067  7DE902B8  NtAddDriverEntry\n00000068  7DE902D0  NtAdjustGroupsToken\n0000003E  7DE8FEC0  NtAdjustPrivilegesToken\n0000006C  7DE9033C  NtAllocateReserveObject\n0000006D  7DE90354  NtAllocateUserPhysicalPages\n00000015  7DE8FAC0  NtAllocateVirtualMemory\n0000006F  7DE90388  NtAlpcAcceptConnectPort\n00000070  7DE903A0  NtAlpcCancelMessage\n00000071  7DE903B8  NtAlpcConnectPort\n00000072  7DE903D0  NtAlpcCreatePort\n00000073  7DE903E8  NtAlpcCreatePortSection\n00000074  7DE90400  NtAlpcCreateResourceReserve\n00000075  7DE90418  NtAlpcCreateSectionView\n00000076  7DE90430  NtAlpcCreateSecurityContext\n00000077  7DE90448  NtAlpcDeletePortSection\n00000078  7DE90460  NtAlpcDeleteResourceReserve\n00000079  7DE90478  NtAlpcDeleteSectionView\n0000007A  7DE90490  NtAlpcDeleteSecurityContext\n0000007B  7DE904A8  NtAlpcDisconnectPort\n0000007C  7DE904C0  NtAlpcImpersonateClientOfPort\n0000007D  7DE904D8  NtAlpcOpenSenderProcess\n0000007E  7DE904F0  NtAlpcOpenSenderThread\n0000007F  7DE90508  NtAlpcQueryInformation\n00000080  7DE90520  NtAlpcQueryInformationMessage\n00000081  7DE90538  NtAlpcRevokeSecurityContext\n00000082  7DE90550  NtAlpcSendWaitReceivePort\n00000083  7DE90568  NtAlpcSetInformation\n00000049  7DE8FFD4  NtApphelpCacheControl\n00000002  7DE8F8D8  NtCallbackReturn\n0000005A  7DE9017C  NtCancelIoFile\n00000086  7DE905B8  NtCancelIoFileEx\n00000087  7DE905D0  NtCancelSynchronousIoFile\n0000000C  7DE8F9E0  NtClose\n00000038  7DE8FE2C  NtCloseObjectAuditAlarm\n00000088  7DE905E8  NtCommitComplete\n00000089  7DE90600  NtCommitEnlistment\n0000008A  7DE90618  NtCommitTransaction\n0000008B  7DE90630  NtCompactKeys\n0000008C  7DE90648  NtCompareTokens\n0000008D  7DE90660  NtCompleteConnectPort\n0000008F  7DE90694  NtConnectPort\n00000040  7DE8FEF0  NtContinue\n00000090  7DE906AC  NtCreateDebugObject\n00000091  7DE906C4  NtCreateDirectoryObject\n00000092  7DE906DC  NtCreateEnlistment\n00000045  7DE8FF74  NtCreateEvent\n00000093  7DE906F4  NtCreateEventPair\n00000052  7DE900B4  NtCreateFile\n00000094  7DE9070C  NtCreateIoCompletion\n00000095  7DE90724  NtCreateJobObject\n00000096  7DE9073C  NtCreateJobSet\n0000001A  7DE8FB40  NtCreateKey\n00000097  7DE90754  NtCreateKeyTransacted\n00000098  7DE9076C  NtCreateKeyedEvent\n00000099  7DE90784  NtCreateMailslotFile\n0000009A  7DE9079C  NtCreateMutant\n0000009B  7DE907B4  NtCreateNamedPipeFile\n0000009C  7DE907CC  NtCreatePagingFile\n0000009D  7DE907E4  NtCreatePort\n0000009E  7DE907FC  NtCreatePrivateNamespace\n0000009F  7DE90814  NtCreateProcess\n0000004A  7DE8FFEC  NtCreateProcessEx\n000000A0  7DE9082C  NtCreateProfile\n000000A1  7DE90844  NtCreateProfileEx\n000000A2  7DE9085C  NtCreateResourceManager\n00000047  7DE8FFA4  NtCreateSection\n000000A3  7DE90874  NtCreateSemaphore\n000000A4  7DE9088C  NtCreateSymbolicLinkObject\n0000004B  7DE90004  NtCreateThread\n000000A5  7DE908A4  NtCreateThreadEx\n000000A6  7DE908BC  NtCreateTimer\n000000A7  7DE908D4  NtCreateToken\n000000A8  7DE908EC  NtCreateTransaction\n000000A9  7DE90904  NtCreateTransactionManager\n000000AA  7DE9091C  NtCreateUserProcess\n000000AB  7DE90934  NtCreateWaitablePort\n000000AC  7DE9094C  NtCreateWorkerFactory\n000000AE  7DE90980  NtDebugContinue\n000000B0  7DE909B4  NtDeleteBootEntry\n000000B1  7DE909CC  NtDeleteDriverEntry\n000000B2  7DE909E4  NtDeleteFile\n000000B3  7DE909FC  NtDeleteKey\n000000B4  7DE90A14  NtDeleteObjectAuditAlarm\n000000B5  7DE90A2C  NtDeletePrivateNamespace\n000000B6  7DE90A44  NtDeleteValueKey\n000000B7  7DE90A5C  NtDisableLastKnownGood\n000000B8  7DE90A74  NtDisplayString\n000000B9  7DE90A8C  NtDrawText\n00000039  7DE8FE44  NtDuplicateObject\n0000003F  7DE8FED8  NtDuplicateToken\n000000BA  7DE90AA4  NtEnableLastKnownGood\n000000BB  7DE90ABC  NtEnumerateBootEntries\n000000BC  7DE90AD4  NtEnumerateDriverEntries\n0000002F  7DE8FD4C  NtEnumerateKey\n000000BD  7DE90AEC  NtEnumerateSystemEnvironmentValuesEx\n000000BE  7DE90B04  NtEnumerateTransactionObject\n00000010  7DE8FA40  NtEnumerateValueKey\n000000BF  7DE90B1C  NtExtendSection\n000000C0  7DE90B34  NtFilterToken\n00000048  7DE8FFBC  NtFlushBuffersFile\n000000C1  7DE90B4C  NtFlushInstallUILanguage\n000000C4  7DE90B9C  NtFlushProcessWriteBuffers\n000000C5  7DE90BB4  NtFlushVirtualMemory\n000000C7  7DE90BE8  NtFreeUserPhysicalPages\n0000001B  7DE8FB58  NtFreeVirtualMemory\n000000C8  7DE90C00  NtFreezeRegistry\n000000C9  7DE90C18  NtFreezeTransactions\n000000CA  7DE90C30  NtGetContextThread\n000000CD  7DE90C80  NtGetMUIRegistryInfo\n000000CE  7DE90C98  NtGetNextProcess\n000000CF  7DE90CB0  NtGetNextThread\n000000D0  7DE90CC8  NtGetNlsSectionPtr\n000000D1  7DE90CE0  NtGetNotificationResourceManager\n000000D2  7DE90CF8  NtGetPlugPlayEvent\n000000D3  7DE90D10  NtGetWriteWatch\n000000D5  7DE90D44  NtImpersonateThread\n000000D6  7DE90D5C  NtInitializeNlsFiles\n000000D7  7DE90D74  NtInitializeRegistry\n000000DA  7DE90DC4  NtIsUILanguageComitted\n000000DB  7DE90DDC  NtListenPort\n000000DC  7DE90DF4  NtLoadDriver\n000000DD  7DE90E0C  NtLoadKey\n000000DE  7DE90E24  NtLoadKey2\n000000DF  7DE90E3C  NtLoadKeyEx\n000000E0  7DE90E54  NtLockFile\n000000E3  7DE90EA4  NtLockVirtualMemory\n000000E6  7DE90EF4  NtMapCMFModule\n00000025  7DE8FC50  NtMapViewOfSection\n000000E8  7DE90F28  NtModifyBootEntry\n000000E9  7DE90F40  NtModifyDriverEntry\n000000EA  7DE90F58  NtNotifyChangeDirectoryFile\n000000EB  7DE90F70  NtNotifyChangeKey\n000000EC  7DE90F88  NtNotifyChangeMultipleKeys\n000000ED  7DE90FA0  NtNotifyChangeSession\n00000055  7DE900FC  NtOpenDirectoryObject\n000000EE  7DE90FB8  NtOpenEnlistment\n0000003D  7DE8FEA8  NtOpenEvent\n000000EF  7DE90FD0  NtOpenEventPair\n00000030  7DE8FD64  NtOpenFile\n000000F0  7DE90FE8  NtOpenIoCompletion\n000000F1  7DE91000  NtOpenJobObject\n0000000F  7DE8FA28  NtOpenKey\n000000F2  7DE91018  NtOpenKeyEx\n000000F3  7DE91030  NtOpenKeyTransacted\n000000F4  7DE91048  NtOpenKeyTransactedEx\n000000F5  7DE91060  NtOpenKeyedEvent\n000000F6  7DE91078  NtOpenMutant\n000000F7  7DE91090  NtOpenObjectAuditAlarm\n000000F8  7DE910A8  NtOpenPrivateNamespace\n00000023  7DE8FC20  NtOpenProcess\n000000F9  7DE910C0  NtOpenProcessToken\n0000002D  7DE8FD18  NtOpenProcessTokenEx\n000000FA  7DE910D8  NtOpenResourceManager\n00000034  7DE8FDC8  NtOpenSection\n000000FB  7DE910F0  NtOpenSemaphore\n000000FC  7DE91108  NtOpenSession\n000000FD  7DE91120  NtOpenSymbolicLinkObject\n000000FE  7DE91138  NtOpenThread\n00000021  7DE8FBF0  NtOpenThreadToken\n0000002C  7DE8FD00  NtOpenThreadTokenEx\n000000FF  7DE91150  NtOpenTimer\n00000100  7DE91168  NtOpenTransaction\n00000101  7DE91180  NtOpenTransactionManager\n00000102  7DE91198  NtPlugPlayControl\n0000005C  7DE901AC  NtPowerInformation\n00000103  7DE911B0  NtPrePrepareComplete\n00000104  7DE911C8  NtPrePrepareEnlistment\n00000105  7DE911E0  NtPrepareComplete\n00000106  7DE911F8  NtPrepareEnlistment\n00000108  7DE9122C  NtPrivilegeObjectAuditAlarm\n00000109  7DE91244  NtPrivilegedServiceAuditAlarm\n0000010A  7DE9125C  NtPropagationComplete\n0000010B  7DE91274  NtPropagationFailed\n0000004D  7DE90038  NtProtectVirtualMemory\n0000003A  7DE8FE5C  NtQueryAttributesFile\n0000010D  7DE912A8  NtQueryBootEntryOrder\n0000010E  7DE912C0  NtQueryBootOptions\n00000032  7DE8FD98  NtQueryDirectoryFile\n00000110  7DE912F4  NtQueryDirectoryObject\n00000111  7DE9130C  NtQueryDriverEntryOrder\n00000112  7DE91324  NtQueryEaFile\n00000053  7DE900CC  NtQueryEvent\n00000113  7DE9133C  NtQueryFullAttributesFile\n00000114  7DE91354  NtQueryInformationAtom\n00000115  7DE9136C  NtQueryInformationEnlistment\n0000000E  7DE8FA10  NtQueryInformationFile\n00000116  7DE91384  NtQueryInformationJobObject\n00000117  7DE9139C  NtQueryInformationPort\n00000016  7DE8FAD8  NtQueryInformationProcess\n00000118  7DE913B4  NtQueryInformationResourceManager\n00000022  7DE8FC08  NtQueryInformationThread\n0000001E  7DE8FBA8  NtQueryInformationToken\n00000119  7DE913CC  NtQueryInformationTransaction\n0000011A  7DE913E4  NtQueryInformationTransactionManager\n0000011B  7DE913FC  NtQueryInformationWorkerFactory\n0000011E  7DE9144C  NtQueryIoCompletion\n00000013  7DE8FA90  NtQueryKey\n0000011F  7DE91464  NtQueryLicenseValue\n00000120  7DE9147C  NtQueryMultipleValueKey\n00000121  7DE91494  NtQueryMutant\n0000000D  7DE8F9F8  NtQueryObject\n00000122  7DE914AC  NtQueryOpenSubKeys\n00000123  7DE914C4  NtQueryOpenSubKeysEx\n00000125  7DE914F8  NtQueryQuotaInformationFile\n0000004E  7DE90050  NtQuerySection\n00000126  7DE91510  NtQuerySecurityAttributesToken\n00000127  7DE91528  NtQuerySecurityObject\n00000128  7DE91540  NtQuerySemaphore\n00000129  7DE91558  NtQuerySymbolicLinkObject\n0000012A  7DE91570  NtQuerySystemEnvironmentValue\n0000012B  7DE91588  NtQuerySystemEnvironmentValueEx\n00000033  7DE8FDB0  NtQuerySystemInformation\n0000012C  7DE915A0  NtQuerySystemInformationEx\n00000035  7DE8FDE0  NtQueryTimer\n00000014  7DE8FAA8  NtQueryValueKey\n00000020  7DE8FBD8  NtQueryVirtualMemory\n00000046  7DE8FF8C  NtQueryVolumeInformationFile\n00000042  7DE8FF24  NtQueueApcThread\n0000012E  7DE915D4  NtQueueApcThreadEx\n0000012F  7DE915EC  NtRaiseException\n00000130  7DE91604  NtRaiseHardError\n00000131  7DE9161C  NtReadOnlyEnlistment\n00000051  7DE9009C  NtReadRequestData\n0000003C  7DE8FE90  NtReadVirtualMemory\n00000132  7DE91634  NtRecoverEnlistment\n00000133  7DE9164C  NtRecoverResourceManager\n00000134  7DE91664  NtRecoverTransactionManager\n00000135  7DE9167C  NtRegisterProtocolAddressInformation\n00000138  7DE916CC  NtReleaseWorkerFactoryWorker\n00000139  7DE916E4  NtRemoveIoCompletionEx\n0000013B  7DE91718  NtRenameKey\n0000013C  7DE91730  NtRenameTransactionManager\n0000013D  7DE91748  NtReplaceKey\n0000013E  7DE91760  NtReplacePartitionUnit\n00000009  7DE8F994  NtReplyPort\n00000008  7DE8F97C  NtReplyWaitReceivePort\n00000028  7DE8FC98  NtReplyWaitReceivePortEx\n0000013F  7DE91778  NtReplyWaitReplyPort\n00000140  7DE91790  NtRequestPort\n0000001F  7DE8FBC0  NtRequestWaitReplyPort\n00000143  7DE917E0  NtRestoreKey\n00000145  7DE91814  NtRollbackComplete\n00000146  7DE9182C  NtRollbackEnlistment\n00000147  7DE91844  NtRollbackTransaction\n00000148  7DE9185C  NtRollforwardTransactionManager\n00000149  7DE91874  NtSaveKey\n0000014A  7DE9188C  NtSaveKeyEx\n0000014C  7DE918C0  NtSecureConnectPort\n0000014D  7DE918D8  NtSerializeBoot\n0000014E  7DE918F0  NtSetBootEntryOrder\n0000014F  7DE91908  NtSetBootOptions\n00000150  7DE91920  NtSetContextThread\n00000155  7DE919A8  NtSetDriverEntryOrder\n00000156  7DE919C0  NtSetEaFile\n00000159  7DE91A10  NtSetInformationDebugObject\n0000015A  7DE91A28  NtSetInformationEnlistment\n00000024  7DE8FC38  NtSetInformationFile\n0000015B  7DE91A40  NtSetInformationJobObject\n0000015C  7DE91A58  NtSetInformationKey\n00000059  7DE90164  NtSetInformationObject\n00000019  7DE8FB28  NtSetInformationProcess\n0000015D  7DE91A70  NtSetInformationResourceManager\n0000000A  7DE8F9AC  NtSetInformationThread\n0000015E  7DE91A88  NtSetInformationToken\n0000015F  7DE91AA0  NtSetInformationTransaction\n00000160  7DE91AB8  NtSetInformationTransactionManager\n00000161  7DE91AD0  NtSetInformationWorkerFactory\n00000163  7DE91B04  NtSetIoCompletion\n00000164  7DE91B1C  NtSetIoCompletionEx\n00000165  7DE91B34  NtSetLdtEntries\n00000168  7DE91B84  NtSetQuotaInformationFile\n00000169  7DE91B9C  NtSetSecurityObject\n0000016A  7DE91BB4  NtSetSystemEnvironmentValue\n0000016B  7DE91BCC  NtSetSystemEnvironmentValueEx\n0000016C  7DE91BE4  NtSetSystemInformation\n0000016D  7DE91BFC  NtSetSystemPowerState\n0000005F  7DE901F8  NtSetTimer\n00000170  7DE91C4C  NtSetTimerEx\n0000005D  7DE901C4  NtSetValueKey\n00000173  7DE91C9C  NtSetVolumeInformationFile\n00000175  7DE91CD0  NtShutdownWorkerFactory\n00000177  7DE91D04  NtSinglePhaseReject\n0000017C  7DE91D8C  NtSystemDebugControl\n00000029  7DE8FCB0  NtTerminateProcess\n00000050  7DE90084  NtTerminateThread\n0000017F  7DE91DDC  NtThawRegistry\n00000180  7DE91DF4  NtThawTransactions\n00000181  7DE91E0C  NtTraceControl\n0000005B  7DE90194  NtTraceEvent\n00000183  7DE91E40  NtUmsThreadYield\n00000184  7DE91E58  NtUnloadDriver\n00000185  7DE91E70  NtUnloadKey\n00000186  7DE91E88  NtUnloadKey2\n00000187  7DE91EA0  NtUnloadKeyEx\n00000188  7DE91EB8  NtUnlockFile\n00000189  7DE91ED0  NtUnlockVirtualMemory\n00000027  7DE8FC80  NtUnmapViewOfSection\n0000018A  7DE91EE8  NtVdmControl\n0000018B  7DE91F00  NtWaitForDebugEvent\n0000018D  7DE91F34  NtWaitForWorkViaWorkerFactory\n00000190  7DE91F84  NtWorkerFactoryWorkerReady\n000001A3  7DE9214C  NtWow64CallFunction64\n00000194  7DE91FE4  NtWow64CsrAllocateCaptureBuffer\n00000196  7DE92014  NtWow64CsrAllocateMessagePointer\n00000197  7DE9202C  NtWow64CsrCaptureMessageBuffer\n00000198  7DE92044  NtWow64CsrCaptureMessageString\n00000193  7DE91FCC  NtWow64CsrClientCallServer\n00000191  7DE91F9C  NtWow64CsrClientConnectToServer\n00000195  7DE91FFC  NtWow64CsrFreeCaptureBuffer\n00000199  7DE9205C  NtWow64CsrGetProcessId\n00000192  7DE91FB4  NtWow64CsrIdentifyAlertableThread\n0000019A  7DE92074  NtWow64CsrVerifyRegion\n0000019B  7DE9208C  NtWow64DebuggerCall\n0000019C  7DE920A4  NtWow64GetCurrentProcessorNumberEx\n0000019D  7DE920BC  NtWow64GetNativeSystemInformation\n0000019E  7DE920D4  NtWow64InterlockedPopEntrySList\n0000019F  7DE920EC  NtWow64QueryInformationProcess64\n000001A2  7DE92134  NtWow64QueryVirtualMemory64\n000001A0  7DE92104  NtWow64ReadVirtualMemory64\n000001A1  7DE9211C  NtWow64WriteVirtualMemory64\n00000054  7DE900E4  NtWriteRequestData\n00000037  7DE8FE14  NtWriteVirtualMemory\n0000019D  7DE920BC  RtlGetNativeSystemInformation\n00000060  7DE90210  ZwAcceptConnectPort\n00000061  7DE90228  ZwAccessCheck\n00000026  7DE8FC68  ZwAccessCheckAndAuditAlarm\n00000062  7DE90240  ZwAccessCheckByType\n00000056  7DE90114  ZwAccessCheckByTypeAndAuditAlarm\n00000063  7DE90258  ZwAccessCheckByTypeResultList\n00000064  7DE90270  ZwAccessCheckByTypeResultListAndAuditAlarm\n00000065  7DE90288  ZwAccessCheckByTypeResultListAndAuditAlarmByHandle\n00000066  7DE902A0  ZwAddBootEntry\n00000067  7DE902B8  ZwAddDriverEntry\n00000068  7DE902D0  ZwAdjustGroupsToken\n0000003E  7DE8FEC0  ZwAdjustPrivilegesToken\n0000006C  7DE9033C  ZwAllocateReserveObject\n0000006D  7DE90354  ZwAllocateUserPhysicalPages\n00000015  7DE8FAC0  ZwAllocateVirtualMemory\n0000006F  7DE90388  ZwAlpcAcceptConnectPort\n00000070  7DE903A0  ZwAlpcCancelMessage\n00000071  7DE903B8  ZwAlpcConnectPort\n00000072  7DE903D0  ZwAlpcCreatePort\n00000073  7DE903E8  ZwAlpcCreatePortSection\n00000074  7DE90400  ZwAlpcCreateResourceReserve\n00000075  7DE90418  ZwAlpcCreateSectionView\n00000076  7DE90430  ZwAlpcCreateSecurityContext\n00000077  7DE90448  ZwAlpcDeletePortSection\n00000078  7DE90460  ZwAlpcDeleteResourceReserve\n00000079  7DE90478  ZwAlpcDeleteSectionView\n0000007A  7DE90490  ZwAlpcDeleteSecurityContext\n0000007B  7DE904A8  ZwAlpcDisconnectPort\n0000007C  7DE904C0  ZwAlpcImpersonateClientOfPort\n0000007D  7DE904D8  ZwAlpcOpenSenderProcess\n0000007E  7DE904F0  ZwAlpcOpenSenderThread\n0000007F  7DE90508  ZwAlpcQueryInformation\n00000080  7DE90520  ZwAlpcQueryInformationMessage\n00000081  7DE90538  ZwAlpcRevokeSecurityContext\n00000082  7DE90550  ZwAlpcSendWaitReceivePort\n00000083  7DE90568  ZwAlpcSetInformation\n00000049  7DE8FFD4  ZwApphelpCacheControl\n00000002  7DE8F8D8  ZwCallbackReturn\n0000005A  7DE9017C  ZwCancelIoFile\n00000086  7DE905B8  ZwCancelIoFileEx\n00000087  7DE905D0  ZwCancelSynchronousIoFile\n0000000C  7DE8F9E0  ZwClose\n00000038  7DE8FE2C  ZwCloseObjectAuditAlarm\n00000088  7DE905E8  ZwCommitComplete\n00000089  7DE90600  ZwCommitEnlistment\n0000008A  7DE90618  ZwCommitTransaction\n0000008B  7DE90630  ZwCompactKeys\n0000008C  7DE90648  ZwCompareTokens\n0000008D  7DE90660  ZwCompleteConnectPort\n0000008F  7DE90694  ZwConnectPort\n00000040  7DE8FEF0  ZwContinue\n00000090  7DE906AC  ZwCreateDebugObject\n00000091  7DE906C4  ZwCreateDirectoryObject\n00000092  7DE906DC  ZwCreateEnlistment\n00000045  7DE8FF74  ZwCreateEvent\n00000093  7DE906F4  ZwCreateEventPair\n00000052  7DE900B4  ZwCreateFile\n00000094  7DE9070C  ZwCreateIoCompletion\n00000095  7DE90724  ZwCreateJobObject\n00000096  7DE9073C  ZwCreateJobSet\n0000001A  7DE8FB40  ZwCreateKey\n00000097  7DE90754  ZwCreateKeyTransacted\n00000098  7DE9076C  ZwCreateKeyedEvent\n00000099  7DE90784  ZwCreateMailslotFile\n0000009A  7DE9079C  ZwCreateMutant\n0000009B  7DE907B4  ZwCreateNamedPipeFile\n0000009C  7DE907CC  ZwCreatePagingFile\n0000009D  7DE907E4  ZwCreatePort\n0000009E  7DE907FC  ZwCreatePrivateNamespace\n0000009F  7DE90814  ZwCreateProcess\n0000004A  7DE8FFEC  ZwCreateProcessEx\n000000A0  7DE9082C  ZwCreateProfile\n000000A1  7DE90844  ZwCreateProfileEx\n000000A2  7DE9085C  ZwCreateResourceManager\n00000047  7DE8FFA4  ZwCreateSection\n000000A3  7DE90874  ZwCreateSemaphore\n000000A4  7DE9088C  ZwCreateSymbolicLinkObject\n0000004B  7DE90004  ZwCreateThread\n000000A5  7DE908A4  ZwCreateThreadEx\n000000A6  7DE908BC  ZwCreateTimer\n000000A7  7DE908D4  ZwCreateToken\n000000A8  7DE908EC  ZwCreateTransaction\n000000A9  7DE90904  ZwCreateTransactionManager\n000000AA  7DE9091C  ZwCreateUserProcess\n000000AB  7DE90934  ZwCreateWaitablePort\n000000AC  7DE9094C  ZwCreateWorkerFactory\n000000AE  7DE90980  ZwDebugContinue\n000000B0  7DE909B4  ZwDeleteBootEntry\n000000B1  7DE909CC  ZwDeleteDriverEntry\n000000B2  7DE909E4  ZwDeleteFile\n000000B3  7DE909FC  ZwDeleteKey\n000000B4  7DE90A14  ZwDeleteObjectAuditAlarm\n000000B5  7DE90A2C  ZwDeletePrivateNamespace\n000000B6  7DE90A44  ZwDeleteValueKey\n000000B7  7DE90A5C  ZwDisableLastKnownGood\n000000B8  7DE90A74  ZwDisplayString\n000000B9  7DE90A8C  ZwDrawText\n00000039  7DE8FE44  ZwDuplicateObject\n0000003F  7DE8FED8  ZwDuplicateToken\n000000BA  7DE90AA4  ZwEnableLastKnownGood\n000000BB  7DE90ABC  ZwEnumerateBootEntries\n000000BC  7DE90AD4  ZwEnumerateDriverEntries\n0000002F  7DE8FD4C  ZwEnumerateKey\n000000BD  7DE90AEC  ZwEnumerateSystemEnvironmentValuesEx\n000000BE  7DE90B04  ZwEnumerateTransactionObject\n00000010  7DE8FA40  ZwEnumerateValueKey\n000000BF  7DE90B1C  ZwExtendSection\n000000C0  7DE90B34  ZwFilterToken\n00000048  7DE8FFBC  ZwFlushBuffersFile\n000000C1  7DE90B4C  ZwFlushInstallUILanguage\n000000C4  7DE90B9C  ZwFlushProcessWriteBuffers\n000000C5  7DE90BB4  ZwFlushVirtualMemory\n000000C7  7DE90BE8  ZwFreeUserPhysicalPages\n0000001B  7DE8FB58  ZwFreeVirtualMemory\n000000C8  7DE90C00  ZwFreezeRegistry\n000000C9  7DE90C18  ZwFreezeTransactions\n000000CA  7DE90C30  ZwGetContextThread\n000000CD  7DE90C80  ZwGetMUIRegistryInfo\n000000CE  7DE90C98  ZwGetNextProcess\n000000CF  7DE90CB0  ZwGetNextThread\n000000D0  7DE90CC8  ZwGetNlsSectionPtr\n000000D1  7DE90CE0  ZwGetNotificationResourceManager\n000000D2  7DE90CF8  ZwGetPlugPlayEvent\n000000D3  7DE90D10  ZwGetWriteWatch\n000000D5  7DE90D44  ZwImpersonateThread\n000000D6  7DE90D5C  ZwInitializeNlsFiles\n000000D7  7DE90D74  ZwInitializeRegistry\n000000DA  7DE90DC4  ZwIsUILanguageComitted\n000000DB  7DE90DDC  ZwListenPort\n000000DC  7DE90DF4  ZwLoadDriver\n000000DD  7DE90E0C  ZwLoadKey\n000000DE  7DE90E24  ZwLoadKey2\n000000DF  7DE90E3C  ZwLoadKeyEx\n000000E0  7DE90E54  ZwLockFile\n000000E3  7DE90EA4  ZwLockVirtualMemory\n000000E6  7DE90EF4  ZwMapCMFModule\n00000025  7DE8FC50  ZwMapViewOfSection\n000000E8  7DE90F28  ZwModifyBootEntry\n000000E9  7DE90F40  ZwModifyDriverEntry\n000000EA  7DE90F58  ZwNotifyChangeDirectoryFile\n000000EB  7DE90F70  ZwNotifyChangeKey\n000000EC  7DE90F88  ZwNotifyChangeMultipleKeys\n000000ED  7DE90FA0  ZwNotifyChangeSession\n00000055  7DE900FC  ZwOpenDirectoryObject\n000000EE  7DE90FB8  ZwOpenEnlistment\n0000003D  7DE8FEA8  ZwOpenEvent\n000000EF  7DE90FD0  ZwOpenEventPair\n00000030  7DE8FD64  ZwOpenFile\n000000F0  7DE90FE8  ZwOpenIoCompletion\n000000F1  7DE91000  ZwOpenJobObject\n0000000F  7DE8FA28  ZwOpenKey\n000000F2  7DE91018  ZwOpenKeyEx\n000000F3  7DE91030  ZwOpenKeyTransacted\n000000F4  7DE91048  ZwOpenKeyTransactedEx\n000000F5  7DE91060  ZwOpenKeyedEvent\n000000F6  7DE91078  ZwOpenMutant\n000000F7  7DE91090  ZwOpenObjectAuditAlarm\n000000F8  7DE910A8  ZwOpenPrivateNamespace\n00000023  7DE8FC20  ZwOpenProcess\n000000F9  7DE910C0  ZwOpenProcessToken\n0000002D  7DE8FD18  ZwOpenProcessTokenEx\n000000FA  7DE910D8  ZwOpenResourceManager\n00000034  7DE8FDC8  ZwOpenSection\n000000FB  7DE910F0  ZwOpenSemaphore\n000000FC  7DE91108  ZwOpenSession\n000000FD  7DE91120  ZwOpenSymbolicLinkObject\n000000FE  7DE91138  ZwOpenThread\n00000021  7DE8FBF0  ZwOpenThreadToken\n0000002C  7DE8FD00  ZwOpenThreadTokenEx\n000000FF  7DE91150  ZwOpenTimer\n00000100  7DE91168  ZwOpenTransaction\n00000101  7DE91180  ZwOpenTransactionManager\n00000102  7DE91198  ZwPlugPlayControl\n0000005C  7DE901AC  ZwPowerInformation\n00000103  7DE911B0  ZwPrePrepareComplete\n00000104  7DE911C8  ZwPrePrepareEnlistment\n00000105  7DE911E0  ZwPrepareComplete\n00000106  7DE911F8  ZwPrepareEnlistment\n00000108  7DE9122C  ZwPrivilegeObjectAuditAlarm\n00000109  7DE91244  ZwPrivilegedServiceAuditAlarm\n0000010A  7DE9125C  ZwPropagationComplete\n0000010B  7DE91274  ZwPropagationFailed\n0000004D  7DE90038  ZwProtectVirtualMemory\n0000003A  7DE8FE5C  ZwQueryAttributesFile\n0000010D  7DE912A8  ZwQueryBootEntryOrder\n0000010E  7DE912C0  ZwQueryBootOptions\n00000032  7DE8FD98  ZwQueryDirectoryFile\n00000110  7DE912F4  ZwQueryDirectoryObject\n00000111  7DE9130C  ZwQueryDriverEntryOrder\n00000112  7DE91324  ZwQueryEaFile\n00000053  7DE900CC  ZwQueryEvent\n00000113  7DE9133C  ZwQueryFullAttributesFile\n00000114  7DE91354  ZwQueryInformationAtom\n00000115  7DE9136C  ZwQueryInformationEnlistment\n0000000E  7DE8FA10  ZwQueryInformationFile\n00000116  7DE91384  ZwQueryInformationJobObject\n00000117  7DE9139C  ZwQueryInformationPort\n00000016  7DE8FAD8  ZwQueryInformationProcess\n00000118  7DE913B4  ZwQueryInformationResourceManager\n00000022  7DE8FC08  ZwQueryInformationThread\n0000001E  7DE8FBA8  ZwQueryInformationToken\n00000119  7DE913CC  ZwQueryInformationTransaction\n0000011A  7DE913E4  ZwQueryInformationTransactionManager\n0000011B  7DE913FC  ZwQueryInformationWorkerFactory\n0000011E  7DE9144C  ZwQueryIoCompletion\n00000013  7DE8FA90  ZwQueryKey\n0000011F  7DE91464  ZwQueryLicenseValue\n00000120  7DE9147C  ZwQueryMultipleValueKey\n00000121  7DE91494  ZwQueryMutant\n0000000D  7DE8F9F8  ZwQueryObject\n00000122  7DE914AC  ZwQueryOpenSubKeys\n00000123  7DE914C4  ZwQueryOpenSubKeysEx\n00000125  7DE914F8  ZwQueryQuotaInformationFile\n0000004E  7DE90050  ZwQuerySection\n00000126  7DE91510  ZwQuerySecurityAttributesToken\n00000127  7DE91528  ZwQuerySecurityObject\n00000128  7DE91540  ZwQuerySemaphore\n00000129  7DE91558  ZwQuerySymbolicLinkObject\n0000012A  7DE91570  ZwQuerySystemEnvironmentValue\n0000012B  7DE91588  ZwQuerySystemEnvironmentValueEx\n00000033  7DE8FDB0  ZwQuerySystemInformation\n0000012C  7DE915A0  ZwQuerySystemInformationEx\n00000035  7DE8FDE0  ZwQueryTimer\n00000014  7DE8FAA8  ZwQueryValueKey\n00000020  7DE8FBD8  ZwQueryVirtualMemory\n00000046  7DE8FF8C  ZwQueryVolumeInformationFile\n00000042  7DE8FF24  ZwQueueApcThread\n0000012E  7DE915D4  ZwQueueApcThreadEx\n0000012F  7DE915EC  ZwRaiseException\n00000130  7DE91604  ZwRaiseHardError\n00000131  7DE9161C  ZwReadOnlyEnlistment\n00000051  7DE9009C  ZwReadRequestData\n0000003C  7DE8FE90  ZwReadVirtualMemory\n00000132  7DE91634  ZwRecoverEnlistment\n00000133  7DE9164C  ZwRecoverResourceManager\n00000134  7DE91664  ZwRecoverTransactionManager\n00000135  7DE9167C  ZwRegisterProtocolAddressInformation\n00000138  7DE916CC  ZwReleaseWorkerFactoryWorker\n00000139  7DE916E4  ZwRemoveIoCompletionEx\n0000013B  7DE91718  ZwRenameKey\n0000013C  7DE91730  ZwRenameTransactionManager\n0000013D  7DE91748  ZwReplaceKey\n0000013E  7DE91760  ZwReplacePartitionUnit\n00000009  7DE8F994  ZwReplyPort\n00000008  7DE8F97C  ZwReplyWaitReceivePort\n00000028  7DE8FC98  ZwReplyWaitReceivePortEx\n0000013F  7DE91778  ZwReplyWaitReplyPort\n00000140  7DE91790  ZwRequestPort\n0000001F  7DE8FBC0  ZwRequestWaitReplyPort\n00000143  7DE917E0  ZwRestoreKey\n00000145  7DE91814  ZwRollbackComplete\n00000146  7DE9182C  ZwRollbackEnlistment\n00000147  7DE91844  ZwRollbackTransaction\n00000148  7DE9185C  ZwRollforwardTransactionManager\n00000149  7DE91874  ZwSaveKey\n0000014A  7DE9188C  ZwSaveKeyEx\n0000014C  7DE918C0  ZwSecureConnectPort\n0000014D  7DE918D8  ZwSerializeBoot\n0000014E  7DE918F0  ZwSetBootEntryOrder\n0000014F  7DE91908  ZwSetBootOptions\n00000150  7DE91920  ZwSetContextThread\n00000155  7DE919A8  ZwSetDriverEntryOrder\n00000156  7DE919C0  ZwSetEaFile\n00000159  7DE91A10  ZwSetInformationDebugObject\n0000015A  7DE91A28  ZwSetInformationEnlistment\n00000024  7DE8FC38  ZwSetInformationFile\n0000015B  7DE91A40  ZwSetInformationJobObject\n0000015C  7DE91A58  ZwSetInformationKey\n00000059  7DE90164  ZwSetInformationObject\n00000019  7DE8FB28  ZwSetInformationProcess\n0000015D  7DE91A70  ZwSetInformationResourceManager\n0000000A  7DE8F9AC  ZwSetInformationThread\n0000015E  7DE91A88  ZwSetInformationToken\n0000015F  7DE91AA0  ZwSetInformationTransaction\n00000160  7DE91AB8  ZwSetInformationTransactionManager\n00000161  7DE91AD0  ZwSetInformationWorkerFactory\n00000163  7DE91B04  ZwSetIoCompletion\n00000164  7DE91B1C  ZwSetIoCompletionEx\n00000165  7DE91B34  ZwSetLdtEntries\n00000168  7DE91B84  ZwSetQuotaInformationFile\n00000169  7DE91B9C  ZwSetSecurityObject\n0000016A  7DE91BB4  ZwSetSystemEnvironmentValue\n0000016B  7DE91BCC  ZwSetSystemEnvironmentValueEx\n0000016C  7DE91BE4  ZwSetSystemInformation\n0000016D  7DE91BFC  ZwSetSystemPowerState\n0000005F  7DE901F8  ZwSetTimer\n00000170  7DE91C4C  ZwSetTimerEx\n0000005D  7DE901C4  ZwSetValueKey\n00000173  7DE91C9C  ZwSetVolumeInformationFile\n00000175  7DE91CD0  ZwShutdownWorkerFactory\n00000177  7DE91D04  ZwSinglePhaseReject\n0000017C  7DE91D8C  ZwSystemDebugControl\n00000029  7DE8FCB0  ZwTerminateProcess\n00000050  7DE90084  ZwTerminateThread\n0000017F  7DE91DDC  ZwThawRegistry\n00000180  7DE91DF4  ZwThawTransactions\n00000181  7DE91E0C  ZwTraceControl\n0000005B  7DE90194  ZwTraceEvent\n00000183  7DE91E40  ZwUmsThreadYield\n00000184  7DE91E58  ZwUnloadDriver\n00000185  7DE91E70  ZwUnloadKey\n00000186  7DE91E88  ZwUnloadKey2\n00000187  7DE91EA0  ZwUnloadKeyEx\n00000188  7DE91EB8  ZwUnlockFile\n00000189  7DE91ED0  ZwUnlockVirtualMemory\n00000027  7DE8FC80  ZwUnmapViewOfSection\n0000018A  7DE91EE8  ZwVdmControl\n0000018B  7DE91F00  ZwWaitForDebugEvent\n0000018D  7DE91F34  ZwWaitForWorkViaWorkerFactory\n00000190  7DE91F84  ZwWorkerFactoryWorkerReady\n000001A3  7DE9214C  ZwWow64CallFunction64\n00000194  7DE91FE4  ZwWow64CsrAllocateCaptureBuffer\n00000196  7DE92014  ZwWow64CsrAllocateMessagePointer\n00000197  7DE9202C  ZwWow64CsrCaptureMessageBuffer\n00000198  7DE92044  ZwWow64CsrCaptureMessageString\n00000193  7DE91FCC  ZwWow64CsrClientCallServer\n00000191  7DE91F9C  ZwWow64CsrClientConnectToServer\n00000195  7DE91FFC  ZwWow64CsrFreeCaptureBuffer\n00000199  7DE9205C  ZwWow64CsrGetProcessId\n00000192  7DE91FB4  ZwWow64CsrIdentifyAlertableThread\n0000019A  7DE92074  ZwWow64CsrVerifyRegion\n0000019B  7DE9208C  ZwWow64DebuggerCall\n0000019C  7DE920A4  ZwWow64GetCurrentProcessorNumberEx\n0000019D  7DE920BC  ZwWow64GetNativeSystemInformation\n0000019E  7DE920D4  ZwWow64InterlockedPopEntrySList\n0000019F  7DE920EC  ZwWow64QueryInformationProcess64\n000001A2  7DE92134  ZwWow64QueryVirtualMemory64\n000001A0  7DE92104  ZwWow64ReadVirtualMemory64\n000001A1  7DE9211C  ZwWow64WriteVirtualMemory64\n00000054  7DE900E4  ZwWriteRequestData\n00000037  7DE8FE14  ZwWriteVirtualMemory\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eEnjoy :)\u003c/p\u003e\n\u003c/div\u003e",
  "Date": "2014-02-11T14:28:00Z",
  "Author": "Simone Margaritelli"
}